<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="持续精进">
<meta property="og:type" content="website">
<meta property="og:title" content="Jay&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jay&#39;s Blog">
<meta property="og:description" content="持续精进">
<meta property="og:locale">
<meta property="article:author" content="史海杰">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Jay's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1dc984dfc86062a60470cc7297fb0653";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jay's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">知而不行为不知</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/12/20/pandas%E4%B8%8Emysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/12/20/pandas%E4%B8%8Emysql/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-12-20T10:13:22+08:00">
                2024-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2024/12/20/pandas%E4%B8%8Emysql/" class="leancloud_visitors" data-flag-title="">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  23 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://mp.weixin.qq.com/s?__biz=MzI2MjE3OTA1MA==&amp;mid=2247488879&amp;idx=1&amp;sn=a3c9edf4009c9b0b896695aaca9d89c4&amp;chksm=ea4e44eadd39cdfceeb9332c6b373a5a5fd2b54667c4ef5fa37323bc39a9b7aa95e4334c592a&amp;scene=27">https://mp.weixin.qq.com/s?__biz=MzI2MjE3OTA1MA==&amp;mid=2247488879&amp;idx=1&amp;sn=a3c9edf4009c9b0b896695aaca9d89c4&amp;chksm=ea4e44eadd39cdfceeb9332c6b373a5a5fd2b54667c4ef5fa37323bc39a9b7aa95e4334c592a&amp;scene=27</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/12/03/%E8%AE%A1%E7%AE%97%E4%B9%8B%E9%AD%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/12/03/%E8%AE%A1%E7%AE%97%E4%B9%8B%E9%AD%82/" itemprop="url">《计算机之魂》核心要点整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-12-03T22:13:16+08:00">
                2024-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B9%A6/" itemprop="url" rel="index">
                    <span itemprop="name">书</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/12/03/%E8%AE%A1%E7%AE%97%E4%B9%8B%E9%AD%82/" class="leancloud_visitors" data-flag-title="《计算机之魂》核心要点整理">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  911 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="《计算机之魂》核心要点整理"><a href="#《计算机之魂》核心要点整理" class="headerlink" title="《计算机之魂》核心要点整理"></a>《计算机之魂》核心要点整理</h1><h2 id="核心思维与原则"><a href="#核心思维与原则" class="headerlink" title="核心思维与原则"></a>核心思维与原则</h2><h3 id="计算机思维的核心概念"><a href="#计算机思维的核心概念" class="headerlink" title="计算机思维的核心概念"></a>计算机思维的核心概念</h3><ul>
<li><strong>递归</strong>：通过函数调用自身来解决问题，通常用于分解复杂问题为更小的子问题。</li>
<li><strong>分治</strong>：将一个问题分解为多个较小规模的问题，分别求解后合并结果。</li>
</ul>
<h3 id="关键原则"><a href="#关键原则" class="headerlink" title="关键原则"></a>关键原则</h3><h4 id="等价性原理"><a href="#等价性原理" class="headerlink" title="等价性原理"></a>等价性原理</h4><ul>
<li><strong>等价转换</strong>：如书中P310所述，交换变量x和y的方法展示了如何利用等价性进行巧妙编程。例如，<code>x, x-1, 2x</code>在某些情况下是等价的。</li>
<li><strong>应用</strong>：等价性常用于将复杂状态简化，并间接解决难题，有助于归类和简化问题处理。</li>
</ul>
<h4 id="抽象化"><a href="#抽象化" class="headerlink" title="抽象化"></a>抽象化</h4><ul>
<li><strong>模型构建</strong>：使用数学模型、数据结构或编码方式将现实问题转化为可计算的形式。</li>
<li><strong>示例</strong>：从具体问题中抽象出不同的状态，并理解它们之间的转换关系。</li>
</ul>
<h4 id="平衡艺术"><a href="#平衡艺术" class="headerlink" title="平衡艺术"></a>平衡艺术</h4><ul>
<li><strong>精度与范围</strong>：计算机表示浮点数时需平衡数值精度和表达范围，采用近似值以适应存储限制。</li>
<li><strong>权衡策略</strong>：在不同场景下（如粗调+精调）做出适当的权衡，确保效率与效果的最优结合。</li>
</ul>
<h4 id="分类逻辑"><a href="#分类逻辑" class="headerlink" title="分类逻辑"></a>分类逻辑</h4><ul>
<li><strong>智能问题的本质</strong>：很多问题可以归结为分类问题，包括分类、组织、查找和重组。</li>
<li><strong>桥梁理论</strong>：第一座桥梁是将实际问题转换为信息处理中的分类问题；第二座桥梁是解决这些分类问题。</li>
<li><strong>集合边界确认</strong>：<ul>
<li><strong>二叉判断</strong>：如二分决策树、M叉树（如B+树）。</li>
<li><strong>枚举元素</strong>：如哈希表直接列出集合中的成员。</li>
</ul>
</li>
</ul>
<h2 id="存储理论和技术"><a href="#存储理论和技术" class="headerlink" title="存储理论和技术"></a>存储理论和技术</h2><h3 id="数据访问模式"><a href="#数据访问模式" class="headerlink" title="数据访问模式"></a>数据访问模式</h3><ul>
<li><strong>特点导向</strong>：根据数据使用特点（顺序访问&#x2F;随机访问）和获取量（大量&#x2F;单个）选择合适的存储设备。</li>
<li><strong>层次结构</strong>：围绕存储系统的层次展开讨论，考虑缓存、内存、磁盘等不同层级的作用。</li>
</ul>
<h3 id="多路归并与排序算法"><a href="#多路归并与排序算法" class="headerlink" title="多路归并与排序算法"></a>多路归并与排序算法</h3><ul>
<li><strong>多路归并</strong>：用于处理n个有序序列的合并问题，如找出前几名元素。</li>
<li><strong>快速排序分割</strong>：适用于解决中值问题或比例划分问题。</li>
</ul>
<h2 id="图论及其应用"><a href="#图论及其应用" class="headerlink" title="图论及其应用"></a>图论及其应用</h2><h3 id="图的基本概念"><a href="#图的基本概念" class="headerlink" title="图的基本概念"></a>图的基本概念</h3><ul>
<li><strong>点与线的关系</strong>：图是对离散、有限集合元素间关系的描述，广泛应用于最短路径、最大流、匹配等问题。</li>
</ul>
<h3 id="图的遍历方法"><a href="#图的遍历方法" class="headerlink" title="图的遍历方法"></a>图的遍历方法</h3><ul>
<li><strong>深度优先遍历</strong>：生成图的生成树，探索所有可能路径。</li>
<li><strong>连通性分析</strong>：检查图中节点间的可达性。</li>
</ul>
<h3 id="最短路径与最大流"><a href="#最短路径与最大流" class="headerlink" title="最短路径与最大流"></a>最短路径与最大流</h3><ul>
<li><strong>动态规划</strong>：一种常用算法，用于求解最短路径问题。</li>
<li><strong>等价问题</strong>：最大流问题与最大配对问题在一定条件下是等价的。</li>
</ul>
<h2 id="确定性与随机性"><a href="#确定性与随机性" class="headerlink" title="确定性与随机性"></a>确定性与随机性</h2><h3 id="概率算法的应用"><a href="#概率算法的应用" class="headerlink" title="概率算法的应用"></a>概率算法的应用</h3><ul>
<li><strong>世界本质</strong>：不确定性是固有的，概率算法能够有效应对这种特性。</li>
<li><strong>量子通信安全</strong>：依赖于随机性来保证安全性。</li>
<li><strong>置信度权衡</strong>：在成本与效果之间寻找最佳平衡点。</li>
</ul>
<h2 id="排序优化"><a href="#排序优化" class="headerlink" title="排序优化"></a>排序优化</h2><h3 id="蒂姆排序（Timsort）"><a href="#蒂姆排序（Timsort）" class="headerlink" title="蒂姆排序（Timsort）"></a>蒂姆排序（Timsort）</h3><ul>
<li><strong>混合排序法</strong>：结合了插入排序（节省内存）和归并排序（节省时间）的优点，是一种高效的排序算法。</li>
</ul>
<h2 id="数学特性"><a href="#数学特性" class="headerlink" title="数学特性"></a>数学特性</h2><h3 id="对数函数特征"><a href="#对数函数特征" class="headerlink" title="对数函数特征"></a>对数函数特征</h3><ul>
<li><strong>分辨率变化</strong>：对数函数对较小数字提供高分辨率，而对较大数字则分辨率较低，这反映了其非线性的增长模式。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/11/13/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/13/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/" itemprop="url">进程、线程、协程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-13T22:39:07+08:00">
                2024-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">计算机基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/11/13/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/" class="leancloud_visitors" data-flag-title="进程、线程、协程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考<a href="https://blog.csdn.net/xushiyu1996818/article/details/106590789">https://blog.csdn.net/xushiyu1996818/article/details/106590789</a></p>
<p>同一个进程内的线程切换比进程切换快，</strong>因为线程具有相同的地址空间（虚拟内存共享），这意味着同一个进程的线程都具有同一个页表，那么在<strong>切换的时候不需要切换页表</strong>。而对于进程之间的切换，切换的时候要把<em><strong>页表</strong></em>给切换掉，而页表的切换过程开销是比较大的；</p>
<p><img src="https://img-blog.csdnimg.cn/202108251216575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBAeHVzaGl5dTE5OTY4MTg=,size_26,color_FFFFFF,t_70,g_se,x_16"></p>
<p>进程上下文 操作系统中把进程物理实体和支持进程运行的环境合称为进程上下文。</p>
<p>进程在其当前上下文中运行，当系统调度新进程占有处理器时，新老进程随之发生上下文切换。即保存老进程状态而装入被保护了的新进程的状态，以便新进程运行</p>
<p>进程上下文组成<br>用户级上下文：由正文（程序）、数据、共享存储区、用户栈组成，占用进程的虚地址空间。</p>
<p>存器上下文：由程序状态字寄存器、指令计数器、栈指针、控制寄存器、通用寄存器等组成。</p>
<p>系统级上下文：由进程控制块、主存管理信息（页表或段表）、核心栈等组成。</p>
<p>CPU 上下文切换<br>大多数操作系统都是多任务，通常支持大于 CPU 数量的任务同时运行。实际上，这些任务并不是同时运行的，只是因为系统在很短的时间内，让各个任务分别在 CPU 运行，于是就造成同时运行的错误。</p>
<p>任务是交给 CPU 运行的，那么在每个任务运行前，CPU 需要知道任务从哪里加载，又从哪里开始运行。</p>
<p>所以，操作系统需要事先帮 CPU 设置好 CPU 寄存器和程序计数器。</p>
<p>CPU 寄存器是 CPU 内部一个容量小，但是速度极快的内存（缓存）。我举个例子，寄存器像是你的口袋，内存像你的书包，硬盘则是你家里的柜子，如果你的东西存放到口袋，那肯定是比你从书包或家里柜子取出来要快的多。</p>
<p>再来，程序计数器则是用来存储 CPU 正在执行的指令位置、或者即将执行的下一条指令位置。</p>
<p>所以说，CPU 寄存器和程序计数是 CPU 在运行任何任务前，所必须依赖的环境，这些环境就叫做 CPU 上下文。</p>
<p>既然知道了什么是 CPU 上下文，那理解 CPU 上下文切换就不难了。</p>
<p>CPU 上下文切换就是先把前一个任务的 CPU 上下文（CPU 寄存器和程序计数器）保存起来，然后加载新任务的上下文到这些寄存器和程序计数器，最后再跳转到程序计数器所指的新位置，运行新任务。</p>
<p>系统内核会存储保持下来的上下文信息，当此任务再次被分配给 CPU 运行时，CPU 会重新加载这些上下文，这样就能保证任务原来的状态不受影响，让任务看起来还是连续运行。</p>
<p>上面说到所谓的「任务」，主要包含进程、线程和中断。所以，可以根据任务的不同，***&#x3D;&#x3D;把 CPU 上下文切换分成：进程上下文切换、线程上下文切换和中断上下文切换。&#x3D;&#x3D;***</p>
<p>进程的上下文切换到底是切换什么呢？<br>进程是由内核管理和调度的，所以进程的切换只能发生在内核态。</p>
<p>所以，进程的上下文切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的资源。</p>
<p>通常，会把交换的信息保存在进程的 PCB，当要运行另外一个进程的时候，我们需要从这个进程的 PCB 取出上下文，然后恢复到 CPU 中，这使得这个进程可以继续执行，如下图所示：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/2da0fb4c075c772cde0c089a2ccbc8f8.png"></p>
<p>大家需要注意，进程的上下文开销是很关键的，我们希望它的开销越小越好，这样可以使得进程可以把更多时间花费在执行程序上，而不是耗费在上下文切换。</p>
<p>原文链接：<a href="https://blog.csdn.net/xushiyu1996818/article/details/106590789">https://blog.csdn.net/xushiyu1996818/article/details/106590789</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/11/13/%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%8C%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E8%87%AA%E5%8A%A8%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/13/%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%8C%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E8%87%AA%E5%8A%A8%E6%9C%BA/" itemprop="url">自动机，状态机，有限自动机，有限状态机，有限状态自动机</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-13T22:14:56+08:00">
                2024-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">计算机基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/11/13/%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%8C%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%8C%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E8%87%AA%E5%8A%A8%E6%9C%BA/" class="leancloud_visitors" data-flag-title="自动机，状态机，有限自动机，有限状态机，有限状态自动机">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  52 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://blog.csdn.net/c601097836/article/details/47040703">自动机，状态机，有限自动机，有限状态机，有限状态自动机，非确定下有限状态自动，确定性有限状态自动机的区别于联系-CSDN博客</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/11/13/%E5%9B%9E%E6%BA%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/13/%E5%9B%9E%E6%BA%AF/" itemprop="url">回溯</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-13T19:56:39+08:00">
                2024-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/11/13/%E5%9B%9E%E6%BA%AF/" class="leancloud_visitors" data-flag-title="回溯">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  553 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h1><p>回溯其实就是暴力搜索，其思路是dfs。</p>
<p>回溯法思路的简单描述是：把问题的解空间转化成了图或者树的结构表示，然后使用**深度优先搜索策略**进行遍历，遍历的过程中记录和寻找所有可行解或者最优解。</p>
<h1 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h1><p>解空间树分为两种：**子集树和排列树**。两种在算法结构和思路上大体相同。</p>
<p>排列就是遍历所有空间，需要标记是否遍历过；for(i&#x3D;0)</p>
<p>组合和子集其实是一类问题，只用遍历同一层还没遍历的，因此可以省去标记，for(i&#x3D;start)</p>
<p>不同的是子集问题是，只要遍历一个点，就将当前符合要求的路径添加到最终答案中。</p>
<h1 id="回溯法模板："><a href="#回溯法模板：" class="headerlink" title="回溯法模板："></a>回溯法模板：</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(参数)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (终止条件) &#123;</span><br><span class="line">        存放结果;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//其实就是遍历与其相连的所有节点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (选择：本层集合中元素（树中节点孩子的数量就是集合的大小）) &#123;</span><br><span class="line"></span><br><span class="line">      判断是否处理过</span><br><span class="line"></span><br><span class="line">        处理节点;</span><br><span class="line"></span><br><span class="line">      记录状态、遍历过与否的标记</span><br><span class="line"></span><br><span class="line">        backtrack(路径，选择列表); <span class="comment">// 递归</span></span><br><span class="line">        回溯，撤销处理结果，回退状态、遍历过与否的标记</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="对于需要去重的回溯问题："><a href="#对于需要去重的回溯问题：" class="headerlink" title="对于需要去重的回溯问题："></a>对于需要去重的回溯问题：</h2><p>（1）排列：</p>
<p>for(int i &#x3D; 0; i &lt; nums.length; i++){</p>
<p>            &#x2F;&#x2F;若在同一层已经遍历过（就是循环过了），则跳过这次</p>
<p>            if(i &gt; 1 &amp;&amp; nums[i] &#x3D;&#x3D; nums[i-1] &amp;&amp; !used[i - 1]) continue;</p>
<p> </p>
<p>（2）子集和组合：</p>
<p>for(inti&#x3D;start;i&lt;nums.length;i++){</p>
<p>if(i&gt;start&amp;&amp;nums[i]&#x3D;&#x3D;nums[i-1])continue;</p>
<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>当问题是要求满足某种性质（约束条件）的所有解或最优解时，往往使用回溯法。<br>它有“通用解题法”之美誉。</p>
<ol>
<li>子集问题lc78，lc90</li>
<li>排列问题lc46，lc47</li>
<li>组合求和问题lc39，40，216</li>
<li>分割回文串lc131</li>
<li>阿里快递最短路alibaba（DFS）</li>
<li>组合问题lc77【lc77中有对回溯法的优化，即剪枝】，lc401</li>
<li>二维平面上使用回溯法 lc79</li>
<li>floodfill lc200（岛屿的个数），130，417</li>
<li>N皇后问题lc51</li>
<li>数独问题lc37</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/11/10/%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E9%80%9A%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/10/%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E9%80%9A%E8%A7%A3/" itemprop="url">股票问题通解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-10T20:26:50+08:00">
                2024-11-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/11/10/%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E9%80%9A%E8%A7%A3/" class="leancloud_visitors" data-flag-title="股票问题通解">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  119 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于每天的情况都可以分为两种状态：买入和卖出，而这两种状态的收益和前一天的状态有关，因此构造<strong>动态规划</strong>的通用解。<br>在问题的进一步扩展上，增加了交易次数。<br>难点和关键在于找到状态之间的递推公式。<br>而动态规划的<strong>空间优化</strong>需要注意。</p>
<p>参考<a href="https://leetcode.cn/circle/discuss/qiAgHn/">分享｜股票问题系列通解（转载翻译） - 力扣（LeetCode）</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/11/04/sql-questions-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/04/sql-questions-03/" itemprop="url">SQL常见面试题总结（3）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-04T21:14:30+08:00">
                2024-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/" itemprop="url" rel="index">
                    <span itemprop="name">面试问题</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/11/04/sql-questions-03/" class="leancloud_visitors" data-flag-title="SQL常见面试题总结（3）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  11.9k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  55 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>题目来源于：<a href="https://www.nowcoder.com/exam/oj?page=1&tab=SQL%E7%AF%87&topicId=240">牛客题霸 - SQL 进阶挑战</a></p>
</blockquote>
<p>较难或者困难的题目可以根据自身实际情况和面试需要来决定是否要跳过。</p>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><h3 id="SQL-类别高难度试卷得分的截断平均值（较难）"><a href="#SQL-类别高难度试卷得分的截断平均值（较难）" class="headerlink" title="SQL 类别高难度试卷得分的截断平均值（较难）"></a>SQL 类别高难度试卷得分的截断平均值（较难）</h3><p><strong>描述</strong>： 牛客的运营同学想要查看大家在 SQL 类别中高难度试卷的得分情况。</p>
<p>请你帮她从<code>exam_record</code>数据表中计算所有用户完成 SQL 类别高难度试卷得分的截断平均值（去掉一个最大值和一个最小值后的平均值）。</p>
<p>示例数据：<code>examination_info</code>（<code>exam_id</code> 试卷 ID, tag 试卷类别, <code>difficulty</code> 试卷难度, <code>duration</code> 考试时长, <code>release_time</code> 发布时间）</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2020-08-02 10:00:00</td>
</tr>
</tbody></table>
<p>示例数据：<code>exam_record</code>（uid 用户 ID, exam_id 试卷 ID, start_time 开始作答时间, submit_time 交卷时间, score 得分）</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2020-01-02 09:01:01</td>
<td>2020-01-02 09:21:01</td>
<td>80</td>
</tr>
<tr>
<td>2</td>
<td>1001</td>
<td>9001</td>
<td>2021-05-02 10:01:01</td>
<td>2021-05-02 10:30:01</td>
<td>81</td>
</tr>
<tr>
<td>3</td>
<td>1001</td>
<td>9001</td>
<td>2021-06-02 19:01:01</td>
<td>2021-06-02 19:31:01</td>
<td>84</td>
</tr>
<tr>
<td>4</td>
<td>1001</td>
<td>9002</td>
<td>2021-09-05 19:01:01</td>
<td>2021-09-05 19:40:01</td>
<td>89</td>
</tr>
<tr>
<td>5</td>
<td>1001</td>
<td>9001</td>
<td>2021-09-02 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>6</td>
<td>1001</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>7</td>
<td>1002</td>
<td>9002</td>
<td>2021-02-02 19:01:01</td>
<td>2021-02-02 19:30:01</td>
<td>87</td>
</tr>
<tr>
<td>8</td>
<td>1002</td>
<td>9001</td>
<td>2021-05-05 18:01:01</td>
<td>2021-05-05 18:59:02</td>
<td>90</td>
</tr>
<tr>
<td>9</td>
<td>1003</td>
<td>9001</td>
<td>2021-09-07 12:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>50</td>
</tr>
<tr>
<td>10</td>
<td>1004</td>
<td>9001</td>
<td>2021-09-06 10:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
</tbody></table>
<p>根据输入你的查询结果如下：</p>
<table>
<thead>
<tr>
<th>tag</th>
<th>difficulty</th>
<th>clip_avg_score</th>
</tr>
</thead>
<tbody><tr>
<td>SQL</td>
<td>hard</td>
<td>81.7</td>
</tr>
</tbody></table>
<p>从<code>examination_info</code>表可知，试卷 9001 为高难度 SQL 试卷，该试卷被作答的得分有[80,81,84,90,50]，去除最高分和最低分后为[80,81,84]，平均分为 81.6666667，保留一位小数后为 81.7</p>
<p><strong>输入描述：</strong></p>
<p>输入数据中至少有 3 个有效分数</p>
<p><strong>思路一：</strong> 要找出高难度 sql 试卷，肯定需要联 examination_info 这张表，然后找出高难度的课程，由 examination_info 得知，高难度 sql 的 exam_id 为 9001，那么等下就以 exam_id &#x3D; 9001 作为条件去查询；</p>
<p>先找出 9001 号考试 <code>select * from exam_record where exam_id = 9001</code></p>
<p>然后，找出最高分 <code>select max(score) 最高分 from exam_record where exam_id = 9001</code></p>
<p>接着，找出最低分 <code>select min(score) 最低分 from exam_record where exam_id = 9001</code></p>
<p>在查询出来的分数结果集当中，去掉最高分和最低分，最直观能想到的就是 NOT IN 或者 用 NOT EXISTS 也行，这里以 NOT IN 来做</p>
<p>首先将主体写出来<code>select tag, difficulty, round(avg(score), 1) clip_avg_score from examination_info info INNER JOIN exam_record record</code></p>
<p><strong>小 tips</strong> : MYSQL 的 <code>ROUND()</code> 函数 ,<code>ROUND(X)</code>返回参数 X 最近似的整数 <code>ROUND(X,D)</code>返回 X ,其值保留到小数点后 D 位,第 D 位的保留方式为四舍五入。</p>
<p>再将上面的 “碎片” 语句拼凑起来即可， 注意在 NOT IN 中两个子查询用 UNION ALL 来关联，用 union 把 max 和 min 的结果集中在一行当中，这样形成一列多行的效果。</p>
<p><strong>答案一：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tag, difficulty, ROUND(<span class="built_in">AVG</span>(score), <span class="number">1</span>) clip_avg_score</span><br><span class="line">	<span class="keyword">FROM</span> examination_info info  <span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line">		<span class="keyword">WHERE</span> info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">			<span class="keyword">AND</span>  record.exam_id <span class="operator">=</span> <span class="number">9001</span></span><br><span class="line">				<span class="keyword">AND</span> record.score <span class="keyword">NOT</span> <span class="keyword">IN</span>(</span><br><span class="line">					<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(score)</span><br><span class="line">						<span class="keyword">FROM</span> exam_record</span><br><span class="line">							<span class="keyword">WHERE</span> exam_id <span class="operator">=</span> <span class="number">9001</span></span><br><span class="line">								<span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">					<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(score)</span><br><span class="line">						<span class="keyword">FROM</span> exam_record</span><br><span class="line">							<span class="keyword">WHERE</span> exam_id <span class="operator">=</span> <span class="number">9001</span></span><br><span class="line">				)</span><br></pre></td></tr></table></figure>

<p>这是最直观，也是最容易想到的解法，但是还有待改进，这算是投机取巧过关，其实严格按照题目要求应该这么写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tag,</span><br><span class="line">       difficulty,</span><br><span class="line">       ROUND(<span class="built_in">AVG</span>(score), <span class="number">1</span>) clip_avg_score</span><br><span class="line"><span class="keyword">FROM</span> examination_info info</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line"><span class="keyword">WHERE</span> info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">  <span class="keyword">AND</span> record.exam_id <span class="operator">=</span></span><br><span class="line">    (<span class="keyword">SELECT</span> examination_info.exam_id</span><br><span class="line">     <span class="keyword">FROM</span> examination_info</span><br><span class="line">     <span class="keyword">WHERE</span> tag <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">       <span class="keyword">AND</span> difficulty <span class="operator">=</span> <span class="string">&#x27;hard&#x27;</span> )</span><br><span class="line">  <span class="keyword">AND</span> record.score <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(score)</span><br><span class="line">     <span class="keyword">FROM</span> exam_record</span><br><span class="line">     <span class="keyword">WHERE</span> exam_id <span class="operator">=</span></span><br><span class="line">         (<span class="keyword">SELECT</span> examination_info.exam_id</span><br><span class="line">          <span class="keyword">FROM</span> examination_info</span><br><span class="line">          <span class="keyword">WHERE</span> tag <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">            <span class="keyword">AND</span> difficulty <span class="operator">=</span> <span class="string">&#x27;hard&#x27;</span> )</span><br><span class="line">     <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(score)</span><br><span class="line">     <span class="keyword">FROM</span> exam_record</span><br><span class="line">     <span class="keyword">WHERE</span> exam_id <span class="operator">=</span></span><br><span class="line">         (<span class="keyword">SELECT</span> examination_info.exam_id</span><br><span class="line">          <span class="keyword">FROM</span> examination_info</span><br><span class="line">          <span class="keyword">WHERE</span> tag <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">            <span class="keyword">AND</span> difficulty <span class="operator">=</span> <span class="string">&#x27;hard&#x27;</span> ) )</span><br></pre></td></tr></table></figure>

<p>然而你会发现，重复的语句非常多，所以可以利用<code>WITH</code>来抽取公共部分</p>
<p><strong><code>WITH</code> 子句介绍</strong>：</p>
<p><code>WITH</code> 子句，也称为公共表表达式（Common Table Expression，CTE），是在 SQL 查询中定义临时表的方式。它可以让我们在查询中创建一个临时命名的结果集，并且可以在同一查询中引用该结果集。</p>
<p>基本用法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> cte_name (column1, column2, ..., columnN) <span class="keyword">AS</span> (</span><br><span class="line">    <span class="comment">-- 查询体</span></span><br><span class="line">    <span class="keyword">SELECT</span> ...</span><br><span class="line">    <span class="keyword">FROM</span> ...</span><br><span class="line">    <span class="keyword">WHERE</span> ...</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 主查询</span></span><br><span class="line"><span class="keyword">SELECT</span> ...</span><br><span class="line"><span class="keyword">FROM</span> cte_name</span><br><span class="line"><span class="keyword">WHERE</span> ...</span><br></pre></td></tr></table></figure>

<p><code>WITH</code> 子句由以下几个部分组成：</p>
<ul>
<li><code>cte_name</code>: 给临时表起一个名称，可以在主查询中引用。</li>
<li><code>(column1, column2, ..., columnN)</code>: 可选，指定临时表的列名。</li>
<li><code>AS</code>: 必需，表示开始定义临时表。</li>
<li><code>CTE 查询体</code>: 实际的查询语句，用于定义临时表中的数据。</li>
</ul>
<p><code>WITH</code> 子句的主要用途之一是增强查询的可读性和可维护性，尤其在涉及多个嵌套子查询或需要重复使用相同的查询逻辑时。通过将这些逻辑放在一个命名的临时表中，我们可以更清晰地组织查询，并消除重复代码。</p>
<p>此外，<code>WITH</code> 子句还可以在复杂的查询中实现递归查询。递归查询允许我们在单个查询中执行对同一表的多次迭代，逐步构建结果集。这在处理层次结构数据、组织结构和树状结构等场景中非常有用。</p>
<p><strong>小细节</strong>：MySQL 5.7 版本以及之前的版本不支持在 <code>WITH</code> 子句中直接使用别名。</p>
<p>下面是改进后的答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> t1 <span class="keyword">AS</span></span><br><span class="line">  (<span class="keyword">SELECT</span> record.<span class="operator">*</span>,</span><br><span class="line">          info.tag,</span><br><span class="line">          info.difficulty</span><br><span class="line">   <span class="keyword">FROM</span> exam_record record</span><br><span class="line">   <span class="keyword">INNER</span> <span class="keyword">JOIN</span> examination_info info <span class="keyword">ON</span> record.exam_id <span class="operator">=</span> info.exam_id</span><br><span class="line">   <span class="keyword">WHERE</span> info.tag <span class="operator">=</span> &quot;SQL&quot;</span><br><span class="line">     <span class="keyword">AND</span> info.difficulty <span class="operator">=</span> &quot;hard&quot; )</span><br><span class="line"><span class="keyword">SELECT</span> tag,</span><br><span class="line">       difficulty,</span><br><span class="line">       ROUND(<span class="built_in">AVG</span>(score), <span class="number">1</span>)</span><br><span class="line"><span class="keyword">FROM</span> t1</span><br><span class="line"><span class="keyword">WHERE</span> score <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">max</span>(score)</span><br><span class="line">     <span class="keyword">FROM</span> t1</span><br><span class="line">     <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="built_in">min</span>(score)</span><br><span class="line">     <span class="keyword">FROM</span> t1)</span><br></pre></td></tr></table></figure>

<p><strong>思路二：</strong></p>
<ul>
<li>筛选 SQL 高难度试卷：<code>where tag=&quot;SQL&quot; and difficulty=&quot;hard&quot;</code></li>
<li>计算截断平均值：<code>(和-最大值-最小值) / (总个数-2)</code>:<ul>
<li><code>(sum(score) - max(score) - min(score)) / (count(score) - 2)</code></li>
<li>有一个缺点就是，如果最大值和最小值有多个，这个方法就很难筛选出来, 但是题目中说了—–&gt;<strong><code>去掉一个最大值和一个最小值后的平均值</code></strong>, 所以这里可以用这个公式。</li>
</ul>
</li>
</ul>
<p><strong>答案二：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> info.tag,</span><br><span class="line">       info.difficulty,</span><br><span class="line">       ROUND((<span class="built_in">SUM</span>(record.score)<span class="operator">-</span> <span class="built_in">MIN</span>(record.score)<span class="operator">-</span> <span class="built_in">MAX</span>(record.score)) <span class="operator">/</span> (<span class="built_in">COUNT</span>(record.score)<span class="operator">-</span> <span class="number">2</span>), <span class="number">1</span>) <span class="keyword">AS</span> clip_avg_score</span><br><span class="line"><span class="keyword">FROM</span> examination_info info,</span><br><span class="line">     exam_record record</span><br><span class="line"><span class="keyword">WHERE</span> info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">  <span class="keyword">AND</span> info.tag <span class="operator">=</span> &quot;SQL&quot;</span><br><span class="line">  <span class="keyword">AND</span> info.difficulty <span class="operator">=</span> &quot;hard&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="统计作答次数"><a href="#统计作答次数" class="headerlink" title="统计作答次数"></a>统计作答次数</h3><p>有一个试卷作答记录表 <code>exam_record</code>，请从中统计出总作答次数 <code>total_pv</code>、试卷已完成作答数 <code>complete_pv</code>、已完成的试卷数 <code>complete_exam_cnt</code>。</p>
<p>示例数据 <code>exam_record</code> 表（<code>uid</code> 用户 ID, <code>exam_id</code> 试卷 ID, <code>start_time</code> 开始作答时间, <code>submit_time</code> 交卷时间, <code>score</code> 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2020-01-02 09:01:01</td>
<td>2020-01-02 09:21:01</td>
<td>80</td>
</tr>
<tr>
<td>2</td>
<td>1001</td>
<td>9001</td>
<td>2021-05-02 10:01:01</td>
<td>2021-05-02 10:30:01</td>
<td>81</td>
</tr>
<tr>
<td>3</td>
<td>1001</td>
<td>9001</td>
<td>2021-06-02 19:01:01</td>
<td>2021-06-02 19:31:01</td>
<td>84</td>
</tr>
<tr>
<td>4</td>
<td>1001</td>
<td>9002</td>
<td>2021-09-05 19:01:01</td>
<td>2021-09-05 19:40:01</td>
<td>89</td>
</tr>
<tr>
<td>5</td>
<td>1001</td>
<td>9001</td>
<td>2021-09-02 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>6</td>
<td>1001</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>7</td>
<td>1002</td>
<td>9002</td>
<td>2021-02-02 19:01:01</td>
<td>2021-02-02 19:30:01</td>
<td>87</td>
</tr>
<tr>
<td>8</td>
<td>1002</td>
<td>9001</td>
<td>2021-05-05 18:01:01</td>
<td>2021-05-05 18:59:02</td>
<td>90</td>
</tr>
<tr>
<td>9</td>
<td>1003</td>
<td>9001</td>
<td>2021-09-07 12:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>50</td>
</tr>
<tr>
<td>10</td>
<td>1004</td>
<td>9001</td>
<td>2021-09-06 10:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
</tbody></table>
<p>示例输出：</p>
<table>
<thead>
<tr>
<th>total_pv</th>
<th>complete_pv</th>
<th>complete_exam_cnt</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
<td>7</td>
<td>2</td>
</tr>
</tbody></table>
<p>解释：表示截止当前，有 10 次试卷作答记录，已完成的作答次数为 7 次（中途退出的为未完成状态，其交卷时间和份数为 NULL），已完成的试卷有 9001 和 9002 两份。</p>
<p><strong>思路</strong>： 这题一看到统计次数，肯定第一时间就要想到用<code>COUNT</code>这个函数来解决，问题是要统计不同的记录，该怎么来写？使用子查询就能解决这个题目(这题用 case when 也能写出来，解法类似，逻辑不同而已)；首先在做这个题之前，让我们先来了解一下<code>COUNT</code>的基本用法；</p>
<p><code>COUNT()</code> 函数的基本语法如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">COUNT</span>(expression)</span><br></pre></td></tr></table></figure>

<p>其中，<code>expression</code> 可以是列名、表达式、常量或通配符。下面是一些常见的用法示例：</p>
<ol>
<li>计算表中所有行的数量：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>计算特定列非空（不为 NULL）值的数量：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(column_name) <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>计算满足条件的行数：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>结合 <code>GROUP BY</code> 使用，计算分组后每个组的行数：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name <span class="keyword">GROUP</span> <span class="keyword">BY</span> column_name;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>计算不同列组合的唯一组合数：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> column_name1, column_name2) <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<p>在使用 <code>COUNT()</code> 函数时，如果不指定任何参数或者使用 <code>COUNT(*)</code>，将会计算所有行的数量。而如果使用列名，则只会计算该列非空值的数量。</p>
<p>另外，<code>COUNT()</code> 函数的结果是一个整数值。即使结果是零，也不会返回 NULL，这点需要谨记。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">count</span>(<span class="operator">*</span>) total_pv,</span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> exam_record <span class="keyword">WHERE</span> submit_time <span class="keyword">IS</span> <span class="keyword">NOT NULL</span> ) complete_pv,</span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>( <span class="keyword">DISTINCT</span> exam_id, score <span class="keyword">IS</span> <span class="keyword">NOT NULL</span> <span class="keyword">OR</span> <span class="keyword">NULL</span> ) <span class="keyword">FROM</span> exam_record ) complete_exam_cnt</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	exam_record</span><br></pre></td></tr></table></figure>

<p>这里着重说一下<code>COUNT( DISTINCT exam_id, score IS NOT NULL OR NULL )</code>这一句，判断 score 是否为 null ，如果是即为真，如果不是返回 null；注意这里如果不加 <code>or null</code> 在不是 null 的情况下只会返回 false 也就是返回 0；</p>
<p><code>COUNT</code>本身是不可以对多列求行数的，<code>distinct</code>的加入是的多列成为一个整体，可以求出现的行数了;<code>count distinct</code>在计算时只返回非 null 的行, 这个也要注意；</p>
<p>另外通过本题 get 到了——&gt;count 加条件常用句式<code>count( 列判断 or null)</code></p>
<h3 id="得分不小于平均分的最低分"><a href="#得分不小于平均分的最低分" class="headerlink" title="得分不小于平均分的最低分"></a>得分不小于平均分的最低分</h3><p><strong>描述</strong>： 请从试卷作答记录表中找到 SQL 试卷得分不小于该类试卷平均得分的用户最低得分。</p>
<p>示例数据 exam_record 表（uid 用户 ID, exam_id 试卷 ID, start_time 开始作答时间, submit_time 交卷时间, score 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2020-01-02 09:01:01</td>
<td>2020-01-02 09:21:01</td>
<td>80</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-05 19:01:01</td>
<td>2021-09-05 19:40:01</td>
<td>89</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-02 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>5</td>
<td>1002</td>
<td>9001</td>
<td>2021-02-02 19:01:01</td>
<td>2021-02-02 19:30:01</td>
<td>87</td>
</tr>
<tr>
<td>6</td>
<td>1002</td>
<td>9002</td>
<td>2021-05-05 18:01:01</td>
<td>2021-05-05 18:59:02</td>
<td>90</td>
</tr>
<tr>
<td>7</td>
<td>1003</td>
<td>9002</td>
<td>2021-02-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>8</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>86</td>
</tr>
<tr>
<td>9</td>
<td>1004</td>
<td>9003</td>
<td>2021-09-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
</tbody></table>
<p><code>examination_info</code> 表（<code>exam_id</code> 试卷 ID, <code>tag</code> 试卷类别, <code>difficulty</code> 试卷难度, <code>duration</code> 考试时长, <code>release_time</code> 发布时间）</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>SQL</td>
<td>easy</td>
<td>60</td>
<td>2020-02-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2020-08-02 10:00:00</td>
</tr>
</tbody></table>
<p>示例输出数据：</p>
<table>
<thead>
<tr>
<th>min_score_over_avg</th>
</tr>
</thead>
<tbody><tr>
<td>87</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：试卷 9001 和 9002 为 SQL 类别，作答这两份试卷的得分有[80,89,87,90]，平均分为 86.5，不小于平均分的最小分数为 87</p>
<p><strong>思路</strong>：这类题目第一眼看确实很复杂， 因为不知道从哪入手，但是当我们仔细读题审题后，要学会抓住题干中的关键信息。以本题为例：<code>请从试卷作答记录表中找到SQL试卷得分不小于该类试卷平均得分的用户最低得分。</code>你能一眼从中提取哪些有效信息来作为解题思路？</p>
<p>第一条：找到&#x3D;&#x3D;SQL&#x3D;&#x3D;试卷得分</p>
<p>第二条：该类试卷&#x3D;&#x3D;平均得分&#x3D;&#x3D;</p>
<p>第三条：该类试卷的&#x3D;&#x3D;用户最低得分&#x3D;&#x3D;</p>
<p>然后中间的 “桥梁” 就是&#x3D;&#x3D;不小于&#x3D;&#x3D;</p>
<p>将条件拆分后，先逐步完成</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 找出tag为‘SQL’的得分   【80, 89,87,90】</span></span><br><span class="line"><span class="comment">-- 再算出这一组的平均得分</span></span><br><span class="line"><span class="keyword">select</span>  ROUND(<span class="built_in">AVG</span>(score), <span class="number">1</span>) <span class="keyword">from</span>  examination_info info <span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line">	<span class="keyword">where</span> info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">	<span class="keyword">and</span> tag<span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后再找出该类试卷的最低得分，接着将结果集<code>【80, 89,87,90】</code> 去和平均分数作比较，方可得出最终答案。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(score) <span class="keyword">AS</span> min_score_over_avg</span><br><span class="line"><span class="keyword">FROM</span> examination_info info</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line"><span class="keyword">WHERE</span> info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">  <span class="keyword">AND</span> tag<span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> score <span class="operator">&gt;=</span></span><br><span class="line">    (<span class="keyword">SELECT</span> ROUND(<span class="built_in">AVG</span>(score), <span class="number">1</span>)</span><br><span class="line">     <span class="keyword">FROM</span> examination_info info</span><br><span class="line">     <span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line">     <span class="keyword">WHERE</span> info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">       <span class="keyword">AND</span> tag<span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span> )</span><br></pre></td></tr></table></figure>

<p>其实这类题目给出的要求看似很 “绕”，但其实仔细梳理一遍，将大条件拆分成小条件，逐个拆分完以后，最后将所有条件拼凑起来。反正只要记住：<strong>抓主干，理分支</strong>，问题便迎刃而解。</p>
<h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><h3 id="平均活跃天数和月活人数"><a href="#平均活跃天数和月活人数" class="headerlink" title="平均活跃天数和月活人数"></a>平均活跃天数和月活人数</h3><p><strong>描述</strong>：用户在牛客试卷作答区作答记录存储在表 <code>exam_record</code> 中，内容如下：</p>
<p><code>exam_record</code> 表（<code>uid</code> 用户 ID, <code>exam_id</code> 试卷 ID, <code>start_time</code> 开始作答时间, <code>submit_time</code> 交卷时间, <code>score</code> 得分）</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-07-02 09:01:01</td>
<td>2021-07-02 09:21:01</td>
<td>80</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-05 19:01:01</td>
<td>2021-09-05 19:40:01</td>
<td>81</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-02 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>5</td>
<td>1002</td>
<td>9001</td>
<td>2021-07-02 19:01:01</td>
<td>2021-07-02 19:30:01</td>
<td>82</td>
</tr>
<tr>
<td>6</td>
<td>1002</td>
<td>9002</td>
<td>2021-07-05 18:01:01</td>
<td>2021-07-05 18:59:02</td>
<td>90</td>
</tr>
<tr>
<td>7</td>
<td>1003</td>
<td>9002</td>
<td>2021-07-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>8</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>86</td>
</tr>
<tr>
<td>9</td>
<td>1004</td>
<td>9003</td>
<td>2021-09-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>10</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>81</td>
</tr>
<tr>
<td>11</td>
<td>1005</td>
<td>9001</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>88</td>
</tr>
<tr>
<td>12</td>
<td>1006</td>
<td>9002</td>
<td>2021-09-02 12:11:01</td>
<td>2021-09-02 12:31:01</td>
<td>89</td>
</tr>
<tr>
<td>13</td>
<td>1007</td>
<td>9002</td>
<td>2020-09-02 12:11:01</td>
<td>2020-09-02 12:31:01</td>
<td>89</td>
</tr>
</tbody></table>
<p>请计算 2021 年每个月里试卷作答区用户平均月活跃天数 <code>avg_active_days</code> 和月度活跃人数 <code>mau</code>，上面数据的示例输出如下：</p>
<table>
<thead>
<tr>
<th>month</th>
<th>avg_active_days</th>
<th>mau</th>
</tr>
</thead>
<tbody><tr>
<td>202107</td>
<td>1.50</td>
<td>2</td>
</tr>
<tr>
<td>202109</td>
<td>1.25</td>
<td>4</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：2021 年 7 月有 2 人活跃，共活跃了 3 天（1001 活跃 1 天，1002 活跃 2 天），平均活跃天数 1.5；2021 年 9 月有 4 人活跃，共活跃了 5 天，平均活跃天数 1.25，结果保留 2 位小数。</p>
<p>注：此处活跃指有&#x3D;&#x3D;交卷&#x3D;&#x3D;行为。</p>
<p><strong>思路</strong>：读完题先注意高亮部分；一般求天数和月活跃人数马上就要想到相关的日期函数；这一题我们同样来进行拆分，把问题细化再解决；首先求活跃人数，肯定要用到<code>COUNT()</code>，那这里首先就有一个坑，不知道大家注意了没有？用户 1002 在 9 月份做了两种不同的试卷，所以这里要注意去重，不然在统计的时候，活跃人数是错的；第二个就是要知道日期的格式化，如上表，题目要求以<code>202107</code>这种日期格式展现，要用到<code>DATE_FORMAT</code>来进行格式化。</p>
<p>基本用法：</p>
<p><code>DATE_FORMAT(date_value, format)</code></p>
<ul>
<li><code>date_value</code> 参数是待格式化的日期或时间值。</li>
<li><code>format</code> 参数是指定的日期或时间格式（这个和 Java 里面的日期格式一样）。</li>
</ul>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(submit_time, <span class="string">&#x27;%Y%m&#x27;</span>) <span class="keyword">MONTH</span>,</span><br><span class="line">                                        round(<span class="built_in">count</span>(<span class="keyword">DISTINCT</span> UID, DATE_FORMAT(submit_time, <span class="string">&#x27;%Y%m%d&#x27;</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> UID), <span class="number">2</span>) avg_active_days,</span><br><span class="line">                                        <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> UID) mau</span><br><span class="line"><span class="keyword">FROM</span> exam_record</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">YEAR</span> (submit_time) <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">MONTH</span></span><br></pre></td></tr></table></figure>

<p>这里多说一句, 使用<code>COUNT(DISTINCT uid, DATE_FORMAT(submit_time, &#39;%Y%m%d&#39;))</code> 可以统计在 <code>uid</code> 列和 <code>submit_time</code> 列按照年份、月份和日期进行格式化后的组合值的数量。</p>
<h3 id="月总刷题数和日均刷题数"><a href="#月总刷题数和日均刷题数" class="headerlink" title="月总刷题数和日均刷题数"></a>月总刷题数和日均刷题数</h3><p><strong>描述</strong>：现有一张题目练习记录表 <code>practice_record</code>，示例内容如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>question_id</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>8001</td>
<td>2021-08-02 11:41:01</td>
<td>60</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>8001</td>
<td>2021-09-02 19:30:01</td>
<td>50</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>8001</td>
<td>2021-09-02 19:20:01</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>8002</td>
<td>2021-09-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>5</td>
<td>1003</td>
<td>8002</td>
<td>2021-08-01 19:38:01</td>
<td>80</td>
</tr>
</tbody></table>
<p>请从中统计出 2021 年每个月里用户的月总刷题数 <code>month_q_cnt</code> 和日均刷题数 <code>avg_day_q_cnt</code>（按月份升序排序）以及该年的总体情况，示例数据输出如下：</p>
<table>
<thead>
<tr>
<th>submit_month</th>
<th>month_q_cnt</th>
<th>avg_day_q_cnt</th>
</tr>
</thead>
<tbody><tr>
<td>202108</td>
<td>2</td>
<td>0.065</td>
</tr>
<tr>
<td>202109</td>
<td>3</td>
<td>0.100</td>
</tr>
<tr>
<td>2021 汇总</td>
<td>5</td>
<td>0.161</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：2021 年 8 月共有 2 次刷题记录，日均刷题数为 2&#x2F;31&#x3D;0.065（保留 3 位小数）；2021 年 9 月共有 3 次刷题记录，日均刷题数为 3&#x2F;30&#x3D;0.100；2021 年共有 5 次刷题记录（年度汇总平均无实际意义，这里我们按照 31 天来算 5&#x2F;31&#x3D;0.161）</p>
<blockquote>
<p>牛客已经采用最新的 Mysql 版本，如果您运行结果出现错误：ONLY_FULL_GROUP_BY，意思是：对于 GROUP BY 聚合操作，如果在 SELECT 中的列，没有在 GROUP BY 中出现，那么这个 SQL 是不合法的，因为列不在 GROUP BY 从句中，也就是说查出来的列必须在 group by 后面出现否则就会报错，或者这个字段出现在聚合函数里面。</p>
</blockquote>
<p><strong>思路：</strong></p>
<p>看到实例数据就要马上联想到相关的函数，比如<code>submit_month</code>就要用到<code>DATE_FORMAT</code>来格式化日期。然后查出每月的刷题数量。</p>
<p>每月的刷题数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span> ( submit_time ), <span class="built_in">COUNT</span>( question_id )</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	practice_record</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	<span class="keyword">MONTH</span> (submit_time)</span><br></pre></td></tr></table></figure>

<p>接着第三列这里要用到<code>DAY(LAST_DAY(date_value))</code>函数来查找给定日期的月份中的天数。</p>
<p>示例代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(LAST_DAY(<span class="string">&#x27;2023-07-08&#x27;</span>)) <span class="keyword">AS</span> days_in_month;</span><br><span class="line"><span class="comment">-- 输出：31</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(LAST_DAY(<span class="string">&#x27;2023-02-01&#x27;</span>)) <span class="keyword">AS</span> days_in_month;</span><br><span class="line"><span class="comment">-- 输出：28 (闰年中的二月份)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(LAST_DAY(NOW())) <span class="keyword">AS</span> days_in_current_month;</span><br><span class="line"><span class="comment">-- 输出：31 （当前月份的天数）</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>LAST_DAY()</code> 函数获取给定日期的当月最后一天，然后使用 <code>DAY()</code> 函数提取该日期的天数。这样就能获得指定月份的天数。</p>
<p>需要注意的是，<code>LAST_DAY()</code> 函数返回的是日期值，而 <code>DAY()</code> 函数用于提取日期值中的天数部分。</p>
<p>有了上述的分析之后，即可马上写出答案，这题复杂就复杂在处理日期上，其中的逻辑并不难。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(submit_time, <span class="string">&#x27;%Y%m&#x27;</span>) submit_month,</span><br><span class="line">       <span class="built_in">count</span>(question_id) month_q_cnt,</span><br><span class="line">       ROUND(<span class="built_in">COUNT</span>(question_id) <span class="operator">/</span> <span class="keyword">DAY</span> (LAST_DAY(submit_time)), <span class="number">3</span>) avg_day_q_cnt</span><br><span class="line"><span class="keyword">FROM</span> practice_record</span><br><span class="line"><span class="keyword">WHERE</span> DATE_FORMAT(submit_time, <span class="string">&#x27;%Y&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;2021&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> submit_month</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;2021汇总&#x27;</span> <span class="keyword">AS</span> submit_month,</span><br><span class="line">       <span class="built_in">count</span>(question_id) month_q_cnt,</span><br><span class="line">       ROUND(<span class="built_in">COUNT</span>(question_id) <span class="operator">/</span> <span class="number">31</span>, <span class="number">3</span>) avg_day_q_cnt</span><br><span class="line"><span class="keyword">FROM</span> practice_record</span><br><span class="line"><span class="keyword">WHERE</span> DATE_FORMAT(submit_time, <span class="string">&#x27;%Y&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;2021&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> submit_month</span><br></pre></td></tr></table></figure>

<p>在实例数据输出中因为最后一行需要得出汇总数据，所以这里要 <code>UNION ALL</code>加到结果集中；别忘了最后要排序！</p>
<h3 id="未完成试卷数大于-1-的有效用户（较难）"><a href="#未完成试卷数大于-1-的有效用户（较难）" class="headerlink" title="未完成试卷数大于 1 的有效用户（较难）"></a>未完成试卷数大于 1 的有效用户（较难）</h3><p><strong>描述</strong>：现有试卷作答记录表 <code>exam_record</code>（<code>uid</code> 用户 ID, <code>exam_id</code> 试卷 ID, <code>start_time</code> 开始作答时间, <code>submit_time</code> 交卷时间, <code>score</code> 得分），示例数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-07-02 09:01:01</td>
<td>2021-07-02 09:21:01</td>
<td>80</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-05 19:01:01</td>
<td>2021-09-05 19:40:01</td>
<td>81</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-02 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>5</td>
<td>1002</td>
<td>9001</td>
<td>2021-07-02 19:01:01</td>
<td>2021-07-02 19:30:01</td>
<td>82</td>
</tr>
<tr>
<td>6</td>
<td>1002</td>
<td>9002</td>
<td>2021-07-05 18:01:01</td>
<td>2021-07-05 18:59:02</td>
<td>90</td>
</tr>
<tr>
<td>7</td>
<td>1003</td>
<td>9002</td>
<td>2021-07-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>8</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>86</td>
</tr>
<tr>
<td>9</td>
<td>1004</td>
<td>9003</td>
<td>2021-09-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>10</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>81</td>
</tr>
<tr>
<td>11</td>
<td>1005</td>
<td>9001</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>88</td>
</tr>
<tr>
<td>12</td>
<td>1006</td>
<td>9002</td>
<td>2021-09-02 12:11:01</td>
<td>2021-09-02 12:31:01</td>
<td>89</td>
</tr>
<tr>
<td>13</td>
<td>1007</td>
<td>9002</td>
<td>2020-09-02 12:11:01</td>
<td>2020-09-02 12:31:01</td>
<td>89</td>
</tr>
</tbody></table>
<p>还有一张试卷信息表 <code>examination_info</code>（<code>exam_id</code> 试卷 ID, <code>tag</code> 试卷类别, <code>difficulty</code> 试卷难度, <code>duration</code> 考试时长, <code>release_time</code> 发布时间），示例数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>SQL</td>
<td>easy</td>
<td>60</td>
<td>2020-02-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2020-08-02 10:00:00</td>
</tr>
</tbody></table>
<p>请统计 2021 年每个未完成试卷作答数大于 1 的有效用户的数据（有效用户指完成试卷作答数至少为 1 且未完成数小于 5），输出用户 ID、未完成试卷作答数、完成试卷作答数、作答过的试卷 tag 集合，按未完成试卷数量由多到少排序。示例数据的输出结果如下：</p>
<table>
<thead>
<tr>
<th>uid</th>
<th>incomplete_cnt</th>
<th>complete_cnt</th>
<th>detail</th>
</tr>
</thead>
<tbody><tr>
<td>1002</td>
<td>2</td>
<td>4</td>
<td>2021-09-01:算法;2021-07-02:SQL;2021-09-02:SQL;2021-09-05:SQL;2021-07-05:SQL</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：2021 年的作答记录中，除了 1004，其他用户均满足有效用户定义，但只有 1002 未完成试卷数大于 1，因此只输出 1002，detail 中是 1002 作答过的试卷{日期:tag}集合，日期和 tag 间用 <strong>:</strong> 连接，多元素间用 <strong>;</strong> 连接。</p>
<p><strong>思路：</strong></p>
<p>仔细读题后，分析出：首先要联表，因为后面要输出<code>tag</code>；</p>
<p>筛选出 2021 年的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> exam_record er</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> examination_info ei <span class="keyword">ON</span> er.exam_id <span class="operator">=</span> ei.exam_id</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">YEAR</span> (er.start_time)<span class="operator">=</span> <span class="number">2021</span></span><br></pre></td></tr></table></figure>

<p>根据 uid 进行分组，然后对每个用户进行条件进行判断，题目中要求<code>完成试卷数至少为1,未完成试卷数要大于1，小于5</code></p>
<p>那么等会儿写 sql 的时候条件应该是：<code>未完成 &gt; 1 and 已完成 &gt;=1 and 未完成 &lt; 5</code></p>
<p>因为最后要用到字符串的拼接，而且还要组合拼接，这个可以用<code>GROUP_CONCAT</code>函数，下面简单介绍一下该函数的用法：</p>
<p>基本格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GROUP_CONCAT([<span class="keyword">DISTINCT</span>] expr [<span class="keyword">ORDER</span> <span class="keyword">BY</span> &#123;unsigned_integer <span class="operator">|</span> col_name <span class="operator">|</span> expr&#125; [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>] [, ...]]             [SEPARATOR sep])</span><br></pre></td></tr></table></figure>

<ul>
<li><code>expr</code>：要连接的列或表达式。</li>
<li><code>DISTINCT</code>：可选参数，用于去重。当指定了 <code>DISTINCT</code>，相同的值只会出现一次。</li>
<li><code>ORDER BY</code>：可选参数，用于排序连接后的值。可以选择升序 (<code>ASC</code>) 或降序 (<code>DESC</code>) 排序。</li>
<li><code>SEPARATOR sep</code>：可选参数，用于设置连接后的值的分隔符。（本题要用这个参数设置 ; 号 ）</li>
</ul>
<p><code>GROUP_CONCAT()</code> 函数常用于 <code>GROUP BY</code> 子句中，将一组行的值连接为一个字符串，并在结果集中以聚合的形式返回。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.uid,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">               <span class="keyword">WHEN</span> a.submit_time <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">           <span class="keyword">END</span>) <span class="keyword">AS</span> incomplete_cnt,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">               <span class="keyword">WHEN</span> a.submit_time <span class="keyword">IS</span> <span class="keyword">NOT NULL</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">           <span class="keyword">END</span>) <span class="keyword">AS</span> complete_cnt,</span><br><span class="line">       GROUP_CONCAT(<span class="keyword">DISTINCT</span> CONCAT(DATE_FORMAT(a.start_time, <span class="string">&#x27;%Y-%m-%d&#x27;</span>), <span class="string">&#x27;:&#x27;</span>, b.tag)</span><br><span class="line">                    <span class="keyword">ORDER</span> <span class="keyword">BY</span> start_time SEPARATOR &quot;;&quot;) <span class="keyword">AS</span> detail</span><br><span class="line"><span class="keyword">FROM</span> exam_record a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> examination_info b <span class="keyword">ON</span> a.exam_id <span class="operator">=</span> b.exam_id</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">YEAR</span> (a.start_time)<span class="operator">=</span> <span class="number">2021</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> a.uid</span><br><span class="line"><span class="keyword">HAVING</span> incomplete_cnt <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> complete_cnt <span class="operator">&gt;=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> incomplete_cnt <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> incomplete_cnt <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>SUM(CASE WHEN a.submit_time IS NULL THEN 1 END)</code> 统计了每个用户未完成的记录数量。</li>
<li><code>SUM(CASE WHEN a.submit_time IS NOT NULL THEN 1 END)</code> 统计了每个用户已完成的记录数量。</li>
<li><code>GROUP_CONCAT(DISTINCT CONCAT(DATE_FORMAT(a.start_time, &#39;%Y-%m-%d&#39;), &#39;:&#39;, b.tag) ORDER BY a.start_time SEPARATOR &#39;;&#39;)</code> 将每个用户的考试日期和标签以逗号分隔的形式连接成一个字符串，并按考试开始时间进行排序。</li>
</ul>
<h2 id="嵌套子查询"><a href="#嵌套子查询" class="headerlink" title="嵌套子查询"></a>嵌套子查询</h2><h3 id="月均完成试卷数不小于-3-的用户爱作答的类别（较难）"><a href="#月均完成试卷数不小于-3-的用户爱作答的类别（较难）" class="headerlink" title="月均完成试卷数不小于 3 的用户爱作答的类别（较难）"></a>月均完成试卷数不小于 3 的用户爱作答的类别（较难）</h3><p><strong>描述</strong>：现有试卷作答记录表 <code>exam_record</code>（<code>uid</code>：用户 ID, <code>exam_id</code>：试卷 ID, <code>start_time</code>：开始作答时间, <code>submit_time</code>：交卷时间，没提交的话为 NULL, <code>score</code>：得分），示例数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-07-02 09:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:21:01</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-02 12:01:01</td>
<td>2021-09-02 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-05 19:01:01</td>
<td>2021-09-05 19:40:01</td>
<td>81</td>
</tr>
<tr>
<td>5</td>
<td>1002</td>
<td>9002</td>
<td>2021-07-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>6</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>86</td>
</tr>
<tr>
<td>7</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-08 12:01:01</td>
<td>2021-09-08 12:11:01</td>
<td>40</td>
</tr>
<tr>
<td>8</td>
<td>1003</td>
<td>9001</td>
<td>2021-09-08 13:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>9</td>
<td>1003</td>
<td>9002</td>
<td>2021-09-08 14:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>10</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-08 15:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>11</td>
<td>1005</td>
<td>9001</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>88</td>
</tr>
<tr>
<td>12</td>
<td>1005</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>88</td>
</tr>
<tr>
<td>13</td>
<td>1005</td>
<td>9002</td>
<td>2021-09-02 12:11:01</td>
<td>2021-09-02 12:31:01</td>
<td>89</td>
</tr>
</tbody></table>
<p>试卷信息表 <code>examination_info</code>（<code>exam_id</code>：试卷 ID, <code>tag</code>：试卷类别, <code>difficulty</code>：试卷难度, <code>duration</code>：考试时长, <code>release_time</code>：发布时间），示例数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>C++</td>
<td>easy</td>
<td>60</td>
<td>2020-02-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2020-08-02 10:00:00</td>
</tr>
</tbody></table>
<p>请从表中统计出 “当月均完成试卷数”不小于 3 的用户们爱作答的类别及作答次数，按次数降序输出，示例输出如下：</p>
<table>
<thead>
<tr>
<th>tag</th>
<th>tag_cnt</th>
</tr>
</thead>
<tbody><tr>
<td>C++</td>
<td>4</td>
</tr>
<tr>
<td>SQL</td>
<td>2</td>
</tr>
<tr>
<td>算法</td>
<td>1</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：用户 1002 和 1005 在 2021 年 09 月的完成试卷数目均为 3，其他用户均小于 3；然后用户 1002 和 1005 作答过的试卷 tag 分布结果按作答次数降序排序依次为 C++、SQL、算法。</p>
<p><strong>思路</strong>：这题考察联合子查询，重点在于<code>月均回答&gt;=3</code>, 但是个人认为这里没有表述清楚，应该直接说查 9 月的就容易理解多了；这里不是每个月都要&gt;&#x3D;3 或者是所有答题次数&#x2F;答题月份。不要理解错误了。</p>
<p>先查询出哪些用户月均答题大于三次</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> UID</span><br><span class="line"><span class="keyword">FROM</span> exam_record record</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> UID,</span><br><span class="line">         <span class="keyword">MONTH</span> (start_time)</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">count</span>(submit_time) <span class="operator">&gt;=</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>有了这一步之后再进行深入，只要能理解上一步(我的意思是不被题目中的月均所困扰)，然后再套一个子查询，查哪些用户包含其中，然后查出题目中所需的列即可。记得排序！！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tag,</span><br><span class="line">       <span class="built_in">count</span>(start_time) <span class="keyword">AS</span> tag_cnt</span><br><span class="line"><span class="keyword">FROM</span> exam_record record</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> examination_info info <span class="keyword">ON</span> record.exam_id <span class="operator">=</span> info.exam_id</span><br><span class="line"><span class="keyword">WHERE</span> UID <span class="keyword">IN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> UID</span><br><span class="line">     <span class="keyword">FROM</span> exam_record record</span><br><span class="line">     <span class="keyword">GROUP</span> <span class="keyword">BY</span> UID,</span><br><span class="line">              <span class="keyword">MONTH</span> (start_time)</span><br><span class="line">     <span class="keyword">HAVING</span> <span class="built_in">count</span>(submit_time) <span class="operator">&gt;=</span> <span class="number">3</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> tag</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> tag_cnt <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h3 id="试卷发布当天作答人数和平均分"><a href="#试卷发布当天作答人数和平均分" class="headerlink" title="试卷发布当天作答人数和平均分"></a>试卷发布当天作答人数和平均分</h3><p><strong>描述</strong>：现有用户信息表 <code>user_info</code>（<code>uid</code> 用户 ID，<code>nick_name</code> 昵称, <code>achievement</code> 成就值, <code>level</code> 等级, <code>job</code> 职业方向, <code>register_time</code> 注册时间），示例数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>nick_name</th>
<th>achievement</th>
<th>level</th>
<th>job</th>
<th>register_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>牛客 1 号</td>
<td>3100</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>牛客 2 号</td>
<td>2100</td>
<td>6</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>牛客 3 号</td>
<td>1500</td>
<td>5</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>4</td>
<td>1004</td>
<td>牛客 4 号</td>
<td>1100</td>
<td>4</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>5</td>
<td>1005</td>
<td>牛客 5 号</td>
<td>1600</td>
<td>6</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>6</td>
<td>1006</td>
<td>牛客 6 号</td>
<td>3000</td>
<td>6</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
</tbody></table>
<p><strong>释义</strong>：用户 1001 昵称为牛客 1 号，成就值为 3100，用户等级是 7 级，职业方向为算法，注册时间 2020-01-01 10:00:00</p>
<p>试卷信息表 <code>examination_info</code>（<code>exam_id</code> 试卷 ID, <code>tag</code> 试卷类别, <code>difficulty</code> 试卷难度, <code>duration</code> 考试时长, <code>release_time</code> 发布时间） 示例数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>C++</td>
<td>easy</td>
<td>60</td>
<td>2020-02-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2020-08-02 10:00:00</td>
</tr>
</tbody></table>
<p>试卷作答记录表 <code>exam_record</code>（<code>uid</code> 用户 ID, <code>exam_id</code> 试卷 ID, <code>start_time</code> 开始作答时间, <code>submit_time</code> 交卷时间, <code>score</code> 得分） 示例数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-07-02 09:01:01</td>
<td>2021-09-01 09:41:01</td>
<td>70</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:21:01</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-02 12:01:01</td>
<td>2021-09-02 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td>80</td>
</tr>
<tr>
<td>5</td>
<td>1002</td>
<td>9003</td>
<td>2021-08-01 12:01:01</td>
<td>2021-08-01 12:21:01</td>
<td>60</td>
</tr>
<tr>
<td>6</td>
<td>1002</td>
<td>9002</td>
<td>2021-08-02 12:01:01</td>
<td>2021-08-02 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>7</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td>85</td>
</tr>
<tr>
<td>8</td>
<td>1002</td>
<td>9002</td>
<td>2021-07-06 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>9</td>
<td>1003</td>
<td>9002</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>86</td>
</tr>
<tr>
<td>10</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-08 12:01:01</td>
<td>2021-09-08 12:11:01</td>
<td>40</td>
</tr>
<tr>
<td>11</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-01 13:01:01</td>
<td>2021-09-01 13:41:01</td>
<td>70</td>
</tr>
<tr>
<td>12</td>
<td>1003</td>
<td>9001</td>
<td>2021-09-08 14:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>13</td>
<td>1003</td>
<td>9002</td>
<td>2021-09-08 15:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>14</td>
<td>1005</td>
<td>9001</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>90</td>
</tr>
<tr>
<td>15</td>
<td>1005</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>88</td>
</tr>
<tr>
<td>16</td>
<td>1005</td>
<td>9002</td>
<td>2021-09-02 12:11:01</td>
<td>2021-09-02 12:31:01</td>
<td>89</td>
</tr>
</tbody></table>
<p>请计算每张 SQL 类别试卷发布后，当天 5 级以上的用户作答的人数 <code>uv</code> 和平均分 <code>avg_score</code>，按人数降序，相同人数的按平均分升序，示例数据结果输出如下：</p>
<table>
<thead>
<tr>
<th>exam_id</th>
<th>uv</th>
<th>avg_score</th>
</tr>
</thead>
<tbody><tr>
<td>9001</td>
<td>3</td>
<td>81.3</td>
</tr>
</tbody></table>
<p>解释：只有一张 SQL 类别的试卷，试卷 ID 为 9001，发布当天（2021-09-01）有 1001、1002、1003、1005 作答过，但是 1003 是 5 级用户，其他 3 位为 5 级以上，他们三的得分有[70,80,85,90]，平均分为 81.3（保留 1 位小数）。</p>
<p><strong>思路</strong>：这题看似很复杂，但是先逐步将“外边”条件拆分，然后合拢到一起，答案就出来，多表查询反正记住：由外向里，抽丝剥茧。</p>
<p>先把三种表连起来，同时给定一些条件，比如题目中要求<code>等级&gt; 5</code>的用户，那么可以先查出来</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> u_info.uid</span><br><span class="line"><span class="keyword">FROM</span> examination_info e_info</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> user_info u_info</span><br><span class="line"><span class="keyword">WHERE</span> e_info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">  <span class="keyword">AND</span> u_info.uid <span class="operator">=</span> record.uid</span><br><span class="line">  <span class="keyword">AND</span> u_info.LEVEL <span class="operator">&gt;</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>接着注意题目中要求：<code>每张sql类别试卷发布后，当天作答用户</code>，注意其中的&#x3D;&#x3D;当天&#x3D;&#x3D;，那我们马上就要想到要用到时间的比较。</p>
<p>对试卷发布日期和开始考试日期进行比较：<code>DATE(e_info.release_time) = DATE(record.start_time)</code>；不用担心<code>submit_time</code> 为 null 的问题，后续在 where 中会给过滤掉。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> record.exam_id <span class="keyword">AS</span> exam_id,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> u_info.uid) <span class="keyword">AS</span> uv,</span><br><span class="line">       ROUND(<span class="built_in">SUM</span>(record.score) <span class="operator">/</span> <span class="built_in">COUNT</span>(u_info.uid), <span class="number">1</span>) <span class="keyword">AS</span> avg_score</span><br><span class="line"><span class="keyword">FROM</span> examination_info e_info</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> user_info u_info</span><br><span class="line"><span class="keyword">WHERE</span> e_info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">  <span class="keyword">AND</span> u_info.uid <span class="operator">=</span> record.uid</span><br><span class="line">  <span class="keyword">AND</span> <span class="type">DATE</span> (e_info.release_time) <span class="operator">=</span> <span class="type">DATE</span> (record.start_time)</span><br><span class="line">  <span class="keyword">AND</span> submit_time <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">  <span class="keyword">AND</span> tag <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> u_info.LEVEL <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> record.exam_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> uv <span class="keyword">DESC</span>,</span><br><span class="line">         avg_score <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>

<p>注意最后的分组排序！先按人数排，若一致，按平均分排。</p>
<h3 id="作答试卷得分大于过-80-的人的用户等级分布"><a href="#作答试卷得分大于过-80-的人的用户等级分布" class="headerlink" title="作答试卷得分大于过 80 的人的用户等级分布"></a>作答试卷得分大于过 80 的人的用户等级分布</h3><p><strong>描述</strong>：</p>
<p>现有用户信息表 <code>user_info</code>（<code>uid</code> 用户 ID，<code>nick_name</code> 昵称, <code>achievement</code> 成就值, <code>level</code> 等级, <code>job</code> 职业方向, <code>register_time</code> 注册时间）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>nick_name</th>
<th>achievement</th>
<th>level</th>
<th>job</th>
<th>register_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>牛客 1 号</td>
<td>3100</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>牛客 2 号</td>
<td>2100</td>
<td>6</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>牛客 3 号</td>
<td>1500</td>
<td>5</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>4</td>
<td>1004</td>
<td>牛客 4 号</td>
<td>1100</td>
<td>4</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>5</td>
<td>1005</td>
<td>牛客 5 号</td>
<td>1600</td>
<td>6</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>6</td>
<td>1006</td>
<td>牛客 6 号</td>
<td>3000</td>
<td>6</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
</tbody></table>
<p>试卷信息表 <code>examination_info</code>（<code>exam_id</code> 试卷 ID, <code>tag</code> 试卷类别, <code>difficulty</code> 试卷难度, <code>duration</code> 考试时长, <code>release_time</code> 发布时间）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>C++</td>
<td>easy</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2021-09-01 10:00:00</td>
</tr>
</tbody></table>
<p>试卷作答信息表 <code>exam_record</code>（<code>uid</code> 用户 ID, <code>exam_id</code> 试卷 ID, <code>start_time</code> 开始作答时间, <code>submit_time</code> 交卷时间, <code>score</code> 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-09-01 09:01:01</td>
<td>2021-09-01 09:41:01</td>
<td>79</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9003</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:21:01</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td>80</td>
</tr>
<tr>
<td>5</td>
<td>1002</td>
<td>9003</td>
<td>2021-08-01 12:01:01</td>
<td>2021-08-01 12:21:01</td>
<td>60</td>
</tr>
<tr>
<td>6</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>7</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td>85</td>
</tr>
<tr>
<td>8</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>9</td>
<td>1003</td>
<td>9002</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:31:01</td>
<td>86</td>
</tr>
<tr>
<td>10</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-08 12:01:01</td>
<td>2021-09-08 12:11:01</td>
<td>40</td>
</tr>
<tr>
<td>11</td>
<td>1003</td>
<td>9003</td>
<td>2021-09-01 13:01:01</td>
<td>2021-09-01 13:41:01</td>
<td>81</td>
</tr>
<tr>
<td>12</td>
<td>1003</td>
<td>9001</td>
<td>2021-09-01 14:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>13</td>
<td>1003</td>
<td>9002</td>
<td>2021-09-08 15:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
<tr>
<td>14</td>
<td>1005</td>
<td>9001</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>90</td>
</tr>
<tr>
<td>15</td>
<td>1005</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>88</td>
</tr>
<tr>
<td>16</td>
<td>1005</td>
<td>9002</td>
<td>2021-09-02 12:11:01</td>
<td>2021-09-02 12:31:01</td>
<td>89</td>
</tr>
</tbody></table>
<p>统计作答 SQL 类别的试卷得分大于过 80 的人的用户等级分布，按数量降序排序（保证数量都不同）。示例数据结果输出如下：</p>
<table>
<thead>
<tr>
<th>level</th>
<th>level_cnt</th>
</tr>
</thead>
<tbody><tr>
<td>6</td>
<td>2</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
</tr>
</tbody></table>
<p>解释：9001 为 SQL 类试卷，作答该试卷大于 80 分的人有 1002、1003、1005 共 3 人，6 级两人，5 级一人。</p>
<p><strong>思路：</strong>这题和上一题都是一样的数据，只是查询条件改变了而已，上一题理解了，这题分分钟做出来。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> u_info.LEVEL <span class="keyword">AS</span> LEVEL,</span><br><span class="line">       <span class="built_in">count</span>(u_info.uid) <span class="keyword">AS</span> level_cnt</span><br><span class="line"><span class="keyword">FROM</span> examination_info e_info</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> user_info u_info</span><br><span class="line"><span class="keyword">WHERE</span> e_info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">  <span class="keyword">AND</span> u_info.uid <span class="operator">=</span> record.uid</span><br><span class="line">  <span class="keyword">AND</span> record.score <span class="operator">&gt;</span> <span class="number">80</span></span><br><span class="line">  <span class="keyword">AND</span> submit_time <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">  <span class="keyword">AND</span> tag <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> LEVEL</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> level_cnt <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h2 id="合并查询"><a href="#合并查询" class="headerlink" title="合并查询"></a>合并查询</h2><h3 id="每个题目和每份试卷被作答的人数和次数"><a href="#每个题目和每份试卷被作答的人数和次数" class="headerlink" title="每个题目和每份试卷被作答的人数和次数"></a>每个题目和每份试卷被作答的人数和次数</h3><p><strong>描述</strong>：</p>
<p>现有试卷作答记录表 exam_record（uid 用户 ID, exam_id 试卷 ID, start_time 开始作答时间, submit_time 交卷时间, score 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-09-01 09:01:01</td>
<td>2021-09-01 09:41:01</td>
<td>81</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td>80</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>5</td>
<td>1004</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td>85</td>
</tr>
<tr>
<td>6</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
</tbody></table>
<p>题目练习表 practice_record（uid 用户 ID, question_id 题目 ID, submit_time 提交时间, score 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>question_id</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>8001</td>
<td>2021-08-02 11:41:01</td>
<td>60</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>8001</td>
<td>2021-09-02 19:30:01</td>
<td>50</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>8001</td>
<td>2021-09-02 19:20:01</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>8002</td>
<td>2021-09-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>5</td>
<td>1003</td>
<td>8001</td>
<td>2021-08-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>6</td>
<td>1003</td>
<td>8001</td>
<td>2021-08-02 19:48:01</td>
<td>90</td>
</tr>
<tr>
<td>7</td>
<td>1003</td>
<td>8002</td>
<td>2021-08-01 19:38:01</td>
<td>80</td>
</tr>
</tbody></table>
<p>请统计每个题目和每份试卷被作答的人数和次数，分别按照”试卷”和”题目”的 uv &amp; pv 降序显示，示例数据结果输出如下：</p>
<table>
<thead>
<tr>
<th>tid</th>
<th>uv</th>
<th>pv</th>
</tr>
</thead>
<tbody><tr>
<td>9001</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>9002</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>8001</td>
<td>3</td>
<td>5</td>
</tr>
<tr>
<td>8002</td>
<td>2</td>
<td>2</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：“试卷”有 3 人共练习 3 次试卷 9001，1 人作答 3 次 9002；“刷题”有 3 人刷 5 次 8001，有 2 人刷 2 次 8002</p>
<p><strong>思路</strong>：这题的难点和易错点在于<code>UNION</code>和<code>ORDER BY</code> 同时使用的问题</p>
<p>有以下几种情况：使用<code>union</code>和多个<code>order by</code>不加括号，报错！</p>
<p><code>order by</code>在<code>union</code>连接的子句中不起作用；</p>
<p>比如不加括号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> exam_id <span class="keyword">AS</span> tid,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> UID) <span class="keyword">AS</span> uv,</span><br><span class="line">       <span class="built_in">COUNT</span>(UID) <span class="keyword">AS</span> pv</span><br><span class="line"><span class="keyword">FROM</span> exam_record</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> exam_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> uv <span class="keyword">DESC</span>,</span><br><span class="line">         pv <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> question_id <span class="keyword">AS</span> tid,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> UID) <span class="keyword">AS</span> uv,</span><br><span class="line">       <span class="built_in">COUNT</span>(UID) <span class="keyword">AS</span> pv</span><br><span class="line"><span class="keyword">FROM</span> practice_record</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> uv <span class="keyword">DESC</span>,</span><br><span class="line">         pv <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>直接报语法错误，如果没有括号，只能有一个<code>order by</code></p>
<p>还有一种<code>order by</code>不起作用的情况，但是能在子句的子句中起作用，这里的解决方案就是在外面再套一层查询。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  (<span class="keyword">SELECT</span> exam_id <span class="keyword">AS</span> tid,</span><br><span class="line">          <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> exam_record.uid) uv,</span><br><span class="line">          <span class="built_in">COUNT</span>(<span class="operator">*</span>) pv</span><br><span class="line">   <span class="keyword">FROM</span> exam_record</span><br><span class="line">   <span class="keyword">GROUP</span> <span class="keyword">BY</span> exam_id</span><br><span class="line">   <span class="keyword">ORDER</span> <span class="keyword">BY</span> uv <span class="keyword">DESC</span>, pv <span class="keyword">DESC</span>) t1</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  (<span class="keyword">SELECT</span> question_id <span class="keyword">AS</span> tid,</span><br><span class="line">          <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> practice_record.uid) uv,</span><br><span class="line">          <span class="built_in">COUNT</span>(<span class="operator">*</span>) pv</span><br><span class="line">   <span class="keyword">FROM</span> practice_record</span><br><span class="line">   <span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line">   <span class="keyword">ORDER</span> <span class="keyword">BY</span> uv <span class="keyword">DESC</span>, pv <span class="keyword">DESC</span>) t2;</span><br></pre></td></tr></table></figure>

<h3 id="分别满足两个活动的人"><a href="#分别满足两个活动的人" class="headerlink" title="分别满足两个活动的人"></a>分别满足两个活动的人</h3><p><strong>描述</strong>： 为了促进更多用户在牛客平台学习和刷题进步，我们会经常给一些既活跃又表现不错的用户发放福利。假使以前我们有两拨运营活动，分别给每次试卷得分都能到 85 分的人（activity1）、至少有一次用了一半时间就完成高难度试卷且分数大于 80 的人（activity2）发了福利券。</p>
<p>现在，需要你一次性将这两个活动满足的人筛选出来，交给运营同学。请写出一个 SQL 实现：输出 2021 年里，所有每次试卷得分都能到 85 分的人以及至少有一次用了一半时间就完成高难度试卷且分数大于 80 的人的 id 和活动号，按用户 ID 排序输出。</p>
<p>现有试卷信息表 <code>examination_info</code>（<code>exam_id</code> 试卷 ID, <code>tag</code> 试卷类别, <code>difficulty</code> 试卷难度, <code>duration</code> 考试时长, <code>release_time</code> 发布时间）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>C++</td>
<td>easy</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2021-09-01 10:00:00</td>
</tr>
</tbody></table>
<p>试卷作答记录表 <code>exam_record</code>（<code>uid</code> 用户 ID, <code>exam_id</code> 试卷 ID, <code>start_time</code> 开始作答时间, <code>submit_time</code> 交卷时间, <code>score</code> 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-09-01 09:01:01</td>
<td>2021-09-01 09:31:00</td>
<td>81</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>70</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td><strong>86</strong></td>
</tr>
<tr>
<td>4</td>
<td>1003</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>89</td>
</tr>
<tr>
<td>5</td>
<td>1004</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:30:01</td>
<td>85</td>
</tr>
</tbody></table>
<p>示例数据输出结果：</p>
<table>
<thead>
<tr>
<th>uid</th>
<th>activity</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>activity2</td>
</tr>
<tr>
<td>1003</td>
<td>activity1</td>
</tr>
<tr>
<td>1004</td>
<td>activity1</td>
</tr>
<tr>
<td>1004</td>
<td>activity2</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：用户 1001 最小分数 81 不满足活动 1，但 29 分 59 秒完成了 60 分钟长的试卷得分 81，满足活动 2；1003 最小分数 86 满足活动 1，完成时长都大于试卷时长的一半，不满足活动 2；用户 1004 刚好用了一半时间（30 分钟整）完成了试卷得分 85，满足活动 1 和活动 2。</p>
<p><strong>思路</strong>： 这一题需要涉及到时间的减法，需要用到 <code>TIMESTAMPDIFF()</code> 函数计算两个时间戳之间的分钟差值。</p>
<p>下面我们来看一下基本用法</p>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TIMESTAMPDIFF(<span class="keyword">MINUTE</span>, start_time, end_time)</span><br></pre></td></tr></table></figure>

<p><code>TIMESTAMPDIFF()</code> 函数的第一个参数是时间单位，这里我们选择 <code>MINUTE</code> 表示返回分钟差值。第二个参数是较早的时间戳，第三个参数是较晚的时间戳。函数会返回它们之间的分钟差值</p>
<p>了解了这个函数的用法之后，我们再回过头来看<code>activity1</code>的要求，求分数大于 85 即可，那我们还是先把这个写出来，后续思路就会清晰很多</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> UID</span><br><span class="line"><span class="keyword">FROM</span> exam_record</span><br><span class="line"><span class="keyword">WHERE</span> score <span class="operator">&gt;=</span> <span class="number">85</span></span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">YEAR</span> (start_time) <span class="operator">=</span> <span class="string">&#x27;2021&#x27;</span></span><br></pre></td></tr></table></figure>

<p>根据条件 2，接着写出<code>在一半时间内完成高难度试卷且分数大于80的人</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> UID</span><br><span class="line"><span class="keyword">FROM</span> examination_info info</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> exam_record record</span><br><span class="line"><span class="keyword">WHERE</span> info.exam_id <span class="operator">=</span> record.exam_id</span><br><span class="line">  <span class="keyword">AND</span> (TIMESTAMPDIFF(<span class="keyword">MINUTE</span>, start_time, submit_time)) <span class="operator">&lt;</span> (info.duration <span class="operator">/</span> <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">AND</span> difficulty <span class="operator">=</span> <span class="string">&#x27;hard&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> score <span class="operator">&gt;=</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>然后再把两者<code>UNION</code> 起来即可。（这里特别要注意括号问题和<code>order by</code>位置，具体用法在上一篇中已提及）</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> UID UID,</span><br><span class="line">                    <span class="string">&#x27;activity1&#x27;</span> activity</span><br><span class="line"><span class="keyword">FROM</span> exam_record</span><br><span class="line"><span class="keyword">WHERE</span> UID <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">    (<span class="keyword">SELECT</span> UID</span><br><span class="line">     <span class="keyword">FROM</span> exam_record</span><br><span class="line">     <span class="keyword">WHERE</span> score<span class="operator">&lt;</span><span class="number">85</span></span><br><span class="line">       <span class="keyword">AND</span> <span class="keyword">YEAR</span>(submit_time) <span class="operator">=</span> <span class="number">2021</span> )</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> UID UID,</span><br><span class="line">                    <span class="string">&#x27;activity2&#x27;</span> activity</span><br><span class="line"><span class="keyword">FROM</span> exam_record e_r</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> examination_info e_i <span class="keyword">ON</span> e_r.exam_id <span class="operator">=</span> e_i.exam_id</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(submit_time) <span class="operator">=</span> <span class="number">2021</span></span><br><span class="line">  <span class="keyword">AND</span> difficulty <span class="operator">=</span> <span class="string">&#x27;hard&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> TIMESTAMPDIFF(<span class="keyword">SECOND</span>, start_time, submit_time) <span class="operator">&lt;=</span> duration <span class="operator">*</span><span class="number">30</span></span><br><span class="line">  <span class="keyword">AND</span> score<span class="operator">&gt;</span><span class="number">80</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> UID</span><br></pre></td></tr></table></figure>

<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><h3 id="满足条件的用户的试卷完成数和题目练习数（困难）"><a href="#满足条件的用户的试卷完成数和题目练习数（困难）" class="headerlink" title="满足条件的用户的试卷完成数和题目练习数（困难）"></a>满足条件的用户的试卷完成数和题目练习数（困难）</h3><p><strong>描述</strong>：</p>
<p>现有用户信息表 user_info（uid 用户 ID，nick_name 昵称, achievement 成就值, level 等级, job 职业方向, register_time 注册时间）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>nick_name</th>
<th>achievement</th>
<th>level</th>
<th>job</th>
<th>register_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>牛客 1 号</td>
<td>3100</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>牛客 2 号</td>
<td>2300</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>牛客 3 号</td>
<td>2500</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>4</td>
<td>1004</td>
<td>牛客 4 号</td>
<td>1200</td>
<td>5</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>5</td>
<td>1005</td>
<td>牛客 5 号</td>
<td>1600</td>
<td>6</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>6</td>
<td>1006</td>
<td>牛客 6 号</td>
<td>2000</td>
<td>6</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
</tbody></table>
<p>试卷信息表 examination_info（exam_id 试卷 ID, tag 试卷类别, difficulty 试卷难度, duration 考试时长, release_time 发布时间）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>C++</td>
<td>hard</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2021-09-01 10:00:00</td>
</tr>
</tbody></table>
<p>试卷作答记录表 exam_record（uid 用户 ID, exam_id 试卷 ID, start_time 开始作答时间, submit_time 交卷时间, score 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>9001</td>
<td>2021-09-01 09:01:01</td>
<td>2021-09-01 09:31:00</td>
<td>81</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:01</td>
<td>81</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:40:01</td>
<td>86</td>
</tr>
<tr>
<td>4</td>
<td>1003</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:51</td>
<td>89</td>
</tr>
<tr>
<td>5</td>
<td>1004</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:30:01</td>
<td>85</td>
</tr>
<tr>
<td>6</td>
<td>1005</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:02</td>
<td>85</td>
</tr>
<tr>
<td>7</td>
<td>1006</td>
<td>9003</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:21:01</td>
<td>84</td>
</tr>
<tr>
<td>8</td>
<td>1006</td>
<td>9001</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:21:01</td>
<td>80</td>
</tr>
</tbody></table>
<p>题目练习记录表 practice_record（uid 用户 ID, question_id 题目 ID, submit_time 提交时间, score 得分）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>question_id</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>8001</td>
<td>2021-08-02 11:41:01</td>
<td>60</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>8001</td>
<td>2021-09-02 19:30:01</td>
<td>50</td>
</tr>
<tr>
<td>3</td>
<td>1002</td>
<td>8001</td>
<td>2021-09-02 19:20:01</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>1002</td>
<td>8002</td>
<td>2021-09-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>5</td>
<td>1004</td>
<td>8001</td>
<td>2021-08-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>6</td>
<td>1004</td>
<td>8002</td>
<td>2021-08-02 19:48:01</td>
<td>90</td>
</tr>
<tr>
<td>7</td>
<td>1001</td>
<td>8002</td>
<td>2021-08-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>8</td>
<td>1004</td>
<td>8002</td>
<td>2021-08-02 19:48:01</td>
<td>90</td>
</tr>
<tr>
<td>9</td>
<td>1004</td>
<td>8002</td>
<td>2021-08-02 19:58:01</td>
<td>94</td>
</tr>
<tr>
<td>10</td>
<td>1004</td>
<td>8003</td>
<td>2021-08-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>11</td>
<td>1004</td>
<td>8003</td>
<td>2021-08-02 19:48:01</td>
<td>90</td>
</tr>
<tr>
<td>12</td>
<td>1004</td>
<td>8003</td>
<td>2021-08-01 19:38:01</td>
<td>80</td>
</tr>
</tbody></table>
<p>请你找到高难度 SQL 试卷得分平均值大于 80 并且是 7 级的红名大佬，统计他们的 2021 年试卷总完成次数和题目总练习次数，只保留 2021 年有试卷完成记录的用户。结果按试卷完成数升序，按题目练习数降序。</p>
<p>示例数据输出如下：</p>
<table>
<thead>
<tr>
<th>uid</th>
<th>exam_cnt</th>
<th>question_cnt</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>1003</td>
<td>2</td>
<td>0</td>
</tr>
</tbody></table>
<p>解释：用户 1001、1003、1004、1006 满足高难度 SQL 试卷得分平均值大于 80，但只有 1001、1003 是 7 级红名大佬；1001 完成了 1 次试卷 1001，练习了 2 次题目；1003 完成了 2 次试卷 9001、9002，未练习题目（因此计数为 0）</p>
<p><strong>思路：</strong></p>
<p>先将条件进行初步筛选，比如先查出做过高难度 sql 试卷的用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	record.uid</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	exam_record record</span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> examination_info e_info <span class="keyword">ON</span> record.exam_id <span class="operator">=</span> e_info.exam_id</span><br><span class="line">	<span class="keyword">JOIN</span> user_info u_info <span class="keyword">ON</span> record.uid <span class="operator">=</span> u_info.uid</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	e_info.tag <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">	<span class="keyword">AND</span> e_info.difficulty <span class="operator">=</span> <span class="string">&#x27;hard&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后根据题目要求，接着再往里叠条件即可；</p>
<p>但是这里又要注意：</p>
<p>第一：不能<code>YEAR(submit_time)= 2021</code>这个条件放到最后，要在<code>ON</code>条件里，因为左连接存在返回左表全部行，右表为 null 的情形，放在 <code>JOIN</code>条件的 <code>ON</code> 子句中的目的是为了确保在连接两个表时，只有满足年份条件的记录会进行连接。这样可以避免其他年份的记录被包含在结果中。即 1001 做过 2021 年的试卷，但没有练习过，如果把条件放到最后，就会排除掉这种情况。</p>
<p>第二，必须是<code>COUNT(distinct er.exam_id) exam_cnt, COUNT(distinct pr.id) question_cnt，</code>要加 distinct，因为有左连接产生很多重复值。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> er.uid <span class="keyword">AS</span> UID,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> er.exam_id) <span class="keyword">AS</span> exam_cnt,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> pr.id) <span class="keyword">AS</span> question_cnt</span><br><span class="line"><span class="keyword">FROM</span> exam_record er</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> practice_record pr <span class="keyword">ON</span> er.uid <span class="operator">=</span> pr.uid</span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">YEAR</span> (er.submit_time)<span class="operator">=</span> <span class="number">2021</span></span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">YEAR</span> (pr.submit_time)<span class="operator">=</span> <span class="number">2021</span></span><br><span class="line"><span class="keyword">WHERE</span> er.uid <span class="keyword">IN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> er.uid</span><br><span class="line">     <span class="keyword">FROM</span> exam_record er</span><br><span class="line">     <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> examination_info ei <span class="keyword">ON</span> er.exam_id <span class="operator">=</span> ei.exam_id</span><br><span class="line">     <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> user_info ui <span class="keyword">ON</span> er.uid <span class="operator">=</span> ui.uid</span><br><span class="line">     <span class="keyword">WHERE</span> tag <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">       <span class="keyword">AND</span> difficulty <span class="operator">=</span> <span class="string">&#x27;hard&#x27;</span></span><br><span class="line">       <span class="keyword">AND</span> LEVEL <span class="operator">=</span> <span class="number">7</span></span><br><span class="line">     <span class="keyword">GROUP</span> <span class="keyword">BY</span> er.uid</span><br><span class="line">     <span class="keyword">HAVING</span> <span class="built_in">avg</span>(score) <span class="operator">&gt;</span> <span class="number">80</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> er.uid</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> exam_cnt,</span><br><span class="line">         question_cnt <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>可能细心的小伙伴会发现，为什么明明将条件限制了<code>tag = &#39;SQL&#39; AND difficulty = &#39;hard&#39;</code>，但是用户 1003 仍然能查出两条考试记录，其中一条的考试<code>tag</code>为 <code>C++</code>; 这是由于<code>LEFT JOIN</code>的特性，即使没有与右表匹配的行，左表的所有记录仍然会被保留。</p>
<h3 id="每个-6-7-级用户活跃情况（困难）"><a href="#每个-6-7-级用户活跃情况（困难）" class="headerlink" title="每个 6&#x2F;7 级用户活跃情况（困难）"></a>每个 6&#x2F;7 级用户活跃情况（困难）</h3><p><strong>描述</strong>：</p>
<p>现有用户信息表 <code>user_info</code>（<code>uid</code> 用户 ID，<code>nick_name</code> 昵称, <code>achievement</code> 成就值, <code>level</code> 等级, <code>job</code> 职业方向, <code>register_time</code> 注册时间）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>uid</th>
<th>nick_name</th>
<th>achievement</th>
<th>level</th>
<th>job</th>
<th>register_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1001</td>
<td>牛客 1 号</td>
<td>3100</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>牛客 2 号</td>
<td>2300</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>牛客 3 号</td>
<td>2500</td>
<td>7</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>4</td>
<td>1004</td>
<td>牛客 4 号</td>
<td>1200</td>
<td>5</td>
<td>算法</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>5</td>
<td>1005</td>
<td>牛客 5 号</td>
<td>1600</td>
<td>6</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
<tr>
<td>6</td>
<td>1006</td>
<td>牛客 6 号</td>
<td>2600</td>
<td>7</td>
<td>C++</td>
<td>2020-01-01 10:00:00</td>
</tr>
</tbody></table>
<p>试卷信息表 <code>examination_info</code>（<code>exam_id</code> 试卷 ID, <code>tag</code> 试卷类别, <code>difficulty</code> 试卷难度, <code>duration</code> 考试时长, <code>release_time</code> 发布时间）：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>exam_id</th>
<th>tag</th>
<th>difficulty</th>
<th>duration</th>
<th>release_time</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>9001</td>
<td>SQL</td>
<td>hard</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>2</td>
<td>9002</td>
<td>C++</td>
<td>easy</td>
<td>60</td>
<td>2021-09-01 06:00:00</td>
</tr>
<tr>
<td>3</td>
<td>9003</td>
<td>算法</td>
<td>medium</td>
<td>80</td>
<td>2021-09-01 10:00:00</td>
</tr>
</tbody></table>
<p>试卷作答记录表 <code>exam_record</code>（<code>uid</code> 用户 ID, <code>exam_id</code> 试卷 ID, <code>start_time</code> 开始作答时间, <code>submit_time</code> 交卷时间, <code>score</code> 得分）：</p>
<table>
<thead>
<tr>
<th>uid</th>
<th>exam_id</th>
<th>start_time</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>9001</td>
<td>2021-09-01 09:01:01</td>
<td>2021-09-01 09:31:00</td>
<td>78</td>
</tr>
<tr>
<td>1001</td>
<td>9001</td>
<td>2021-09-01 09:01:01</td>
<td>2021-09-01 09:31:00</td>
<td>81</td>
</tr>
<tr>
<td>1005</td>
<td>9001</td>
<td>2021-09-01 19:01:01</td>
<td>2021-09-01 19:30:01</td>
<td>85</td>
</tr>
<tr>
<td>1005</td>
<td>9002</td>
<td>2021-09-01 12:01:01</td>
<td>2021-09-01 12:31:02</td>
<td>85</td>
</tr>
<tr>
<td>1006</td>
<td>9003</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:21:59</td>
<td>84</td>
</tr>
<tr>
<td>1006</td>
<td>9001</td>
<td>2021-09-07 10:01:01</td>
<td>2021-09-07 10:21:01</td>
<td>81</td>
</tr>
<tr>
<td>1002</td>
<td>9001</td>
<td>2020-09-01 13:01:01</td>
<td>2020-09-01 13:41:01</td>
<td>81</td>
</tr>
<tr>
<td>1005</td>
<td>9001</td>
<td>2021-09-01 14:01:01</td>
<td>(NULL)</td>
<td>(NULL)</td>
</tr>
</tbody></table>
<p>题目练习记录表 <code>practice_record</code>（<code>uid</code> 用户 ID, <code>question_id</code> 题目 ID, <code>submit_time</code> 提交时间, <code>score</code> 得分）：</p>
<table>
<thead>
<tr>
<th>uid</th>
<th>question_id</th>
<th>submit_time</th>
<th>score</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>8001</td>
<td>2021-08-02 11:41:01</td>
<td>60</td>
</tr>
<tr>
<td>1004</td>
<td>8001</td>
<td>2021-08-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>1004</td>
<td>8002</td>
<td>2021-08-02 19:48:01</td>
<td>90</td>
</tr>
<tr>
<td>1001</td>
<td>8002</td>
<td>2021-08-02 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>1004</td>
<td>8002</td>
<td>2021-08-02 19:48:01</td>
<td>90</td>
</tr>
<tr>
<td>1006</td>
<td>8002</td>
<td>2021-08-04 19:58:01</td>
<td>94</td>
</tr>
<tr>
<td>1006</td>
<td>8003</td>
<td>2021-08-03 19:38:01</td>
<td>70</td>
</tr>
<tr>
<td>1006</td>
<td>8003</td>
<td>2021-08-02 19:48:01</td>
<td>90</td>
</tr>
<tr>
<td>1006</td>
<td>8003</td>
<td>2020-08-01 19:38:01</td>
<td>80</td>
</tr>
</tbody></table>
<p>请统计每个 6&#x2F;7 级用户总活跃月份数、2021 年活跃天数、2021 年试卷作答活跃天数、2021 年答题活跃天数，按照总活跃月份数、2021 年活跃天数降序排序。由示例数据结果输出如下：</p>
<table>
<thead>
<tr>
<th>uid</th>
<th>act_month_total</th>
<th>act_days_2021</th>
<th>act_days_2021_exam</th>
</tr>
</thead>
<tbody><tr>
<td>1006</td>
<td>3</td>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>1001</td>
<td>2</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>1005</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1002</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1003</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<p><strong>解释</strong>：6&#x2F;7 级用户共有 5 个，其中 1006 在 202109、202108、202008 共 3 个月活跃过，2021 年活跃的日期有 20210907、20210804、20210803、20210802 共 4 天，2021 年在试卷作答区 20210907 活跃 1 天，在题目练习区活跃了 3 天。</p>
<p><strong>思路：</strong></p>
<p>这题的关键在于<code>CASE WHEN THEN</code>的使用，不然要写很多的<code>left join</code> 因为会产生很多的结果集。</p>
<p><code>CASE WHEN THEN</code>语句是一种条件表达式，用于在 SQL 中根据条件执行不同的操作或返回不同的结果。</p>
<p>语法结构如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> condition1 <span class="keyword">THEN</span> result1</span><br><span class="line">    <span class="keyword">WHEN</span> condition2 <span class="keyword">THEN</span> result2</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>在这个结构中，可以根据需要添加多个<code>WHEN</code>子句，每个<code>WHEN</code>子句后面跟着一个条件（condition）和一个结果（result）。条件可以是任何逻辑表达式，如果满足条件，将返回对应的结果。</p>
<p>最后的<code>ELSE</code>子句是可选的，用于指定当所有前面的条件都不满足时的默认返回结果。如果没有提供<code>ELSE</code>子句，则默认返回<code>NULL</code>。</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> score,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="string">&#x27;优秀&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">80</span> <span class="keyword">THEN</span> <span class="string">&#x27;良好&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="string">&#x27;及格&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;不及格&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> grade</span><br><span class="line"><span class="keyword">FROM</span> student_scores;</span><br></pre></td></tr></table></figure>

<p>在上述示例中，根据学生成绩（score）的不同范围，使用 CASE WHEN THEN 语句返回相应的等级（grade）。如果成绩大于等于 90，则返回”优秀”；如果成绩大于等于 80，则返回”良好”；如果成绩大于等于 60，则返回”及格”；否则返回”不及格”。</p>
<p>那了解到了上述的用法之后，回过头看看该题，要求列出不同的活跃天数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> act_month) <span class="keyword">as</span> act_month_total,</span><br><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">year</span>(act_time)<span class="operator">=</span><span class="string">&#x27;2021&#x27;</span><span class="keyword">then</span> act_day <span class="keyword">end</span>) <span class="keyword">as</span> act_days_2021,</span><br><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">year</span>(act_time)<span class="operator">=</span><span class="string">&#x27;2021&#x27;</span> <span class="keyword">and</span> tag<span class="operator">=</span><span class="string">&#x27;exam&#x27;</span> <span class="keyword">then</span> act_day <span class="keyword">end</span>) <span class="keyword">as</span> act_days_2021_exam,</span><br><span class="line"><span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">year</span>(act_time)<span class="operator">=</span><span class="string">&#x27;2021&#x27;</span> <span class="keyword">and</span> tag<span class="operator">=</span><span class="string">&#x27;question&#x27;</span><span class="keyword">then</span> act_day <span class="keyword">end</span>) <span class="keyword">as</span> act_days_2021_question</span><br></pre></td></tr></table></figure>

<p>这里的 tag 是先给标记，方便对查询进行区分，将考试和答题分开。</p>
<p>找出试卷作答区的用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">		uid,</span><br><span class="line">		exam_id <span class="keyword">AS</span> ans_id,</span><br><span class="line">		start_time <span class="keyword">AS</span> act_time,</span><br><span class="line">		date_format( start_time, <span class="string">&#x27;%Y%m&#x27;</span> ) <span class="keyword">AS</span> act_month,</span><br><span class="line">		date_format( start_time, <span class="string">&#x27;%Y%m%d&#x27;</span> ) <span class="keyword">AS</span> act_day,</span><br><span class="line">		<span class="string">&#x27;exam&#x27;</span> <span class="keyword">AS</span> tag</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		exam_record</span><br></pre></td></tr></table></figure>

<p>紧接着就是答题作答区的用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">		uid,</span><br><span class="line">		question_id <span class="keyword">AS</span> ans_id,</span><br><span class="line">		submit_time <span class="keyword">AS</span> act_time,</span><br><span class="line">		date_format( submit_time, <span class="string">&#x27;%Y%m&#x27;</span> ) <span class="keyword">AS</span> act_month,</span><br><span class="line">		date_format( submit_time, <span class="string">&#x27;%Y%m%d&#x27;</span> ) <span class="keyword">AS</span> act_day,</span><br><span class="line">		<span class="string">&#x27;question&#x27;</span> <span class="keyword">AS</span> tag</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		practice_record</span><br></pre></td></tr></table></figure>

<p>最后将两个结果进行<code>UNION</code> 最后别忘了将结果进行排序 （这题有点类似于分治法的思想）</p>
<p><strong>答案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_info.uid,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> act_month) <span class="keyword">AS</span> act_month_total,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span></span><br><span class="line">                          <span class="keyword">WHEN</span> <span class="keyword">YEAR</span> (act_time)<span class="operator">=</span> <span class="string">&#x27;2021&#x27;</span> <span class="keyword">THEN</span> act_day</span><br><span class="line">                      <span class="keyword">END</span>) <span class="keyword">AS</span> act_days_2021,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span></span><br><span class="line">                          <span class="keyword">WHEN</span> <span class="keyword">YEAR</span> (act_time)<span class="operator">=</span> <span class="string">&#x27;2021&#x27;</span></span><br><span class="line">                               <span class="keyword">AND</span> tag <span class="operator">=</span> <span class="string">&#x27;exam&#x27;</span> <span class="keyword">THEN</span> act_day</span><br><span class="line">                      <span class="keyword">END</span>) <span class="keyword">AS</span> act_days_2021_exam,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span></span><br><span class="line">                          <span class="keyword">WHEN</span> <span class="keyword">YEAR</span> (act_time)<span class="operator">=</span> <span class="string">&#x27;2021&#x27;</span></span><br><span class="line">                               <span class="keyword">AND</span> tag <span class="operator">=</span> <span class="string">&#x27;question&#x27;</span> <span class="keyword">THEN</span> act_day</span><br><span class="line">                      <span class="keyword">END</span>) <span class="keyword">AS</span> act_days_2021_question</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  (<span class="keyword">SELECT</span> UID,</span><br><span class="line">          exam_id <span class="keyword">AS</span> ans_id,</span><br><span class="line">          start_time <span class="keyword">AS</span> act_time,</span><br><span class="line">          date_format(start_time, <span class="string">&#x27;%Y%m&#x27;</span>) <span class="keyword">AS</span> act_month,</span><br><span class="line">          date_format(start_time, <span class="string">&#x27;%Y%m%d&#x27;</span>) <span class="keyword">AS</span> act_day,</span><br><span class="line">          <span class="string">&#x27;exam&#x27;</span> <span class="keyword">AS</span> tag</span><br><span class="line">   <span class="keyword">FROM</span> exam_record</span><br><span class="line">   <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> UID,</span><br><span class="line">                    question_id <span class="keyword">AS</span> ans_id,</span><br><span class="line">                    submit_time <span class="keyword">AS</span> act_time,</span><br><span class="line">                    date_format(submit_time, <span class="string">&#x27;%Y%m&#x27;</span>) <span class="keyword">AS</span> act_month,</span><br><span class="line">                    date_format(submit_time, <span class="string">&#x27;%Y%m%d&#x27;</span>) <span class="keyword">AS</span> act_day,</span><br><span class="line">                    <span class="string">&#x27;question&#x27;</span> <span class="keyword">AS</span> tag</span><br><span class="line">   <span class="keyword">FROM</span> practice_record) total</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> user_info <span class="keyword">ON</span> total.uid <span class="operator">=</span> user_info.uid</span><br><span class="line"><span class="keyword">WHERE</span> user_info.LEVEL <span class="keyword">IN</span> (<span class="number">6</span>,</span><br><span class="line">                          <span class="number">7</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_info.uid</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> act_month_total <span class="keyword">DESC</span>,</span><br><span class="line">         act_days_2021 <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/11/01/Vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/01/Vue/" itemprop="url">Vue精要</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-01T17:01:55+08:00">
                2024-11-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/11/01/Vue/" class="leancloud_visitors" data-flag-title="Vue精要">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.5k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Vue-js-基础知识与特性"><a href="#Vue-js-基础知识与特性" class="headerlink" title="Vue.js 基础知识与特性"></a>Vue.js 基础知识与特性</h1><h2 id="1-简单使用总结"><a href="#1-简单使用总结" class="headerlink" title="1. 简单使用总结"></a>1. 简单使用总结</h2><h3 id="1-1-使用-Vue-实例管理-DOM"><a href="#1-1-使用-Vue-实例管理-DOM" class="headerlink" title="1.1 使用 Vue 实例管理 DOM"></a>1.1 使用 Vue 实例管理 DOM</h3><ul>
<li><strong>核心思想</strong>：Vue 实例将页面元素和数据联系起来，通过双向绑定机制，使开发者只需关注数据和事件的处理，无需手动修改视图。</li>
<li><strong>DOM 与数据&#x2F;事件绑定</strong>：Vue 提供了简洁的语法来实现数据绑定和事件监听，使得开发更加高效。</li>
</ul>
<h3 id="1-2-Vue-实例的工作过程"><a href="#1-2-Vue-实例的工作过程" class="headerlink" title="1.2 Vue 实例的工作过程"></a>1.2 Vue 实例的工作过程</h3><ol>
<li><strong>HTML 加载</strong>：首先加载 HTML 文件，包括容器（如 <code>&lt;div&gt;</code>）。</li>
<li><strong>Vue 初始化</strong>：创建 Vue 实例时，Vue 会解析绑定的容器中的模板，生成处理后的新容器，并替换原有的容器。</li>
<li><strong>模板解析</strong>：容器中的代码成为模板，Vue 通过 <code>&#123;&#123;&#125;&#125;</code> 占位符进行插值，类似于 MyBatis 中的 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code>。</li>
<li><strong>容器与实例关系</strong>：容器和 Vue 实例是一对一的关系。在真实开发中，通常只会有一个 Vue 实例，并且会配合组件一起使用。</li>
</ol>
<h3 id="1-3-模板语法"><a href="#1-3-模板语法" class="headerlink" title="1.3 模板语法"></a>1.3 模板语法</h3><ul>
<li><strong>插值</strong>：用于插入数据到标签内容中，如 <code>&#123;&#123; message &#125;&#125;</code>。</li>
<li><strong>指令</strong>：用于绑定属性、事件等，所有指令都以 <code>v-</code> 开头，例如 <code>v-bind</code>、<code>v-on</code>。</li>
</ul>
<h2 id="2-组件化编程"><a href="#2-组件化编程" class="headerlink" title="2. 组件化编程"></a>2. 组件化编程</h2><h3 id="2-1-组件的本质"><a href="#2-1-组件的本质" class="headerlink" title="2.1 组件的本质"></a>2.1 组件的本质</h3><ul>
<li><strong>组件是 Vue 实例</strong>：组件本质上是一个 Vue 实例，因此它可以接收 <code>data</code>、<code>methods</code>、生命周期函数等选项。</li>
<li><strong>无 <code>el</code> 属性</strong>：组件不会直接与页面元素绑定，否则无法复用。因此，组件没有 <code>el</code> 属性。</li>
<li><strong><code>template</code> 属性</strong>：组件需要一个 HTML 模板，因此增加了 <code>template</code> 属性，其值为 HTML 模板。</li>
</ul>
<h3 id="2-2-组件定义"><a href="#2-2-组件定义" class="headerlink" title="2.2 组件定义"></a>2.2 组件定义</h3><ul>
<li><strong>全局组件</strong>：定义完毕后，任何 Vue 实例都可以直接在 HTML 中通过组件名称来使用组件。</li>
<li><strong>局部组件</strong>：仅在特定的 Vue 实例或父组件中注册和使用。</li>
</ul>
<h3 id="2-3-数据与方法"><a href="#2-3-数据与方法" class="headerlink" title="2.3 数据与方法"></a>2.3 数据与方法</h3><ul>
<li><strong><code>data</code> 必须是函数</strong>：为了确保每个组件实例都有独立的数据副本，<code>data</code> 必须是一个返回对象的函数，而不是直接的对象。</li>
<li><strong>原型链</strong>：组件的构造函数（如 <code>VueComponent</code>）具有 <code>prototype</code> 属性，实例对象（如 <code>vc</code>）则通过 <code>__proto__</code> 隐式引用构造函数的原型对象。</li>
</ul>
<h3 id="2-4-示例"><a href="#2-4-示例" class="headerlink" title="2.4 示例"></a>2.4 示例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全局组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;MyComponent&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">title</span>: <span class="string">&#x27;Hello Vue!&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">content</span>: <span class="string">&#x27;This is a Vue component.&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">greet</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">alert</span>(<span class="string">&#x27;Hello!&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-生命周期"><a href="#3-生命周期" class="headerlink" title="3. 生命周期"></a>3. 生命周期</h2><h3 id="3-1-生命周期钩子"><a href="#3-1-生命周期钩子" class="headerlink" title="3.1 生命周期钩子"></a>3.1 生命周期钩子</h3><p>每个 Vue 实例在被创建时都要经过一系列的初始化过程，Vue 为生命周期中的每个状态都设置了钩子函数（监听函数）。每当 Vue 实例处于不同的生命周期阶段时，对应的函数就会被触发调用。</p>
<h3 id="3-2-常见钩子函数"><a href="#3-2-常见钩子函数" class="headerlink" title="3.2 常见钩子函数"></a>3.2 常见钩子函数</h3><table>
<thead>
<tr>
<th>钩子函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>beforeCreate</code></td>
<td>在实例初始化之后，数据观测 (data observer) 和 event&#x2F;watcher 事件配置之前被调用。</td>
</tr>
<tr>
<td><code>created</code></td>
<td>在实例创建完成后被调用，此时已完成数据观测、属性和方法的运算，但尚未挂载到 DOM。</td>
</tr>
<tr>
<td><code>beforeMount</code></td>
<td>在挂载开始之前被调用，相关的 render 函数首次被调用。</td>
</tr>
<tr>
<td><code>mounted</code></td>
<td>在实例挂载到 DOM 后被调用，此时可以访问到真实的 DOM 节点。</td>
</tr>
<tr>
<td><code>beforeUpdate</code></td>
<td>在数据更新时调用，发生在虚拟 DOM 打补丁之前。</td>
</tr>
<tr>
<td><code>updated</code></td>
<td>在数据更新后，虚拟 DOM 重新渲染并打补丁后调用。</td>
</tr>
<tr>
<td><code>beforeDestroy</code></td>
<td>在实例销毁之前调用，此时实例仍然完全可用。</td>
</tr>
<tr>
<td><code>destroyed</code></td>
<td>在实例销毁后调用，此时所有的事件监听器和子组件都被移除。</td>
</tr>
</tbody></table>
<h3 id="3-3-生命周期图示"><a href="#3-3-生命周期图示" class="headerlink" title="3.3 生命周期图示"></a>3.3 生命周期图示</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate → created → beforeMount → mounted → beforeUpdate → updated → beforeDestroy → destroyed</span><br></pre></td></tr></table></figure>

<h2 id="4-运行流程"><a href="#4-运行流程" class="headerlink" title="4. 运行流程"></a>4. 运行流程</h2><h3 id="4-1-页面加载"><a href="#4-1-页面加载" class="headerlink" title="4.1 页面加载"></a>4.1 页面加载</h3><ol>
<li><strong>进入页面</strong>：首先加载 <code>index.html</code> 和 <code>main.js</code> 文件。</li>
<li><strong>导入模块</strong>：<code>main.js</code> 导入了 <code>vue</code>、<code>app</code>、<code>router</code> 等模块，并创建 Vue 实例，关联 <code>index.html</code> 页面的元素。</li>
<li><strong>使用路由</strong>：<code>main.js</code> 导入了 <code>App</code> 组件，并通过 <code>&lt;router-view&gt;</code> 标签引用该组件。</li>
<li><strong>默认显示</strong>：第一次访问时，默认显示 <code>App</code> 组件。<code>App</code> 组件包含一个图片和一个代表路由视图的 <code>&lt;router-view&gt;</code>。由于路由路径默认使用 HASH 模式（<code>/#/</code>），因此会显示 <code>HelloWorld</code> 组件。</li>
</ol>
<h3 id="4-2-组件跳转"><a href="#4-2-组件跳转" class="headerlink" title="4.2 组件跳转"></a>4.2 组件跳转</h3><ul>
<li><strong>自定义组件</strong>：可以尝试自己编写一个组件，并将其加入路由配置中。</li>
<li><strong>点击跳转</strong>：通过点击按钮或其他方式，可以触发路由跳转，显示不同的组件。</li>
</ul>
<h3 id="4-3-示例"><a href="#4-3-示例" class="headerlink" title="4.3 示例"></a>4.3 示例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/dist/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HelloWorld</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/HelloWorld.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyComponent</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/MyComponent.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HelloWorld</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/my-component&#x27;</span>, <span class="attr">component</span>: <span class="title class_">MyComponent</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;@/assets/logo.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Logo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HelloWorld.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;HelloWorld&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyComponent.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My Custom Component<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;goToHome&quot;</span>&gt;</span>Go to Home<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;MyComponent&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">goToHome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/10/31/%E5%92%8C%E4%B8%BAk%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/31/%E5%92%8C%E4%B8%BAk%E7%9A%84%E9%97%AE%E9%A2%98/" itemprop="url">和为k的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-31T18:58:24+08:00">
                2024-10-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/10/31/%E5%92%8C%E4%B8%BAk%E7%9A%84%E9%97%AE%E9%A2%98/" class="leancloud_visitors" data-flag-title="和为k的问题">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  744 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="通用思想："><a href="#通用思想：" class="headerlink" title="通用思想："></a>通用思想：</h1><p>按照和是否等于k的情况，可以分为***++查找问题、搜索问题++***（本质上是一样的），因此可以用++特殊数据结构来存储和查找（哈希表、前缀数组）、暴力搜索、递归、分治，回溯法其实就是暴力法，进一步地记忆化搜索、动态规划来处理++。</p>
<p>先考虑该问题是否可以用特殊的<strong>数据结构</strong>来解决，再考虑<strong>算法</strong>。</p>
<p>更进一步地，按照题目给定数组的条件，使用<em><strong>滑动窗口、双指针、二分法</strong></em>都可以来解决，通常辅以<strong>前缀数组</strong>、后缀数组会大大简化。</p>
<p>通过前缀数组，区间和可以转换为两个前缀数组的差。</p>
<p>0-1背包问题就是动态规划的运用。</p>
<p>注意<em><strong>数组中是否有负数</strong></em>的情况又不一样，数组中均为正数的情况，会更简单些，往往可以直接用二分或者滑动窗口。</p>
<p>有负数时，可以考虑用<strong>单调栈、队列</strong>等辅助的数据结构，来进行滑动窗口。（leetcode862）</p>
<h2 id="和为k的子数组："><a href="#和为k的子数组：" class="headerlink" title="和为k的子数组："></a>和为k的子数组：</h2><p>相对于原问题更简单，附加了连续性，即缩小了范围，增加了遍历条件线索。</p>
<h3 id="x20-方法："><a href="#x20-方法：" class="headerlink" title="&#x20;方法："></a>&#x20;方法：</h3><p>双层循环O(N2)</p>
<p>前缀和+map。这个表对应的映射项可以是最早出现这个sum的index（以此来求最长子数组的长度），也可以是对应这个sum出现的次数（对应求满足条件的子数组个数）。</p>
<h3 id="x20-变式："><a href="#x20-变式：" class="headerlink" title="&#x20;变式："></a>&#x20;变式：</h3><p>在原问题基础上，增加了数组中的值均为正数的约束，因此数组和天然存在了递增的特性，可以采用滑动窗口的思想。</p>
<h2 id="x20-子数组和小于等于定值"><a href="#x20-子数组和小于等于定值" class="headerlink" title="&#x20;子数组和小于等于定值"></a>&#x20;子数组和小于等于定值</h2><h3 id="子数组中均为正整数："><a href="#子数组中均为正整数：" class="headerlink" title="子数组中均为正整数："></a>子数组中均为正整数：</h3><h3 id="子数组中有负数："><a href="#子数组中有负数：" class="headerlink" title="子数组中有负数："></a>子数组中有负数：</h3><p>这个题目应该是求和小于等于K的最长子数组。按理说，存在负数的话，是不能使用滑动窗口的，但是下面的解法借助两个辅助数组</p>
<p>使用两个辅助数组：<code>min_value</code>、<code>min_index</code>：<code>min_value[i]</code>表示以i位置开始往后加的最小累加和；<code>min_index</code>表示<code>min_value</code>对应的最小累加和的右边界；这两个辅助数组是能够在O(n)时间复杂内计算出来的：倒序遍历，min_value[i] 只需要判断min_value[i+1]的值是不是负数，如果是负数就加上，不是就到本身这里结尾。得到这样一个数组以后我们就可能轻易得到从某一个位置开始和最小的子数组。</p>
<p>有了这两个辅助数组以后，就可以采用滑动窗口的思想，左右两个指针都不回退，右指针以上面辅助数组进行累加，左指针正常遍历，使得总体的时间复杂度为O(n)，参考<a href="https://www.liuin.cn/2018/07/16/LeetCode%E6%80%BB%E7%BB%93%E2%80%94%E2%80%94%E5%92%8C%E4%B8%BA%E5%AE%9A%E5%80%BC/#:~:text=LeetCode%E6%80%BB%E7%BB%93%E2%80%94%E2%80%94%E5%92%8C%E4%B8%BA%E5%AE%9A%E5%80%BC%20%7C%20Sixzeroo%20%3E%20m%3B%20%3B%20i%20%3E%3D,nums%20%5Bi%5D%3B%20min_index%20%5Bi%5D%20%3D%20min_index%20%5Bi%2B%2F%2F%20%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%B1%82%E8%A7%A3">LeetCode总结——和为定值 | Sixzeroo (liuin.cn)</a>  &#x20;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/10/29/sql-questions-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/29/sql-questions-01/" itemprop="url">SQL常见面试题总结（1）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-29T21:48:04+08:00">
                2024-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/" itemprop="url" rel="index">
                    <span itemprop="name">面试问题</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2024/10/29/sql-questions-01/" class="leancloud_visitors" data-flag-title="SQL常见面试题总结（1）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  42 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>题目来源于：<a href="https://www.nowcoder.com/exam/oj?page=1&tab=SQL%E7%AF%87&topicId=298">牛客题霸 - SQL 必知必会</a></p>
</blockquote>
<h2 id="检索数据"><a href="#检索数据" class="headerlink" title="检索数据"></a>检索数据</h2><p><code>SELECT</code> 用于从数据库中查询数据。</p>
<h3 id="从-Customers-表中检索所有的-ID"><a href="#从-Customers-表中检索所有的-ID" class="headerlink" title="从 Customers 表中检索所有的 ID"></a>从 Customers 表中检索所有的 ID</h3><p>现有表 <code>Customers</code> 如下：</p>
<table>
<thead>
<tr>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
</tr>
<tr>
<td>B</td>
</tr>
<tr>
<td>C</td>
</tr>
</tbody></table>
<p>编写 SQL 语句，从 <code>Customers</code> 表中检索所有的 <code>cust_id</code>。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br></pre></td></tr></table></figure>

<h3 id="检索并列出已订购产品的清单"><a href="#检索并列出已订购产品的清单" class="headerlink" title="检索并列出已订购产品的清单"></a>检索并列出已订购产品的清单</h3><p>表 <code>OrderItems</code> 含有非空的列 <code>prod_id</code> 代表商品 id，包含了所有已订购的商品（有些已被订购多次）。</p>
<table>
<thead>
<tr>
<th>prod_id</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
</tr>
<tr>
<td>a2</td>
</tr>
<tr>
<td>a3</td>
</tr>
<tr>
<td>a4</td>
</tr>
<tr>
<td>a5</td>
</tr>
<tr>
<td>a6</td>
</tr>
<tr>
<td>a7</td>
</tr>
</tbody></table>
<p>编写 SQL 语句，检索并列出所有已订购商品（<code>prod_id</code>）的去重后的清单。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> prod_id</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br></pre></td></tr></table></figure>

<p>知识点：<code>DISTINCT</code> 用于返回列中的唯一不同值。</p>
<h3 id="检索所有列"><a href="#检索所有列" class="headerlink" title="检索所有列"></a>检索所有列</h3><p>现在有 <code>Customers</code> 表（表中含有列 <code>cust_id</code> 代表客户 id，<code>cust_name</code> 代表客户姓名）</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>andy</td>
</tr>
<tr>
<td>a2</td>
<td>ben</td>
</tr>
<tr>
<td>a3</td>
<td>tony</td>
</tr>
<tr>
<td>a4</td>
<td>tom</td>
</tr>
<tr>
<td>a5</td>
<td>an</td>
</tr>
<tr>
<td>a6</td>
<td>lee</td>
</tr>
<tr>
<td>a7</td>
<td>hex</td>
</tr>
</tbody></table>
<p>需要编写 SQL 语句，检索所有列。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id, cust_name</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br></pre></td></tr></table></figure>

<h2 id="排序检索数据"><a href="#排序检索数据" class="headerlink" title="排序检索数据"></a>排序检索数据</h2><p><code>ORDER BY</code> 用于对结果集按照一个列或者多个列进行排序。默认按照升序对记录进行排序，如果需要按照降序对记录进行排序，可以使用 <code>DESC</code> 关键字。</p>
<h3 id="检索顾客名称并且排序"><a href="#检索顾客名称并且排序" class="headerlink" title="检索顾客名称并且排序"></a>检索顾客名称并且排序</h3><p>有表 <code>Customers</code>，<code>cust_id</code> 代表客户 id，<code>cust_name</code> 代表客户姓名。</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>andy</td>
</tr>
<tr>
<td>a2</td>
<td>ben</td>
</tr>
<tr>
<td>a3</td>
<td>tony</td>
</tr>
<tr>
<td>a4</td>
<td>tom</td>
</tr>
<tr>
<td>a5</td>
<td>an</td>
</tr>
<tr>
<td>a6</td>
<td>lee</td>
</tr>
<tr>
<td>a7</td>
<td>hex</td>
</tr>
</tbody></table>
<p>从 <code>Customers</code> 中检索所有的顾客名称（<code>cust_name</code>），并按从 Z 到 A 的顺序显示结果。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h3 id="对顾客-ID-和日期排序"><a href="#对顾客-ID-和日期排序" class="headerlink" title="对顾客 ID 和日期排序"></a>对顾客 ID 和日期排序</h3><p>有 <code>Orders</code> 表：</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>order_num</th>
<th>order_date</th>
</tr>
</thead>
<tbody><tr>
<td>andy</td>
<td>aaaa</td>
<td>2021-01-01 00:00:00</td>
</tr>
<tr>
<td>andy</td>
<td>bbbb</td>
<td>2021-01-01 12:00:00</td>
</tr>
<tr>
<td>bob</td>
<td>cccc</td>
<td>2021-01-10 12:00:00</td>
</tr>
<tr>
<td>dick</td>
<td>dddd</td>
<td>2021-01-11 00:00:00</td>
</tr>
</tbody></table>
<p>编写 SQL 语句，从 <code>Orders</code> 表中检索顾客 ID（<code>cust_id</code>）和订单号（<code>order_num</code>），并先按顾客 ID 对结果进行排序，再按订单日期倒序排列。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 根据列名排序</span><br><span class="line"># 注意：是 order_date 降序，而不是 order_num</span><br><span class="line"><span class="keyword">SELECT</span> cust_id, order_num</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_id,order_date <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>知识点：<code>order by</code> 对多列排序的时候，先排序的列放前面，后排序的列放后面。并且，不同的列可以有不同的排序规则。</p>
<h3 id="按照数量和价格排序"><a href="#按照数量和价格排序" class="headerlink" title="按照数量和价格排序"></a>按照数量和价格排序</h3><p>假设有一个 <code>OrderItems</code> 表：</p>
<table>
<thead>
<tr>
<th>quantity</th>
<th>item_price</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>100</td>
</tr>
<tr>
<td>10</td>
<td>1003</td>
</tr>
<tr>
<td>2</td>
<td>500</td>
</tr>
</tbody></table>
<p>编写 SQL 语句，显示 <code>OrderItems</code> 表中的数量（<code>quantity</code>）和价格（<code>item_price</code>），并按数量由多到少、价格由高到低排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantity, item_price</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> quantity <span class="keyword">DESC</span>,item_price <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h3 id="检查-SQL-语句"><a href="#检查-SQL-语句" class="headerlink" title="检查 SQL 语句"></a>检查 SQL 语句</h3><p>有 <code>Vendors</code> 表：</p>
<table>
<thead>
<tr>
<th>vend_name</th>
</tr>
</thead>
<tbody><tr>
<td>海底捞</td>
</tr>
<tr>
<td>小龙坎</td>
</tr>
<tr>
<td>大龙燚</td>
</tr>
</tbody></table>
<p>下面的 SQL 语句有问题吗？尝试将它改正确，使之能够正确运行，并且返回结果根据<code>vend_name</code> 逆序排列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name,</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> vend_name <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>改正后：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>知识点：</p>
<ul>
<li>逗号作用是用来隔开列与列之间的。</li>
<li>ORDER BY 是有 BY 的，需要撰写完整，且位置正确。</li>
</ul>
<h2 id="过滤数据"><a href="#过滤数据" class="headerlink" title="过滤数据"></a>过滤数据</h2><p><code>WHERE</code> 可以过滤返回的数据。</p>
<p>下面的运算符可以在 <code>WHERE</code> 子句中使用：</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&#x3D;</td>
<td align="left">等于</td>
</tr>
<tr>
<td align="left">&lt;&gt;</td>
<td align="left">不等于。 <strong>注释：</strong> 在 SQL 的一些版本中，该操作符可被写成 !&#x3D;</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">大于</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于</td>
</tr>
<tr>
<td align="left">&gt;&#x3D;</td>
<td align="left">大于等于</td>
</tr>
<tr>
<td align="left">&lt;&#x3D;</td>
<td align="left">小于等于</td>
</tr>
<tr>
<td align="left">BETWEEN</td>
<td align="left">在某个范围内</td>
</tr>
<tr>
<td align="left">LIKE</td>
<td align="left">搜索某种模式</td>
</tr>
<tr>
<td align="left">IN</td>
<td align="left">指定针对某个列的多个可能值</td>
</tr>
</tbody></table>
<h3 id="返回固定价格的产品"><a href="#返回固定价格的产品" class="headerlink" title="返回固定价格的产品"></a>返回固定价格的产品</h3><p>有表 <code>Products</code>：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_name</th>
<th>prod_price</th>
</tr>
</thead>
<tbody><tr>
<td>a0018</td>
<td>sockets</td>
<td>9.49</td>
</tr>
<tr>
<td>a0019</td>
<td>iphone13</td>
<td>600</td>
</tr>
<tr>
<td>b0018</td>
<td>gucci t-shirts</td>
<td>1000</td>
</tr>
</tbody></table>
<p>【问题】从 <code>Products</code> 表中检索产品 ID（<code>prod_id</code>）和产品名称（<code>prod_name</code>），只返回价格为 9.49 美元的产品。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">=</span> <span class="number">9.49</span></span><br></pre></td></tr></table></figure>

<h3 id="返回更高价格的产品"><a href="#返回更高价格的产品" class="headerlink" title="返回更高价格的产品"></a>返回更高价格的产品</h3><p>有表 <code>Products</code>：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_name</th>
<th>prod_price</th>
</tr>
</thead>
<tbody><tr>
<td>a0018</td>
<td>sockets</td>
<td>9.49</td>
</tr>
<tr>
<td>a0019</td>
<td>iphone13</td>
<td>600</td>
</tr>
<tr>
<td>b0019</td>
<td>gucci t-shirts</td>
<td>1000</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，从 <code>Products</code> 表中检索产品 ID（<code>prod_id</code>）和产品名称（<code>prod_name</code>），只返回价格为 9 美元或更高的产品。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&gt;=</span> <span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="返回产品并且按照价格排序"><a href="#返回产品并且按照价格排序" class="headerlink" title="返回产品并且按照价格排序"></a>返回产品并且按照价格排序</h3><p>有表 <code>Products</code>：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_name</th>
<th>prod_price</th>
</tr>
</thead>
<tbody><tr>
<td>a0011</td>
<td>egg</td>
<td>3</td>
</tr>
<tr>
<td>a0019</td>
<td>sockets</td>
<td>4</td>
</tr>
<tr>
<td>b0019</td>
<td>coffee</td>
<td>15</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回 <code>Products</code> 表中所有价格在 3 美元到 6 美元之间的产品的名称（<code>prod_name</code>）和价格（<code>prod_price</code>），然后按价格对结果进行排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">AND</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price</span><br><span class="line"></span><br><span class="line"># 或者</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&gt;=</span> <span class="number">3</span> <span class="keyword">AND</span> prod_price <span class="operator">&lt;=</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price</span><br></pre></td></tr></table></figure>

<h3 id="返回更多的产品"><a href="#返回更多的产品" class="headerlink" title="返回更多的产品"></a>返回更多的产品</h3><p><code>OrderItems</code> 表含有：订单号 <code>order_num</code>，<code>quantity</code>产品数量</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>105</td>
</tr>
<tr>
<td>a2</td>
<td>1100</td>
</tr>
<tr>
<td>a2</td>
<td>200</td>
</tr>
<tr>
<td>a4</td>
<td>1121</td>
</tr>
<tr>
<td>a5</td>
<td>10</td>
</tr>
<tr>
<td>a2</td>
<td>19</td>
</tr>
<tr>
<td>a7</td>
<td>5</td>
</tr>
</tbody></table>
<p>【问题】从 <code>OrderItems</code> 表中检索出所有不同且不重复的订单号（<code>order_num</code>），其中每个订单都要包含 100 个或更多的产品。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(quantity) <span class="operator">&gt;=</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h2 id="高级数据过滤"><a href="#高级数据过滤" class="headerlink" title="高级数据过滤"></a>高级数据过滤</h2><p><code>AND</code> 和 <code>OR</code> 运算符用于基于一个以上的条件对记录进行过滤，两者可以结合使用。<code>AND</code> 必须 2 个条件都成立，<code>OR</code>只要 2 个条件中的一个成立即可。</p>
<h3 id="检索供应商名称"><a href="#检索供应商名称" class="headerlink" title="检索供应商名称"></a>检索供应商名称</h3><p><code>Vendors</code> 表有字段供应商名称（<code>vend_name</code>）、供应商国家（<code>vend_country</code>）、供应商州（<code>vend_state</code>）</p>
<table>
<thead>
<tr>
<th>vend_name</th>
<th>vend_country</th>
<th>vend_state</th>
</tr>
</thead>
<tbody><tr>
<td>apple</td>
<td>USA</td>
<td>CA</td>
</tr>
<tr>
<td>vivo</td>
<td>CNA</td>
<td>shenzhen</td>
</tr>
<tr>
<td>huawei</td>
<td>CNA</td>
<td>xian</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，从 <code>Vendors</code> 表中检索供应商名称（<code>vend_name</code>），仅返回加利福尼亚州的供应商（这需要按国家[USA]和州[CA]进行过滤，没准其他国家也存在一个 CA）</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">WHERE</span> vend_country <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span> <span class="keyword">AND</span> vend_state <span class="operator">=</span> <span class="string">&#x27;CA&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="检索并列出已订购产品的清单-1"><a href="#检索并列出已订购产品的清单-1" class="headerlink" title="检索并列出已订购产品的清单"></a>检索并列出已订购产品的清单</h3><p><code>OrderItems</code> 表包含了所有已订购的产品（有些已被订购多次）。</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>order_num</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>BR01</td>
<td>a1</td>
<td>105</td>
</tr>
<tr>
<td>BR02</td>
<td>a2</td>
<td>1100</td>
</tr>
<tr>
<td>BR02</td>
<td>a2</td>
<td>200</td>
</tr>
<tr>
<td>BR03</td>
<td>a4</td>
<td>1121</td>
</tr>
<tr>
<td>BR017</td>
<td>a5</td>
<td>10</td>
</tr>
<tr>
<td>BR02</td>
<td>a2</td>
<td>19</td>
</tr>
<tr>
<td>BR017</td>
<td>a7</td>
<td>5</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，查找所有订购了数量至少 100 个的 <code>BR01</code>、<code>BR02</code> 或 <code>BR03</code> 的订单。你需要返回 <code>OrderItems</code> 表的订单号（<code>order_num</code>）、产品 ID（<code>prod_id</code>）和数量（<code>quantity</code>），并按产品 ID 和数量进行过滤。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, prod_id, quantity</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">WHERE</span> prod_id <span class="keyword">IN</span> (<span class="string">&#x27;BR01&#x27;</span>, <span class="string">&#x27;BR02&#x27;</span>, <span class="string">&#x27;BR03&#x27;</span>) <span class="keyword">AND</span> quantity <span class="operator">&gt;=</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h3 id="返回所有价格在-3-美元到-6-美元之间的产品的名称和价格"><a href="#返回所有价格在-3-美元到-6-美元之间的产品的名称和价格" class="headerlink" title="返回所有价格在 3 美元到 6 美元之间的产品的名称和价格"></a>返回所有价格在 3 美元到 6 美元之间的产品的名称和价格</h3><p>有表 <code>Products</code>：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_name</th>
<th>prod_price</th>
</tr>
</thead>
<tbody><tr>
<td>a0011</td>
<td>egg</td>
<td>3</td>
</tr>
<tr>
<td>a0019</td>
<td>sockets</td>
<td>4</td>
</tr>
<tr>
<td>b0019</td>
<td>coffee</td>
<td>15</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回所有价格在 3 美元到 6 美元之间的产品的名称（<code>prod_name</code>）和价格（<code>prod_price</code>），使用 AND 操作符，然后按价格对结果进行升序排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&gt;=</span> <span class="number">3</span> <span class="keyword">and</span> prod_price <span class="operator">&lt;=</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price</span><br></pre></td></tr></table></figure>

<h3 id="检查-SQL-语句-1"><a href="#检查-SQL-语句-1" class="headerlink" title="检查 SQL 语句"></a>检查 SQL 语句</h3><p>供应商表 <code>Vendors</code> 有字段供应商名称 <code>vend_name</code>、供应商国家 <code>vend_country</code>、供应商省份 <code>vend_state</code></p>
<table>
<thead>
<tr>
<th>vend_name</th>
<th>vend_country</th>
<th>vend_state</th>
</tr>
</thead>
<tbody><tr>
<td>apple</td>
<td>USA</td>
<td>CA</td>
</tr>
<tr>
<td>vivo</td>
<td>CNA</td>
<td>shenzhen</td>
</tr>
<tr>
<td>huawei</td>
<td>CNA</td>
<td>xian</td>
</tr>
</tbody></table>
<p>【问题】修改正确下面 sql，使之正确返回。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name</span><br><span class="line"><span class="keyword">WHERE</span> vend_country <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span> <span class="keyword">AND</span> vend_state <span class="operator">=</span> <span class="string">&#x27;CA&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>修改后：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">WHERE</span> vend_country <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span> <span class="keyword">AND</span> vend_state <span class="operator">=</span> <span class="string">&#x27;CA&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name</span><br></pre></td></tr></table></figure>

<p><code>ORDER BY</code> 语句必须放在 <code>WHERE</code> 之后。</p>
<h2 id="用通配符进行过滤"><a href="#用通配符进行过滤" class="headerlink" title="用通配符进行过滤"></a>用通配符进行过滤</h2><p>SQL 通配符必须与 <code>LIKE</code> 运算符一起使用</p>
<p>在 SQL 中，可使用以下通配符：</p>
<table>
<thead>
<tr>
<th align="left">通配符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>%</code></td>
<td align="left">代表零个或多个字符</td>
</tr>
<tr>
<td align="left"><code>_</code></td>
<td align="left">仅替代一个字符</td>
</tr>
<tr>
<td align="left"><code>[charlist]</code></td>
<td align="left">字符列中的任何单一字符</td>
</tr>
<tr>
<td align="left"><code>[^charlist]</code> 或者 <code>[!charlist]</code></td>
<td align="left">不在字符列中的任何单一字符</td>
</tr>
</tbody></table>
<h3 id="检索产品名称和描述（一）"><a href="#检索产品名称和描述（一）" class="headerlink" title="检索产品名称和描述（一）"></a>检索产品名称和描述（一）</h3><p><code>Products</code> 表如下：</p>
<table>
<thead>
<tr>
<th>prod_name</th>
<th>prod_desc</th>
</tr>
</thead>
<tbody><tr>
<td>a0011</td>
<td>usb</td>
</tr>
<tr>
<td>a0019</td>
<td>iphone13</td>
</tr>
<tr>
<td>b0019</td>
<td>gucci t-shirts</td>
</tr>
<tr>
<td>c0019</td>
<td>gucci toy</td>
</tr>
<tr>
<td>d0019</td>
<td>lego toy</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，从 <code>Products</code> 表中检索产品名称（<code>prod_name</code>）和描述（<code>prod_desc</code>），仅返回描述中包含 <code>toy</code> 一词的产品名称。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_desc</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_desc <span class="keyword">LIKE</span> <span class="string">&#x27;%toy%&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="检索产品名称和描述（二）"><a href="#检索产品名称和描述（二）" class="headerlink" title="检索产品名称和描述（二）"></a>检索产品名称和描述（二）</h3><p><code>Products</code> 表如下：</p>
<table>
<thead>
<tr>
<th>prod_name</th>
<th>prod_desc</th>
</tr>
</thead>
<tbody><tr>
<td>a0011</td>
<td>usb</td>
</tr>
<tr>
<td>a0019</td>
<td>iphone13</td>
</tr>
<tr>
<td>b0019</td>
<td>gucci t-shirts</td>
</tr>
<tr>
<td>c0019</td>
<td>gucci toy</td>
</tr>
<tr>
<td>d0019</td>
<td>lego toy</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，从 <code>Products</code> 表中检索产品名称（<code>prod_name</code>）和描述（<code>prod_desc</code>），仅返回描述中未出现 <code>toy</code> 一词的产品，最后按”产品名称“对结果进行排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_desc</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_desc <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%toy%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name</span><br></pre></td></tr></table></figure>

<h3 id="检索产品名称和描述（三）"><a href="#检索产品名称和描述（三）" class="headerlink" title="检索产品名称和描述（三）"></a>检索产品名称和描述（三）</h3><p><code>Products</code> 表如下：</p>
<table>
<thead>
<tr>
<th>prod_name</th>
<th>prod_desc</th>
</tr>
</thead>
<tbody><tr>
<td>a0011</td>
<td>usb</td>
</tr>
<tr>
<td>a0019</td>
<td>iphone13</td>
</tr>
<tr>
<td>b0019</td>
<td>gucci t-shirts</td>
</tr>
<tr>
<td>c0019</td>
<td>gucci toy</td>
</tr>
<tr>
<td>d0019</td>
<td>lego carrots toy</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，从 <code>Products</code> 表中检索产品名称（<code>prod_name</code>）和描述（<code>prod_desc</code>），仅返回描述中同时出现 <code>toy</code> 和 <code>carrots</code> 的产品。有好几种方法可以执行此操作，但对于这个挑战题，请使用 <code>AND</code> 和两个 <code>LIKE</code> 比较。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_desc</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_desc <span class="keyword">LIKE</span> <span class="string">&#x27;%toy%&#x27;</span> <span class="keyword">AND</span> prod_desc <span class="keyword">LIKE</span> &quot;%carrots%&quot;</span><br></pre></td></tr></table></figure>

<h3 id="检索产品名称和描述（四）"><a href="#检索产品名称和描述（四）" class="headerlink" title="检索产品名称和描述（四）"></a>检索产品名称和描述（四）</h3><p><code>Products</code> 表如下：</p>
<table>
<thead>
<tr>
<th>prod_name</th>
<th>prod_desc</th>
</tr>
</thead>
<tbody><tr>
<td>a0011</td>
<td>usb</td>
</tr>
<tr>
<td>a0019</td>
<td>iphone13</td>
</tr>
<tr>
<td>b0019</td>
<td>gucci t-shirts</td>
</tr>
<tr>
<td>c0019</td>
<td>gucci toy</td>
</tr>
<tr>
<td>d0019</td>
<td>lego toy carrots</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，从 Products 表中检索产品名称（prod_name）和描述（prod_desc），仅返回在描述中以<strong>先后顺序</strong>同时出现 toy 和 carrots 的产品。提示：只需要用带有三个 <code>%</code> 符号的 <code>LIKE</code> 即可。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_desc</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_desc <span class="keyword">LIKE</span> <span class="string">&#x27;%toy%carrots%&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="创建计算字段"><a href="#创建计算字段" class="headerlink" title="创建计算字段"></a>创建计算字段</h2><h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><p>别名的常见用法是在检索出的结果中重命名表的列字段（为了符合特定的报表要求或客户需求）。有表 <code>Vendors</code> 代表供应商信息，<code>vend_id</code> 供应商 id、<code>vend_name</code> 供应商名称、<code>vend_address</code> 供应商地址、<code>vend_city</code> 供应商城市。</p>
<table>
<thead>
<tr>
<th>vend_id</th>
<th>vend_name</th>
<th>vend_address</th>
<th>vend_city</th>
</tr>
</thead>
<tbody><tr>
<td>a001</td>
<td>tencent cloud</td>
<td>address1</td>
<td>shenzhen</td>
</tr>
<tr>
<td>a002</td>
<td>huawei cloud</td>
<td>address2</td>
<td>dongguan</td>
</tr>
<tr>
<td>a003</td>
<td>aliyun cloud</td>
<td>address3</td>
<td>hangzhou</td>
</tr>
<tr>
<td>a003</td>
<td>netease cloud</td>
<td>address4</td>
<td>guangzhou</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，从 <code>Vendors</code> 表中检索 <code>vend_id</code>、<code>vend_name</code>、<code>vend_address</code> 和 <code>vend_city</code>，将 <code>vend_name</code> 重命名为 <code>vname</code>，将 <code>vend_city</code> 重命名为 <code>vcity</code>，将 <code>vend_address</code> 重命名为 <code>vaddress</code>，按供应商名称对结果进行升序排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_id, vend_name <span class="keyword">AS</span> vname, vend_address <span class="keyword">AS</span> vaddress, vend_city <span class="keyword">AS</span> vcity</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vname</span><br><span class="line"># <span class="keyword">as</span> 可以省略</span><br><span class="line"><span class="keyword">SELECT</span> vend_id, vend_name vname, vend_address vaddress, vend_city vcity</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vname</span><br></pre></td></tr></table></figure>

<h3 id="打折"><a href="#打折" class="headerlink" title="打折"></a>打折</h3><p>我们的示例商店正在进行打折促销，所有产品均降价 10%。<code>Products</code> 表包含 <code>prod_id</code> 产品 id、<code>prod_price</code> 产品价格。</p>
<p>【问题】编写 SQL 语句，从 <code>Products</code> 表中返回 <code>prod_id</code>、<code>prod_price</code> 和 <code>sale_price</code>。<code>sale_price</code> 是一个包含促销价格的计算字段。提示：可以乘以 0.9，得到原价的 90%（即 10%的折扣）。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, prod_price, prod_price <span class="operator">*</span> <span class="number">0.9</span> <span class="keyword">AS</span> sale_price</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p>注意：<code>sale_price</code> 是对计算结果的命名，而不是原有的列名。</p>
<h2 id="使用函数处理数据"><a href="#使用函数处理数据" class="headerlink" title="使用函数处理数据"></a>使用函数处理数据</h2><h3 id="顾客登录名"><a href="#顾客登录名" class="headerlink" title="顾客登录名"></a>顾客登录名</h3><p>我们的商店已经上线了，正在创建顾客账户。所有用户都需要登录名，默认登录名是其名称和所在城市的组合。</p>
<p>给出 <code>Customers</code> 表 如下：</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
<th>cust_contact</th>
<th>cust_city</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>Andy Li</td>
<td>Andy Li</td>
<td>Oak Park</td>
</tr>
<tr>
<td>a2</td>
<td>Ben Liu</td>
<td>Ben Liu</td>
<td>Oak Park</td>
</tr>
<tr>
<td>a3</td>
<td>Tony Dai</td>
<td>Tony Dai</td>
<td>Oak Park</td>
</tr>
<tr>
<td>a4</td>
<td>Tom Chen</td>
<td>Tom Chen</td>
<td>Oak Park</td>
</tr>
<tr>
<td>a5</td>
<td>An Li</td>
<td>An Li</td>
<td>Oak Park</td>
</tr>
<tr>
<td>a6</td>
<td>Lee Chen</td>
<td>Lee Chen</td>
<td>Oak Park</td>
</tr>
<tr>
<td>a7</td>
<td>Hex Liu</td>
<td>Hex Liu</td>
<td>Oak Park</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回顾客 ID（<code>cust_id</code>）、顾客名称（<code>cust_name</code>）和登录名（<code>user_login</code>），其中登录名全部为大写字母，并由顾客联系人的前两个字符（<code>cust_contact</code>）和其所在城市的前三个字符（<code>cust_city</code>）组成。提示：需要使用函数、拼接和别名。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id, cust_name, <span class="built_in">UPPER</span>(CONCAT(<span class="built_in">SUBSTRING</span>(cust_contact, <span class="number">1</span>, <span class="number">2</span>), <span class="built_in">SUBSTRING</span>(cust_city, <span class="number">1</span>, <span class="number">3</span>))) <span class="keyword">AS</span> user_login</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br></pre></td></tr></table></figure>

<p>知识点：</p>
<ul>
<li><p>截取函数<code>SUBSTRING()</code>：截取字符串，<code>substring(str ,n ,m)</code>（n 表示起始截取位置，m 表示要截取的字符个数）表示返回字符串 str 从第 n 个字符开始截取 m 个字符；</p>
</li>
<li><p>拼接函数<code>CONCAT()</code>：将两个或多个字符串连接成一个字符串，select concat(A,B)：连接字符串 A 和 B。</p>
</li>
<li><p>大写函数 <code>UPPER()</code>：将指定字符串转换为大写。</p>
</li>
</ul>
<h3 id="返回-2020-年-1-月的所有订单的订单号和订单日期"><a href="#返回-2020-年-1-月的所有订单的订单号和订单日期" class="headerlink" title="返回 2020 年 1 月的所有订单的订单号和订单日期"></a>返回 2020 年 1 月的所有订单的订单号和订单日期</h3><p><code>Orders</code> 订单表如下：</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>order_date</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>2020-01-01 00:00:00</td>
</tr>
<tr>
<td>a0002</td>
<td>2020-01-02 00:00:00</td>
</tr>
<tr>
<td>a0003</td>
<td>2020-01-01 12:00:00</td>
</tr>
<tr>
<td>a0004</td>
<td>2020-02-01 00:00:00</td>
</tr>
<tr>
<td>a0005</td>
<td>2020-03-01 00:00:00</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回 2020 年 1 月的所有订单的订单号（<code>order_num</code>）和订单日期（<code>order_date</code>），并按订单日期升序排序</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, order_date</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">month</span>(order_date) <span class="operator">=</span> <span class="string">&#x27;01&#x27;</span> <span class="keyword">AND</span> <span class="keyword">YEAR</span>(order_date) <span class="operator">=</span> <span class="string">&#x27;2020&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date</span><br></pre></td></tr></table></figure>

<p>也可以用通配符来做：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, order_date</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> order_date <span class="keyword">LIKE</span> <span class="string">&#x27;2020-01%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date</span><br></pre></td></tr></table></figure>

<p>知识点：</p>
<ul>
<li>日期格式：<code>YYYY-MM-DD</code></li>
<li>时间格式：<code>HH:MM:SS</code></li>
</ul>
<p>日期和时间处理相关的常用函数：</p>
<table>
<thead>
<tr>
<th>函 数</th>
<th>说 明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ADDDATE()</code></td>
<td>增加一个日期（天、周等）</td>
</tr>
<tr>
<td><code>ADDTIME()</code></td>
<td>增加一个时间（时、分等）</td>
</tr>
<tr>
<td><code>CURDATE()</code></td>
<td>返回当前日期</td>
</tr>
<tr>
<td><code>CURTIME()</code></td>
<td>返回当前时间</td>
</tr>
<tr>
<td><code>DATE()</code></td>
<td>返回日期时间的日期部分</td>
</tr>
<tr>
<td><code>DATEDIFF</code></td>
<td>计算两个日期之差</td>
</tr>
<tr>
<td><code>DATE_FORMAT()</code></td>
<td>返回一个格式化的日期或时间串</td>
</tr>
<tr>
<td><code>DAY()</code></td>
<td>返回一个日期的天数部分</td>
</tr>
<tr>
<td><code>DAYOFWEEK()</code></td>
<td>对于一个日期，返回对应的星期几</td>
</tr>
<tr>
<td><code>HOUR()</code></td>
<td>返回一个时间的小时部分</td>
</tr>
<tr>
<td><code>MINUTE()</code></td>
<td>返回一个时间的分钟部分</td>
</tr>
<tr>
<td><code>MONTH()</code></td>
<td>返回一个日期的月份部分</td>
</tr>
<tr>
<td><code>NOW()</code></td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td><code>SECOND()</code></td>
<td>返回一个时间的秒部分</td>
</tr>
<tr>
<td><code>TIME()</code></td>
<td>返回一个日期时间的时间部分</td>
</tr>
<tr>
<td><code>YEAR()</code></td>
<td>返回一个日期的年份部分</td>
</tr>
</tbody></table>
<h2 id="汇总数据"><a href="#汇总数据" class="headerlink" title="汇总数据"></a>汇总数据</h2><p>汇总数据相关的函数：</p>
<table>
<thead>
<tr>
<th>函 数</th>
<th>说 明</th>
</tr>
</thead>
<tbody><tr>
<td><code>AVG()</code></td>
<td>返回某列的平均值</td>
</tr>
<tr>
<td><code>COUNT()</code></td>
<td>返回某列的行数</td>
</tr>
<tr>
<td><code>MAX()</code></td>
<td>返回某列的最大值</td>
</tr>
<tr>
<td><code>MIN()</code></td>
<td>返回某列的最小值</td>
</tr>
<tr>
<td><code>SUM()</code></td>
<td>返回某列值之和</td>
</tr>
</tbody></table>
<h3 id="确定已售出产品的总数"><a href="#确定已售出产品的总数" class="headerlink" title="确定已售出产品的总数"></a>确定已售出产品的总数</h3><p><code>OrderItems</code> 表代表售出的产品，<code>quantity</code> 代表售出商品数量。</p>
<table>
<thead>
<tr>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
</tr>
<tr>
<td>100</td>
</tr>
<tr>
<td>1000</td>
</tr>
<tr>
<td>10001</td>
</tr>
<tr>
<td>2</td>
</tr>
<tr>
<td>15</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，确定已售出产品的总数。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">Sum</span>(quantity) <span class="keyword">AS</span> items_ordered</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br></pre></td></tr></table></figure>

<h3 id="确定已售出产品项-BR01-的总数"><a href="#确定已售出产品项-BR01-的总数" class="headerlink" title="确定已售出产品项 BR01 的总数"></a>确定已售出产品项 BR01 的总数</h3><p><code>OrderItems</code> 表代表售出的产品，<code>quantity</code> 代表售出商品数量，产品项为 <code>prod_id</code>。</p>
<table>
<thead>
<tr>
<th>quantity</th>
<th>prod_id</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
<td>AR01</td>
</tr>
<tr>
<td>100</td>
<td>AR10</td>
</tr>
<tr>
<td>1000</td>
<td>BR01</td>
</tr>
<tr>
<td>10001</td>
<td>BR010</td>
</tr>
</tbody></table>
<p>【问题】修改创建的语句，确定已售出产品项（<code>prod_id</code>）为”BR01”的总数。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">Sum</span>(quantity) <span class="keyword">AS</span> items_ordered</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="确定-Products-表中价格不超过-10-美元的最贵产品的价格"><a href="#确定-Products-表中价格不超过-10-美元的最贵产品的价格" class="headerlink" title="确定 Products 表中价格不超过 10 美元的最贵产品的价格"></a>确定 Products 表中价格不超过 10 美元的最贵产品的价格</h3><p><code>Products</code> 表如下，<code>prod_price</code> 代表商品的价格。</p>
<table>
<thead>
<tr>
<th>prod_price</th>
</tr>
</thead>
<tbody><tr>
<td>9.49</td>
</tr>
<tr>
<td>600</td>
</tr>
<tr>
<td>1000</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，确定 <code>Products</code> 表中价格不超过 10 美元的最贵产品的价格（<code>prod_price</code>）。将计算所得的字段命名为 <code>max_price</code>。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">Max</span>(prod_price) <span class="keyword">AS</span> max_price</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&lt;=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h2 id="分组数据"><a href="#分组数据" class="headerlink" title="分组数据"></a>分组数据</h2><p><code>GROUP BY</code>：</p>
<ul>
<li><code>GROUP BY</code> 子句将记录分组到汇总行中。</li>
<li><code>GROUP BY</code> 为每个组返回一个记录。</li>
<li><code>GROUP BY</code> 通常还涉及聚合<code>COUNT</code>，<code>MAX</code>，<code>SUM</code>，<code>AVG</code> 等。</li>
<li><code>GROUP BY</code> 可以按一列或多列进行分组。</li>
<li><code>GROUP BY</code> 按分组字段进行排序后，<code>ORDER BY</code> 可以以汇总字段来进行排序。</li>
</ul>
<p><code>HAVING</code>：</p>
<ul>
<li><code>HAVING</code> 用于对汇总的 <code>GROUP BY</code> 结果进行过滤。</li>
<li><code>HAVING</code> 必须要与 <code>GROUP BY</code> 连用。</li>
<li><code>WHERE</code> 和 <code>HAVING</code> 可以在相同的查询中。</li>
</ul>
<p><code>HAVING</code> vs <code>WHERE</code>：</p>
<ul>
<li><code>WHERE</code>：过滤指定的行，后面不能加聚合函数（分组函数）。</li>
<li><code>HAVING</code>：过滤分组，必须要与 <code>GROUP BY</code> 连用，不能单独使用。</li>
</ul>
<h3 id="返回每个订单号各有多少行数"><a href="#返回每个订单号各有多少行数" class="headerlink" title="返回每个订单号各有多少行数"></a>返回每个订单号各有多少行数</h3><p><code>OrderItems</code> 表包含每个订单的每个产品</p>
<table>
<thead>
<tr>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>a002</td>
</tr>
<tr>
<td>a002</td>
</tr>
<tr>
<td>a002</td>
</tr>
<tr>
<td>a004</td>
</tr>
<tr>
<td>a007</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回每个订单号（<code>order_num</code>）各有多少行数（<code>order_lines</code>），并按 <code>order_lines</code> 对结果进行升序排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, <span class="built_in">Count</span>(order_num) <span class="keyword">AS</span> order_lines</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_lines</span><br></pre></td></tr></table></figure>

<p>知识点：</p>
<ol>
<li><code>count(*)</code>,<code>count(列名)</code>都可以，区别在于，<code>count(列名)</code>是统计非 NULL 的行数；</li>
<li><code>order by</code> 最后执行，所以可以使用列别名；</li>
<li>分组聚合一定不要忘记加上 <code>group by</code> ,不然只会有一行结果。</li>
</ol>
<h3 id="每个供应商成本最低的产品"><a href="#每个供应商成本最低的产品" class="headerlink" title="每个供应商成本最低的产品"></a>每个供应商成本最低的产品</h3><p>有 <code>Products</code> 表，含有字段 <code>prod_price</code> 代表产品价格，<code>vend_id</code> 代表供应商 id</p>
<table>
<thead>
<tr>
<th>vend_id</th>
<th>prod_price</th>
</tr>
</thead>
<tbody><tr>
<td>a0011</td>
<td>100</td>
</tr>
<tr>
<td>a0019</td>
<td>0.1</td>
</tr>
<tr>
<td>b0019</td>
<td>1000</td>
</tr>
<tr>
<td>b0019</td>
<td>6980</td>
</tr>
<tr>
<td>b0019</td>
<td>20</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回名为 <code>cheapest_item</code> 的字段，该字段包含每个供应商成本最低的产品（使用 <code>Products</code> 表中的 <code>prod_price</code>），然后从最低成本到最高成本对结果进行升序排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_id, <span class="built_in">Min</span>(prod_price) <span class="keyword">AS</span> cheapest_item</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cheapest_item</span><br></pre></td></tr></table></figure>

<h3 id="返回订单数量总和不小于-100-的所有订单的订单号"><a href="#返回订单数量总和不小于-100-的所有订单的订单号" class="headerlink" title="返回订单数量总和不小于 100 的所有订单的订单号"></a>返回订单数量总和不小于 100 的所有订单的订单号</h3><p><code>OrderItems</code> 代表订单商品表，包括：订单号 <code>order_num</code> 和订单数量 <code>quantity</code>。</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>105</td>
</tr>
<tr>
<td>a2</td>
<td>1100</td>
</tr>
<tr>
<td>a2</td>
<td>200</td>
</tr>
<tr>
<td>a4</td>
<td>1121</td>
</tr>
<tr>
<td>a5</td>
<td>10</td>
</tr>
<tr>
<td>a2</td>
<td>19</td>
</tr>
<tr>
<td>a7</td>
<td>5</td>
</tr>
</tbody></table>
<p>【问题】请编写 SQL 语句，返回订单数量总和不小于 100 的所有订单号，最后结果按照订单号升序排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 直接聚合</span><br><span class="line"><span class="keyword">SELECT</span> order_num</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">Sum</span>(quantity) <span class="operator">&gt;=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_num</span><br><span class="line"></span><br><span class="line"># 子查询</span><br><span class="line"><span class="keyword">SELECT</span> a.order_num</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> order_num, <span class="built_in">Sum</span>(quantity) <span class="keyword">AS</span> sum_num</span><br><span class="line">    <span class="keyword">FROM</span> OrderItems</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num</span><br><span class="line">    <span class="keyword">HAVING</span> sum_num <span class="operator">&gt;=</span> <span class="number">100</span>) a</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.order_num</span><br></pre></td></tr></table></figure>

<p>知识点：</p>
<ul>
<li><code>where</code>：过滤过滤指定的行，后面不能加聚合函数（分组函数）。</li>
<li><code>having</code>：过滤分组，与 <code>group by</code> 连用，不能单独使用。</li>
</ul>
<h3 id="计算总和"><a href="#计算总和" class="headerlink" title="计算总和"></a>计算总和</h3><p><code>OrderItems</code> 表代表订单信息，包括字段：订单号 <code>order_num</code> 和 <code>item_price</code> 商品售出价格、<code>quantity</code> 商品数量。</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>item_price</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>10</td>
<td>105</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
<td>1100</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
<td>200</td>
</tr>
<tr>
<td>a4</td>
<td>2</td>
<td>1121</td>
</tr>
<tr>
<td>a5</td>
<td>5</td>
<td>10</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
<td>19</td>
</tr>
<tr>
<td>a7</td>
<td>7</td>
<td>5</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，根据订单号聚合，返回订单总价不小于 1000 的所有订单号，最后的结果按订单号进行升序排序。</p>
<p>提示：总价 &#x3D; item_price 乘以 quantity</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, <span class="built_in">Sum</span>(item_price <span class="operator">*</span> quantity) <span class="keyword">AS</span> total_price</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num</span><br><span class="line"><span class="keyword">HAVING</span> total_price <span class="operator">&gt;=</span> <span class="number">1000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_num</span><br></pre></td></tr></table></figure>

<h3 id="检查-SQL-语句-2"><a href="#检查-SQL-语句-2" class="headerlink" title="检查 SQL 语句"></a>检查 SQL 语句</h3><p><code>OrderItems</code> 表含有 <code>order_num</code> 订单号</p>
<table>
<thead>
<tr>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>a002</td>
</tr>
<tr>
<td>a002</td>
</tr>
<tr>
<td>a002</td>
</tr>
<tr>
<td>a004</td>
</tr>
<tr>
<td>a007</td>
</tr>
</tbody></table>
<p>【问题】将下面代码修改正确后执行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> items</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> items</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> items, order_num;</span><br></pre></td></tr></table></figure>

<p>修改后：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> items</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num</span><br><span class="line"><span class="keyword">HAVING</span> items <span class="operator">&gt;=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> items, order_num;</span><br></pre></td></tr></table></figure>

<h2 id="使用子查询"><a href="#使用子查询" class="headerlink" title="使用子查询"></a>使用子查询</h2><p>子查询是嵌套在较大查询中的 SQL 查询，也称内部查询或内部选择，包含子查询的语句也称为外部查询或外部选择。简单来说，子查询就是指将一个 <code>SELECT</code> 查询（子查询）的结果作为另一个 SQL 语句（主查询）的数据来源或者判断条件。</p>
<p>子查询可以嵌入 <code>SELECT</code>、<code>INSERT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 语句中，也可以和 <code>=</code>、<code>&lt;</code>、<code>&gt;</code>、<code>IN</code>、<code>BETWEEN</code>、<code>EXISTS</code> 等运算符一起使用。</p>
<p>子查询常用在 <code>WHERE</code> 子句和 <code>FROM</code> 子句后边：</p>
<ul>
<li>当用于 <code>WHERE</code> 子句时，根据不同的运算符，子查询可以返回单行单列、多行单列、单行多列数据。子查询就是要返回能够作为 WHERE 子句查询条件的值。</li>
<li>当用于 <code>FROM</code> 子句时，一般返回多行多列数据，相当于返回一张临时表，这样才符合 <code>FROM</code> 后面是表的规则。这种做法能够实现多表联合查询。</li>
</ul>
<blockquote>
<p>注意：MySQL 数据库从 4.1 版本才开始支持子查询，早期版本是不支持的。</p>
</blockquote>
<p>用于 <code>WHERE</code> 子句的子查询的基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name [, column_name ]</span><br><span class="line"><span class="keyword">FROM</span> table1 [, table2 ]</span><br><span class="line"><span class="keyword">WHERE</span> column_name operator</span><br><span class="line">(<span class="keyword">SELECT</span> column_name [, column_name ]</span><br><span class="line"><span class="keyword">FROM</span> table1 [, table2 ]</span><br><span class="line">[<span class="keyword">WHERE</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>子查询需要放在括号<code>( )</code>内。</li>
<li><code>operator</code> 表示用于 <code>WHERE</code> 子句的运算符，可以是比较运算符（如 <code>=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;&gt;</code> 等）或逻辑运算符（如 <code>IN</code>, <code>NOT IN</code>, <code>EXISTS</code>, <code>NOT EXISTS</code> 等），具体根据需求来确定。</li>
</ul>
<p>用于 <code>FROM</code> 子句的子查询的基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name [, column_name ]</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> column_name [, column_name ]</span><br><span class="line">      <span class="keyword">FROM</span> table1 [, table2 ]</span><br><span class="line">      [<span class="keyword">WHERE</span>]) <span class="keyword">AS</span> temp_table_name [, ...]</span><br><span class="line">[<span class="keyword">JOIN</span> type <span class="keyword">JOIN</span> table_name <span class="keyword">ON</span> <span class="keyword">condition</span>]</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>用于 <code>FROM</code> 的子查询返回的结果相当于一张临时表，所以需要使用 AS 关键字为该临时表起一个名字。</li>
<li>子查询需要放在括号 <code>( )</code> 内。</li>
<li>可以指定多个临时表名，并使用 <code>JOIN</code> 语句连接这些表。</li>
</ul>
<h3 id="返回购买价格为-10-美元或以上产品的顾客列表"><a href="#返回购买价格为-10-美元或以上产品的顾客列表" class="headerlink" title="返回购买价格为 10 美元或以上产品的顾客列表"></a>返回购买价格为 10 美元或以上产品的顾客列表</h3><p><code>OrderItems</code> 表示订单商品表，含有字段订单号：<code>order_num</code>、订单价格：<code>item_price</code>；<code>Orders</code> 表代表订单信息表，含有顾客 <code>id：cust_id</code> 和订单号：<code>order_num</code></p>
<p><code>OrderItems</code> 表:</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>item_price</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>10</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
</tr>
<tr>
<td>a4</td>
<td>2</td>
</tr>
<tr>
<td>a5</td>
<td>5</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
</tr>
<tr>
<td>a7</td>
<td>7</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表：</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>cust10</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a4</td>
<td>cust2</td>
</tr>
<tr>
<td>a5</td>
<td>cust5</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a7</td>
<td>cust7</td>
</tr>
</tbody></table>
<p>【问题】使用子查询，返回购买价格为 10 美元或以上产品的顾客列表，结果无需排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> order_num</span><br><span class="line">    <span class="keyword">FROM</span> OrderItems</span><br><span class="line">    <span class="keyword">where</span> item_price <span class="operator">&gt;=</span> <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h3 id="确定哪些订单购买了-prod-id-为-BR01-的产品（一）"><a href="#确定哪些订单购买了-prod-id-为-BR01-的产品（一）" class="headerlink" title="确定哪些订单购买了 prod_id 为 BR01 的产品（一）"></a>确定哪些订单购买了 prod_id 为 BR01 的产品（一）</h3><p>表 <code>OrderItems</code> 代表订单商品信息表，<code>prod_id</code> 为产品 id；<code>Orders</code> 表代表订单表有 <code>cust_id</code> 代表顾客 id 和订单日期 <code>order_date</code></p>
<p><code>OrderItems</code> 表：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>BR01</td>
<td>a0001</td>
</tr>
<tr>
<td>BR01</td>
<td>a0002</td>
</tr>
<tr>
<td>BR02</td>
<td>a0003</td>
</tr>
<tr>
<td>BR02</td>
<td>a0013</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表：</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
<th>order_date</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>cust10</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr>
<td>a0002</td>
<td>cust1</td>
<td>2022-01-01 00:01:00</td>
</tr>
<tr>
<td>a0003</td>
<td>cust1</td>
<td>2022-01-02 00:00:00</td>
</tr>
<tr>
<td>a0013</td>
<td>cust2</td>
<td>2022-01-01 00:20:00</td>
</tr>
</tbody></table>
<p>【问题】</p>
<p>编写 SQL 语句，使用子查询来确定哪些订单（在 <code>OrderItems</code> 中）购买了 <code>prod_id</code> 为 “BR01” 的产品，然后从 <code>Orders</code> 表中返回每个产品对应的顾客 ID（<code>cust_id</code>）和订单日期（<code>order_date</code>），按订购日期对结果进行升序排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 写法 <span class="number">1</span>：子查询</span><br><span class="line"><span class="keyword">SELECT</span> cust_id,order_date</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> order_num <span class="keyword">IN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> order_num</span><br><span class="line">     <span class="keyword">FROM</span> OrderItems</span><br><span class="line">     <span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span> )</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date;</span><br><span class="line"></span><br><span class="line"># 写法 <span class="number">2</span>: 连接表</span><br><span class="line"><span class="keyword">SELECT</span> b.cust_id, b.order_date</span><br><span class="line"><span class="keyword">FROM</span> OrderItems a,Orders b</span><br><span class="line"><span class="keyword">WHERE</span> a.order_num <span class="operator">=</span> b.order_num <span class="keyword">AND</span> a.prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date</span><br></pre></td></tr></table></figure>

<h3 id="返回购买-prod-id-为-BR01-的产品的所有顾客的电子邮件（一）"><a href="#返回购买-prod-id-为-BR01-的产品的所有顾客的电子邮件（一）" class="headerlink" title="返回购买 prod_id 为 BR01 的产品的所有顾客的电子邮件（一）"></a>返回购买 prod_id 为 BR01 的产品的所有顾客的电子邮件（一）</h3><p>你想知道订购 BR01 产品的日期，有表 <code>OrderItems</code> 代表订单商品信息表，<code>prod_id</code> 为产品 id；<code>Orders</code> 表代表订单表有 <code>cust_id</code> 代表顾客 id 和订单日期 <code>order_date</code>；<code>Customers</code> 表含有 <code>cust_email</code> 顾客邮件和 <code>cust_id</code> 顾客 id</p>
<p><code>OrderItems</code> 表：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>BR01</td>
<td>a0001</td>
</tr>
<tr>
<td>BR01</td>
<td>a0002</td>
</tr>
<tr>
<td>BR02</td>
<td>a0003</td>
</tr>
<tr>
<td>BR02</td>
<td>a0013</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表：</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
<th>order_date</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>cust10</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr>
<td>a0002</td>
<td>cust1</td>
<td>2022-01-01 00:01:00</td>
</tr>
<tr>
<td>a0003</td>
<td>cust1</td>
<td>2022-01-02 00:00:00</td>
</tr>
<tr>
<td>a0013</td>
<td>cust2</td>
<td>2022-01-01 00:20:00</td>
</tr>
</tbody></table>
<p><code>Customers</code> 表代表顾客信息，<code>cust_id</code> 为顾客 id，<code>cust_email</code> 为顾客 email</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_email</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td><a href="mailto:&#99;&#x75;&#x73;&#116;&#49;&#48;&#x40;&#x63;&#x75;&#x73;&#116;&#x2e;&#99;&#111;&#x6d;">&#99;&#x75;&#x73;&#116;&#49;&#48;&#x40;&#x63;&#x75;&#x73;&#116;&#x2e;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>cust1</td>
<td><a href="mailto:&#99;&#x75;&#115;&#x74;&#49;&#64;&#x63;&#117;&#x73;&#116;&#x2e;&#x63;&#x6f;&#109;">&#99;&#x75;&#115;&#x74;&#49;&#64;&#x63;&#117;&#x73;&#116;&#x2e;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>cust2</td>
<td><a href="mailto:&#99;&#x75;&#115;&#116;&#x32;&#x40;&#99;&#117;&#x73;&#116;&#46;&#x63;&#111;&#x6d;">&#99;&#x75;&#115;&#116;&#x32;&#x40;&#99;&#117;&#x73;&#116;&#46;&#x63;&#111;&#x6d;</a></td>
</tr>
</tbody></table>
<p>【问题】返回购买 <code>prod_id</code> 为 <code>BR01</code> 的产品的所有顾客的电子邮件（<code>Customers</code> 表中的 <code>cust_email</code>），结果无需排序。</p>
<p>提示：这涉及 <code>SELECT</code> 语句，最内层的从 <code>OrderItems</code> 表返回 <code>order_num</code>，中间的从 <code>Customers</code> 表返回 <code>cust_id</code>。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 写法 <span class="number">1</span>：子查询</span><br><span class="line"><span class="keyword">SELECT</span> cust_email</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> cust_id</span><br><span class="line">    <span class="keyword">FROM</span> Orders</span><br><span class="line">    <span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (<span class="keyword">SELECT</span> order_num</span><br><span class="line">        <span class="keyword">FROM</span> OrderItems</span><br><span class="line">        <span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span>))</span><br><span class="line"></span><br><span class="line"># 写法 <span class="number">2</span>: 连接表（<span class="keyword">inner</span> <span class="keyword">join</span>）</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_email</span><br><span class="line"><span class="keyword">FROM</span> OrderItems a,Orders b,Customers c</span><br><span class="line"><span class="keyword">WHERE</span> a.order_num <span class="operator">=</span> b.order_num <span class="keyword">AND</span> b.cust_id <span class="operator">=</span> c.cust_id <span class="keyword">AND</span> a.prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span></span><br><span class="line"></span><br><span class="line"># 写法 <span class="number">3</span>：连接表（<span class="keyword">left</span> <span class="keyword">join</span>）</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_email</span><br><span class="line"><span class="keyword">FROM</span> Orders a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">  OrderItems b <span class="keyword">ON</span> a.order_num <span class="operator">=</span> b.order_num <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">  Customers c <span class="keyword">ON</span> a.cust_id <span class="operator">=</span> c.cust_id</span><br><span class="line"><span class="keyword">WHERE</span> b.prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="返回每个顾客不同订单的总金额"><a href="#返回每个顾客不同订单的总金额" class="headerlink" title="返回每个顾客不同订单的总金额"></a>返回每个顾客不同订单的总金额</h3><p>我们需要一个顾客 ID 列表，其中包含他们已订购的总金额。</p>
<p><code>OrderItems</code> 表代表订单信息，<code>OrderItems</code> 表有订单号：<code>order_num</code> 和商品售出价格：<code>item_price</code>、商品数量：<code>quantity</code>。</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>item_price</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>10</td>
<td>105</td>
</tr>
<tr>
<td>a0002</td>
<td>1</td>
<td>1100</td>
</tr>
<tr>
<td>a0002</td>
<td>1</td>
<td>200</td>
</tr>
<tr>
<td>a0013</td>
<td>2</td>
<td>1121</td>
</tr>
<tr>
<td>a0003</td>
<td>5</td>
<td>10</td>
</tr>
<tr>
<td>a0003</td>
<td>1</td>
<td>19</td>
</tr>
<tr>
<td>a0003</td>
<td>7</td>
<td>5</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表订单号：<code>order_num</code>、顾客 id：<code>cust_id</code></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>cust10</td>
</tr>
<tr>
<td>a0002</td>
<td>cust1</td>
</tr>
<tr>
<td>a0003</td>
<td>cust1</td>
</tr>
<tr>
<td>a0013</td>
<td>cust2</td>
</tr>
</tbody></table>
<p>【问题】</p>
<p>编写 SQL 语句，返回顾客 ID（<code>Orders</code> 表中的 <code>cust_id</code>），并使用子查询返回 <code>total_ordered</code> 以便返回每个顾客的订单总数，将结果按金额从大到小排序。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 写法 <span class="number">1</span>：子查询</span><br><span class="line"><span class="keyword">SELECT</span> o.cust_id, <span class="built_in">SUM</span>(tb.total_ordered) <span class="keyword">AS</span> `total_ordered`</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> order_num, <span class="built_in">SUM</span>(item_price <span class="operator">*</span> quantity) <span class="keyword">AS</span> total_ordered</span><br><span class="line">    <span class="keyword">FROM</span> OrderItems</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num) <span class="keyword">AS</span> tb,</span><br><span class="line">  Orders o</span><br><span class="line"><span class="keyword">WHERE</span> tb.order_num <span class="operator">=</span> o.order_num</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> o.cust_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_ordered <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"># 写法 <span class="number">2</span>：连接表</span><br><span class="line"><span class="keyword">SELECT</span> b.cust_id, <span class="built_in">Sum</span>(a.quantity <span class="operator">*</span> a.item_price) <span class="keyword">AS</span> total_ordered</span><br><span class="line"><span class="keyword">FROM</span> OrderItems a,Orders b</span><br><span class="line"><span class="keyword">WHERE</span> a.order_num <span class="operator">=</span> b.order_num</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_ordered <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>关于写法一详细介绍可以参考： <a href="https://github.com/Snailclimb/JavaGuide/issues/2402">issue#2402：写法 1 存在的错误以及修改方法</a>。</p>
<h3 id="从-Products-表中检索所有的产品名称以及对应的销售总数"><a href="#从-Products-表中检索所有的产品名称以及对应的销售总数" class="headerlink" title="从 Products 表中检索所有的产品名称以及对应的销售总数"></a>从 Products 表中检索所有的产品名称以及对应的销售总数</h3><p><code>Products</code> 表中检索所有的产品名称：<code>prod_name</code>、产品 id：<code>prod_id</code></p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_name</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>egg</td>
</tr>
<tr>
<td>a0002</td>
<td>sockets</td>
</tr>
<tr>
<td>a0013</td>
<td>coffee</td>
</tr>
<tr>
<td>a0003</td>
<td>cola</td>
</tr>
</tbody></table>
<p><code>OrderItems</code> 代表订单商品表，订单产品：<code>prod_id</code>、售出数量：<code>quantity</code></p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>105</td>
</tr>
<tr>
<td>a0002</td>
<td>1100</td>
</tr>
<tr>
<td>a0002</td>
<td>200</td>
</tr>
<tr>
<td>a0013</td>
<td>1121</td>
</tr>
<tr>
<td>a0003</td>
<td>10</td>
</tr>
<tr>
<td>a0003</td>
<td>19</td>
</tr>
<tr>
<td>a0003</td>
<td>5</td>
</tr>
</tbody></table>
<p>【问题】</p>
<p>编写 SQL 语句，从 <code>Products</code> 表中检索所有的产品名称（<code>prod_name</code>），以及名为 <code>quant_sold</code> 的计算列，其中包含所售产品的总数（在 <code>OrderItems</code> 表上使用子查询和 <code>SUM(quantity)</code> 检索）。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 写法 <span class="number">1</span>：子查询</span><br><span class="line"><span class="keyword">SELECT</span> p.prod_name, tb.quant_sold</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> prod_id, <span class="built_in">Sum</span>(quantity) <span class="keyword">AS</span> quant_sold</span><br><span class="line">    <span class="keyword">FROM</span> OrderItems</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> prod_id) <span class="keyword">AS</span> tb,</span><br><span class="line">  Products p</span><br><span class="line"><span class="keyword">WHERE</span> tb.prod_id <span class="operator">=</span> p.prod_id</span><br><span class="line"></span><br><span class="line"># 写法 <span class="number">2</span>：连接表</span><br><span class="line"><span class="keyword">SELECT</span> p.prod_name, <span class="built_in">Sum</span>(o.quantity) <span class="keyword">AS</span> quant_sold</span><br><span class="line"><span class="keyword">FROM</span> Products p,</span><br><span class="line">  OrderItems o</span><br><span class="line"><span class="keyword">WHERE</span> p.prod_id <span class="operator">=</span> o.prod_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> p.prod_name（这里不能用 p.prod_id，会报错）</span><br></pre></td></tr></table></figure>

<h2 id="连接表"><a href="#连接表" class="headerlink" title="连接表"></a>连接表</h2><p>JOIN 是“连接”的意思，顾名思义，SQL JOIN 子句用于将两个或者多个表联合起来进行查询。</p>
<p>连接表时需要在每个表中选择一个字段，并对这些字段的值进行比较，值相同的两条记录将合并为一条。<strong>连接表的本质就是将不同表的记录合并起来，形成一张新表。当然，这张新表只是临时的，它仅存在于本次查询期间</strong>。</p>
<p>使用 <code>JOIN</code> 连接两个表的基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table1.column1, table2.column2...</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.common_column1 <span class="operator">=</span> table2.common_column2;</span><br></pre></td></tr></table></figure>

<p><code>table1.common_column1 = table2.common_column2</code> 是连接条件，只有满足此条件的记录才会合并为一行。您可以使用多个运算符来连接表，例如 &#x3D;、&gt;、&lt;、&lt;&gt;、&lt;&#x3D;、&gt;&#x3D;、!&#x3D;、<code>between</code>、<code>like</code> 或者 <code>not</code>，但是最常见的是使用 &#x3D;。</p>
<p>当两个表中有同名的字段时，为了帮助数据库引擎区分是哪个表的字段，在书写同名字段名时需要加上表名。当然，如果书写的字段名在两个表中是唯一的，也可以不使用以上格式，只写字段名即可。</p>
<p>另外，如果两张表的关联字段名相同，也可以使用 <code>USING</code>子句来代替 <code>ON</code>，举个例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># join....on</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers c</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders o</span><br><span class="line"><span class="keyword">ON</span> c.cust_id <span class="operator">=</span> o.cust_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name</span><br><span class="line"></span><br><span class="line"># 如果两张表的关联字段名相同，也可以使用<span class="keyword">USING</span>子句：JOIN....USING()</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers c</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders o</span><br><span class="line"><span class="keyword">USING</span>(cust_id)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name</span><br></pre></td></tr></table></figure>

<p><strong><code>ON</code> 和 <code>WHERE</code> 的区别</strong>：</p>
<ul>
<li>连接表时，SQL 会根据连接条件生成一张新的临时表。<code>ON</code> 就是连接条件，它决定临时表的生成。</li>
<li><code>WHERE</code> 是在临时表生成以后，再对临时表中的数据进行过滤，生成最终的结果集，这个时候已经没有 JOIN-ON 了。</li>
</ul>
<p>所以总结来说就是：<strong>SQL 先根据 ON 生成一张临时表，然后再根据 WHERE 对临时表进行筛选</strong>。</p>
<p>SQL 允许在 <code>JOIN</code> 左边加上一些修饰性的关键词，从而形成不同类型的连接，如下表所示：</p>
<table>
<thead>
<tr>
<th>连接类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>INNER JOIN 内连接</td>
<td>（默认连接方式）只有当两个表都存在满足条件的记录时才会返回行。</td>
</tr>
<tr>
<td>LEFT JOIN &#x2F; LEFT OUTER JOIN 左(外)连接</td>
<td>返回左表中的所有行，即使右表中没有满足条件的行也是如此。</td>
</tr>
<tr>
<td>RIGHT JOIN &#x2F; RIGHT OUTER JOIN 右(外)连接</td>
<td>返回右表中的所有行，即使左表中没有满足条件的行也是如此。</td>
</tr>
<tr>
<td>FULL JOIN &#x2F; FULL OUTER JOIN 全(外)连接</td>
<td>只要其中有一个表存在满足条件的记录，就返回行。</td>
</tr>
<tr>
<td>SELF JOIN</td>
<td>将一个表连接到自身，就像该表是两个表一样。为了区分两个表，在 SQL 语句中需要至少重命名一个表。</td>
</tr>
<tr>
<td>CROSS JOIN</td>
<td>交叉连接，从两个或者多个连接表中返回记录集的笛卡尔积。</td>
</tr>
</tbody></table>
<p>下图展示了 LEFT JOIN、RIGHT JOIN、INNER JOIN、OUTER JOIN 相关的 7 种用法。</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/csdn/d1794312b448516831369f869814ab39.png"></p>
<p>如果不加任何修饰词，只写 <code>JOIN</code>，那么默认为 <code>INNER JOIN</code></p>
<p>对于 <code>INNER JOIN</code> 来说，还有一种隐式的写法，称为 “<strong>隐式内连接</strong>”，也就是没有 <code>INNER JOIN</code> 关键字，使用 <code>WHERE</code> 语句实现内连接的功能</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 隐式内连接</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers c,Orders o</span><br><span class="line"><span class="keyword">WHERE</span> c.cust_id <span class="operator">=</span> o.cust_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name</span><br><span class="line"></span><br><span class="line"># 显式内连接</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers c</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders o</span><br><span class="line"><span class="keyword">USING</span>(cust_id)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name;</span><br></pre></td></tr></table></figure>

<h3 id="返回顾客名称和相关订单号"><a href="#返回顾客名称和相关订单号" class="headerlink" title="返回顾客名称和相关订单号"></a>返回顾客名称和相关订单号</h3><p><code>Customers</code> 表有字段顾客名称 <code>cust_name</code>、顾客 id <code>cust_id</code></p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td>andy</td>
</tr>
<tr>
<td>cust1</td>
<td>ben</td>
</tr>
<tr>
<td>cust2</td>
<td>tony</td>
</tr>
<tr>
<td>cust22</td>
<td>tom</td>
</tr>
<tr>
<td>cust221</td>
<td>an</td>
</tr>
<tr>
<td>cust2217</td>
<td>hex</td>
</tr>
</tbody></table>
<p><code>Orders</code> 订单信息表，含有字段 <code>order_num</code> 订单号、<code>cust_id</code> 顾客 id</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>cust10</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a3</td>
<td>cust2</td>
</tr>
<tr>
<td>a4</td>
<td>cust22</td>
</tr>
<tr>
<td>a5</td>
<td>cust221</td>
</tr>
<tr>
<td>a7</td>
<td>cust2217</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回 <code>Customers</code> 表中的顾客名称（<code>cust_name</code>）和 <code>Orders</code> 表中的相关订单号（<code>order_num</code>），并按顾客名称再按订单号对结果进行升序排序。你可以尝试用两个不同的写法，一个使用简单的等连接语法，另外一个使用 INNER JOIN。</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 隐式内连接</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers c,Orders o</span><br><span class="line"><span class="keyword">WHERE</span> c.cust_id <span class="operator">=</span> o.cust_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name,o.order_num</span><br><span class="line"></span><br><span class="line"># 显式内连接</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers c</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders o</span><br><span class="line"><span class="keyword">USING</span>(cust_id)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name,o.order_num;</span><br></pre></td></tr></table></figure>

<h3 id="返回顾客名称和相关订单号以及每个订单的总价"><a href="#返回顾客名称和相关订单号以及每个订单的总价" class="headerlink" title="返回顾客名称和相关订单号以及每个订单的总价"></a>返回顾客名称和相关订单号以及每个订单的总价</h3><p><code>Customers</code> 表有字段，顾客名称：<code>cust_name</code>、顾客 id：<code>cust_id</code></p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td>andy</td>
</tr>
<tr>
<td>cust1</td>
<td>ben</td>
</tr>
<tr>
<td>cust2</td>
<td>tony</td>
</tr>
<tr>
<td>cust22</td>
<td>tom</td>
</tr>
<tr>
<td>cust221</td>
<td>an</td>
</tr>
<tr>
<td>cust2217</td>
<td>hex</td>
</tr>
</tbody></table>
<p><code>Orders</code> 订单信息表，含有字段，订单号：<code>order_num</code>、顾客 id：<code>cust_id</code></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>cust10</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a3</td>
<td>cust2</td>
</tr>
<tr>
<td>a4</td>
<td>cust22</td>
</tr>
<tr>
<td>a5</td>
<td>cust221</td>
</tr>
<tr>
<td>a7</td>
<td>cust2217</td>
</tr>
</tbody></table>
<p><code>OrderItems</code> 表有字段，商品订单号：<code>order_num</code>、商品数量：<code>quantity</code>、商品价格：<code>item_price</code></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>quantity</th>
<th>item_price</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>1000</td>
<td>10</td>
</tr>
<tr>
<td>a2</td>
<td>200</td>
<td>10</td>
</tr>
<tr>
<td>a3</td>
<td>10</td>
<td>15</td>
</tr>
<tr>
<td>a4</td>
<td>25</td>
<td>50</td>
</tr>
<tr>
<td>a5</td>
<td>15</td>
<td>25</td>
</tr>
<tr>
<td>a7</td>
<td>7</td>
<td>7</td>
</tr>
</tbody></table>
<p>【问题】除了返回顾客名称和订单号，返回 <code>Customers</code> 表中的顾客名称（<code>cust_name</code>）和 <code>Orders</code> 表中的相关订单号（<code>order_num</code>），添加第三列 <code>OrderTotal</code>，其中包含每个订单的总价，并按顾客名称再按订单号对结果进行升序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 简单的等连接语法</span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num, <span class="built_in">SUM</span>(quantity <span class="operator">*</span> item_price) <span class="keyword">AS</span> OrderTotal</span><br><span class="line"><span class="keyword">FROM</span> Customers c,Orders o,OrderItems oi</span><br><span class="line"><span class="keyword">WHERE</span> c.cust_id <span class="operator">=</span> o.cust_id <span class="keyword">AND</span> o.order_num <span class="operator">=</span> oi.order_num</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c.cust_name, o.order_num</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name, o.order_num</span><br></pre></td></tr></table></figure>

<p>注意，可能有小伙伴会这样写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c.cust_name, o.order_num, <span class="built_in">SUM</span>(quantity <span class="operator">*</span> item_price) <span class="keyword">AS</span> OrderTotal</span><br><span class="line"><span class="keyword">FROM</span> Customers c,Orders o,OrderItems oi</span><br><span class="line"><span class="keyword">WHERE</span> c.cust_id <span class="operator">=</span> o.cust_id <span class="keyword">AND</span> o.order_num <span class="operator">=</span> oi.order_num</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c.cust_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.cust_name,o.order_num</span><br></pre></td></tr></table></figure>

<p>这是错误的！只对 <code>cust_name</code> 进行聚类确实符合题意，但是不符合 <code>GROUP BY</code> 的语法。</p>
<p>select 语句中，如果没有 <code>GROUP BY</code> 语句，那么 <code>cust_name</code>、<code>order_num</code> 会返回若干个值，而 <code>sum(quantity * item_price)</code> 只返回一个值，通过 <code>group by</code> <code>cust_name</code> 可以让 <code>cust_name</code> 和 <code>sum(quantity * item_price)</code> 一一对应起来，或者说<strong>聚类</strong>，所以同样的，也要对 <code>order_num</code> 进行聚类。</p>
<blockquote>
<p><strong>一句话，select 中的字段要么都聚类，要么都不聚类</strong></p>
</blockquote>
<h3 id="确定哪些订单购买了-prod-id-为-BR01-的产品（二）"><a href="#确定哪些订单购买了-prod-id-为-BR01-的产品（二）" class="headerlink" title="确定哪些订单购买了 prod_id 为 BR01 的产品（二）"></a>确定哪些订单购买了 prod_id 为 BR01 的产品（二）</h3><p>表 <code>OrderItems</code> 代表订单商品信息表，<code>prod_id</code> 为产品 id；<code>Orders</code> 表代表订单表有 <code>cust_id</code> 代表顾客 id 和订单日期 <code>order_date</code></p>
<p><code>OrderItems</code> 表：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>BR01</td>
<td>a0001</td>
</tr>
<tr>
<td>BR01</td>
<td>a0002</td>
</tr>
<tr>
<td>BR02</td>
<td>a0003</td>
</tr>
<tr>
<td>BR02</td>
<td>a0013</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表：</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
<th>order_date</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>cust10</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr>
<td>a0002</td>
<td>cust1</td>
<td>2022-01-01 00:01:00</td>
</tr>
<tr>
<td>a0003</td>
<td>cust1</td>
<td>2022-01-02 00:00:00</td>
</tr>
<tr>
<td>a0013</td>
<td>cust2</td>
<td>2022-01-01 00:20:00</td>
</tr>
</tbody></table>
<p>【问题】</p>
<p>编写 SQL 语句，使用子查询来确定哪些订单（在 <code>OrderItems</code> 中）购买了 <code>prod_id</code> 为 “BR01” 的产品，然后从 <code>Orders</code> 表中返回每个产品对应的顾客 ID（<code>cust_id</code>）和订单日期（<code>order_date</code>），按订购日期对结果进行升序排序。</p>
<p>提示：这一次使用连接和简单的等连接语法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 写法 <span class="number">1</span>：子查询</span><br><span class="line"><span class="keyword">SELECT</span> cust_id, order_date</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (<span class="keyword">SELECT</span> order_num</span><br><span class="line">    <span class="keyword">FROM</span> OrderItems</span><br><span class="line">    <span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date</span><br><span class="line"></span><br><span class="line"># 写法 <span class="number">2</span>：连接表 <span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_id, order_date</span><br><span class="line"><span class="keyword">FROM</span> Orders o <span class="keyword">INNER</span> <span class="keyword">JOIN</span></span><br><span class="line">  (<span class="keyword">SELECT</span> order_num</span><br><span class="line">    <span class="keyword">FROM</span> OrderItems</span><br><span class="line">    <span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span>) tb <span class="keyword">ON</span> o.order_num <span class="operator">=</span> tb.order_num</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date</span><br><span class="line"></span><br><span class="line"># 写法 <span class="number">3</span>：写法 <span class="number">2</span> 的简化版</span><br><span class="line"><span class="keyword">SELECT</span> cust_id, order_date</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> OrderItems <span class="keyword">USING</span>(order_num)</span><br><span class="line"><span class="keyword">WHERE</span> OrderItems.prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date</span><br></pre></td></tr></table></figure>

<h3 id="返回购买-prod-id-为-BR01-的产品的所有顾客的电子邮件（二）"><a href="#返回购买-prod-id-为-BR01-的产品的所有顾客的电子邮件（二）" class="headerlink" title="返回购买 prod_id 为 BR01 的产品的所有顾客的电子邮件（二）"></a>返回购买 prod_id 为 BR01 的产品的所有顾客的电子邮件（二）</h3><p>有表 <code>OrderItems</code> 代表订单商品信息表，<code>prod_id</code> 为产品 id；<code>Orders</code> 表代表订单表有 <code>cust_id</code> 代表顾客 id 和订单日期 <code>order_date</code>；<code>Customers</code> 表含有 <code>cust_email</code> 顾客邮件和 cust_id 顾客 id</p>
<p><code>OrderItems</code> 表：</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>BR01</td>
<td>a0001</td>
</tr>
<tr>
<td>BR01</td>
<td>a0002</td>
</tr>
<tr>
<td>BR02</td>
<td>a0003</td>
</tr>
<tr>
<td>BR02</td>
<td>a0013</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表：</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
<th>order_date</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>cust10</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr>
<td>a0002</td>
<td>cust1</td>
<td>2022-01-01 00:01:00</td>
</tr>
<tr>
<td>a0003</td>
<td>cust1</td>
<td>2022-01-02 00:00:00</td>
</tr>
<tr>
<td>a0013</td>
<td>cust2</td>
<td>2022-01-01 00:20:00</td>
</tr>
</tbody></table>
<p><code>Customers</code> 表代表顾客信息，<code>cust_id</code> 为顾客 id，<code>cust_email</code> 为顾客 email</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_email</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td><a href="mailto:&#x63;&#x75;&#115;&#x74;&#49;&#x30;&#x40;&#x63;&#117;&#x73;&#x74;&#46;&#99;&#111;&#109;">&#x63;&#x75;&#115;&#x74;&#49;&#x30;&#x40;&#x63;&#117;&#x73;&#x74;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>cust1</td>
<td><a href="mailto:&#x63;&#117;&#115;&#116;&#x31;&#x40;&#99;&#x75;&#115;&#x74;&#46;&#99;&#x6f;&#x6d;">&#x63;&#117;&#115;&#116;&#x31;&#x40;&#99;&#x75;&#115;&#x74;&#46;&#99;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>cust2</td>
<td><a href="mailto:&#x63;&#117;&#x73;&#116;&#x32;&#x40;&#x63;&#117;&#x73;&#x74;&#x2e;&#x63;&#x6f;&#109;">&#x63;&#117;&#x73;&#116;&#x32;&#x40;&#x63;&#117;&#x73;&#x74;&#x2e;&#x63;&#x6f;&#109;</a></td>
</tr>
</tbody></table>
<p>【问题】返回购买 <code>prod_id</code> 为 BR01 的产品的所有顾客的电子邮件（<code>Customers</code> 表中的 <code>cust_email</code>），结果无需排序。</p>
<p>提示：涉及到 <code>SELECT</code> 语句，最内层的从 <code>OrderItems</code> 表返回 <code>order_num</code>，中间的从 <code>Customers</code> 表返回 <code>cust_id</code>，但是必须使用 INNER JOIN 语法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_email</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">using</span>(cust_id)</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> OrderItems <span class="keyword">using</span>(order_num)</span><br><span class="line"><span class="keyword">WHERE</span> OrderItems.prod_id <span class="operator">=</span> <span class="string">&#x27;BR01&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="确定最佳顾客的另一种方式（二）"><a href="#确定最佳顾客的另一种方式（二）" class="headerlink" title="确定最佳顾客的另一种方式（二）"></a>确定最佳顾客的另一种方式（二）</h3><p><code>OrderItems</code> 表代表订单信息，确定最佳顾客的另一种方式是看他们花了多少钱，<code>OrderItems</code> 表有订单号 <code>order_num</code> 和 <code>item_price</code> 商品售出价格、<code>quantity</code> 商品数量</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>item_price</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>10</td>
<td>105</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
<td>1100</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
<td>200</td>
</tr>
<tr>
<td>a4</td>
<td>2</td>
<td>1121</td>
</tr>
<tr>
<td>a5</td>
<td>5</td>
<td>10</td>
</tr>
<tr>
<td>a2</td>
<td>1</td>
<td>19</td>
</tr>
<tr>
<td>a7</td>
<td>7</td>
<td>5</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表含有字段 <code>order_num</code> 订单号、<code>cust_id</code> 顾客 id</p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>cust10</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a3</td>
<td>cust2</td>
</tr>
<tr>
<td>a4</td>
<td>cust22</td>
</tr>
<tr>
<td>a5</td>
<td>cust221</td>
</tr>
<tr>
<td>a7</td>
<td>cust2217</td>
</tr>
</tbody></table>
<p>顾客表 <code>Customers</code> 有字段 <code>cust_id</code> 客户 id、<code>cust_name</code> 客户姓名</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td>andy</td>
</tr>
<tr>
<td>cust1</td>
<td>ben</td>
</tr>
<tr>
<td>cust2</td>
<td>tony</td>
</tr>
<tr>
<td>cust22</td>
<td>tom</td>
</tr>
<tr>
<td>cust221</td>
<td>an</td>
</tr>
<tr>
<td>cust2217</td>
<td>hex</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，返回订单总价不小于 1000 的客户名称和总额（<code>OrderItems</code> 表中的 <code>order_num</code>）。</p>
<p>提示：需要计算总和（<code>item_price</code> 乘以 <code>quantity</code>）。按总额对结果进行排序，请使用 <code>INNER JOIN</code>语法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, <span class="built_in">SUM</span>(item_price <span class="operator">*</span> quantity) <span class="keyword">AS</span> total_price</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">USING</span>(cust_id)</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> OrderItems <span class="keyword">USING</span>(order_num)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_name</span><br><span class="line"><span class="keyword">HAVING</span> total_price <span class="operator">&gt;=</span> <span class="number">1000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_price</span><br></pre></td></tr></table></figure>

<h2 id="创建高级连接"><a href="#创建高级连接" class="headerlink" title="创建高级连接"></a>创建高级连接</h2><h3 id="检索每个顾客的名称和所有的订单号（一）"><a href="#检索每个顾客的名称和所有的订单号（一）" class="headerlink" title="检索每个顾客的名称和所有的订单号（一）"></a>检索每个顾客的名称和所有的订单号（一）</h3><p><code>Customers</code> 表代表顾客信息含有顾客 id <code>cust_id</code> 和 顾客名称 <code>cust_name</code></p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td>andy</td>
</tr>
<tr>
<td>cust1</td>
<td>ben</td>
</tr>
<tr>
<td>cust2</td>
<td>tony</td>
</tr>
<tr>
<td>cust22</td>
<td>tom</td>
</tr>
<tr>
<td>cust221</td>
<td>an</td>
</tr>
<tr>
<td>cust2217</td>
<td>hex</td>
</tr>
</tbody></table>
<p><code>Orders</code> 表代表订单信息含有订单号 <code>order_num</code> 和顾客 id <code>cust_id</code></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>cust10</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a3</td>
<td>cust2</td>
</tr>
<tr>
<td>a4</td>
<td>cust22</td>
</tr>
<tr>
<td>a5</td>
<td>cust221</td>
</tr>
<tr>
<td>a7</td>
<td>cust2217</td>
</tr>
</tbody></table>
<p>【问题】使用 INNER JOIN 编写 SQL 语句，检索每个顾客的名称（<code>Customers</code> 表中的 <code>cust_name</code>）和所有的订单号（<code>Orders</code> 表中的 <code>order_num</code>），最后根据顾客姓名 <code>cust_name</code> 升序返回。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">USING</span>(cust_id)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name</span><br></pre></td></tr></table></figure>

<h3 id="检索每个顾客的名称和所有的订单号（二）"><a href="#检索每个顾客的名称和所有的订单号（二）" class="headerlink" title="检索每个顾客的名称和所有的订单号（二）"></a>检索每个顾客的名称和所有的订单号（二）</h3><p><code>Orders</code> 表代表订单信息含有订单号 <code>order_num</code> 和顾客 id <code>cust_id</code></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>a1</td>
<td>cust10</td>
</tr>
<tr>
<td>a2</td>
<td>cust1</td>
</tr>
<tr>
<td>a3</td>
<td>cust2</td>
</tr>
<tr>
<td>a4</td>
<td>cust22</td>
</tr>
<tr>
<td>a5</td>
<td>cust221</td>
</tr>
<tr>
<td>a7</td>
<td>cust2217</td>
</tr>
</tbody></table>
<p><code>Customers</code> 表代表顾客信息含有顾客 id <code>cust_id</code> 和 顾客名称 <code>cust_name</code></p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td>andy</td>
</tr>
<tr>
<td>cust1</td>
<td>ben</td>
</tr>
<tr>
<td>cust2</td>
<td>tony</td>
</tr>
<tr>
<td>cust22</td>
<td>tom</td>
</tr>
<tr>
<td>cust221</td>
<td>an</td>
</tr>
<tr>
<td>cust2217</td>
<td>hex</td>
</tr>
<tr>
<td>cust40</td>
<td>ace</td>
</tr>
</tbody></table>
<p>【问题】检索每个顾客的名称（<code>Customers</code> 表中的 <code>cust_name</code>）和所有的订单号（Orders 表中的 <code>order_num</code>），列出所有的顾客，即使他们没有下过订单。最后根据顾客姓名 <code>cust_name</code> 升序返回。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">USING</span>(cust_id)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name</span><br></pre></td></tr></table></figure>

<h3 id="返回产品名称和与之相关的订单号"><a href="#返回产品名称和与之相关的订单号" class="headerlink" title="返回产品名称和与之相关的订单号"></a>返回产品名称和与之相关的订单号</h3><p><code>Products</code> 表为产品信息表含有字段 <code>prod_id</code> 产品 id、<code>prod_name</code> 产品名称</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_name</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>egg</td>
</tr>
<tr>
<td>a0002</td>
<td>sockets</td>
</tr>
<tr>
<td>a0013</td>
<td>coffee</td>
</tr>
<tr>
<td>a0003</td>
<td>cola</td>
</tr>
<tr>
<td>a0023</td>
<td>soda</td>
</tr>
</tbody></table>
<p><code>OrderItems</code> 表为订单信息表含有字段 <code>order_num</code> 订单号和产品 id <code>prod_id</code></p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>a105</td>
</tr>
<tr>
<td>a0002</td>
<td>a1100</td>
</tr>
<tr>
<td>a0002</td>
<td>a200</td>
</tr>
<tr>
<td>a0013</td>
<td>a1121</td>
</tr>
<tr>
<td>a0003</td>
<td>a10</td>
</tr>
<tr>
<td>a0003</td>
<td>a19</td>
</tr>
<tr>
<td>a0003</td>
<td>a5</td>
</tr>
</tbody></table>
<p>【问题】使用外连接（left join、 right join、full join）联结 <code>Products</code> 表和 <code>OrderItems</code> 表，返回产品名称（<code>prod_name</code>）和与之相关的订单号（<code>order_num</code>）的列表，并按照产品名称升序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, order_num</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> OrderItems</span><br><span class="line"><span class="keyword">USING</span>(prod_id)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name</span><br></pre></td></tr></table></figure>

<h3 id="返回产品名称和每一项产品的总订单数"><a href="#返回产品名称和每一项产品的总订单数" class="headerlink" title="返回产品名称和每一项产品的总订单数"></a>返回产品名称和每一项产品的总订单数</h3><p><code>Products</code> 表为产品信息表含有字段 <code>prod_id</code> 产品 id、<code>prod_name</code> 产品名称</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_name</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>egg</td>
</tr>
<tr>
<td>a0002</td>
<td>sockets</td>
</tr>
<tr>
<td>a0013</td>
<td>coffee</td>
</tr>
<tr>
<td>a0003</td>
<td>cola</td>
</tr>
<tr>
<td>a0023</td>
<td>soda</td>
</tr>
</tbody></table>
<p><code>OrderItems</code> 表为订单信息表含有字段 <code>order_num</code> 订单号和产品 id <code>prod_id</code></p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>a105</td>
</tr>
<tr>
<td>a0002</td>
<td>a1100</td>
</tr>
<tr>
<td>a0002</td>
<td>a200</td>
</tr>
<tr>
<td>a0013</td>
<td>a1121</td>
</tr>
<tr>
<td>a0003</td>
<td>a10</td>
</tr>
<tr>
<td>a0003</td>
<td>a19</td>
</tr>
<tr>
<td>a0003</td>
<td>a5</td>
</tr>
</tbody></table>
<p>【问题】</p>
<p>使用 OUTER JOIN 联结 <code>Products</code> 表和 <code>OrderItems</code> 表，返回产品名称（<code>prod_name</code>）和每一项产品的总订单数（不是订单号），并按产品名称升序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, <span class="built_in">COUNT</span>(order_num) <span class="keyword">AS</span> orders</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> OrderItems</span><br><span class="line"><span class="keyword">USING</span>(prod_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> prod_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name</span><br></pre></td></tr></table></figure>

<h3 id="列出供应商及其可供产品的数量"><a href="#列出供应商及其可供产品的数量" class="headerlink" title="列出供应商及其可供产品的数量"></a>列出供应商及其可供产品的数量</h3><p>有 <code>Vendors</code> 表含有 <code>vend_id</code> （供应商 id）</p>
<table>
<thead>
<tr>
<th>vend_id</th>
</tr>
</thead>
<tbody><tr>
<td>a0002</td>
</tr>
<tr>
<td>a0013</td>
</tr>
<tr>
<td>a0003</td>
</tr>
<tr>
<td>a0010</td>
</tr>
</tbody></table>
<p>有 <code>Products</code> 表含有 <code>vend_id</code>（供应商 id）和 prod_id（供应产品 id）</p>
<table>
<thead>
<tr>
<th>vend_id</th>
<th>prod_id</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>egg</td>
</tr>
<tr>
<td>a0002</td>
<td>prod_id_iphone</td>
</tr>
<tr>
<td>a00113</td>
<td>prod_id_tea</td>
</tr>
<tr>
<td>a0003</td>
<td>prod_id_vivo phone</td>
</tr>
<tr>
<td>a0010</td>
<td>prod_id_huawei phone</td>
</tr>
</tbody></table>
<p>【问题】列出供应商（<code>Vendors</code> 表中的 <code>vend_id</code>）及其可供产品的数量，包括没有产品的供应商。你需要使用 OUTER JOIN 和 COUNT()聚合函数来计算 <code>Products</code> 表中每种产品的数量，最后根据 vend_id 升序排序。</p>
<p>注意：<code>vend_id</code> 列会显示在多个表中，因此在每次引用它时都需要完全限定它。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> v.vend_id, <span class="built_in">COUNT</span>(prod_id) <span class="keyword">AS</span> prod_id</span><br><span class="line"><span class="keyword">FROM</span> Vendors v</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Products p</span><br><span class="line"><span class="keyword">USING</span>(vend_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> v.vend_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> v.vend_id</span><br></pre></td></tr></table></figure>

<h2 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h2><p><code>UNION</code> 运算符将两个或更多查询的结果组合起来，并生成一个结果集，其中包含来自 <code>UNION</code> 中参与查询的提取行。</p>
<p><code>UNION</code> 基本规则：</p>
<ul>
<li>所有查询的列数和列顺序必须相同。</li>
<li>每个查询中涉及表的列的数据类型必须相同或兼容。</li>
<li>通常返回的列名取自第一个查询。</li>
</ul>
<p>默认地，<code>UNION</code> 操作符选取不同的值。如果允许重复的值，请使用 <code>UNION ALL</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>

<p><code>UNION</code> 结果集中的列名总是等于 <code>UNION</code> 中第一个 <code>SELECT</code> 语句中的列名。</p>
<p><code>JOIN</code> vs <code>UNION</code>：</p>
<ul>
<li><code>JOIN</code> 中连接表的列可能不同，但在 <code>UNION</code> 中，所有查询的列数和列顺序必须相同。</li>
<li><code>UNION</code> 将查询之后的行放在一起（垂直放置），但 <code>JOIN</code> 将查询之后的列放在一起（水平放置），即它构成一个笛卡尔积。</li>
</ul>
<h3 id="将两个-SELECT-语句结合起来（一）"><a href="#将两个-SELECT-语句结合起来（一）" class="headerlink" title="将两个 SELECT 语句结合起来（一）"></a>将两个 SELECT 语句结合起来（一）</h3><p>表 <code>OrderItems</code> 包含订单产品信息，字段 <code>prod_id</code> 代表产品 id、<code>quantity</code> 代表产品数量</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>105</td>
</tr>
<tr>
<td>a0002</td>
<td>100</td>
</tr>
<tr>
<td>a0002</td>
<td>200</td>
</tr>
<tr>
<td>a0013</td>
<td>1121</td>
</tr>
<tr>
<td>a0003</td>
<td>10</td>
</tr>
<tr>
<td>a0003</td>
<td>19</td>
</tr>
<tr>
<td>a0003</td>
<td>5</td>
</tr>
<tr>
<td>BNBG</td>
<td>10002</td>
</tr>
</tbody></table>
<p>【问题】将两个 <code>SELECT</code> 语句结合起来，以便从 <code>OrderItems</code> 表中检索产品 id（<code>prod_id</code>）和 <code>quantity</code>。其中，一个 <code>SELECT</code> 语句过滤数量为 100 的行，另一个 <code>SELECT</code> 语句过滤 id 以 BNBG 开头的产品，最后按产品 id 对结果进行升序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, quantity</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">WHERE</span> quantity <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, quantity</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">WHERE</span> prod_id <span class="keyword">LIKE</span> <span class="string">&#x27;BNBG%&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="将两个-SELECT-语句结合起来（二）"><a href="#将两个-SELECT-语句结合起来（二）" class="headerlink" title="将两个 SELECT 语句结合起来（二）"></a>将两个 SELECT 语句结合起来（二）</h3><p>表 <code>OrderItems</code> 包含订单产品信息，字段 <code>prod_id</code> 代表产品 id、<code>quantity</code> 代表产品数量。</p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>quantity</th>
</tr>
</thead>
<tbody><tr>
<td>a0001</td>
<td>105</td>
</tr>
<tr>
<td>a0002</td>
<td>100</td>
</tr>
<tr>
<td>a0002</td>
<td>200</td>
</tr>
<tr>
<td>a0013</td>
<td>1121</td>
</tr>
<tr>
<td>a0003</td>
<td>10</td>
</tr>
<tr>
<td>a0003</td>
<td>19</td>
</tr>
<tr>
<td>a0003</td>
<td>5</td>
</tr>
<tr>
<td>BNBG</td>
<td>10002</td>
</tr>
</tbody></table>
<p>【问题】将两个 <code>SELECT</code> 语句结合起来，以便从 <code>OrderItems</code> 表中检索产品 id（<code>prod_id</code>）和 <code>quantity</code>。其中，一个 <code>SELECT</code> 语句过滤数量为 100 的行，另一个 <code>SELECT</code> 语句过滤 id 以 BNBG 开头的产品，最后按产品 id 对结果进行升序排序。 注意：<strong>这次仅使用单个 SELECT 语句。</strong></p>
<p>答案：</p>
<p>要求只用一条 select 语句，那就用 <code>or</code> 不用 <code>union</code> 了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, quantity</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">WHERE</span> quantity <span class="operator">=</span> <span class="number">100</span> <span class="keyword">OR</span> prod_id <span class="keyword">LIKE</span> <span class="string">&#x27;BNBG%&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="组合-Products-表中的产品名称和-Customers-表中的顾客名称"><a href="#组合-Products-表中的产品名称和-Customers-表中的顾客名称" class="headerlink" title="组合 Products 表中的产品名称和 Customers 表中的顾客名称"></a>组合 Products 表中的产品名称和 Customers 表中的顾客名称</h3><p><code>Products</code> 表含有字段 <code>prod_name</code> 代表产品名称</p>
<table>
<thead>
<tr>
<th>prod_name</th>
</tr>
</thead>
<tbody><tr>
<td>flower</td>
</tr>
<tr>
<td>rice</td>
</tr>
<tr>
<td>ring</td>
</tr>
<tr>
<td>umbrella</td>
</tr>
</tbody></table>
<p>Customers 表代表顾客信息，cust_name 代表顾客名称</p>
<table>
<thead>
<tr>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>andy</td>
</tr>
<tr>
<td>ben</td>
</tr>
<tr>
<td>tony</td>
</tr>
<tr>
<td>tom</td>
</tr>
<tr>
<td>an</td>
</tr>
<tr>
<td>lee</td>
</tr>
<tr>
<td>hex</td>
</tr>
</tbody></table>
<p>【问题】编写 SQL 语句，组合 <code>Products</code> 表中的产品名称（<code>prod_name</code>）和 <code>Customers</code> 表中的顾客名称（<code>cust_name</code>）并返回，然后按产品名称对结果进行升序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">UNION</span> 结果集中的列名总是等于 <span class="keyword">UNION</span> 中第一个 <span class="keyword">SELECT</span> 语句中的列名。</span><br><span class="line"><span class="keyword">SELECT</span> prod_name</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name</span><br></pre></td></tr></table></figure>

<h3 id="检查-SQL-语句-3"><a href="#检查-SQL-语句-3" class="headerlink" title="检查 SQL 语句"></a>检查 SQL 语句</h3><p>表 <code>Customers</code> 含有字段 <code>cust_name</code> 顾客名、<code>cust_contact</code> 顾客联系方式、<code>cust_state</code> 顾客州、<code>cust_email</code> 顾客 <code>email</code></p>
<table>
<thead>
<tr>
<th>cust_name</th>
<th>cust_contact</th>
<th>cust_state</th>
<th>cust_email</th>
</tr>
</thead>
<tbody><tr>
<td>cust10</td>
<td>8695192</td>
<td>MI</td>
<td><a href="mailto:&#x63;&#117;&#x73;&#116;&#49;&#48;&#64;&#x63;&#x75;&#115;&#x74;&#46;&#x63;&#111;&#x6d;">&#x63;&#117;&#x73;&#116;&#49;&#48;&#64;&#x63;&#x75;&#115;&#x74;&#46;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>cust1</td>
<td>8695193</td>
<td>MI</td>
<td><a href="mailto:&#99;&#x75;&#x73;&#x74;&#x31;&#x40;&#99;&#117;&#x73;&#x74;&#x2e;&#x63;&#111;&#x6d;">&#99;&#x75;&#x73;&#x74;&#x31;&#x40;&#99;&#117;&#x73;&#x74;&#x2e;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>cust2</td>
<td>8695194</td>
<td>IL</td>
<td><a href="mailto:&#99;&#117;&#x73;&#116;&#x32;&#x40;&#99;&#117;&#x73;&#116;&#x2e;&#x63;&#x6f;&#x6d;">&#99;&#117;&#x73;&#116;&#x32;&#x40;&#99;&#117;&#x73;&#116;&#x2e;&#x63;&#x6f;&#x6d;</a></td>
</tr>
</tbody></table>
<p>【问题】修正下面错误的 SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="operator">=</span> <span class="string">&#x27;MI&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="operator">=</span> <span class="string">&#x27;IL&#x27;</span><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br></pre></td></tr></table></figure>

<p>修正后：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="operator">=</span> <span class="string">&#x27;MI&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="operator">=</span> <span class="string">&#x27;IL&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br></pre></td></tr></table></figure>

<p>使用 <code>union</code> 组合查询时，只能使用一条 <code>order by</code> 字句，他必须位于最后一条 <code>select</code> 语句之后</p>
<p>或者直接用 <code>or</code> 来做：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="operator">=</span> <span class="string">&#x27;MI&#x27;</span> <span class="keyword">or</span> cust_state <span class="operator">=</span> <span class="string">&#x27;IL&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br></pre></td></tr></table></figure>

<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">264</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/JayVae" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/shi-hai-jie-35" target="_blank" title="Zhihu">
                      
                        <i class="fa fa-fw fa-globe"></i>Zhihu</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="wechat" target="_blank" title="Wechat">
                      
                        <i class="fa fa-fw fa-globe"></i>Wechat</a>
                  </span>
                
            </div>
          

		  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=554191378&auto=1&height=66"></iframe>
		  
          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">史海杰</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">722k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("SWULgkVHBjhFp99nBHCr8oHC-gzGzoHsz", "DQQN5XsGzlq3PIf1OSvGvoRR");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
