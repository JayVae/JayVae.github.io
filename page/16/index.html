<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="æŒç»­ç²¾è¿›">
<meta property="og:type" content="website">
<meta property="og:title" content="Jay&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/16/index.html">
<meta property="og:site_name" content="Jay&#39;s Blog">
<meta property="og:description" content="æŒç»­ç²¾è¿›">
<meta property="og:locale">
<meta property="article:author" content="å²æµ·æ°">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/16/"/>





  <title>Jay's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1dc984dfc86062a60470cc7297fb0653";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jay's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">çŸ¥è€Œä¸è¡Œä¸ºä¸çŸ¥</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            ç•™è¨€
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/28/linkedhashmap-source-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/28/linkedhashmap-source-code/" itemprop="url">LinkedHashMap æºç åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-04-28T23:58:50+08:00">
                2021-04-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E9%9B%86%E5%90%88/" itemprop="url" rel="index">
                    <span itemprop="name">é›†åˆ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/04/28/linkedhashmap-source-code/" class="leancloud_visitors" data-flag-title="LinkedHashMap æºç åˆ†æ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  5.8k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  23 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="LinkedHashMap-ç®€ä»‹"><a href="#LinkedHashMap-ç®€ä»‹" class="headerlink" title="LinkedHashMap ç®€ä»‹"></a>LinkedHashMap ç®€ä»‹</h2><p><code>LinkedHashMap</code> æ˜¯ Java æä¾›çš„ä¸€ä¸ªé›†åˆç±»ï¼Œå®ƒç»§æ‰¿è‡ª <code>HashMap</code>ï¼Œå¹¶åœ¨ <code>HashMap</code> åŸºç¡€ä¸Šç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—å…·å¤‡å¦‚ä¸‹ç‰¹æ€§:</p>
<ol>
<li>æ”¯æŒéå†æ—¶ä¼šæŒ‰ç…§æ’å…¥é¡ºåºæœ‰åºè¿›è¡Œè¿­ä»£ã€‚</li>
<li>æ”¯æŒæŒ‰ç…§å…ƒç´ è®¿é—®é¡ºåºæ’åº,é€‚ç”¨äºå°è£… LRU ç¼“å­˜å·¥å…·ã€‚</li>
<li>å› ä¸ºå†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å„ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥éå†æ—¶çš„æ•ˆç‡å’Œå…ƒç´ ä¸ªæ•°æˆæ­£æ¯”ï¼Œç›¸è¾ƒäºå’Œå®¹é‡æˆæ­£æ¯”çš„ HashMap æ¥è¯´ï¼Œè¿­ä»£æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚</li>
</ol>
<p><code>LinkedHashMap</code> é€»è¾‘ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®ƒæ˜¯åœ¨ <code>HashMap</code> åŸºç¡€ä¸Šåœ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—åŸæœ¬æ•£åˆ—åœ¨ä¸åŒ bucket ä¸Šçš„èŠ‚ç‚¹ã€é“¾è¡¨ã€çº¢é»‘æ ‘æœ‰åºå…³è”èµ·æ¥ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/linkhashmap-structure-overview.png" alt="LinkedHashMap é€»è¾‘ç»“æ„"></p>
<h2 id="LinkedHashMap-ä½¿ç”¨ç¤ºä¾‹"><a href="#LinkedHashMap-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="LinkedHashMap ä½¿ç”¨ç¤ºä¾‹"></a>LinkedHashMap ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="æ’å…¥é¡ºåºéå†"><a href="#æ’å…¥é¡ºåºéå†" class="headerlink" title="æ’å…¥é¡ºåºéå†"></a>æ’å…¥é¡ºåºéå†</h3><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬æŒ‰ç…§é¡ºåºå¾€ <code>LinkedHashMap</code> æ·»åŠ å…ƒç´ ç„¶åè¿›è¡Œéå†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HashMap &lt; String, String &gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span> &lt; &gt; ();</span><br><span class="line">map.put(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;g&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;r&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;23&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Map.Entry &lt; String, String &gt; entry: map.entrySet()) &#123;</span><br><span class="line">    System.out.println(entry.getKey() + <span class="string">&quot;:&quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span></span><br><span class="line">g:<span class="number">3</span></span><br><span class="line">r:<span class="number">1</span></span><br><span class="line">e:<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>LinkedHashMap</code> çš„è¿­ä»£é¡ºåºæ˜¯å’Œæ’å…¥é¡ºåºä¸€è‡´çš„,è¿™ä¸€ç‚¹æ˜¯ <code>HashMap</code> æ‰€ä¸å…·å¤‡çš„ã€‚</p>
<h3 id="è®¿é—®é¡ºåºéå†"><a href="#è®¿é—®é¡ºåºéå†" class="headerlink" title="è®¿é—®é¡ºåºéå†"></a>è®¿é—®é¡ºåºéå†</h3><p><code>LinkedHashMap</code> å®šä¹‰äº†æ’åºæ¨¡å¼ <code>accessOrder</code>(boolean ç±»å‹ï¼Œé»˜è®¤ä¸º false)ï¼Œè®¿é—®é¡ºåºåˆ™ä¸º trueï¼Œæ’å…¥é¡ºåºåˆ™ä¸º falseã€‚</p>
<p>ä¸ºäº†å®ç°è®¿é—®é¡ºåºéå†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ å…¥ <code>accessOrder</code> å±æ€§çš„ <code>LinkedHashMap</code> æ„é€ æ–¹æ³•ï¼Œå¹¶å°† <code>accessOrder</code> è®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºå…¶å…·å¤‡è®¿é—®æœ‰åºæ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashMap&lt;Integer, String&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;(<span class="number">16</span>, <span class="number">0.75f</span>, <span class="literal">true</span>);</span><br><span class="line">map.put(<span class="number">1</span>, <span class="string">&quot;one&quot;</span>);</span><br><span class="line">map.put(<span class="number">2</span>, <span class="string">&quot;two&quot;</span>);</span><br><span class="line">map.put(<span class="number">3</span>, <span class="string">&quot;three&quot;</span>);</span><br><span class="line">map.put(<span class="number">4</span>, <span class="string">&quot;four&quot;</span>);</span><br><span class="line">map.put(<span class="number">5</span>, <span class="string">&quot;five&quot;</span>);</span><br><span class="line"><span class="comment">//è®¿é—®å…ƒç´ 2,è¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨è‡³é“¾è¡¨æœ«ç«¯</span></span><br><span class="line">map.get(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//è®¿é—®å…ƒç´ 3,è¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨è‡³é“¾è¡¨æœ«ç«¯</span></span><br><span class="line">map.get(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    System.out.println(entry.getKey() + <span class="string">&quot; : &quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> : one</span><br><span class="line"><span class="number">4</span> : four</span><br><span class="line"><span class="number">5</span> : five</span><br><span class="line"><span class="number">2</span> : two</span><br><span class="line"><span class="number">3</span> : three</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>LinkedHashMap</code> çš„è¿­ä»£é¡ºåºæ˜¯å’Œè®¿é—®é¡ºåºä¸€è‡´çš„ã€‚</p>
<h3 id="LRU-ç¼“å­˜"><a href="#LRU-ç¼“å­˜" class="headerlink" title="LRU ç¼“å­˜"></a>LRU ç¼“å­˜</h3><p>ä»ä¸Šä¸€ä¸ªæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°é€šè¿‡ <code>LinkedHashMap</code> æˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ LRUï¼ˆ<strong>L</strong>east <strong>R</strong>ecently <strong>U</strong>sedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ ç¼“å­˜ï¼Œç¡®ä¿å½“å­˜æ”¾çš„å…ƒç´ è¶…è¿‡å®¹å™¨å®¹é‡æ—¶ï¼Œå°†æœ€è¿‘æœ€å°‘è®¿é—®çš„å…ƒç´ ç§»é™¤ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/lru-cache.png"></p>
<p>å…·ä½“å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç»§æ‰¿ <code>LinkedHashMap</code>;</li>
<li>æ„é€ æ–¹æ³•ä¸­æŒ‡å®š <code>accessOrder</code> ä¸º true ï¼Œè¿™æ ·åœ¨è®¿é—®å…ƒç´ æ—¶å°±ä¼šæŠŠè¯¥å…ƒç´ ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œé“¾è¡¨é¦–å…ƒç´ å°±æ˜¯æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„å…ƒç´ ï¼›</li>
<li>é‡å†™<code>removeEldestEntry</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª boolean å€¼ï¼Œå‘ŠçŸ¥ <code>LinkedHashMap</code> æ˜¯å¦éœ€è¦ç§»é™¤é“¾è¡¨é¦–å…ƒç´ ï¼ˆç¼“å­˜å®¹é‡æœ‰é™ï¼‰ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LRUCache</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(capacity, <span class="number">0.75f</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­sizeè¶…è¿‡å®¹é‡æ—¶è¿”å›trueï¼Œå‘ŠçŸ¥LinkedHashMapç§»é™¤æœ€è€çš„ç¼“å­˜é¡¹(å³é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ )</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry&lt;K, V&gt; eldest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size() &gt; capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œç¬”è€…åˆå§‹åŒ–ç¼“å­˜å®¹é‡ä¸º 3ï¼Œç„¶åæŒ‰ç…§æ¬¡åºå…ˆåæ·»åŠ  4 ä¸ªå…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LRUCache&lt;Integer, String&gt; cache = <span class="keyword">new</span> <span class="title class_">LRUCache</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">cache.put(<span class="number">1</span>, <span class="string">&quot;one&quot;</span>);</span><br><span class="line">cache.put(<span class="number">2</span>, <span class="string">&quot;two&quot;</span>);</span><br><span class="line">cache.put(<span class="number">3</span>, <span class="string">&quot;three&quot;</span>);</span><br><span class="line">cache.put(<span class="number">4</span>, <span class="string">&quot;four&quot;</span>);</span><br><span class="line">cache.put(<span class="number">5</span>, <span class="string">&quot;five&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">    System.out.println(cache.get(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span></span><br><span class="line"><span class="literal">null</span></span><br><span class="line">three</span><br><span class="line">four</span><br><span class="line">five</span><br></pre></td></tr></table></figure>

<p>ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼Œç”±äºç¼“å­˜å®¹é‡ä¸º 3 ï¼Œå› æ­¤ï¼Œæ·»åŠ ç¬¬ 4 ä¸ªå…ƒç´ æ—¶ï¼Œç¬¬ 1 ä¸ªå…ƒç´ ä¼šè¢«åˆ é™¤ã€‚æ·»åŠ ç¬¬ 5 ä¸ªå…ƒç´ æ—¶ï¼Œç¬¬ 2 ä¸ªå…ƒç´ ä¼šè¢«åˆ é™¤ã€‚</p>
<h2 id="LinkedHashMap-æºç è§£æ"><a href="#LinkedHashMap-æºç è§£æ" class="headerlink" title="LinkedHashMap æºç è§£æ"></a>LinkedHashMap æºç è§£æ</h2><h3 id="Node-çš„è®¾è®¡"><a href="#Node-çš„è®¾è®¡" class="headerlink" title="Node çš„è®¾è®¡"></a>Node çš„è®¾è®¡</h3><p>åœ¨æ­£å¼è®¨è®º <code>LinkedHashMap</code> å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠ <code>LinkedHashMap</code> èŠ‚ç‚¹ <code>Entry</code> çš„è®¾è®¡,æˆ‘ä»¬éƒ½çŸ¥é“ <code>HashMap</code> çš„ bucket ä¸Šçš„å› ä¸ºå†²çªè½¬ä¸ºé“¾è¡¨çš„èŠ‚ç‚¹ä¼šåœ¨ç¬¦åˆä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ä¼šå°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘:</p>
<ol>
<li><del>é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹ä¸ªæ•°è¾¾åˆ°æ ‘åŒ–çš„é˜ˆå€¼ 7ï¼Œå³<code>TREEIFY_THRESHOLD - 1</code>ã€‚</del></li>
<li>bucket çš„å®¹é‡è¾¾åˆ°æœ€å°çš„æ ‘åŒ–å®¹é‡å³<code>MIN_TREEIFY_CAPACITY</code>ã€‚</li>
</ol>
<blockquote>
<p><strong>ğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š<a href="https://github.com/Snailclimb/JavaGuide/issues/2147">issue#2147</a>ï¼‰</strong>ï¼š</p>
<p>é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹ä¸ªæ•°è¾¾åˆ°æ ‘åŒ–çš„é˜ˆå€¼æ˜¯ 8 è€Œé 7ã€‚å› ä¸ºæºç çš„åˆ¤æ–­æ˜¯ä»é“¾è¡¨åˆå§‹å…ƒç´ å¼€å§‹éå†ï¼Œä¸‹æ ‡æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥åˆ¤æ–­æ¡ä»¶è®¾ç½®ä¸º 8-1&#x3D;7ï¼Œå…¶å®æ˜¯è¿­ä»£åˆ°å°¾éƒ¨å…ƒç´ æ—¶å†åˆ¤æ–­æ•´ä¸ªé“¾è¡¨é•¿åº¦å¤§äºç­‰äº 8 æ‰è¿›è¡Œæ ‘åŒ–æ“ä½œã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/LinkedHashMap-putval-TREEIFY.png"></p>
</blockquote>
<p>è€Œ <code>LinkedHashMap</code> æ˜¯åœ¨ <code>HashMap</code> çš„åŸºç¡€ä¸Šä¸º bucket ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œè¿™å°±ä½¿å¾—è½¬ä¸ºçº¢é»‘æ ‘çš„æ ‘èŠ‚ç‚¹ä¹Ÿéœ€è¦å…·å¤‡åŒå‘é“¾è¡¨èŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œå³æ¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹éƒ½éœ€è¦æ‹¥æœ‰ä¸¤ä¸ªå¼•ç”¨å­˜å‚¨å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹çš„åœ°å€,æ‰€ä»¥å¯¹äºæ ‘èŠ‚ç‚¹ç±» <code>TreeNode</code> çš„è®¾è®¡å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ã€‚</p>
<p>å¯¹æ­¤æˆ‘ä»¬ä¸å¦¨æ¥çœ‹çœ‹ä¸¤è€…ä¹‹é—´èŠ‚ç‚¹ç±»çš„ç±»å›¾ï¼Œå¯ä»¥çœ‹åˆ°:</p>
<ol>
<li><code>LinkedHashMap</code> çš„èŠ‚ç‚¹å†…éƒ¨ç±» <code>Entry</code> åŸºäº <code>HashMap</code> çš„åŸºç¡€ä¸Šï¼Œå¢åŠ  <code>before</code> å’Œ <code>after</code> æŒ‡é’ˆä½¿èŠ‚ç‚¹å…·å¤‡åŒå‘é“¾è¡¨çš„ç‰¹æ€§ã€‚</li>
<li><code>HashMap</code> çš„æ ‘èŠ‚ç‚¹ <code>TreeNode</code> ç»§æ‰¿äº†å…·å¤‡åŒå‘é“¾è¡¨ç‰¹æ€§çš„ <code>LinkedHashMap</code> çš„ <code>Entry</code>ã€‚</li>
</ol>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/map-hashmap-linkedhashmap.png" alt="LinkedHashMap å’Œ HashMap ä¹‹é—´çš„å…³ç³»"></p>
<p>å¾ˆå¤šè¯»è€…æ­¤æ—¶å°±ä¼šæœ‰è¿™æ ·ä¸€ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆ <code>HashMap</code> çš„æ ‘èŠ‚ç‚¹ <code>TreeNode</code> è¦é€šè¿‡ <code>LinkedHashMap</code> è·å–åŒå‘é“¾è¡¨çš„ç‰¹æ€§å‘¢?ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨ <code>Node</code> ä¸Šå®ç°å‰é©±å’Œåç»§æŒ‡é’ˆå‘¢?</p>
<p>å…ˆæ¥å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ <code>LinkedHashMap</code> æ˜¯åœ¨ <code>HashMap</code> åŸºç¡€ä¸Šå¯¹èŠ‚ç‚¹å¢åŠ åŒå‘æŒ‡é’ˆå®ç°åŒå‘é“¾è¡¨çš„ç‰¹æ€§,æ‰€ä»¥ <code>LinkedHashMap</code> å†…éƒ¨é“¾è¡¨è½¬çº¢é»‘æ ‘æ—¶ï¼Œå¯¹åº”çš„èŠ‚ç‚¹ä¼šè½¬ä¸ºæ ‘èŠ‚ç‚¹ <code>TreeNode</code>,ä¸ºäº†ä¿è¯ä½¿ç”¨ <code>LinkedHashMap</code> æ—¶æ ‘èŠ‚ç‚¹å…·å¤‡åŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æ ‘èŠ‚ç‚¹ <code>TreeNode</code> éœ€è¦ç»§æ‰¿ <code>LinkedHashMap</code> çš„ <code>Entry</code>ã€‚</p>
<p>å†æ¥è¯´è¯´ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ <code>HashMap</code> çš„èŠ‚ç‚¹ <code>Node</code> ä¸Šç›´æ¥å®ç°å‰é©±å’Œåç»§æŒ‡é’ˆ,ç„¶å <code>TreeNode</code> ç›´æ¥ç»§æ‰¿ <code>Node</code> è·å–åŒå‘é“¾è¡¨çš„ç‰¹æ€§ä¸ºä»€ä¹ˆä¸è¡Œå‘¢ï¼Ÿå…¶å®è¿™æ ·åšä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åªä¸è¿‡è¿™ç§åšæ³•ä¼šä½¿å¾—ä½¿ç”¨ <code>HashMap</code> æ—¶å­˜å‚¨é”®å€¼å¯¹çš„èŠ‚ç‚¹ç±» <code>Node</code> å¤šäº†ä¸¤ä¸ªæ²¡æœ‰å¿…è¦çš„å¼•ç”¨ï¼Œå ç”¨æ²¡å¿…è¦çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯ <code>HashMap</code> åº•å±‚çš„èŠ‚ç‚¹ç±» <code>Node</code> æ²¡æœ‰å¤šä½™çš„å¼•ç”¨ï¼Œåˆè¦ä¿è¯ <code>LinkedHashMap</code> çš„èŠ‚ç‚¹ç±» <code>Entry</code> æ‹¥æœ‰å­˜å‚¨é“¾è¡¨çš„å¼•ç”¨ï¼Œè®¾è®¡è€…å°±è®© <code>LinkedHashMap</code> çš„èŠ‚ç‚¹ <code>Entry</code> å»ç»§æ‰¿ Node å¹¶å¢åŠ å­˜å‚¨å‰é©±åç»§èŠ‚ç‚¹çš„å¼•ç”¨ <code>before</code>ã€<code>after</code>ï¼Œè®©éœ€è¦ç”¨åˆ°é“¾è¡¨ç‰¹æ€§çš„èŠ‚ç‚¹å»å®ç°éœ€è¦çš„é€»è¾‘ã€‚ç„¶åæ ‘èŠ‚ç‚¹ <code>TreeNode</code> å†é€šè¿‡ç»§æ‰¿ <code>Entry</code> è·å– <code>before</code>ã€<code>after</code> ä¸¤ä¸ªæŒ‡é’ˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">HashMap</span>.Node&lt;K,V&gt; &#123;</span><br><span class="line">        Entry&lt;K,V&gt; before, after;</span><br><span class="line">        Entry(<span class="type">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="built_in">super</span>(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ ·åšï¼Œä¸ä¹Ÿä½¿å¾—ä½¿ç”¨ <code>HashMap</code> æ—¶çš„ <code>TreeNode</code> å¤šäº†ä¸¤ä¸ªæ²¡æœ‰å¿…è¦çš„å¼•ç”¨å—?è¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç©ºé—´çš„æµªè´¹å—ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>.Entry&lt;K,V&gt; &#123;</span><br><span class="line">  <span class="comment">//ç•¥</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºè¿™ä¸ªé—®é¢˜,å¼•ç”¨ä½œè€…çš„ä¸€æ®µæ³¨é‡Šï¼Œä½œè€…ä»¬è®¤ä¸ºåœ¨è‰¯å¥½çš„ <code>hashCode</code> ç®—æ³•æ—¶ï¼Œ<code>HashMap</code> è½¬çº¢é»‘æ ‘çš„æ¦‚ç‡ä¸å¤§ã€‚å°±ç®—è½¬ä¸ºçº¢é»‘æ ‘å˜ä¸ºæ ‘èŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½ä¼šå› ä¸ºç§»é™¤æˆ–è€…æ‰©å®¹å°† <code>TreeNode</code> å˜ä¸º <code>Node</code>ï¼Œæ‰€ä»¥ <code>TreeNode</code> çš„ä½¿ç”¨æ¦‚ç‡ä¸ç®—å¾ˆå¤§ï¼Œå¯¹äºè¿™ä¸€ç‚¹èµ„æºç©ºé—´çš„æµªè´¹æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Because TreeNodes are about twice the size of regular nodes, we</span><br><span class="line">use them only when bins contain enough nodes to warrant use</span><br><span class="line">(see TREEIFY_THRESHOLD). And when they become too small (due to</span><br><span class="line">removal or resizing) they are converted back to plain bins.  In</span><br><span class="line">usages with well-distributed user hashCodes, tree bins are</span><br><span class="line">rarely used.  Ideally, under random hashCodes, the frequency of</span><br><span class="line">nodes <span class="keyword">in</span> bins follows a Poisson distribution</span><br></pre></td></tr></table></figure>

<h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p><code>LinkedHashMap</code> æ„é€ æ–¹æ³•æœ‰ 4 ä¸ªå®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»å³ <code>HashMap</code> çš„æ„é€ æ–¹æ³•å®Œæˆåˆå§‹åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    accessOrder = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">(<span class="type">int</span> initialCapacity)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(initialCapacity);</span><br><span class="line">    accessOrder = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">(<span class="type">int</span> initialCapacity, <span class="type">float</span> loadFactor)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(initialCapacity, loadFactor);</span><br><span class="line">    accessOrder = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">(<span class="type">int</span> initialCapacity,</span></span><br><span class="line"><span class="params">    <span class="type">float</span> loadFactor,</span></span><br><span class="line"><span class="params">    <span class="type">boolean</span> accessOrder)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(initialCapacity, loadFactor);</span><br><span class="line">    <span class="built_in">this</span>.accessOrder = accessOrder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸Šé¢ä¹Ÿæåˆ°äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>accessOrder</code> ä¸º falseï¼Œå¦‚æœæˆ‘ä»¬è¦è®© <code>LinkedHashMap</code> å®ç°é”®å€¼å¯¹æŒ‰ç…§è®¿é—®é¡ºåºæ’åº(å³å°†æœ€è¿‘æœªè®¿é—®çš„å…ƒç´ æ’åœ¨é“¾è¡¨é¦–éƒ¨ã€æœ€è¿‘è®¿é—®çš„å…ƒç´ ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨)ï¼Œéœ€è¦è°ƒç”¨ç¬¬ 4 ä¸ªæ„é€ æ–¹æ³•å°† <code>accessOrder</code> è®¾ç½®ä¸º trueã€‚</p>
<h3 id="get-æ–¹æ³•"><a href="#get-æ–¹æ³•" class="headerlink" title="get æ–¹æ³•"></a>get æ–¹æ³•</h3><p><code>get</code> æ–¹æ³•æ˜¯ <code>LinkedHashMap</code> å¢åˆ æ”¹æŸ¥æ“ä½œä¸­å”¯ä¸€ä¸€ä¸ªé‡å†™çš„æ–¹æ³•ï¼Œ <code>accessOrder</code> ä¸º true çš„æƒ…å†µä¸‹ï¼Œ å®ƒä¼šåœ¨å…ƒç´ æŸ¥è¯¢å®Œæˆä¹‹åï¼Œå°†å½“å‰è®¿é—®çš„å…ƒç´ ç§»åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">     Node &lt; K, V &gt; e;</span><br><span class="line">     <span class="comment">//è·å–keyçš„é”®å€¼å¯¹,è‹¥ä¸ºç©ºç›´æ¥è¿”å›</span></span><br><span class="line">     <span class="keyword">if</span> ((e = getNode(hash(key), key)) == <span class="literal">null</span>)</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">     <span class="comment">//è‹¥accessOrderä¸ºtrueï¼Œåˆ™è°ƒç”¨afterNodeAccesså°†å½“å‰å…ƒç´ ç§»åˆ°é“¾è¡¨æœ«å°¾</span></span><br><span class="line">     <span class="keyword">if</span> (accessOrder)</span><br><span class="line">         afterNodeAccess(e);</span><br><span class="line">     <span class="comment">//è¿”å›é”®å€¼å¯¹çš„å€¼</span></span><br><span class="line">     <span class="keyword">return</span> e.value;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>ä»æºç å¯ä»¥çœ‹å‡ºï¼Œ<code>get</code> çš„æ‰§è¡Œæ­¥éª¤éå¸¸ç®€å•:</p>
<ol>
<li>è°ƒç”¨çˆ¶ç±»å³ <code>HashMap</code> çš„ <code>getNode</code> è·å–é”®å€¼å¯¹ï¼Œè‹¥ä¸ºç©ºåˆ™ç›´æ¥è¿”å›ã€‚</li>
<li>åˆ¤æ–­ <code>accessOrder</code> æ˜¯å¦ä¸º trueï¼Œè‹¥ä¸º true åˆ™è¯´æ˜éœ€è¦ä¿è¯ <code>LinkedHashMap</code> çš„é“¾è¡¨è®¿é—®æœ‰åºæ€§ï¼Œæ‰§è¡Œæ­¥éª¤ 3ã€‚</li>
<li>è°ƒç”¨ <code>LinkedHashMap</code> é‡å†™çš„ <code>afterNodeAccess</code> å°†å½“å‰å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾ã€‚</li>
</ol>
<p>å…³é”®ç‚¹åœ¨äº <code>afterNodeAccess</code> æ–¹æ³•çš„å®ç°ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£å°†å…ƒç´ ç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeAccess</span><span class="params">(Node &lt; K, V &gt; e)</span> &#123; <span class="comment">// move node to last</span></span><br><span class="line">    LinkedHashMap.Entry &lt; K, V &gt; last;</span><br><span class="line">    <span class="comment">//å¦‚æœaccessOrder ä¸”å½“å‰èŠ‚ç‚¹ä¸ä¸ºé“¾è¡¨å°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å½“å‰èŠ‚ç‚¹ã€ä»¥åŠå‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹</span></span><br><span class="line">        LinkedHashMap.Entry &lt; K, V &gt; p =</span><br><span class="line">            (LinkedHashMap.Entry &lt; K, V &gt; ) e, b = p.before, a = p.after;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘ç©ºï¼Œä½¿å…¶å’Œåç»§èŠ‚ç‚¹æ–­å¼€è”ç³»</span></span><br><span class="line">        p.after = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœå‰é©±èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹æ˜¯é“¾è¡¨çš„é¦–èŠ‚ç‚¹ï¼Œæ•…å°†åç»§èŠ‚ç‚¹è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (b == <span class="literal">null</span>)</span><br><span class="line">            head = a;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//å¦‚æœå‰é©±èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™è®©å‰é©±èŠ‚ç‚¹æŒ‡å‘åç»§èŠ‚ç‚¹</span></span><br><span class="line">            b.after = a;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœåç»§èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™è®©åç»§èŠ‚ç‚¹æŒ‡å‘å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (a != <span class="literal">null</span>)</span><br><span class="line">            a.before = b;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//å¦‚æœåç»§èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹åœ¨é“¾è¡¨æœ€æœ«å°¾ï¼Œç›´æ¥è®©last æŒ‡å‘å‰é©±èŠ‚ç‚¹,è¿™ä¸ª elseå…¶å® æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæœ€å¼€å¤´ifå·²ç»ç¡®ä¿äº†pä¸æ˜¯å°¾ç»“ç‚¹äº†ï¼Œè‡ªç„¶afterä¸ä¼šæ˜¯null</span></span><br><span class="line">            last = b;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœlastä¸ºç©ºï¼Œåˆ™è¯´æ˜å½“å‰é“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹pï¼Œåˆ™å°†headæŒ‡å‘p</span></span><br><span class="line">        <span class="keyword">if</span> (last == <span class="literal">null</span>)</span><br><span class="line">            head = p;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//åä¹‹è®©pçš„å‰é©±æŒ‡é’ˆæŒ‡å‘å°¾èŠ‚ç‚¹ï¼Œå†è®©å°¾èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆæŒ‡å‘p</span></span><br><span class="line">            p.before = last;</span><br><span class="line">            last.after = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//tailæŒ‡å‘pï¼Œè‡ªæ­¤å°†èŠ‚ç‚¹pç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾</span></span><br><span class="line">        tail = p;</span><br><span class="line"></span><br><span class="line">        ++modCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»æºç å¯ä»¥çœ‹å‡ºï¼Œ <code>afterNodeAccess</code> æ–¹æ³•å®Œæˆäº†ä¸‹é¢è¿™äº›æ“ä½œ:</p>
<ol>
<li>å¦‚æœ <code>accessOrder</code> ä¸º true ä¸”é“¾è¡¨å°¾éƒ¨ä¸ä¸ºå½“å‰èŠ‚ç‚¹ pï¼Œæˆ‘ä»¬åˆ™éœ€è¦å°†å½“å‰èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ã€‚</li>
<li>è·å–å½“å‰èŠ‚ç‚¹ pã€ä»¥åŠå®ƒçš„å‰é©±èŠ‚ç‚¹ b å’Œåç»§èŠ‚ç‚¹ aã€‚</li>
<li>å°†å½“å‰èŠ‚ç‚¹ p çš„åç»§æŒ‡é’ˆè®¾ç½®ä¸º nullï¼Œä½¿å…¶å’Œåç»§èŠ‚ç‚¹ p æ–­å¼€è”ç³»ã€‚</li>
<li>å°è¯•å°†å‰é©±èŠ‚ç‚¹æŒ‡å‘åç»§èŠ‚ç‚¹ï¼Œè‹¥å‰é©±èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹ p å°±æ˜¯é“¾è¡¨é¦–èŠ‚ç‚¹ï¼Œæ•…ç›´æ¥å°†åç»§èŠ‚ç‚¹ a è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹ï¼Œéšåæˆ‘ä»¬å†å°† p è¿½åŠ åˆ° a çš„æœ«å°¾ã€‚</li>
<li>å†å°è¯•è®©åç»§èŠ‚ç‚¹ a æŒ‡å‘å‰é©±èŠ‚ç‚¹ bã€‚</li>
<li>ä¸Šè¿°æ“ä½œè®©å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹å®Œæˆå…³è”ï¼Œå¹¶å°†å½“å‰èŠ‚ç‚¹ p ç‹¬ç«‹å‡ºæ¥ï¼Œè¿™ä¸€æ­¥åˆ™æ˜¯å°†å½“å‰èŠ‚ç‚¹ p è¿½åŠ åˆ°é“¾è¡¨æœ«ç«¯ï¼Œå¦‚æœé“¾è¡¨æœ«ç«¯ä¸ºç©ºï¼Œåˆ™è¯´æ˜å½“å‰é“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ pï¼Œæ‰€ä»¥ç›´æ¥è®© head æŒ‡å‘ p å³å¯ã€‚</li>
<li>ä¸Šè¿°æ“ä½œå·²ç»å°† p æˆåŠŸåˆ°è¾¾é“¾è¡¨æœ«ç«¯ï¼Œæœ€åæˆ‘ä»¬å°† tail æŒ‡é’ˆå³æŒ‡å‘é“¾è¡¨æœ«ç«¯çš„æŒ‡é’ˆæŒ‡å‘ p å³å¯ã€‚</li>
</ol>
<p>å¯ä»¥ç»“åˆè¿™å¼ å›¾ç†è§£ï¼Œå±•ç¤ºäº† key ä¸º 13 çš„å…ƒç´ è¢«ç§»åŠ¨åˆ°äº†é“¾è¡¨å°¾éƒ¨ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/linkedhashmap-get.png" alt="LinkedHashMap ç§»åŠ¨å…ƒç´  13 åˆ°é“¾è¡¨å°¾éƒ¨"></p>
<p>çœ‹ä¸å¤ªæ‡‚ä¹Ÿæ²¡å…³ç³»ï¼ŒçŸ¥é“è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±å¤Ÿäº†ï¼Œåç»­æœ‰æ—¶é—´å†æ…¢æ…¢æ¶ˆåŒ–ã€‚</p>
<h3 id="remove-æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeRemoval"><a href="#remove-æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeRemoval" class="headerlink" title="remove æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeRemoval"></a>remove æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeRemoval</h3><p><code>LinkedHashMap</code> å¹¶æ²¡æœ‰å¯¹ <code>remove</code> æ–¹æ³•è¿›è¡Œé‡å†™ï¼Œè€Œæ˜¯ç›´æ¥ç»§æ‰¿ <code>HashMap</code> çš„ <code>remove</code> æ–¹æ³•ï¼Œä¸ºäº†ä¿è¯é”®å€¼å¯¹ç§»é™¤ååŒå‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ä¹Ÿä¼šåŒæ­¥è¢«ç§»é™¤ï¼Œ<code>LinkedHashMap</code> é‡å†™äº† <code>HashMap</code> çš„ç©ºå®ç°æ–¹æ³• <code>afterNodeRemoval</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">removeNode</span><span class="params">(<span class="type">int</span> hash, Object key, Object value,</span></span><br><span class="line"><span class="params">                               <span class="type">boolean</span> matchValue, <span class="type">boolean</span> movable)</span> &#123;</span><br><span class="line">        <span class="comment">//ç•¥</span></span><br><span class="line">            <span class="keyword">if</span> (node != <span class="literal">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                                 (value != <span class="literal">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">                <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="built_in">this</span>, tab, movable);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                    tab[index] = node.next;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    p.next = node.next;</span><br><span class="line">                ++modCount;</span><br><span class="line">                --size;</span><br><span class="line">                <span class="comment">//HashMapçš„removeNodeå®Œæˆå…ƒç´ ç§»é™¤åä¼šè°ƒç”¨afterNodeRemovalè¿›è¡Œç§»é™¤åç½®æ“ä½œ</span></span><br><span class="line">                afterNodeRemoval(node);</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//ç©ºå®ç°</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeRemoval</span><span class="params">(Node&lt;K,V&gt; p)</span> &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä» <code>HashMap</code> ç»§æ‰¿æ¥çš„ <code>remove</code> æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„ <code>removeNode</code> æ–¹æ³•å°†èŠ‚ç‚¹ä» bucket åˆ é™¤åï¼Œè°ƒç”¨äº† <code>afterNodeRemoval</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeRemoval</span><span class="params">(Node&lt;K,V&gt; e)</span> &#123; <span class="comment">// unlink</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–å½“å‰èŠ‚ç‚¹pã€ä»¥åŠeçš„å‰é©±èŠ‚ç‚¹bå’Œåç»§èŠ‚ç‚¹a</span></span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">    <span class="comment">//å°†pçš„å‰é©±å’Œåç»§æŒ‡é’ˆéƒ½è®¾ç½®ä¸ºnullï¼Œä½¿å…¶å’Œå‰é©±ã€åç»§èŠ‚ç‚¹æ–­å¼€è”ç³»</span></span><br><span class="line">        p.before = p.after = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœå‰é©±èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹pæ˜¯é“¾è¡¨é¦–èŠ‚ç‚¹ï¼Œè®©headæŒ‡é’ˆæŒ‡å‘åç»§èŠ‚ç‚¹aå³å¯</span></span><br><span class="line">        <span class="keyword">if</span> (b == <span class="literal">null</span>)</span><br><span class="line">            head = a;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="comment">//å¦‚æœå‰é©±èŠ‚ç‚¹bä¸ä¸ºç©ºï¼Œåˆ™è®©bç›´æ¥æŒ‡å‘åç»§èŠ‚ç‚¹a</span></span><br><span class="line">            b.after = a;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœåç»§èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹påœ¨é“¾è¡¨æœ«ç«¯ï¼Œæ‰€ä»¥ç›´æ¥è®©tailæŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹aå³å¯</span></span><br><span class="line">        <span class="keyword">if</span> (a == <span class="literal">null</span>)</span><br><span class="line">            tail = b;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="comment">//åä¹‹åç»§èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆç›´æ¥æŒ‡å‘å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">            a.before = b;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä»æºç å¯ä»¥çœ‹å‡ºï¼Œ <code>afterNodeRemoval</code> æ–¹æ³•çš„æ•´ä½“æ“ä½œå°±æ˜¯è®©å½“å‰èŠ‚ç‚¹ p å’Œå‰é©±èŠ‚ç‚¹ã€åç»§èŠ‚ç‚¹æ–­å¼€è”ç³»ï¼Œç­‰å¾… gc å›æ”¶ï¼Œæ•´ä½“æ­¥éª¤ä¸º:</p>
<ol>
<li>è·å–å½“å‰èŠ‚ç‚¹ pã€ä»¥åŠ p çš„å‰é©±èŠ‚ç‚¹ b å’Œåç»§èŠ‚ç‚¹ aã€‚</li>
<li>è®©å½“å‰èŠ‚ç‚¹ p å’Œå…¶å‰é©±ã€åç»§èŠ‚ç‚¹æ–­å¼€è”ç³»ã€‚</li>
<li>å°è¯•è®©å‰é©±èŠ‚ç‚¹ b æŒ‡å‘åç»§èŠ‚ç‚¹ aï¼Œè‹¥ b ä¸ºç©ºåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹ p åœ¨é“¾è¡¨é¦–éƒ¨ï¼Œæˆ‘ä»¬ç›´æ¥å°† head æŒ‡å‘åç»§èŠ‚ç‚¹ a å³å¯ã€‚</li>
<li>å°è¯•è®©åç»§èŠ‚ç‚¹ a æŒ‡å‘å‰é©±èŠ‚ç‚¹ bï¼Œè‹¥ a ä¸ºç©ºåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹ p åœ¨é“¾è¡¨æœ«ç«¯ï¼Œæ‰€ä»¥ç›´æ¥è®© tail æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹ b å³å¯ã€‚</li>
</ol>
<p>å¯ä»¥ç»“åˆè¿™å¼ å›¾ç†è§£ï¼Œå±•ç¤ºäº† key ä¸º 13 çš„å…ƒç´ è¢«åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯ä»é“¾è¡¨ä¸­ç§»é™¤äº†è¿™ä¸ªå…ƒç´ ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/linkedhashmap-remove.png" alt="LinkedHashMap åˆ é™¤å…ƒç´  13"></p>
<p>çœ‹ä¸å¤ªæ‡‚ä¹Ÿæ²¡å…³ç³»ï¼ŒçŸ¥é“è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±å¤Ÿäº†ï¼Œåç»­æœ‰æ—¶é—´å†æ…¢æ…¢æ¶ˆåŒ–ã€‚</p>
<h3 id="put-æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeInsertion"><a href="#put-æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeInsertion" class="headerlink" title="put æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeInsertion"></a>put æ–¹æ³•åç½®æ“ä½œâ€”â€”afterNodeInsertion</h3><p>åŒæ ·çš„ <code>LinkedHashMap</code> å¹¶æ²¡æœ‰å®ç°æ’å…¥æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥ç»§æ‰¿ <code>HashMap</code> çš„æ‰€æœ‰æ’å…¥æ–¹æ³•äº¤ç”±ç”¨æˆ·ä½¿ç”¨ï¼Œä½†ä¸ºäº†ç»´æŠ¤åŒå‘é“¾è¡¨è®¿é—®çš„æœ‰åºæ€§ï¼Œå®ƒåšäº†è¿™æ ·ä¸¤ä»¶äº‹:</p>
<ol>
<li>é‡å†™ <code>afterNodeAccess</code>(ä¸Šæ–‡æåˆ°è¿‡),å¦‚æœå½“å‰è¢«æ’å…¥çš„ key å·²å­˜åœ¨ä¸ <code>map</code> ä¸­ï¼Œå› ä¸º <code>LinkedHashMap</code> çš„æ’å…¥æ“ä½œä¼šå°†æ–°èŠ‚ç‚¹è¿½åŠ è‡³é“¾è¡¨æœ«å°¾ï¼Œæ‰€ä»¥å¯¹äºå­˜åœ¨çš„ key åˆ™è°ƒç”¨ <code>afterNodeAccess</code> å°†å…¶æ”¾åˆ°é“¾è¡¨æœ«ç«¯ã€‚</li>
<li>é‡å†™äº† <code>HashMap</code> çš„ <code>afterNodeInsertion</code> æ–¹æ³•ï¼Œå½“ <code>removeEldestEntry</code> è¿”å› true æ—¶ï¼Œä¼šå°†é“¾è¡¨é¦–èŠ‚ç‚¹ç§»é™¤ã€‚</li>
</ol>
<p>è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥åœ¨ <code>HashMap</code> çš„æ’å…¥æ“ä½œæ ¸å¿ƒæ–¹æ³• <code>putVal</code> ä¸­çœ‹åˆ°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">                   <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">          <span class="comment">//ç•¥</span></span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                 <span class="comment">//å¦‚æœå½“å‰çš„keyåœ¨mapä¸­å­˜åœ¨ï¼Œåˆ™è°ƒç”¨afterNodeAccess</span></span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">         <span class="comment">//è°ƒç”¨æ’å…¥åç½®æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¢«LinkedHashMapé‡å†™</span></span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°æ­¥éª¤çš„æºç ä¸Šæ–‡å·²ç»è§£é‡Šè¿‡äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç€é‡äº†è§£ä¸€ä¸‹ <code>afterNodeInsertion</code> çš„å·¥ä½œæµç¨‹ï¼Œå‡è®¾æˆ‘ä»¬çš„é‡å†™äº† <code>removeEldestEntry</code>ï¼Œå½“é“¾è¡¨ <code>size</code> è¶…è¿‡ <code>capacity</code> æ—¶ï¼Œå°±è¿”å› trueã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­sizeè¶…è¿‡å®¹é‡æ—¶è¿”å›trueï¼Œå‘ŠçŸ¥LinkedHashMapç§»é™¤æœ€è€çš„ç¼“å­˜é¡¹(å³é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ )</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry &lt; K, V &gt; eldest)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> size() &gt; capacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œå‡è®¾ç¬”è€…æœ€åæ–°æ’å…¥äº†ä¸€ä¸ªä¸å­˜åœ¨çš„èŠ‚ç‚¹ 19,å‡è®¾ <code>capacity</code> ä¸º 4ï¼Œæ‰€ä»¥ <code>removeEldestEntry</code> è¿”å› trueï¼Œæˆ‘ä»¬è¦å°†é“¾è¡¨é¦–èŠ‚ç‚¹ç§»é™¤ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/linkedhashmap-after-insert-1.png" alt="LinkedHashMap ä¸­æ’å…¥æ–°å…ƒç´  19"></p>
<p>ç§»é™¤çš„æ­¥éª¤å¾ˆç®€å•ï¼ŒæŸ¥çœ‹é“¾è¡¨é¦–èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™æ–­å¼€é¦–èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹çš„å…³ç³»ï¼Œå¹¶è®©é¦–èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹ï¼Œæ‰€ä»¥ head æŒ‡é’ˆæŒ‡å‘äº† 12ï¼ŒèŠ‚ç‚¹ 10 æˆä¸ºæ²¡æœ‰ä»»ä½•å¼•ç”¨æŒ‡å‘çš„ç©ºå¯¹è±¡ï¼Œç­‰å¾… GCã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/linkedhashmap-after-insert-2.png" alt="LinkedHashMap ä¸­æ’å…¥æ–°å…ƒç´  19"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeInsertion</span><span class="params">(<span class="type">boolean</span> evict)</span> &#123; <span class="comment">// possibly remove eldest</span></span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class="line">        <span class="comment">//å¦‚æœevictä¸ºtrueä¸”é˜Ÿé¦–å…ƒç´ ä¸ä¸ºç©ºä»¥åŠremoveEldestEntryè¿”å›trueï¼Œåˆ™è¯´æ˜æˆ‘ä»¬éœ€è¦æœ€è€çš„å…ƒç´ (å³åœ¨é“¾è¡¨é¦–éƒ¨çš„å…ƒç´ )ç§»é™¤ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (evict &amp;&amp; (first = head) != <span class="literal">null</span> &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class="line">          <span class="comment">//è·å–é“¾è¡¨é¦–éƒ¨çš„é”®å€¼å¯¹çš„key</span></span><br><span class="line">            <span class="type">K</span> <span class="variable">key</span> <span class="operator">=</span> first.key;</span><br><span class="line">            <span class="comment">//è°ƒç”¨removeNodeå°†å…ƒç´ ä»HashMapçš„bucketä¸­ç§»é™¤ï¼Œå¹¶å’ŒLinkedHashMapçš„åŒå‘é“¾è¡¨æ–­å¼€ï¼Œç­‰å¾…gcå›æ”¶</span></span><br><span class="line">            removeNode(hash(key), key, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä»æºç å¯ä»¥çœ‹å‡ºï¼Œ <code>afterNodeInsertion</code> æ–¹æ³•å®Œæˆäº†ä¸‹é¢è¿™äº›æ“ä½œ:</p>
<ol>
<li>åˆ¤æ–­ <code>eldest</code> æ˜¯å¦ä¸º trueï¼Œåªæœ‰ä¸º true æ‰èƒ½è¯´æ˜å¯èƒ½éœ€è¦å°†æœ€å¹´é•¿çš„é”®å€¼å¯¹(å³é“¾è¡¨é¦–éƒ¨çš„å…ƒç´ )è¿›è¡Œç§»é™¤ï¼Œå…·ä½“æ˜¯å¦å…·ä½“è¦è¿›è¡Œç§»é™¤ï¼Œè¿˜å¾—ç¡®å®šé“¾è¡¨æ˜¯å¦ä¸ºç©º<code>((first = head) != null)</code>ï¼Œä»¥åŠ <code>removeEldestEntry</code> æ–¹æ³•æ˜¯å¦è¿”å› trueï¼Œåªæœ‰è¿™ä¸¤ä¸ªæ–¹æ³•è¿”å› true æ‰èƒ½ç¡®å®šå½“å‰é“¾è¡¨ä¸ä¸ºç©ºï¼Œä¸”é“¾è¡¨éœ€è¦è¿›è¡Œç§»é™¤æ“ä½œäº†ã€‚</li>
<li>è·å–é“¾è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ keyã€‚</li>
<li>è°ƒç”¨ <code>HashMap</code> çš„ <code>removeNode</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æˆ‘ä»¬ä¸Šæ–‡æåˆ°è¿‡ï¼Œå®ƒä¼šå°†èŠ‚ç‚¹ä» <code>HashMap</code> çš„ bucket ä¸­ç§»é™¤ï¼Œå¹¶ä¸” <code>LinkedHashMap</code> è¿˜é‡å†™äº† <code>removeNode</code> ä¸­çš„ <code>afterNodeRemoval</code> æ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥å°†é€šè¿‡è°ƒç”¨ <code>removeNode</code> å°†å…ƒç´ ä» <code>HashMap</code> çš„ bucket ä¸­ç§»é™¤ï¼Œå¹¶å’Œ <code>LinkedHashMap</code> çš„åŒå‘é“¾è¡¨æ–­å¼€ï¼Œç­‰å¾… gc å›æ”¶ã€‚</li>
</ol>
<h2 id="LinkedHashMap-å’Œ-HashMap-éå†æ€§èƒ½æ¯”è¾ƒ"><a href="#LinkedHashMap-å’Œ-HashMap-éå†æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="LinkedHashMap å’Œ HashMap éå†æ€§èƒ½æ¯”è¾ƒ"></a>LinkedHashMap å’Œ HashMap éå†æ€§èƒ½æ¯”è¾ƒ</h2><p><code>LinkedHashMap</code> ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥è®°å½•æ•°æ®æ’å…¥çš„é¡ºåºï¼Œå› æ­¤åœ¨è¿­ä»£éå†ç”Ÿæˆçš„è¿­ä»£å™¨çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§åŒå‘é“¾è¡¨çš„è·¯å¾„è¿›è¡Œéå†çš„ã€‚è¿™ä¸€ç‚¹ç›¸æ¯”äº <code>HashMap</code> é‚£ç§éå†æ•´ä¸ª bucket çš„æ–¹å¼æ¥è¯´ï¼Œé«˜æ•ˆè®¸å¤šã€‚</p>
<p>è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥ä»ä¸¤è€…çš„è¿­ä»£å™¨ä¸­å¾—ä»¥å°è¯ï¼Œå…ˆæ¥çœ‹çœ‹ <code>HashMap</code> çš„è¿­ä»£å™¨ï¼Œå¯ä»¥çœ‹åˆ° <code>HashMap</code> è¿­ä»£é”®å€¼å¯¹æ—¶ä¼šç”¨åˆ°ä¸€ä¸ª <code>nextNode</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å› next æŒ‡å‘çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¼šä» next å¼€å§‹éå† bucket æ‰¾åˆ°ä¸‹ä¸€ä¸ª bucket ä¸­ä¸ä¸ºç©ºçš„å…ƒç´  Nodeã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">EntryIterator</span> <span class="keyword">extends</span> <span class="title class_">HashIterator</span></span><br><span class="line"><span class="keyword">implements</span> <span class="title class_">Iterator</span> &lt; Map.Entry &lt; K, V &gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Map.Entry &lt; K,</span><br><span class="line">    V &gt; next() &#123;</span><br><span class="line">        <span class="keyword">return</span> nextNode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–ä¸‹ä¸€ä¸ªNode</span></span><br><span class="line"><span class="keyword">final</span> Node &lt; K, V &gt; nextNode() &#123;</span><br><span class="line">    Node &lt; K, V &gt; [] t;</span><br><span class="line">    <span class="comment">//è·å–ä¸‹ä¸€ä¸ªå…ƒç´ next</span></span><br><span class="line">    Node &lt; K, V &gt; e = next;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">    <span class="comment">//å°†nextæŒ‡å‘bucketä¸­ä¸‹ä¸€ä¸ªä¸ä¸ºç©ºçš„Node</span></span><br><span class="line">    <span class="keyword">if</span> ((next = (current = e).next) == <span class="literal">null</span> &amp;&amp; (t = table) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›¸æ¯”ä¹‹ä¸‹ <code>LinkedHashMap</code> çš„è¿­ä»£å™¨åˆ™æ˜¯ç›´æ¥ä½¿ç”¨é€šè¿‡ <code>after</code> æŒ‡é’ˆå¿«é€Ÿå®šä½åˆ°å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ï¼Œç®€æ´é«˜æ•ˆè®¸å¤šã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LinkedEntryIterator</span> <span class="keyword">extends</span> <span class="title class_">LinkedHashIterator</span></span><br><span class="line"><span class="keyword">implements</span> <span class="title class_">Iterator</span> &lt; Map.Entry &lt; K, V &gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Map.Entry &lt; K,</span><br><span class="line">    V &gt; next() &#123;</span><br><span class="line">        <span class="keyword">return</span> nextNode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–ä¸‹ä¸€ä¸ªNode</span></span><br><span class="line"><span class="keyword">final</span> LinkedHashMap.Entry &lt; K, V &gt; nextNode() &#123;</span><br><span class="line">    <span class="comment">//è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹next</span></span><br><span class="line">    LinkedHashMap.Entry &lt; K, V &gt; e = next;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">    <span class="comment">//current æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    current = e;</span><br><span class="line">    <span class="comment">//nextç›´æ¥å½“å‰èŠ‚ç‚¹çš„afteræŒ‡é’ˆå¿«é€Ÿå®šä½åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    next = e.after;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†éªŒè¯ç¬”è€…æ‰€è¯´çš„è§‚ç‚¹ï¼Œç¬”è€…å¯¹è¿™ä¸¤ä¸ªå®¹å™¨è¿›è¡Œäº†å‹æµ‹ï¼Œæµ‹è¯•æ’å…¥ 1000w å’Œè¿­ä»£ 1000w æ¡æ•°æ®çš„è€—æ—¶ï¼Œä»£ç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1000_0000</span>;</span><br><span class="line">Map&lt;Integer, Integer&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">Map&lt;Integer, Integer&gt; linkedHashMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> start, end;</span><br><span class="line"></span><br><span class="line">start = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">    hashMap.put(ThreadLocalRandom.current().nextInt(<span class="number">1</span>, count), ThreadLocalRandom.current().nextInt(<span class="number">0</span>, count));</span><br><span class="line">&#125;</span><br><span class="line">end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;map time putVal: &quot;</span> + (end - start));</span><br><span class="line"></span><br><span class="line">start = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">    linkedHashMap.put(ThreadLocalRandom.current().nextInt(<span class="number">1</span>, count), ThreadLocalRandom.current().nextInt(<span class="number">0</span>, count));</span><br><span class="line">&#125;</span><br><span class="line">end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;linkedHashMap putVal time: &quot;</span> + (end - start));</span><br><span class="line"></span><br><span class="line">start = System.currentTimeMillis();</span><br><span class="line"><span class="type">long</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (Integer v : hashMap.values()) &#123;</span><br><span class="line">    num = num + v;</span><br><span class="line">&#125;</span><br><span class="line">end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;map get time: &quot;</span> + (end - start));</span><br><span class="line"></span><br><span class="line">start = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (Integer v : linkedHashMap.values()) &#123;</span><br><span class="line">    num = num + v;</span><br><span class="line">&#125;</span><br><span class="line">end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;linkedHashMap get time: &quot;</span> + (end - start));</span><br><span class="line">System.out.println(num);</span><br></pre></td></tr></table></figure>

<p>ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼Œå› ä¸º <code>LinkedHashMap</code> éœ€è¦ç»´æŠ¤åŒå‘é“¾è¡¨çš„ç¼˜æ•…ï¼Œæ’å…¥å…ƒç´ ç›¸è¾ƒäº <code>HashMap</code> ä¼šæ›´è€—æ—¶ï¼Œä½†æ˜¯æœ‰äº†åŒå‘é“¾è¡¨æ˜ç¡®çš„å‰åèŠ‚ç‚¹å…³ç³»ï¼Œè¿­ä»£æ•ˆç‡ç›¸å¯¹äºå‰è€…é«˜æ•ˆäº†è®¸å¤šã€‚ä¸è¿‡ï¼Œæ€»ä½“æ¥è¯´å´åˆ«ä¸å¤§ï¼Œæ¯•ç«Ÿæ•°æ®é‡è¿™ä¹ˆåºå¤§ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map <span class="keyword">time</span> putVal: 5880</span><br><span class="line">linkedHashMap putVal <span class="keyword">time</span>: 7567</span><br><span class="line">map get <span class="keyword">time</span>: 143</span><br><span class="line">linkedHashMap get <span class="keyword">time</span>: 67</span><br><span class="line">63208969074998</span><br></pre></td></tr></table></figure>

<h2 id="LinkedHashMap-å¸¸è§é¢è¯•é¢˜"><a href="#LinkedHashMap-å¸¸è§é¢è¯•é¢˜" class="headerlink" title="LinkedHashMap å¸¸è§é¢è¯•é¢˜"></a>LinkedHashMap å¸¸è§é¢è¯•é¢˜</h2><h3 id="ä»€ä¹ˆæ˜¯-LinkedHashMapï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-LinkedHashMapï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ LinkedHashMapï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ LinkedHashMapï¼Ÿ</h3><p><code>LinkedHashMap</code> æ˜¯ Java é›†åˆæ¡†æ¶ä¸­ <code>HashMap</code> çš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒç»§æ‰¿äº† <code>HashMap</code> çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ <code>HashMap</code> çš„åŸºç¡€é‡å†™äº† <code>afterNodeRemoval</code>ã€<code>afterNodeInsertion</code>ã€<code>afterNodeAccess</code> æ–¹æ³•ã€‚ä½¿ä¹‹æ‹¥æœ‰é¡ºåºæ’å…¥å’Œè®¿é—®æœ‰åºçš„ç‰¹æ€§ã€‚</p>
<h3 id="LinkedHashMap-å¦‚ä½•æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ"><a href="#LinkedHashMap-å¦‚ä½•æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ" class="headerlink" title="LinkedHashMap å¦‚ä½•æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ"></a>LinkedHashMap å¦‚ä½•æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ</h3><p><code>LinkedHashMap</code> æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£å…ƒç´ æ˜¯å®ƒçš„é»˜è®¤è¡Œä¸ºã€‚<code>LinkedHashMap</code> å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºè®°å½•å…ƒç´ çš„æ’å…¥é¡ºåºã€‚å› æ­¤ï¼Œå½“ä½¿ç”¨è¿­ä»£å™¨è¿­ä»£å…ƒç´ æ—¶ï¼Œå…ƒç´ çš„é¡ºåºä¸å®ƒä»¬æœ€åˆæ’å…¥çš„é¡ºåºç›¸åŒã€‚</p>
<h3 id="LinkedHashMap-å¦‚ä½•æŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ"><a href="#LinkedHashMap-å¦‚ä½•æŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ" class="headerlink" title="LinkedHashMap å¦‚ä½•æŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ"></a>LinkedHashMap å¦‚ä½•æŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ</h3><p><code>LinkedHashMap</code> å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¸­çš„ <code>accessOrder</code> å‚æ•°æŒ‡å®šæŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ã€‚å½“ <code>accessOrder</code> ä¸º true æ—¶ï¼Œæ¯æ¬¡è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°é“¾è¡¨çš„æœ«å°¾ï¼Œå› æ­¤ä¸‹æ¬¡è®¿é—®è¯¥å…ƒç´ æ—¶ï¼Œå®ƒå°±ä¼šæˆä¸ºé“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»è€Œå®ç°æŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ã€‚</p>
<h3 id="LinkedHashMap-å¦‚ä½•å®ç°-LRU-ç¼“å­˜ï¼Ÿ"><a href="#LinkedHashMap-å¦‚ä½•å®ç°-LRU-ç¼“å­˜ï¼Ÿ" class="headerlink" title="LinkedHashMap å¦‚ä½•å®ç° LRU ç¼“å­˜ï¼Ÿ"></a>LinkedHashMap å¦‚ä½•å®ç° LRU ç¼“å­˜ï¼Ÿ</h3><p>å°† <code>accessOrder</code> è®¾ç½®ä¸º true å¹¶é‡å†™ <code>removeEldestEntry</code> æ–¹æ³•å½“é“¾è¡¨å¤§å°è¶…è¿‡å®¹é‡æ—¶è¿”å› trueï¼Œä½¿å¾—æ¯æ¬¡è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚ä¸€æ—¦æ’å…¥æ“ä½œè®© <code>removeEldestEntry</code> è¿”å› true æ—¶ï¼Œè§†ä¸ºç¼“å­˜å·²æ»¡ï¼Œ<code>LinkedHashMap</code> å°±ä¼šå°†é“¾è¡¨é¦–å…ƒç´ ç§»é™¤ï¼Œç”±æ­¤æˆ‘ä»¬å°±èƒ½å®ç°ä¸€ä¸ª LRU ç¼“å­˜ã€‚</p>
<h3 id="LinkedHashMap-å’Œ-HashMap-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#LinkedHashMap-å’Œ-HashMap-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="LinkedHashMap å’Œ HashMap æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>LinkedHashMap å’Œ HashMap æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><code>LinkedHashMap</code> å’Œ <code>HashMap</code> éƒ½æ˜¯ Java é›†åˆæ¡†æ¶ä¸­çš„ Map æ¥å£çš„å®ç°ç±»ã€‚å®ƒä»¬çš„æœ€å¤§åŒºåˆ«åœ¨äºè¿­ä»£å…ƒç´ çš„é¡ºåºã€‚<code>HashMap</code> è¿­ä»£å…ƒç´ çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œè€Œ <code>LinkedHashMap</code> æä¾›äº†æŒ‰ç…§æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ çš„åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œ<code>LinkedHashMap</code> å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºè®°å½•å…ƒç´ çš„æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºï¼Œè€Œ <code>HashMap</code> åˆ™æ²¡æœ‰è¿™ä¸ªé“¾è¡¨ã€‚å› æ­¤ï¼Œ<code>LinkedHashMap</code> çš„æ’å…¥æ€§èƒ½å¯èƒ½ä¼šæ¯” <code>HashMap</code> ç•¥ä½ï¼Œä½†å®ƒæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å¹¶ä¸”è¿­ä»£æ•ˆç‡ç›¸è¾ƒäº <code>HashMap</code> æ›´åŠ é«˜æ•ˆã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li>LinkedHashMap æºç è¯¦ç»†åˆ†æï¼ˆJDK1.8ï¼‰:<a href="https://www.imooc.com/article/22931">https://www.imooc.com/article/22931</a></li>
<li>HashMap ä¸ LinkedHashMap:<a href="https://www.cnblogs.com/Spground/p/8536148.html">https://www.cnblogs.com/Spground/p/8536148.html</a></li>
<li>æºäº LinkedHashMap æºç : <a href="https://leetcode.cn/problems/lru-cache/solution/yuan-yu-linkedhashmapyuan-ma-by-jeromememory/">https://leetcode.cn/problems/lru-cache/solution/yuan-yu-linkedhashmapyuan-ma-by-jeromememory/</a><!-- @include: @article-footer.snippet.md --></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/22/java-collection-precautions-for-use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/22/java-collection-precautions-for-use/" itemprop="url">Javaé›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-04-22T18:32:57+08:00">
                2021-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E9%9B%86%E5%90%88/" itemprop="url" rel="index">
                    <span itemprop="name">é›†åˆ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/04/22/java-collection-precautions-for-use/" class="leancloud_visitors" data-flag-title="Javaé›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  3.1k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  14 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™ç¯‡æ–‡ç« æˆ‘æ ¹æ®ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹æ€»ç»“äº†å…³äºé›†åˆä½¿ç”¨å¸¸è§çš„æ³¨æ„äº‹é¡¹ä»¥åŠå…¶å…·ä½“åŸç†ã€‚</p>
<p>å¼ºçƒˆå»ºè®®å°ä¼™ä¼´ä»¬å¤šå¤šé˜…è¯»å‡ éï¼Œé¿å…è‡ªå·±å†™ä»£ç çš„æ—¶å€™å‡ºç°è¿™äº›ä½çº§çš„é—®é¢˜ã€‚</p>
<h2 id="é›†åˆåˆ¤ç©º"><a href="#é›†åˆåˆ¤ç©º" class="headerlink" title="é›†åˆåˆ¤ç©º"></a>é›†åˆåˆ¤ç©º</h2><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>åˆ¤æ–­æ‰€æœ‰é›†åˆå†…éƒ¨çš„å…ƒç´ æ˜¯å¦ä¸ºç©ºï¼Œä½¿ç”¨ <code>isEmpty()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>size()==0</code> çš„æ–¹å¼ã€‚</strong></p>
</blockquote>
<p>è¿™æ˜¯å› ä¸º <code>isEmpty()</code> æ–¹æ³•çš„å¯è¯»æ€§æ›´å¥½ï¼Œå¹¶ä¸”æ—¶é—´å¤æ‚åº¦ä¸º <code>O(1)</code>ã€‚</p>
<p>ç»å¤§éƒ¨åˆ†æˆ‘ä»¬ä½¿ç”¨çš„é›†åˆçš„ <code>size()</code> æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ <code>O(1)</code>ï¼Œä¸è¿‡ï¼Œä¹Ÿæœ‰å¾ˆå¤šå¤æ‚åº¦ä¸æ˜¯ <code>O(1)</code> çš„ï¼Œæ¯”å¦‚ <code>java.util.concurrent</code> åŒ…ä¸‹çš„ <code>ConcurrentLinkedQueue</code>ã€‚<code>ConcurrentLinkedQueue</code> çš„ <code>isEmpty()</code> æ–¹æ³•é€šè¿‡ <code>first()</code> æ–¹æ³•è¿›è¡Œåˆ¤æ–­ï¼Œå…¶ä¸­ <code>first()</code> æ–¹æ³•è¿”å›çš„æ˜¯é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸ä¸º <code>null</code> çš„èŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹å€¼ä¸º<code>null</code>çš„åŸå› æ˜¯åœ¨è¿­ä»£å™¨ä¸­ä½¿ç”¨çš„é€»è¾‘åˆ é™¤ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123; <span class="keyword">return</span> first() == <span class="literal">null</span>; &#125;</span><br><span class="line"></span><br><span class="line">Node&lt;E&gt; <span class="title function_">first</span><span class="params">()</span> &#123;</span><br><span class="line">    restartFromHead:</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;E&gt; h = head, p = h, q;;) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">hasItem</span> <span class="operator">=</span> (p.item != <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (hasItem || (q = p.next) == <span class="literal">null</span>) &#123;  <span class="comment">// å½“å‰èŠ‚ç‚¹å€¼ä¸ä¸ºç©º æˆ– åˆ°è¾¾é˜Ÿå°¾</span></span><br><span class="line">                updateHead(h, p);  <span class="comment">// å°†headè®¾ç½®ä¸ºp</span></span><br><span class="line">                <span class="keyword">return</span> hasItem ? p : <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p == q) <span class="keyword">continue</span> restartFromHead;</span><br><span class="line">            <span class="keyword">else</span> p = q;  <span class="comment">// p = p.next</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºåœ¨æ’å…¥ä¸åˆ é™¤å…ƒç´ æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œ<code>updateHead(h, p)</code>æ–¹æ³•ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•çš„æ‰§è¡Œçš„æ—¶é—´å¤æ‚åº¦å¯ä»¥è¿‘ä¼¼ä¸º<code>O(1)</code>ã€‚è€Œ <code>size()</code> æ–¹æ³•éœ€è¦éå†æ•´ä¸ªé“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º<code>O(n)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Node&lt;E&gt; p = first(); p != <span class="literal">null</span>; p = succ(p))</span><br><span class="line">        <span class="keyword">if</span> (p.item != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">if</span> (++count == Integer.MAX_VALUE)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œåœ¨<code>ConcurrentHashMap</code> 1.7 ä¸­ <code>size()</code> æ–¹æ³•å’Œ <code>isEmpty()</code> æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿä¸å¤ªä¸€æ ·ã€‚<code>ConcurrentHashMap</code> 1.7 å°†å…ƒç´ æ•°é‡å­˜å‚¨åœ¨æ¯ä¸ª<code>Segment</code> ä¸­ï¼Œ<code>size()</code> æ–¹æ³•éœ€è¦ç»Ÿè®¡æ¯ä¸ª <code>Segment</code> çš„æ•°é‡ï¼Œè€Œ <code>isEmpty()</code> åªéœ€è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ä¸ºç©ºçš„ <code>Segment</code> å³å¯ã€‚ä½†æ˜¯åœ¨<code>ConcurrentHashMap</code> 1.8 ä¸­çš„ <code>size()</code> æ–¹æ³•å’Œ <code>isEmpty()</code> éƒ½éœ€è¦è°ƒç”¨ <code>sumCount()</code> æ–¹æ³•ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ <code>Node</code> æ•°ç»„çš„å¤§å°æœ‰å…³ã€‚ä¸‹é¢æ˜¯ <code>sumCount()</code> æ–¹æ³•çš„æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">long</span> <span class="title function_">sumCount</span><span class="params">()</span> &#123;</span><br><span class="line">    CounterCell[] as = counterCells; CounterCell a;</span><br><span class="line">    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> baseCount;</span><br><span class="line">    <span class="keyword">if</span> (as != <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i)</span><br><span class="line">            <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                sum += a.value;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºåœ¨å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œ<code>ConcurrentHashMap</code> å°†æ¯ä¸ª <code>Node</code> ä¸­èŠ‚ç‚¹çš„æ•°é‡å­˜å‚¨åœ¨ <code>CounterCell[]</code> æ•°ç»„ä¸­ã€‚åœ¨ <code>ConcurrentHashMap</code> 1.7 ä¸­ï¼Œå°†å…ƒç´ æ•°é‡å­˜å‚¨åœ¨æ¯ä¸ª<code>Segment</code> ä¸­ï¼Œ<code>size()</code> æ–¹æ³•éœ€è¦ç»Ÿè®¡æ¯ä¸ª <code>Segment</code> çš„æ•°é‡ï¼Œè€Œ <code>isEmpty()</code> åªéœ€è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ä¸ºç©ºçš„ <code>Segment</code> å³å¯ã€‚</p>
<h2 id="é›†åˆè½¬-Map"><a href="#é›†åˆè½¬-Map" class="headerlink" title="é›†åˆè½¬ Map"></a>é›†åˆè½¬ Map</h2><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>åœ¨ä½¿ç”¨ <code>java.util.stream.Collectors</code> ç±»çš„ <code>toMap()</code> æ–¹æ³•è½¬ä¸º <code>Map</code> é›†åˆæ—¶ï¼Œä¸€å®šè¦æ³¨æ„å½“ value ä¸º null æ—¶ä¼šæŠ› NPE å¼‚å¸¸ã€‚</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">     <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;Person&gt; bookList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">bookList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jack&quot;</span>,<span class="string">&quot;18163138123&quot;</span>));</span><br><span class="line">bookList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;martin&quot;</span>,<span class="literal">null</span>));</span><br><span class="line"><span class="comment">// ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">bookList.stream().collect(Collectors.toMap(Person::getName, Person::getPhoneNumber));</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹åŸå› ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ <code>java.util.stream.Collectors</code> ç±»çš„ <code>toMap()</code> æ–¹æ³• ï¼Œå¯ä»¥çœ‹åˆ°å…¶å†…éƒ¨è°ƒç”¨äº† <code>Map</code> æ¥å£çš„ <code>merge()</code> æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T, K, U, M <span class="keyword">extends</span> <span class="title class_">Map</span>&lt;K, U&gt;&gt;</span><br><span class="line">Collector&lt;T, ?, M&gt; toMap(Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">K</span>&gt; keyMapper,</span><br><span class="line">                            Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">U</span>&gt; valueMapper,</span><br><span class="line">                            BinaryOperator&lt;U&gt; mergeFunction,</span><br><span class="line">                            Supplier&lt;M&gt; mapSupplier) &#123;</span><br><span class="line">    BiConsumer&lt;M, T&gt; accumulator</span><br><span class="line">            = (map, element) -&gt; map.merge(keyMapper.apply(element),</span><br><span class="line">                                          valueMapper.apply(element), mergeFunction);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CollectorImpl</span>&lt;&gt;(mapSupplier, accumulator, mapMerger(mergeFunction), CH_ID);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Map</code> æ¥å£çš„ <code>merge()</code> æ–¹æ³•å¦‚ä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æ¥å£ä¸­çš„é»˜è®¤å®ç°ã€‚</p>
<blockquote>
<p>å¦‚æœä½ è¿˜ä¸äº†è§£ Java 8 æ–°ç‰¹æ€§çš„è¯ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://mp.weixin.qq.com/s/ojyl7B6PiHaTWADqmUq2rw">ã€ŠJava8 æ–°ç‰¹æ€§æ€»ç»“ã€‹</a> ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span> V <span class="title function_">merge</span><span class="params">(K key, V value,</span></span><br><span class="line"><span class="params">        BiFunction&lt;? <span class="built_in">super</span> V, ? <span class="built_in">super</span> V, ? extends V&gt; remappingFunction)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(remappingFunction);</span><br><span class="line">    Objects.requireNonNull(value);</span><br><span class="line">    <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> get(key);</span><br><span class="line">    <span class="type">V</span> <span class="variable">newValue</span> <span class="operator">=</span> (oldValue == <span class="literal">null</span>) ? value :</span><br><span class="line">               remappingFunction.apply(oldValue, value);</span><br><span class="line">    <span class="keyword">if</span>(newValue == <span class="literal">null</span>) &#123;</span><br><span class="line">        remove(key);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        put(key, newValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>merge()</code> æ–¹æ³•ä¼šå…ˆè°ƒç”¨ <code>Objects.requireNonNull()</code> æ–¹æ³•åˆ¤æ–­ value æ˜¯å¦ä¸ºç©ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">requireNonNull</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆéå†"><a href="#é›†åˆéå†" class="headerlink" title="é›†åˆéå†"></a>é›†åˆéå†</h2><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ <code>remove/add</code> æ“ä½œã€‚remove å…ƒç´ è¯·ä½¿ç”¨ <code>Iterator</code> æ–¹å¼ï¼Œå¦‚æœå¹¶å‘æ“ä½œï¼Œéœ€è¦å¯¹ <code>Iterator</code> å¯¹è±¡åŠ é”ã€‚</strong></p>
</blockquote>
<p>é€šè¿‡åç¼–è¯‘ä½ ä¼šå‘ç° foreach è¯­æ³•åº•å±‚å…¶å®è¿˜æ˜¯ä¾èµ– <code>Iterator</code> ã€‚ä¸è¿‡ï¼Œ <code>remove/add</code> æ“ä½œç›´æ¥è°ƒç”¨çš„æ˜¯é›†åˆè‡ªå·±çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>Iterator</code> çš„ <code>remove/add</code>æ–¹æ³•</p>
<p>è¿™å°±å¯¼è‡´ <code>Iterator</code> è«åå…¶å¦™åœ°å‘ç°è‡ªå·±æœ‰å…ƒç´ è¢« <code>remove/add</code> ï¼Œç„¶åï¼Œå®ƒå°±ä¼šæŠ›å‡ºä¸€ä¸ª <code>ConcurrentModificationException</code> æ¥æç¤ºç”¨æˆ·å‘ç”Ÿäº†å¹¶å‘ä¿®æ”¹å¼‚å¸¸ã€‚è¿™å°±æ˜¯å•çº¿ç¨‹çŠ¶æ€ä¸‹äº§ç”Ÿçš„ <strong>fail-fast æœºåˆ¶</strong>ã€‚</p>
<blockquote>
<p><strong>fail-fast æœºåˆ¶</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯¹ fail-fast é›†åˆè¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>ã€‚ å³ä½¿æ˜¯å•çº¿ç¨‹ä¸‹ä¹Ÿæœ‰å¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œä¸Šé¢å·²ç»æåˆ°è¿‡ã€‚</p>
<p>ç›¸å…³é˜…è¯»ï¼š<a href="https://www.cnblogs.com/54chensongxia/p/12470446.html">ä»€ä¹ˆæ˜¯ fail-fast</a> ã€‚</p>
</blockquote>
<p>Java8 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>Collection#removeIf()</code>æ–¹æ³•åˆ é™¤æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å…ƒç´ ,å¦‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    list.add(i);</span><br><span class="line">&#125;</span><br><span class="line">list.removeIf(filter -&gt; filter % <span class="number">2</span> == <span class="number">0</span>); <span class="comment">/* åˆ é™¤listä¸­çš„æ‰€æœ‰å¶æ•° */</span></span><br><span class="line">System.out.println(list); <span class="comment">/* [1, 3, 5, 7, 9] */</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä¸Šé¢ä»‹ç»çš„ç›´æ¥ä½¿ç”¨ <code>Iterator</code> è¿›è¡Œéå†æ“ä½œä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ï¼š</p>
<ul>
<li>ä½¿ç”¨æ™®é€šçš„ for å¾ªç¯</li>
<li>ä½¿ç”¨ fail-safe çš„é›†åˆç±»ã€‚<code>java.util</code>åŒ…ä¸‹é¢çš„æ‰€æœ‰çš„é›†åˆç±»éƒ½æ˜¯ fail-fast çš„ï¼Œè€Œ<code>java.util.concurrent</code>åŒ…ä¸‹é¢çš„æ‰€æœ‰çš„ç±»éƒ½æ˜¯ fail-safe çš„ã€‚</li>
<li>â€¦â€¦</li>
</ul>
<h2 id="é›†åˆå»é‡"><a href="#é›†åˆå»é‡" class="headerlink" title="é›†åˆå»é‡"></a>é›†åˆå»é‡</h2><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>å¯ä»¥åˆ©ç”¨ <code>Set</code> å…ƒç´ å”¯ä¸€çš„ç‰¹æ€§ï¼Œå¯ä»¥å¿«é€Ÿå¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œå»é‡æ“ä½œï¼Œé¿å…ä½¿ç”¨ <code>List</code> çš„ <code>contains()</code> è¿›è¡Œéå†å»é‡æˆ–è€…åˆ¤æ–­åŒ…å«æ“ä½œã€‚</strong></p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ä»¥ <code>HashSet</code> å’Œ <code>ArrayList</code> ä¸ºä¾‹è¯´æ˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set å»é‡ä»£ç ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Set&lt;T&gt; <span class="title function_">removeDuplicateBySet</span><span class="params">(List&lt;T&gt; data)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isEmpty(data)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// List å»é‡ä»£ç ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">removeDuplicateByList</span><span class="params">(List&lt;T&gt; data)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isEmpty(data)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(data.size());</span><br><span class="line">    <span class="keyword">for</span> (T current : data) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!result.contains(current)) &#123;</span><br><span class="line">            result.add(current);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸¤è€…çš„æ ¸å¿ƒå·®åˆ«åœ¨äº <code>contains()</code> æ–¹æ³•çš„å®ç°ã€‚</p>
<p><code>HashSet</code> çš„ <code>contains()</code> æ–¹æ³•åº•éƒ¨ä¾èµ–çš„ <code>HashMap</code> çš„ <code>containsKey()</code> æ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦æ¥è¿‘äº Oï¼ˆ1ï¼‰ï¼ˆæ²¡æœ‰å‡ºç°å“ˆå¸Œå†²çªçš„æ—¶å€™ä¸º Oï¼ˆ1ï¼‰ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> map.containsKey(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœ‰ N ä¸ªå…ƒç´ æ’å…¥è¿› Set ä¸­ï¼Œé‚£æ—¶é—´å¤æ‚åº¦å°±æ¥è¿‘æ˜¯ O (n)ã€‚</p>
<p><code>ArrayList</code> çš„ <code>contains()</code> æ–¹æ³•æ˜¯é€šè¿‡éå†æ‰€æœ‰å…ƒç´ çš„æ–¹æ³•æ¥åšçš„ï¼Œæ—¶é—´å¤æ‚åº¦æ¥è¿‘æ˜¯ O(n)ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[i]==<span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆè½¬æ•°ç»„"><a href="#é›†åˆè½¬æ•°ç»„" class="headerlink" title="é›†åˆè½¬æ•°ç»„"></a>é›†åˆè½¬æ•°ç»„</h2><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>ä½¿ç”¨é›†åˆè½¬æ•°ç»„çš„æ–¹æ³•ï¼Œå¿…é¡»ä½¿ç”¨é›†åˆçš„ <code>toArray(T[] array)</code>ï¼Œä¼ å…¥çš„æ˜¯ç±»å‹å®Œå…¨ä¸€è‡´ã€é•¿åº¦ä¸º 0 çš„ç©ºæ•°ç»„ã€‚</strong></p>
</blockquote>
<p><code>toArray(T[] array)</code> æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ³›å‹æ•°ç»„ï¼Œå¦‚æœ <code>toArray</code> æ–¹æ³•ä¸­æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°çš„è¯è¿”å›çš„æ˜¯ <code>Object</code>ç±» å‹æ•°ç»„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String [] s= <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">    <span class="string">&quot;dog&quot;</span>, <span class="string">&quot;lazy&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;over&quot;</span>, <span class="string">&quot;jumps&quot;</span>, <span class="string">&quot;fox&quot;</span>, <span class="string">&quot;brown&quot;</span>, <span class="string">&quot;quick&quot;</span>, <span class="string">&quot;A&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">List&lt;String&gt; list = Arrays.asList(s);</span><br><span class="line">Collections.reverse(list);</span><br><span class="line"><span class="comment">//æ²¡æœ‰æŒ‡å®šç±»å‹çš„è¯ä¼šæŠ¥é”™</span></span><br><span class="line">s=list.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p>ç”±äº JVM ä¼˜åŒ–ï¼Œ<code>new String[0]</code>ä½œä¸º<code>Collection.toArray()</code>æ–¹æ³•çš„å‚æ•°ç°åœ¨ä½¿ç”¨æ›´å¥½ï¼Œ<code>new String[0]</code>å°±æ˜¯èµ·ä¸€ä¸ªæ¨¡æ¿çš„ä½œç”¨ï¼ŒæŒ‡å®šäº†è¿”å›æ•°ç»„çš„ç±»å‹ï¼Œ0 æ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸ºäº†è¯´æ˜è¿”å›çš„ç±»å‹ã€‚è¯¦è§ï¼š<a href="https://shipilev.net/blog/2016/arrays-wisdom-ancients/">https://shipilev.net/blog/2016/arrays-wisdom-ancients/</a></p>
<h2 id="æ•°ç»„è½¬é›†åˆ"><a href="#æ•°ç»„è½¬é›†åˆ" class="headerlink" title="æ•°ç»„è½¬é›†åˆ"></a>æ•°ç»„è½¬é›†åˆ</h2><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>ä½¿ç”¨å·¥å…·ç±» <code>Arrays.asList()</code> æŠŠæ•°ç»„è½¬æ¢æˆé›†åˆæ—¶ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä¿®æ”¹é›†åˆç›¸å…³çš„æ–¹æ³•ï¼Œ å®ƒçš„ <code>add/remove/clear</code> æ–¹æ³•ä¼šæŠ›å‡º <code>UnsupportedOperationException</code> å¼‚å¸¸ã€‚</strong></p>
</blockquote>
<p>æˆ‘åœ¨ä¹‹å‰çš„ä¸€ä¸ªé¡¹ç›®ä¸­å°±é‡åˆ°ä¸€ä¸ªç±»ä¼¼çš„å‘ã€‚</p>
<p><code>Arrays.asList()</code>åœ¨å¹³æ—¶å¼€å‘ä¸­è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå°†ä¸€ä¸ªæ•°ç»„è½¬æ¢ä¸ºä¸€ä¸ª <code>List</code> é›†åˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] myArray = &#123;<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>&#125;;</span><br><span class="line">List&lt;String&gt; myList = Arrays.asList(myArray);</span><br><span class="line"><span class="comment">//ä¸Šé¢ä¸¤ä¸ªè¯­å¥ç­‰ä»·äºä¸‹é¢ä¸€æ¡è¯­å¥</span></span><br><span class="line">List&lt;String&gt; myList = Arrays.asList(<span class="string">&quot;Apple&quot;</span>,<span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>JDK æºç å¯¹äºè¿™ä¸ªæ–¹æ³•çš„è¯´æ˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  *è¿”å›ç”±æŒ‡å®šæ•°ç»„æ”¯æŒçš„å›ºå®šå¤§å°çš„åˆ—è¡¨ã€‚æ­¤æ–¹æ³•ä½œä¸ºåŸºäºæ•°ç»„å’ŒåŸºäºé›†åˆçš„APIä¹‹é—´çš„æ¡¥æ¢ï¼Œ</span></span><br><span class="line"><span class="comment">  * ä¸ Collection.toArray()ç»“åˆä½¿ç”¨ã€‚è¿”å›çš„Listæ˜¯å¯åºåˆ—åŒ–å¹¶å®ç°RandomAccessæ¥å£ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">asList</span><span class="params">(T... a)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä½¿ç”¨æ³¨æ„äº‹é¡¹ã€‚</p>
<p><strong>1ã€<code>Arrays.asList()</code>æ˜¯æ³›å‹æ–¹æ³•ï¼Œä¼ é€’çš„æ•°ç»„å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»å‹ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] myArray = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.asList(myArray);</span><br><span class="line">System.out.println(myList.size());<span class="comment">//1</span></span><br><span class="line">System.out.println(myList.get(<span class="number">0</span>));<span class="comment">//æ•°ç»„åœ°å€å€¼</span></span><br><span class="line">System.out.println(myList.get(<span class="number">1</span>));<span class="comment">//æŠ¥é”™ï¼šArrayIndexOutOfBoundsException</span></span><br><span class="line"><span class="type">int</span>[] array = (<span class="type">int</span>[]) myList.get(<span class="number">0</span>);</span><br><span class="line">System.out.println(array[<span class="number">0</span>]);<span class="comment">//1</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¼ å…¥ä¸€ä¸ªåŸç”Ÿæ•°æ®ç±»å‹æ•°ç»„æ—¶ï¼Œ<code>Arrays.asList()</code> çš„çœŸæ­£å¾—åˆ°çš„å‚æ•°å°±ä¸æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè€Œæ˜¯æ•°ç»„å¯¹è±¡æœ¬èº«ï¼æ­¤æ—¶ <code>List</code> çš„å”¯ä¸€å…ƒç´ å°±æ˜¯è¿™ä¸ªæ•°ç»„ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸Šé¢çš„ä»£ç ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨åŒ…è£…ç±»å‹æ•°ç»„å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer[] myArray = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>2ã€ä½¿ç”¨é›†åˆçš„ä¿®æ”¹æ–¹æ³•: <code>add()</code>ã€<code>remove()</code>ã€<code>clear()</code>ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">myList.add(<span class="number">4</span>);<span class="comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span></span><br><span class="line">myList.remove(<span class="number">1</span>);<span class="comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span></span><br><span class="line">myList.clear();<span class="comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span></span><br></pre></td></tr></table></figure>

<p><code>Arrays.asList()</code> æ–¹æ³•è¿”å›çš„å¹¶ä¸æ˜¯ <code>java.util.ArrayList</code> ï¼Œè€Œæ˜¯ <code>java.util.Arrays</code> çš„ä¸€ä¸ªå†…éƒ¨ç±»,è¿™ä¸ªå†…éƒ¨ç±»å¹¶æ²¡æœ‰å®ç°é›†åˆçš„ä¿®æ”¹æ–¹æ³•æˆ–è€…è¯´å¹¶æ²¡æœ‰é‡å†™è¿™äº›æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">System.out.println(myList.getClass());<span class="comment">//class java.util.Arrays$ArrayList</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹å›¾æ˜¯ <code>java.util.Arrays$ArrayList</code> çš„ç®€æ˜“æºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»é‡å†™çš„æ–¹æ³•æœ‰å“ªäº›ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;</span><br><span class="line">      <span class="keyword">implements</span> <span class="title class_">RandomAccess</span>, java.io.Serializable</span><br><span class="line">  &#123;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> E <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">         ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forEach</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; action)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">replaceAll</span><span class="params">(UnaryOperator&lt;E&gt; operator)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparator&lt;? <span class="built_in">super</span> E&gt; c)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹<code>java.util.AbstractList</code>çš„ <code>add/remove/clear</code> æ–¹æ³•å°±çŸ¥é“ä¸ºä»€ä¹ˆä¼šæŠ›å‡º <code>UnsupportedOperationException</code> äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    add(size(), e);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    removeRange(<span class="number">0</span>, size());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">removeRange</span><span class="params">(<span class="type">int</span> fromIndex, <span class="type">int</span> toIndex)</span> &#123;</span><br><span class="line">    ListIterator&lt;E&gt; it = listIterator(fromIndex);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>, n=toIndex-fromIndex; i&lt;n; i++) &#123;</span><br><span class="line">        it.next();</span><br><span class="line">        it.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é‚£æˆ‘ä»¬å¦‚ä½•æ­£ç¡®çš„å°†æ•°ç»„è½¬æ¢ä¸º <code>ArrayList</code> ?</strong></p>
<p>1ã€æ‰‹åŠ¨å®ç°å·¥å…·ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JDK1.5+</span></span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">arrayToList</span><span class="params">(<span class="keyword">final</span> T[] array)</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> List&lt;T&gt; l = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;T&gt;(array.length);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">final</span> T s : array) &#123;</span><br><span class="line">    l.add(s);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Integer [] myArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">System.out.println(arrayToList(myArray).getClass());<span class="comment">//class java.util.ArrayList</span></span><br></pre></td></tr></table></figure>

<p>2ã€æœ€ç®€ä¾¿çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>3ã€ä½¿ç”¨ Java8 çš„ <code>Stream</code>(æ¨è)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Integer [] myArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.stream(myArray).collect(Collectors.toList());</span><br><span class="line"><span class="comment">//åŸºæœ¬ç±»å‹ä¹Ÿå¯ä»¥å®ç°è½¬æ¢ï¼ˆä¾èµ–boxedçš„è£…ç®±æ“ä½œï¼‰</span></span><br><span class="line"><span class="type">int</span> [] myArray2 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.stream(myArray2).boxed().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>4ã€ä½¿ç”¨ Guava</p>
<p>å¯¹äºä¸å¯å˜é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/ImmutableList.java"><code>ImmutableList</code></a>ç±»åŠå…¶<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/ImmutableList.java#L101"><code>of()</code></a>ä¸<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/ImmutableList.java#L225"><code>copyOf()</code></a>å·¥å‚æ–¹æ³•ï¼šï¼ˆå‚æ•°ä¸èƒ½ä¸ºç©ºï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; il = ImmutableList.of(<span class="string">&quot;string&quot;</span>, <span class="string">&quot;elements&quot;</span>);  <span class="comment">// from varargs</span></span><br><span class="line">List&lt;String&gt; il = ImmutableList.copyOf(aStringArray);      <span class="comment">// from array</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºå¯å˜é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/Lists.java"><code>Lists</code></a>ç±»åŠå…¶<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/Lists.java#L87"><code>newArrayList()</code></a>å·¥å‚æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; l1 = Lists.newArrayList(anotherListOrCollection);    <span class="comment">// from collection</span></span><br><span class="line">List&lt;String&gt; l2 = Lists.newArrayList(aStringArray);               <span class="comment">// from array</span></span><br><span class="line">List&lt;String&gt; l3 = Lists.newArrayList(<span class="string">&quot;or&quot;</span>, <span class="string">&quot;string&quot;</span>, <span class="string">&quot;elements&quot;</span>); <span class="comment">// from varargs</span></span><br></pre></td></tr></table></figure>

<p>5ã€ä½¿ç”¨ Apache Commons Collections</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">CollectionUtils.addAll(list, str);</span><br></pre></td></tr></table></figure>

<p>6ã€ ä½¿ç”¨ Java9 çš„ <code>List.of()</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer[] array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">List&lt;Integer&gt; list = List.of(array);</span><br></pre></td></tr></table></figure>

<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/16/distributed-lock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/16/distributed-lock/" itemprop="url">åˆ†å¸ƒå¼é”ä»‹ç»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-04-16T20:41:02+08:00">
                2021-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">åˆ†å¸ƒå¼</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/04/16/distributed-lock/" class="leancloud_visitors" data-flag-title="åˆ†å¸ƒå¼é”ä»‹ç»">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  1.7k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  5 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <!-- @include: @small-advertisement.snippet.md -->

<p>ç½‘ä¸Šæœ‰å¾ˆå¤šåˆ†å¸ƒå¼é”ç›¸å…³çš„æ–‡ç« ï¼Œå†™äº†ä¸€ä¸ªç›¸å¯¹ç®€æ´æ˜“æ‡‚çš„ç‰ˆæœ¬ï¼Œé’ˆå¯¹é¢è¯•å’Œå·¥ä½œåº”è¯¥å¤Ÿç”¨äº†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼é”çš„åŸºæœ¬æ¦‚å¿µã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿ</h2><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼ˆä¾‹å¦‚å•†å“åº“å­˜ã€å¤–å–è®¢å•ï¼‰ï¼Œä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´å‡ºç°è„æ•°æ®æˆ–è€…ç³»ç»Ÿé—®é¢˜ï¼Œå¨èƒåˆ°ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç°åœ¨æœ‰ 100 ä¸ªç”¨æˆ·å‚ä¸æŸä¸ªé™æ—¶ç§’æ€æ´»åŠ¨ï¼Œæ¯ä½ç”¨æˆ·é™è´­ 1 ä»¶å•†å“ï¼Œä¸”å•†å“çš„æ•°é‡åªæœ‰ 3 ä¸ªã€‚å¦‚æœä¸å¯¹å…±äº«èµ„æºè¿›è¡Œäº’æ–¥è®¿é—®ï¼Œå°±å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>çº¿ç¨‹ 1ã€2ã€3 ç­‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥æŠ¢è´­æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªç”¨æˆ·ã€‚</li>
<li>çº¿ç¨‹ 1 æŸ¥è¯¢ç”¨æˆ·å·²ç»æŠ¢è´­çš„æ•°é‡ï¼Œå‘ç°å½“å‰ç”¨æˆ·å°šæœªæŠ¢è´­ä¸”å•†å“åº“å­˜è¿˜æœ‰ 1 ä¸ªï¼Œå› æ­¤è®¤ä¸ºå¯ä»¥ç»§ç»­æ‰§è¡ŒæŠ¢è´­æµç¨‹ã€‚</li>
<li>çº¿ç¨‹ 2 ä¹Ÿæ‰§è¡ŒæŸ¥è¯¢ç”¨æˆ·å·²ç»æŠ¢è´­çš„æ•°é‡ï¼Œå‘ç°å½“å‰ç”¨æˆ·å°šæœªæŠ¢è´­ä¸”å•†å“åº“å­˜è¿˜æœ‰ 1 ä¸ªï¼Œå› æ­¤è®¤ä¸ºå¯ä»¥ç»§ç»­æ‰§è¡ŒæŠ¢è´­æµç¨‹ã€‚</li>
<li>çº¿ç¨‹ 1 ç»§ç»­æ‰§è¡Œï¼Œå°†åº“å­˜æ•°é‡å‡å°‘ 1 ä¸ªï¼Œç„¶åè¿”å›æˆåŠŸã€‚</li>
<li>çº¿ç¨‹ 2 ç»§ç»­æ‰§è¡Œï¼Œå°†åº“å­˜æ•°é‡å‡å°‘ 1 ä¸ªï¼Œç„¶åè¿”å›æˆåŠŸã€‚</li>
<li>æ­¤æ—¶å°±å‘ç”Ÿäº†è¶…å–é—®é¢˜ï¼Œå¯¼è‡´å•†å“è¢«å¤šå–äº†ä¸€ä»½ã€‚</li>
</ul>
<p><img src="https://oss.javaguide.cn/github/javaguide/distributed-system/distributed-lock/oversold-without-locking.png" alt="å…±äº«èµ„æºæœªäº’æ–¥è®¿é—®å¯¼è‡´å‡ºç°é—®é¢˜"></p>
<p>ä¸ºäº†ä¿è¯å…±äº«èµ„æºè¢«å®‰å…¨åœ°è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨äº’æ–¥æ“ä½œå¯¹å…±äº«èµ„æºè¿›è¡Œä¿æŠ¤ï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…å½“å‰çº¿ç¨‹é‡Šæ”¾åæ‰èƒ½è®¿é—®ã€‚è¿™æ ·å¯ä»¥é¿å…æ•°æ®ç«äº‰å’Œè„æ•°æ®é—®é¢˜ï¼Œä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</p>
<p><strong>å¦‚ä½•æ‰èƒ½å®ç°å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®å‘¢ï¼Ÿ</strong> é”æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæ›´å‡†ç¡®ç‚¹æ¥è¯´æ˜¯æ‚²è§‚é”ã€‚</p>
<p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜(æ¯”å¦‚å…±äº«æ•°æ®è¢«ä¿®æ”¹)ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è·å–èµ„æºæ“ä½œçš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ‹¿åˆ°è¿™ä¸ªèµ„æºå°±ä¼šé˜»å¡ç›´åˆ°é”è¢«ä¸Šä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ã€‚</p>
<p>å¯¹äºå•æœºå¤šçº¿ç¨‹æ¥è¯´ï¼Œåœ¨ Java ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ <code>ReentrantLock</code> ç±»ã€<code>synchronized</code> å…³é”®å­—è¿™ç±» JDK è‡ªå¸¦çš„ <strong>æœ¬åœ°é”</strong> æ¥æ§åˆ¶ä¸€ä¸ª JVM è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å¯¹æœ¬åœ°å…±äº«èµ„æºçš„è®¿é—®ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘å¯¹æœ¬åœ°é”ç”»çš„ä¸€å¼ ç¤ºæ„å›¾ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/distributed-system/distributed-lock/jvm-local-lock.png" alt="æœ¬åœ°é”"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›çº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ˜¯äº’æ–¥çš„ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åˆ°æœ¬åœ°é”è®¿é—®å…±äº«èµ„æºã€‚</p>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œä¸åŒçš„æœåŠ¡&#x2F;å®¢æˆ·ç«¯é€šå¸¸è¿è¡Œåœ¨ç‹¬ç«‹çš„ JVM è¿›ç¨‹ä¸Šã€‚å¦‚æœå¤šä¸ª JVM è¿›ç¨‹å…±äº«åŒä¸€ä»½èµ„æºçš„è¯ï¼Œä½¿ç”¨æœ¬åœ°é”å°±æ²¡åŠæ³•å®ç°èµ„æºçš„äº’æ–¥è®¿é—®äº†ã€‚äºæ˜¯ï¼Œ<strong>åˆ†å¸ƒå¼é”</strong> å°±è¯ç”Ÿäº†ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šç³»ç»Ÿçš„è®¢å•æœåŠ¡ä¸€å…±éƒ¨ç½²äº† 3 ä»½ï¼Œéƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚ç”¨æˆ·ä¸‹è®¢å•ä¹‹å‰éœ€è¦æ£€æŸ¥åº“å­˜ï¼Œä¸ºäº†é˜²æ­¢è¶…å–ï¼Œè¿™é‡Œéœ€è¦åŠ é”ä»¥å®ç°å¯¹æ£€æŸ¥åº“å­˜æ“ä½œçš„åŒæ­¥è®¿é—®ã€‚ç”±äºè®¢å•æœåŠ¡ä½äºä¸åŒçš„ JVM è¿›ç¨‹ä¸­ï¼Œæœ¬åœ°é”åœ¨è¿™ç§æƒ…å†µä¸‹å°±æ²¡åŠæ³•æ­£å¸¸å·¥ä½œäº†ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Œè¿™æ ·çš„è¯ï¼Œå³ä½¿å¤šä¸ªçº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ª JVM è¿›ç¨‹ä¸­ä¹Ÿèƒ½è·å–åˆ°åŒä¸€æŠŠé”ï¼Œè¿›è€Œå®ç°å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘å¯¹åˆ†å¸ƒå¼é”ç”»çš„ä¸€å¼ ç¤ºæ„å›¾ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/distributed-system/distributed-lock/distributed-lock.png" alt="åˆ†å¸ƒå¼é”"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›ç‹¬ç«‹çš„è¿›ç¨‹ä¸­çš„çº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ˜¯äº’æ–¥çš„ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åˆ°åˆ†å¸ƒå¼é”è®¿é—®å…±äº«èµ„æºã€‚</p>
<h2 id="åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡å“ªäº›æ¡ä»¶ï¼Ÿ"><a href="#åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡å“ªäº›æ¡ä»¶ï¼Ÿ" class="headerlink" title="åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡å“ªäº›æ¡ä»¶ï¼Ÿ"></a>åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡å“ªäº›æ¡ä»¶ï¼Ÿ</h2><p>ä¸€ä¸ªæœ€åŸºæœ¬çš„åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³ï¼š</p>
<ul>
<li><strong>äº’æ–¥</strong>ï¼šä»»æ„ä¸€ä¸ªæ—¶åˆ»ï¼Œé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</li>
<li><strong>é«˜å¯ç”¨</strong>ï¼šé”æœåŠ¡æ˜¯é«˜å¯ç”¨çš„ï¼Œå½“ä¸€ä¸ªé”æœåŠ¡å‡ºç°é—®é¢˜ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªé”æœåŠ¡ã€‚å¹¶ä¸”ï¼Œå³ä½¿å®¢æˆ·ç«¯çš„é‡Šæ”¾é”çš„ä»£ç é€»è¾‘å‡ºç°é—®é¢˜ï¼Œé”æœ€ç»ˆä¸€å®šè¿˜æ˜¯ä¼šè¢«é‡Šæ”¾ï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚è¿™ä¸€èˆ¬æ˜¯é€šè¿‡è¶…æ—¶æœºåˆ¶å®ç°çš„ã€‚</li>
<li><strong>å¯é‡å…¥</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹è·å–äº†é”ä¹‹åï¼Œè¿˜å¯ä»¥å†æ¬¡è·å–é”ã€‚</li>
</ul>
<p>é™¤äº†ä¸Šé¢è¿™ä¸‰ä¸ªåŸºæœ¬æ¡ä»¶ä¹‹å¤–ï¼Œä¸€ä¸ªå¥½çš„åˆ†å¸ƒå¼é”è¿˜éœ€è¦æ»¡è¶³ä¸‹é¢è¿™äº›æ¡ä»¶ï¼š</p>
<ul>
<li><strong>é«˜æ€§èƒ½</strong>ï¼šè·å–å’Œé‡Šæ”¾é”çš„æ“ä½œåº”è¯¥å¿«é€Ÿå®Œæˆï¼Œå¹¶ä¸”ä¸åº”è¯¥å¯¹æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½é€ æˆè¿‡å¤§å½±å“ã€‚</li>
<li><strong>éé˜»å¡</strong>ï¼šå¦‚æœè·å–ä¸åˆ°é”ï¼Œä¸èƒ½æ— é™æœŸç­‰å¾…ï¼Œé¿å…å¯¹ç³»ç»Ÿæ­£å¸¸è¿è¡Œé€ æˆå½±å“ã€‚</li>
</ul>
<h2 id="åˆ†å¸ƒå¼é”çš„å¸¸è§å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#åˆ†å¸ƒå¼é”çš„å¸¸è§å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="åˆ†å¸ƒå¼é”çš„å¸¸è§å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>åˆ†å¸ƒå¼é”çš„å¸¸è§å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h2><p>å¸¸è§åˆ†å¸ƒå¼é”å®ç°æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li>åŸºäºå…³ç³»å‹æ•°æ®åº“æ¯”å¦‚ MySQL å®ç°åˆ†å¸ƒå¼é”ã€‚</li>
<li>åŸºäºåˆ†å¸ƒå¼åè°ƒæœåŠ¡ ZooKeeper å®ç°åˆ†å¸ƒå¼é”ã€‚</li>
<li>åŸºäºåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿæ¯”å¦‚ Redis ã€Etcd å®ç°åˆ†å¸ƒå¼é”ã€‚</li>
</ul>
<p>å…³ç³»å‹æ•°æ®åº“çš„æ–¹å¼ä¸€èˆ¬æ˜¯é€šè¿‡å”¯ä¸€ç´¢å¼•æˆ–è€…æ’ä»–é”å®ç°ã€‚ä¸è¿‡ï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé—®é¢˜å¤ªå¤šæ¯”å¦‚æ€§èƒ½å¤ªå·®ã€ä¸å…·å¤‡é”å¤±æ•ˆæœºåˆ¶ã€‚</p>
<p>åŸºäº ZooKeeper æˆ–è€… Redis å®ç°åˆ†å¸ƒå¼é”è¿™ä¸¤ç§å®ç°æ–¹å¼è¦ç”¨çš„æ›´å¤šä¸€äº›ï¼Œæˆ‘ä¸“é—¨å†™äº†ä¸€ç¯‡æ–‡ç« æ¥è¯¦ç»†ä»‹ç»è¿™ä¸¤ç§æ–¹æ¡ˆï¼š<a href="./distributed-lock-implementations.md">åˆ†å¸ƒå¼é”å¸¸è§å®ç°æ–¹æ¡ˆæ€»ç»“</a>ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦ä»‹ç»äº†ï¼š</p>
<ul>
<li>åˆ†å¸ƒå¼é”çš„ç”¨é€”ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œä¸åŒçš„æœåŠ¡&#x2F;å®¢æˆ·ç«¯é€šå¸¸è¿è¡Œåœ¨ç‹¬ç«‹çš„ JVM è¿›ç¨‹ä¸Šã€‚å¦‚æœå¤šä¸ª JVM è¿›ç¨‹å…±äº«åŒä¸€ä»½èµ„æºçš„è¯ï¼Œä½¿ç”¨æœ¬åœ°é”å°±æ²¡åŠæ³•å®ç°èµ„æºçš„äº’æ–¥è®¿é—®äº†ã€‚</li>
<li>åˆ†å¸ƒå¼é”çš„åº”è¯¥å…·å¤‡çš„æ¡ä»¶ï¼šäº’æ–¥ã€é«˜å¯ç”¨ã€å¯é‡å…¥ã€é«˜æ€§èƒ½ã€éé˜»å¡ã€‚</li>
<li>åˆ†å¸ƒå¼é”çš„å¸¸è§å®ç°æ–¹å¼ï¼šå…³ç³»å‹æ•°æ®åº“æ¯”å¦‚ MySQLã€åˆ†å¸ƒå¼åè°ƒæœåŠ¡ ZooKeeperã€åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿæ¯”å¦‚ Redis ã€Etcd ã€‚</li>
</ul>
<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/13/copyonwritearraylist-source-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/13/copyonwritearraylist-source-code/" itemprop="url">CopyOnWriteArrayList æºç åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-04-13T20:47:52+08:00">
                2021-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E9%9B%86%E5%90%88/" itemprop="url" rel="index">
                    <span itemprop="name">é›†åˆ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/04/13/copyonwritearraylist-source-code/" class="leancloud_visitors" data-flag-title="CopyOnWriteArrayList æºç åˆ†æ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  3.4k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  13 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="CopyOnWriteArrayList-ç®€ä»‹"><a href="#CopyOnWriteArrayList-ç®€ä»‹" class="headerlink" title="CopyOnWriteArrayList ç®€ä»‹"></a>CopyOnWriteArrayList ç®€ä»‹</h2><p>åœ¨ JDK1.5 ä¹‹å‰ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨å¹¶å‘å®‰å…¨çš„ <code>List</code> åªèƒ½é€‰æ‹© <code>Vector</code>ã€‚è€Œ <code>Vector</code> æ˜¯ä¸€ç§è€æ—§çš„é›†åˆï¼Œå·²ç»è¢«æ·˜æ±°ã€‚<code>Vector</code> å¯¹äºå¢åˆ æ”¹æŸ¥ç­‰æ–¹æ³•åŸºæœ¬éƒ½åŠ äº† <code>synchronized</code>ï¼Œè¿™ç§æ–¹å¼è™½ç„¶èƒ½å¤Ÿä¿è¯åŒæ­¥ï¼Œä½†è¿™ç›¸å½“äºå¯¹æ•´ä¸ª <code>Vector</code> åŠ ä¸Šäº†ä¸€æŠŠå¤§é”ï¼Œä½¿å¾—æ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™éƒ½è¦å»è·å¾—é”ï¼Œå¯¼è‡´æ€§èƒ½éå¸¸ä½ä¸‹ã€‚</p>
<p>JDK1.5 å¼•å…¥äº† <code>Java.util.concurrent</code>ï¼ˆJUCï¼‰åŒ…ï¼Œå…¶ä¸­æä¾›äº†å¾ˆå¤šçº¿ç¨‹å®‰å…¨ä¸”å¹¶å‘æ€§èƒ½è‰¯å¥½çš„å®¹å™¨ï¼Œå…¶ä¸­å”¯ä¸€çš„çº¿ç¨‹å®‰å…¨ <code>List</code> å®ç°å°±æ˜¯ <code>CopyOnWriteArrayList</code> ã€‚å…³äº<code>java.util.concurrent</code> åŒ…ä¸‹å¸¸è§å¹¶å‘å®¹å™¨çš„æ€»ç»“ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://javaguide.cn/java/concurrent/java-concurrent-collections.html">Java å¸¸è§å¹¶å‘å®¹å™¨æ€»ç»“</a> ã€‚</p>
<h3 id="CopyOnWriteArrayList-åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ"><a href="#CopyOnWriteArrayList-åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ" class="headerlink" title="CopyOnWriteArrayList åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ"></a>CopyOnWriteArrayList åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ</h3><p>å¯¹äºå¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯æ¥è¯´ï¼Œè¯»å–æ“ä½œå¾€å¾€æ˜¯è¿œå¤§äºå†™å…¥æ“ä½œçš„ã€‚ç”±äºè¯»å–æ“ä½œä¸ä¼šå¯¹åŸæœ‰æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤ï¼Œå¯¹äºæ¯æ¬¡è¯»å–éƒ½è¿›è¡ŒåŠ é”å…¶å®æ˜¯ä¸€ç§èµ„æºæµªè´¹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—® <code>List</code> çš„å†…éƒ¨æ•°æ®ï¼Œæ¯•ç«Ÿå¯¹äºè¯»å–æ“ä½œæ¥è¯´æ˜¯å®‰å…¨çš„ã€‚</p>
<p>è¿™ç§æ€è·¯ä¸ <code>ReentrantReadWriteLock</code> è¯»å†™é”çš„è®¾è®¡æ€æƒ³éå¸¸ç±»ä¼¼ï¼Œå³è¯»è¯»ä¸äº’æ–¥ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥ï¼ˆåªæœ‰è¯»è¯»ä¸äº’æ–¥ï¼‰ã€‚<code>CopyOnWriteArrayList</code> æ›´è¿›ä¸€æ­¥åœ°å®ç°äº†è¿™ä¸€æ€æƒ³ã€‚ä¸ºäº†å°†è¯»æ“ä½œæ€§èƒ½å‘æŒ¥åˆ°æè‡´ï¼Œ<code>CopyOnWriteArrayList</code> ä¸­çš„è¯»å–æ“ä½œæ˜¯å®Œå…¨æ— éœ€åŠ é”çš„ã€‚æ›´åŠ å‰å®³çš„æ˜¯ï¼Œå†™å…¥æ“ä½œä¹Ÿä¸ä¼šé˜»å¡è¯»å–æ“ä½œï¼Œåªæœ‰å†™å†™æ‰ä¼šäº’æ–¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¯»æ“ä½œçš„æ€§èƒ½å°±å¯ä»¥å¤§å¹…åº¦æå‡ã€‚</p>
<p><code>CopyOnWriteArrayList</code> çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒåœ¨äºå…¶é‡‡ç”¨äº† <strong>å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰</strong> çš„ç­–ç•¥ï¼Œä» <code>CopyOnWriteArrayList</code> çš„åå­—å°±èƒ½çœ‹å‡ºäº†ã€‚</p>
<h3 id="Copy-On-Write-çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Copy-On-Write-çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Copy-On-Write çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Copy-On-Write çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><code>CopyOnWriteArrayList</code>åå­—ä¸­çš„â€œCopy-On-Writeâ€å³å†™æ—¶å¤åˆ¶ï¼Œç®€ç§° COWã€‚</p>
<p>ä¸‹é¢æ˜¯ç»´åŸºç™¾ç§‘å¯¹ Copy-On-Write çš„ä»‹ç»ï¼Œä»‹ç»çš„æŒºä¸é”™ï¼š</p>
<blockquote>
<p>å†™å…¥æ—¶å¤åˆ¶ï¼ˆè‹±è¯­ï¼šCopy-on-writeï¼Œç®€ç§° COWï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¼˜åŒ–ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…ï¼ˆcallersï¼‰åŒæ—¶è¯·æ±‚ç›¸åŒèµ„æºï¼ˆå¦‚å†…å­˜æˆ–ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…±åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è¯•å›¾ä¿®æ”¹èµ„æºçš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨å‰¯æœ¬ï¼ˆprivate copyï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„æœ€åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™è¿‡ç¨‹å¯¹å…¶ä»–çš„è°ƒç”¨è€…éƒ½æ˜¯é€æ˜çš„ã€‚æ­¤ä½œæ³•ä¸»è¦çš„ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹è¯¥èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ï¼ˆprivate copyï¼‰è¢«åˆ›å»ºï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚</p>
</blockquote>
<p>è¿™é‡Œå†ä»¥ <code>CopyOnWriteArrayList</code>ä¸ºä¾‹ä»‹ç»ï¼šå½“éœ€è¦ä¿®æ”¹ï¼ˆ <code>add</code>ï¼Œ<code>set</code>ã€<code>remove</code> ç­‰æ“ä½œï¼‰ <code>CopyOnWriteArrayList</code> çš„å†…å®¹æ—¶ï¼Œä¸ä¼šç›´æ¥ä¿®æ”¹åŸæ•°ç»„ï¼Œè€Œæ˜¯ä¼šå…ˆåˆ›å»ºåº•å±‚æ•°ç»„çš„å‰¯æœ¬ï¼Œå¯¹å‰¯æœ¬æ•°ç»„è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å®Œä¹‹åå†å°†ä¿®æ”¹åçš„æ•°ç»„èµ‹å€¼å›å»ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å†™æ“ä½œä¸ä¼šå½±å“è¯»æ“ä½œäº†ã€‚</p>
<p>å¯ä»¥çœ‹å‡ºï¼Œå†™æ—¶å¤åˆ¶æœºåˆ¶éå¸¸é€‚åˆè¯»å¤šå†™å°‘çš„å¹¶å‘åœºæ™¯ï¼Œèƒ½å¤Ÿæå¤§åœ°æé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</p>
<p>ä¸è¿‡ï¼Œå†™æ—¶å¤åˆ¶æœºåˆ¶å¹¶ä¸æ˜¯é“¶å¼¹ï¼Œå…¶ä¾ç„¶å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œä¸‹é¢åˆ—ä¸¾å‡ ç‚¹ï¼š</p>
<ol>
<li>å†…å­˜å ç”¨ï¼šæ¯æ¬¡å†™æ“ä½œéƒ½éœ€è¦å¤åˆ¶ä¸€ä»½åŸå§‹æ•°æ®ï¼Œä¼šå ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œåœ¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜èµ„æºä¸è¶³ã€‚</li>
<li>å†™æ“ä½œå¼€é”€ï¼šæ¯ä¸€æ¬¡å†™æ“ä½œéƒ½éœ€è¦å¤åˆ¶ä¸€ä»½åŸå§‹æ•°æ®ï¼Œç„¶åå†è¿›è¡Œä¿®æ”¹å’Œæ›¿æ¢ï¼Œæ‰€ä»¥å†™æ“ä½œçš„å¼€é”€ç›¸å¯¹è¾ƒå¤§ï¼Œåœ¨å†™å…¥æ¯”è¾ƒé¢‘ç¹çš„åœºæ™¯ä¸‹ï¼Œæ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚</li>
<li>æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼šä¿®æ”¹æ“ä½œä¸ä¼šç«‹å³åæ˜ åˆ°æœ€ç»ˆç»“æœä¸­ï¼Œè¿˜éœ€è¦ç­‰å¾…å¤åˆ¶å®Œæˆï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€å®šçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li>
<li>â€¦â€¦</li>
</ol>
<h2 id="CopyOnWriteArrayList-æºç åˆ†æ"><a href="#CopyOnWriteArrayList-æºç åˆ†æ" class="headerlink" title="CopyOnWriteArrayList æºç åˆ†æ"></a>CopyOnWriteArrayList æºç åˆ†æ</h2><p>è¿™é‡Œä»¥ JDK1.8 ä¸ºä¾‹ï¼Œåˆ†æä¸€ä¸‹ <code>CopyOnWriteArrayList</code> çš„åº•å±‚æ ¸å¿ƒæºç ã€‚</p>
<p><code>CopyOnWriteArrayList</code> çš„ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;E&gt;</span><br><span class="line"><span class="keyword">extends</span> <span class="title class_">Object</span></span><br><span class="line"><span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, Serializable</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>CopyOnWriteArrayList</code> å®ç°äº†ä»¥ä¸‹æ¥å£ï¼š</p>
<ul>
<li><code>List</code> : è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¸‹æ ‡è¿›è¡Œè®¿é—®ã€‚</li>
<li><code>RandomAccess</code> ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å¿—æ¥å£ï¼Œè¡¨æ˜å®ç°è¿™ä¸ªæ¥å£çš„ <code>List</code> é›†åˆæ˜¯æ”¯æŒ <strong>å¿«é€Ÿéšæœºè®¿é—®</strong> çš„ã€‚</li>
<li><code>Cloneable</code> ï¼šè¡¨æ˜å®ƒå…·æœ‰æ‹·è´èƒ½åŠ›ï¼Œå¯ä»¥è¿›è¡Œæ·±æ‹·è´æˆ–æµ…æ‹·è´æ“ä½œã€‚</li>
<li><code>Serializable</code> : è¡¨æ˜å®ƒå¯ä»¥è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµè¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨æˆ–ç½‘ç»œä¼ è¾“ï¼Œéå¸¸æ–¹ä¾¿ã€‚</li>
</ul>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/copyonwritearraylist-class-diagram.png" alt="CopyOnWriteArrayList ç±»å›¾"></p>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p><code>CopyOnWriteArrayList</code> ä¸­æœ‰ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°å’Œä¸¤ä¸ªæœ‰å‚æ„é€ å‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„ CopyOnWriteArrayList</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CopyOnWriteArrayList</span><span class="params">()</span> &#123;</span><br><span class="line">    setArray(<span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‰ç…§é›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºåˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆå…ƒç´ çš„ CopyOnWriteArrayList</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CopyOnWriteArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">    Object[] elements;</span><br><span class="line">    <span class="keyword">if</span> (c.getClass() == CopyOnWriteArrayList.class)</span><br><span class="line">        elements = ((CopyOnWriteArrayList&lt;?&gt;)c).getArray();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        elements = c.toArray();</span><br><span class="line">        <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">        <span class="keyword">if</span> (elements.getClass() != Object[].class)</span><br><span class="line">            elements = Arrays.copyOf(elements, elements.length, Object[].class);</span><br><span class="line">    &#125;</span><br><span class="line">    setArray(elements);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šæ•°ç»„çš„å‰¯æœ¬çš„åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CopyOnWriteArrayList</span><span class="params">(E[] toCopyIn)</span> &#123;</span><br><span class="line">    setArray(Arrays.copyOf(toCopyIn, toCopyIn.length, Object[].class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥å…ƒç´ "><a href="#æ’å…¥å…ƒç´ " class="headerlink" title="æ’å…¥å…ƒç´ "></a>æ’å…¥å…ƒç´ </h3><p><code>CopyOnWriteArrayList</code> çš„ <code>add()</code>æ–¹æ³•æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼š</p>
<ul>
<li><code>add(E e)</code>ï¼šåœ¨ <code>CopyOnWriteArrayList</code> çš„å°¾éƒ¨æ’å…¥å…ƒç´ ã€‚</li>
<li><code>add(int index, E element)</code>ï¼šåœ¨ <code>CopyOnWriteArrayList</code> çš„æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ã€‚</li>
<li><code>addIfAbsent(E e)</code>ï¼šå¦‚æœæŒ‡å®šå…ƒç´ ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ·»åŠ è¯¥å…ƒç´ ã€‚å¦‚æœæˆåŠŸæ·»åŠ å…ƒç´ åˆ™è¿”å› trueã€‚</li>
</ul>
<p>è¿™é‡Œä»¥<code>add(E e)</code>ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’å…¥å…ƒç´ åˆ° CopyOnWriteArrayList çš„å°¾éƒ¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–åŸæ¥çš„æ•°ç»„</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="comment">// åŸæ¥æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªé•¿åº¦+1çš„æ–°æ•°ç»„ï¼Œå¹¶å°†åŸæ¥æ•°ç»„çš„å…ƒç´ å¤åˆ¶ç»™æ–°æ•°ç»„</span></span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// å…ƒç´ æ”¾åœ¨æ–°æ•°ç»„æœ«å°¾</span></span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        <span class="comment">// arrayæŒ‡å‘æ–°æ•°ç»„</span></span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„æºç å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li><code>add</code>æ–¹æ³•å†…éƒ¨ç”¨åˆ°äº† <code>ReentrantLock</code> åŠ é”ï¼Œä¿è¯äº†åŒæ­¥ï¼Œé¿å…äº†å¤šçº¿ç¨‹å†™çš„æ—¶å€™ä¼šå¤åˆ¶å‡ºå¤šä¸ªå‰¯æœ¬å‡ºæ¥ã€‚é”è¢«ä¿®é¥°ä¿è¯äº†é”çš„å†…å­˜åœ°å€è‚¯å®šä¸ä¼šè¢«ä¿®æ”¹ï¼Œå¹¶ä¸”ï¼Œé‡Šæ”¾é”çš„é€»è¾‘æ”¾åœ¨ <code>finally</code> ä¸­ï¼Œå¯ä»¥ä¿è¯é”èƒ½è¢«é‡Šæ”¾ã€‚</li>
<li><code>CopyOnWriteArrayList</code> é€šè¿‡å¤åˆ¶åº•å±‚æ•°ç»„çš„æ–¹å¼å®ç°å†™æ“ä½œï¼Œå³å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„æ¥å®¹çº³æ–°æ·»åŠ çš„å…ƒç´ ï¼Œç„¶ååœ¨æ–°æ•°ç»„ä¸­è¿›è¡Œå†™æ“ä½œï¼Œæœ€åå°†æ–°æ•°ç»„èµ‹å€¼ç»™åº•å±‚æ•°ç»„çš„å¼•ç”¨ï¼Œæ›¿æ¢æ‰æ—§çš„æ•°ç»„ã€‚è¿™ä¹Ÿå°±è¯æ˜äº†æˆ‘ä»¬å‰é¢è¯´çš„ï¼š<code>CopyOnWriteArrayList</code> çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒåœ¨äºå…¶é‡‡ç”¨äº† <strong>å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰</strong> çš„ç­–ç•¥ã€‚</li>
<li>æ¯æ¬¡å†™æ“ä½œéƒ½éœ€è¦é€šè¿‡ <code>Arrays.copyOf</code> å¤åˆ¶åº•å±‚æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„ï¼Œä¸”ä¼šå ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œ<code>CopyOnWriteArrayList</code> é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œåœ¨å†™æ“ä½œä¸é¢‘ç¹ä¸”å†…å­˜èµ„æºå……è¶³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æå‡ç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°ã€‚</li>
<li><code>CopyOnWriteArrayList</code> ä¸­å¹¶æ²¡æœ‰ç±»ä¼¼äº <code>ArrayList</code> çš„ <code>grow()</code> æ–¹æ³•æ‰©å®¹çš„æ“ä½œã€‚</li>
</ul>
<blockquote>
<p><code>Arrays.copyOf</code> æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œå…¶ä¸­ n è¡¨ç¤ºéœ€è¦å¤åˆ¶çš„æ•°ç»„é•¿åº¦ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•çš„å®ç°åŸç†æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç„¶åå°†æºæ•°ç»„ä¸­çš„æ•°æ®å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œæœ€åè¿”å›æ–°æ•°ç»„ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼Œå› æ­¤å…¶æ—¶é—´å¤æ‚åº¦ä¸æ•°ç»„é•¿åº¦æˆæ­£æ¯”ï¼Œå³ O(n)ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºåº•å±‚è°ƒç”¨äº†ç³»ç»Ÿçº§åˆ«çš„æ‹·è´æŒ‡ä»¤ï¼Œå› æ­¤åœ¨å®é™…åº”ç”¨ä¸­è¿™ä¸ªæ–¹æ³•çš„æ€§èƒ½è¡¨ç°æ¯”è¾ƒä¼˜ç§€ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦æ³¨æ„æ§åˆ¶å¤åˆ¶çš„æ•°æ®é‡ï¼Œé¿å…å‡ºç°å†…å­˜å ç”¨è¿‡é«˜çš„æƒ…å†µã€‚</p>
</blockquote>
<h3 id="è¯»å–å…ƒç´ "><a href="#è¯»å–å…ƒç´ " class="headerlink" title="è¯»å–å…ƒç´ "></a>è¯»å–å…ƒç´ </h3><p><code>CopyOnWriteArrayList</code> çš„è¯»å–æ“ä½œæ˜¯åŸºäºå†…éƒ¨æ•°ç»„ <code>array</code> å¹¶æ²¡æœ‰å‘ç”Ÿå®é™…çš„ä¿®æ”¹ï¼Œå› æ­¤åœ¨è¯»å–æ“ä½œæ—¶ä¸éœ€è¦è¿›è¡ŒåŒæ­¥æ§åˆ¶å’Œé”æ“ä½œï¼Œå¯ä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚è¿™ç§æœºåˆ¶ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº•å±‚æ•°ç»„ï¼Œåªèƒ½é€šè¿‡getArrayå’ŒsetArrayæ–¹æ³•è®¿é—®</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Object[] array;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> get(getArray(), index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Object[] getArray() &#123;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> E <span class="title function_">get</span><span class="params">(Object[] a, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (E) a[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡ï¼Œ<code>get</code>æ–¹æ³•æ˜¯å¼±ä¸€è‡´æ€§çš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½è¯»åˆ°æ—§çš„å…ƒç´ å€¼ã€‚</p>
<p><code>get(int index)</code>æ–¹æ³•æ˜¯åˆ†ä¸¤æ­¥è¿›è¡Œçš„ï¼š</p>
<ol>
<li>é€šè¿‡<code>getArray()</code>è·å–å½“å‰æ•°ç»„çš„å¼•ç”¨ï¼›</li>
<li>ç›´æ¥ä»æ•°ç»„ä¸­è·å–ä¸‹æ ‡ä¸º index çš„å…ƒç´ ã€‚</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹å¹¶æ²¡æœ‰åŠ é”ï¼Œæ‰€ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸‹å¯èƒ½å‡ºç°å¦‚ä¸‹æƒ…å†µï¼š</p>
<ol>
<li>çº¿ç¨‹ 1 è°ƒç”¨<code>get(int index)</code>æ–¹æ³•è·å–å€¼ï¼Œå†…éƒ¨é€šè¿‡<code>getArray()</code>æ–¹æ³•è·å–åˆ°äº† array å±æ€§å€¼ï¼›</li>
<li>çº¿ç¨‹ 2 è°ƒç”¨<code>CopyOnWriteArrayList</code>çš„<code>add</code>ã€<code>set</code>ã€<code>remove</code> ç­‰ä¿®æ”¹æ–¹æ³•æ—¶ï¼Œå†…éƒ¨é€šè¿‡<code>setArray</code>æ–¹æ³•ä¿®æ”¹äº†<code>array</code>å±æ€§çš„å€¼ï¼›</li>
<li>çº¿ç¨‹ 1 è¿˜æ˜¯ä»æ—§çš„ <code>array</code> æ•°ç»„ä¸­å–å€¼ã€‚</li>
</ol>
<h3 id="è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°"><a href="#è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°" class="headerlink" title="è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°"></a>è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getArray().length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>CopyOnWriteArrayList</code>ä¸­çš„<code>array</code>æ•°ç»„æ¯æ¬¡å¤åˆ¶éƒ½åˆšå¥½èƒ½å¤Ÿå®¹çº³ä¸‹æ‰€æœ‰å…ƒç´ ï¼Œå¹¶ä¸åƒ<code>ArrayList</code>é‚£æ ·ä¼šé¢„ç•™ä¸€å®šçš„ç©ºé—´ã€‚å› æ­¤ï¼Œ<code>CopyOnWriteArrayList</code>ä¸­å¹¶æ²¡æœ‰<code>size</code>å±æ€§<code>CopyOnWriteArrayList</code>çš„åº•å±‚æ•°ç»„çš„é•¿åº¦å°±æ˜¯å…ƒç´ ä¸ªæ•°ï¼Œå› æ­¤<code>size()</code>æ–¹æ³•åªè¦è¿”å›æ•°ç»„é•¿åº¦å°±å¯ä»¥äº†ã€‚</p>
<h3 id="åˆ é™¤å…ƒç´ "><a href="#åˆ é™¤å…ƒç´ " class="headerlink" title="åˆ é™¤å…ƒç´ "></a>åˆ é™¤å…ƒç´ </h3><p><code>CopyOnWriteArrayList</code>åˆ é™¤å…ƒç´ ç›¸å…³çš„æ–¹æ³•ä¸€å…±æœ‰ 4 ä¸ªï¼š</p>
<ol>
<li><code>remove(int index)</code>ï¼šç§»é™¤æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ ã€‚å°†ä»»ä½•åç»­å…ƒç´ å‘å·¦ç§»åŠ¨ï¼ˆä»å®ƒä»¬çš„ç´¢å¼•ä¸­å‡å» 1ï¼‰ã€‚</li>
<li><code>boolean remove(Object o)</code>ï¼šåˆ é™¤æ­¤åˆ—è¡¨ä¸­é¦–æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥å…ƒç´ åˆ™è¿”å› falseã€‚</li>
<li><code>boolean removeAll(Collection&lt;?&gt; c)</code>ï¼šä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šé›†åˆä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ ã€‚</li>
<li><code>void clear()</code>ï¼šç§»é™¤æ­¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</li>
</ol>
<p>è¿™é‡Œä»¥<code>remove(int index)</code>ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å¯é‡å…¥é”</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//è·å–å½“å‰arrayæ•°ç»„</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰arrayé•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">        <span class="comment">//è·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´ (æ—§å€¼)</span></span><br><span class="line">        <span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> get(elements, index);</span><br><span class="line">        <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> len - index - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­åˆ é™¤çš„æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (numMoved == <span class="number">0</span>)</span><br><span class="line">             <span class="comment">// å¦‚æœåˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç›´æ¥å¤åˆ¶è¯¥å…ƒç´ å‰çš„æ‰€æœ‰å…ƒç´ åˆ°æ–°çš„æ•°ç»„</span></span><br><span class="line">            setArray(Arrays.copyOf(elements, len - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ†æ®µå¤åˆ¶ï¼Œå°†indexå‰çš„å…ƒç´ å’Œindex+1åçš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„</span></span><br><span class="line">            <span class="comment">// æ–°æ•°ç»„é•¿åº¦ä¸ºæ—§æ•°ç»„é•¿åº¦-1</span></span><br><span class="line">            Object[] newElements = <span class="keyword">new</span> <span class="title class_">Object</span>[len - <span class="number">1</span>];</span><br><span class="line">            System.arraycopy(elements, <span class="number">0</span>, newElements, <span class="number">0</span>, index);</span><br><span class="line">            System.arraycopy(elements, index + <span class="number">1</span>, newElements, index,</span><br><span class="line">                             numMoved);</span><br><span class="line">            <span class="comment">//å°†æ–°æ•°ç»„èµ‹å€¼ç»™arrayå¼•ç”¨</span></span><br><span class="line">            setArray(newElements);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">// è§£é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</h3><p><code>CopyOnWriteArrayList</code>æä¾›äº†ä¸¤ä¸ªç”¨äºåˆ¤æ–­æŒ‡å®šå…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>contains(Object o)</code>ï¼šåˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ ã€‚</li>
<li><code>containsAll(Collection&lt;?&gt; c)</code>ï¼šåˆ¤æ–­æ˜¯å¦ä¿è¯æŒ‡å®šé›†åˆçš„å…¨éƒ¨å…ƒç´ ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–å½“å‰arrayæ•°ç»„</span></span><br><span class="line">    Object[] elements = getArray();</span><br><span class="line">    <span class="comment">//è°ƒç”¨indexå°è¯•æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ï¼Œå¦‚æœè¿”å›å€¼å¤§äºç­‰äº0ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line">    <span class="keyword">return</span> indexOf(o, elements, <span class="number">0</span>, elements.length) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¿è¯æŒ‡å®šé›†åˆçš„å…¨éƒ¨å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsAll</span><span class="params">(Collection&lt;?&gt; c)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–å½“å‰arrayæ•°ç»„</span></span><br><span class="line">    Object[] elements = getArray();</span><br><span class="line">    <span class="comment">//è·å–æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">    <span class="comment">//éå†æŒ‡å®šé›†åˆ</span></span><br><span class="line">    <span class="keyword">for</span> (Object e : c) &#123;</span><br><span class="line">        <span class="comment">//å¾ªç¯è°ƒç”¨indexOfæ–¹æ³•åˆ¤æ–­ï¼Œåªè¦æœ‰ä¸€ä¸ªæ²¡æœ‰åŒ…å«å°±ç›´æ¥è¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span> (indexOf(e, elements, <span class="number">0</span>, len) &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æœ€åè¡¨ç¤ºå…¨éƒ¨åŒ…å«æˆ–è€…åˆ¶å®šé›†åˆä¸ºç©ºé›†åˆï¼Œé‚£ä¹ˆè¿”å›true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CopyOnWriteArrayList-å¸¸ç”¨æ–¹æ³•æµ‹è¯•"><a href="#CopyOnWriteArrayList-å¸¸ç”¨æ–¹æ³•æµ‹è¯•" class="headerlink" title="CopyOnWriteArrayList å¸¸ç”¨æ–¹æ³•æµ‹è¯•"></a>CopyOnWriteArrayList å¸¸ç”¨æ–¹æ³•æµ‹è¯•</h2><p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª CopyOnWriteArrayList å¯¹è±¡</span></span><br><span class="line">CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">list.add(<span class="string">&quot;Java&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;Python&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå§‹åˆ—è¡¨ï¼š&quot;</span> + list);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ get æ–¹æ³•è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">System.out.println(<span class="string">&quot;åˆ—è¡¨ç¬¬äºŒä¸ªå…ƒç´ ä¸ºï¼š&quot;</span> + list.get(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ remove æ–¹æ³•åˆ é™¤æŒ‡å®šå…ƒç´ </span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> list.remove(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ é™¤ç»“æœï¼š&quot;</span> + result);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ—è¡¨åˆ é™¤å…ƒç´ åä¸ºï¼š&quot;</span> + list);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ set æ–¹æ³•æ›´æ–°æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">list.set(<span class="number">1</span>, <span class="string">&quot;Golang&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ—è¡¨æ›´æ–°åä¸ºï¼š&quot;</span> + list);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ add æ–¹æ³•åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ </span></span><br><span class="line">list.add(<span class="number">0</span>, <span class="string">&quot;PHP&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ—è¡¨æ’å…¥å…ƒç´ åä¸ºï¼š&quot;</span> + list);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ size æ–¹æ³•è·å–åˆ—è¡¨å¤§å°</span></span><br><span class="line">System.out.println(<span class="string">&quot;åˆ—è¡¨å¤§å°ä¸ºï¼š&quot;</span> + list.size());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ removeAll æ–¹æ³•åˆ é™¤æŒ‡å®šé›†åˆä¸­æ‰€æœ‰å‡ºç°çš„å…ƒç´ </span></span><br><span class="line">result = list.removeAll(List.of(<span class="string">&quot;Java&quot;</span>, <span class="string">&quot;Golang&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;æ‰¹é‡åˆ é™¤ç»“æœï¼š&quot;</span> + result);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ—è¡¨æ‰¹é‡åˆ é™¤å…ƒç´ åä¸ºï¼š&quot;</span> + list);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ clear æ–¹æ³•æ¸…ç©ºåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">list.clear();</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ—è¡¨æ¸…ç©ºåä¸ºï¼š&quot;</span> + list);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åˆ—è¡¨æ›´æ–°åä¸ºï¼š[Java, Golang]</span><br><span class="line">åˆ—è¡¨æ’å…¥å…ƒç´ åä¸ºï¼š[PHP, Java, Golang]</span><br><span class="line">åˆ—è¡¨å¤§å°ä¸ºï¼š3</span><br><span class="line">æ‰¹é‡åˆ é™¤ç»“æœï¼štrue</span><br><span class="line">åˆ—è¡¨æ‰¹é‡åˆ é™¤å…ƒç´ åä¸ºï¼š[PHP]</span><br><span class="line">åˆ—è¡¨æ¸…ç©ºåä¸ºï¼š[]</span><br></pre></td></tr></table></figure>

<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/18/distributed-configuration-center/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/18/distributed-configuration-center/" itemprop="url">åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒå¸¸è§é—®é¢˜æ€»ç»“(ä»˜è´¹)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-18T22:09:30+08:00">
                2021-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">åˆ†å¸ƒå¼</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/03/18/distributed-configuration-center/" class="leancloud_visitors" data-flag-title="åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒå¸¸è§é—®é¢˜æ€»ç»“(ä»˜è´¹)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  54 å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  1 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</strong> ç›¸å…³çš„é¢è¯•é¢˜ä¸ºæˆ‘çš„<a href="https://javaguide.cn/about-the-author/zhishixingqiu-two-years.html">çŸ¥è¯†æ˜Ÿçƒ</a>ï¼ˆç‚¹å‡»é“¾æ¥å³å¯æŸ¥çœ‹è¯¦ç»†ä»‹ç»ä»¥åŠåŠ å…¥æ–¹æ³•ï¼‰ä¸“å±å†…å®¹ï¼Œå·²ç»æ•´ç†åˆ°äº†ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹ä¸­ã€‚</p>
<p><img src="https://oss.javaguide.cn/javamianshizhibei/distributed-system.png"></p>
<!-- @include: @planet.snippet.md -->

<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/17/high-availability-system-design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/17/high-availability-system-design/" itemprop="url">é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡æŒ‡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-17T19:35:56+08:00">
                2021-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">åˆ†å¸ƒå¼</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%AB%98%E5%8F%AF%E7%94%A8/" itemprop="url" rel="index">
                    <span itemprop="name">é«˜å¯ç”¨</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/03/17/high-availability-system-design/" class="leancloud_visitors" data-flag-title="é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡æŒ‡å—">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  1.6k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  5 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ</h2><p>é«˜å¯ç”¨æè¿°çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿåœ¨å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯å¯ç”¨çš„ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æœåŠ¡çš„ã€‚é«˜å¯ç”¨ä»£è¡¨ç³»ç»Ÿå³ä½¿åœ¨å‘ç”Ÿç¡¬ä»¶æ•…éšœæˆ–è€…ç³»ç»Ÿå‡çº§çš„æ—¶å€™ï¼ŒæœåŠ¡ä»ç„¶æ˜¯å¯ç”¨çš„ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šå°‘ä¸ª 9 æ¥è¯„åˆ¤ä¸€ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚ 99.9999% å°±æ˜¯ä»£è¡¨è¯¥ç³»ç»Ÿåœ¨æ‰€æœ‰çš„è¿è¡Œæ—¶é—´ä¸­åªæœ‰ 0.0001% çš„æ—¶é—´æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™æ ·çš„ç³»ç»Ÿå°±æ˜¯éå¸¸éå¸¸é«˜å¯ç”¨çš„äº†ï¼å½“ç„¶ï¼Œä¹Ÿä¼šæœ‰ç³»ç»Ÿå¦‚æœå¯ç”¨æ€§ä¸å¤ªå¥½çš„è¯ï¼Œå¯èƒ½è¿ 9 éƒ½ä¸Šä¸äº†ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§è¿˜å¯ä»¥ç”¨æŸåŠŸèƒ½çš„å¤±è´¥æ¬¡æ•°ä¸æ€»çš„è¯·æ±‚æ¬¡æ•°ä¹‹æ¯”æ¥è¡¡é‡ï¼Œæ¯”å¦‚å¯¹ç½‘ç«™è¯·æ±‚ 1000 æ¬¡ï¼Œå…¶ä¸­æœ‰ 10 æ¬¡è¯·æ±‚å¤±è´¥ï¼Œé‚£ä¹ˆå¯ç”¨æ€§å°±æ˜¯ 99%ã€‚</p>
<h2 id="å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ"><a href="#å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ" class="headerlink" title="å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ"></a>å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ</h2><ol>
<li>é»‘å®¢æ”»å‡»ï¼›</li>
<li>ç¡¬ä»¶æ•…éšœï¼Œæ¯”å¦‚æœåŠ¡å™¨åæ‰ã€‚</li>
<li>å¹¶å‘é‡&#x2F;ç”¨æˆ·è¯·æ±‚é‡æ¿€å¢å¯¼è‡´æ•´ä¸ªæœåŠ¡å®•æ‰æˆ–è€…éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨ã€‚</li>
<li>ä»£ç ä¸­çš„åå‘³é“å¯¼è‡´å†…å­˜æ³„æ¼æˆ–è€…å…¶ä»–é—®é¢˜å¯¼è‡´ç¨‹åºæŒ‚æ‰ã€‚</li>
<li>ç½‘ç«™æ¶æ„æŸä¸ªé‡è¦çš„è§’è‰²æ¯”å¦‚ Nginx æˆ–è€…æ•°æ®åº“çªç„¶ä¸å¯ç”¨ã€‚</li>
<li>è‡ªç„¶ç¾å®³æˆ–è€…äººä¸ºç ´åã€‚</li>
<li>â€¦â€¦</li>
</ol>
<h2 id="æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ"><a href="#æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ"></a>æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ</h2><h3 id="æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³"><a href="#æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³" class="headerlink" title="æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³"></a>æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³</h3><p>æˆ‘è§‰å¾—è¿™ä¸ªæ˜¯æœ€æœ€æœ€é‡è¦çš„ï¼Œä»£ç è´¨é‡æœ‰é—®é¢˜æ¯”å¦‚æ¯”è¾ƒå¸¸è§çš„å†…å­˜æ³„æ¼ã€å¾ªç¯ä¾èµ–éƒ½æ˜¯å¯¹ç³»ç»Ÿå¯ç”¨æ€§æå¤§çš„æŸå®³ã€‚å¤§å®¶éƒ½å–œæ¬¢è°ˆé™æµã€é™çº§ã€ç†”æ–­ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä»ä»£ç è´¨é‡è¿™ä¸ªæºå¤´æŠŠå…³æ˜¯é¦–å…ˆè¦åšå¥½çš„ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…ã€‚å¦‚ä½•æé«˜ä»£ç è´¨é‡ï¼Ÿæ¯”è¾ƒå®é™…å¯ç”¨çš„å°±æ˜¯ CodeReviewï¼Œä¸è¦åœ¨ä¹æ¯å¤©å¤šèŠ±çš„é‚£ 1 ä¸ªå°æ—¶å·¦å³çš„æ—¶é—´ï¼Œä½œç”¨å¯å¤§ç€å‘¢ï¼</p>
<p>å¦å¤–ï¼Œå®‰åˆ©å‡ ä¸ªå¯¹æé«˜ä»£ç è´¨é‡æœ‰å®é™…æ•ˆæœçš„ç¥å™¨ï¼š</p>
<ul>
<li><a href="https://www.sonarqube.org/">Sonarqube</a>ï¼›</li>
<li>Alibaba å¼€æºçš„ Java è¯Šæ–­å·¥å…· <a href="https://arthas.aliyun.com/doc/">Arthas</a>ï¼›</li>
<li><a href="https://github.com/alibaba/p3c">é˜¿é‡Œå·´å·´ Java ä»£ç è§„èŒƒ</a>ï¼ˆAlibaba Java Code Guidelinesï¼‰ï¼›</li>
<li>IDEA è‡ªå¸¦çš„ä»£ç åˆ†æç­‰å·¥å…·ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ"><a href="#ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ" class="headerlink" title="ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ"></a>ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ</h3><p>å…ˆæ‹¿å¸¸ç”¨çš„ Redis ä¸¾ä¸ªä¾‹å­ï¼æˆ‘ä»¬å¦‚ä½•ä¿è¯æˆ‘ä»¬çš„ Redis ç¼“å­˜é«˜å¯ç”¨å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨é›†ç¾¤ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª Redis å®ä¾‹ä½œä¸ºç¼“å­˜çš„æ—¶å€™ï¼Œè¿™ä¸ª Redis å®ä¾‹æŒ‚äº†ä¹‹åï¼Œæ•´ä¸ªç¼“å­˜æœåŠ¡å¯èƒ½å°±æŒ‚äº†ã€‚ä½¿ç”¨äº†é›†ç¾¤ä¹‹åï¼Œå³ä½¿ä¸€å° Redis å®ä¾‹æŒ‚äº†ï¼Œä¸åˆ°ä¸€ç§’å°±ä¼šæœ‰å¦å¤–ä¸€å° Redis å®ä¾‹é¡¶ä¸Šã€‚</p>
<h3 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h3><p>æµé‡æ§åˆ¶ï¼ˆflow controlï¼‰ï¼Œå…¶åŸç†æ˜¯ç›‘æ§åº”ç”¨æµé‡çš„ QPS æˆ–å¹¶å‘çº¿ç¨‹æ•°ç­‰æŒ‡æ ‡ï¼Œå½“è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼æ—¶å¯¹æµé‡è¿›è¡Œæ§åˆ¶ï¼Œä»¥é¿å…è¢«ç¬æ—¶çš„æµé‡é«˜å³°å†²å®ï¼Œä»è€Œä¿éšœåº”ç”¨çš„é«˜å¯ç”¨æ€§ã€‚â€”â€”æ¥è‡ª <a href="https://github.com/alibaba/Sentinel" title="Sentinel">alibaba-Sentinel</a> çš„ wikiã€‚</p>
<h3 id="è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®"><a href="#è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®" class="headerlink" title="è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®"></a>è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®</h3><p>ä¸€æ—¦ç”¨æˆ·è¯·æ±‚è¶…è¿‡æŸä¸ªæ—¶é—´çš„å¾—ä¸åˆ°å“åº”ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„ï¼Œå¾ˆå¤šçº¿ä¸Šç³»ç»Ÿæ•…éšœéƒ½æ˜¯å› ä¸ºæ²¡æœ‰è¿›è¡Œè¶…æ—¶è®¾ç½®æˆ–è€…è¶…æ—¶è®¾ç½®çš„æ–¹å¼ä¸å¯¹å¯¼è‡´çš„ã€‚æˆ‘ä»¬åœ¨è¯»å–ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ—¶å€™ï¼Œå°¤å…¶é€‚åˆè®¾ç½®è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨ä¸€äº› RPC æ¡†æ¶çš„æ—¶å€™ï¼Œè¿™äº›æ¡†æ¶éƒ½è‡ªå¸¦çš„è¶…æ—¶é‡è¯•çš„é…ç½®ã€‚å¦‚æœä¸è¿›è¡Œè¶…æ—¶è®¾ç½®å¯èƒ½ä¼šå¯¼è‡´è¯·æ±‚å“åº”é€Ÿåº¦æ…¢ï¼Œç”šè‡³å¯¼è‡´è¯·æ±‚å †ç§¯è¿›è€Œè®©ç³»ç»Ÿæ— æ³•å†å¤„ç†è¯·æ±‚ã€‚é‡è¯•çš„æ¬¡æ•°ä¸€èˆ¬è®¾ä¸º 3 æ¬¡ï¼Œå†å¤šæ¬¡çš„é‡è¯•æ²¡æœ‰å¥½å¤„ï¼Œåè€Œä¼šåŠ é‡æœåŠ¡å™¨å‹åŠ›ï¼ˆéƒ¨åˆ†åœºæ™¯ä½¿ç”¨å¤±è´¥é‡è¯•æœºåˆ¶ä¼šä¸å¤ªé€‚åˆï¼‰ã€‚</p>
<h3 id="ç†”æ–­æœºåˆ¶"><a href="#ç†”æ–­æœºåˆ¶" class="headerlink" title="ç†”æ–­æœºåˆ¶"></a>ç†”æ–­æœºåˆ¶</h3><p>è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®ä¹‹å¤–ï¼Œç†”æ–­æœºåˆ¶ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚ ç†”æ–­æœºåˆ¶è¯´çš„æ˜¯ç³»ç»Ÿè‡ªåŠ¨æ”¶é›†æ‰€ä¾èµ–æœåŠ¡çš„èµ„æºä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå½“æ‰€ä¾èµ–çš„æœåŠ¡æ¶åŒ–æˆ–è€…è°ƒç”¨å¤±è´¥æ¬¡æ•°è¾¾åˆ°æŸä¸ªé˜ˆå€¼çš„æ—¶å€™å°±è¿…é€Ÿå¤±è´¥ï¼Œè®©å½“å‰ç³»ç»Ÿç«‹å³åˆ‡æ¢ä¾èµ–å…¶ä»–å¤‡ç”¨æœåŠ¡ã€‚ æ¯”è¾ƒå¸¸ç”¨çš„æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§æ¡†æ¶æ˜¯ Netflix çš„ Hystrix å’Œ alibaba çš„ Sentinelã€‚</p>
<h3 id="å¼‚æ­¥è°ƒç”¨"><a href="#å¼‚æ­¥è°ƒç”¨" class="headerlink" title="å¼‚æ­¥è°ƒç”¨"></a>å¼‚æ­¥è°ƒç”¨</h3><p>å¼‚æ­¥è°ƒç”¨çš„è¯æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒæœ€åçš„ç»“æœï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨æˆ·è¯·æ±‚å®Œæˆä¹‹åå°±ç«‹å³è¿”å›ç»“æœï¼Œå…·ä½“å¤„ç†æˆ‘ä»¬å¯ä»¥åç»­å†åšï¼Œç§’æ€åœºæ™¯ç”¨è¿™ä¸ªè¿˜æ˜¯è›®å¤šçš„ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å¼‚æ­¥ä¹‹åæˆ‘ä»¬å¯èƒ½éœ€è¦ <strong>é€‚å½“ä¿®æ”¹ä¸šåŠ¡æµç¨‹è¿›è¡Œé…åˆ</strong>ï¼Œæ¯”å¦‚<strong>ç”¨æˆ·åœ¨æäº¤è®¢å•ä¹‹åï¼Œä¸èƒ½ç«‹å³è¿”å›ç”¨æˆ·è®¢å•æäº¤æˆåŠŸï¼Œéœ€è¦åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„è®¢å•æ¶ˆè´¹è€…è¿›ç¨‹çœŸæ­£å¤„ç†å®Œè¯¥è®¢å•ä¹‹åï¼Œç”šè‡³å‡ºåº“åï¼Œå†é€šè¿‡ç”µå­é‚®ä»¶æˆ–çŸ­ä¿¡é€šçŸ¥ç”¨æˆ·è®¢å•æˆåŠŸ</strong>ã€‚é™¤äº†å¯ä»¥åœ¨ç¨‹åºä¸­å®ç°å¼‚æ­¥ä¹‹å¤–ï¼Œæˆ‘ä»¬å¸¸å¸¸è¿˜ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥é€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼ˆå‰Šå³°ã€å‡å°‘å“åº”æ‰€éœ€æ—¶é—´ï¼‰å¹¶ä¸”å¯ä»¥é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚</p>
<h3 id="ä½¿ç”¨ç¼“å­˜"><a href="#ä½¿ç”¨ç¼“å­˜" class="headerlink" title="ä½¿ç”¨ç¼“å­˜"></a>ä½¿ç”¨ç¼“å­˜</h3><p>å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿå±äºå¹¶å‘é‡æ¯”è¾ƒé«˜çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬å•çº¯ä½¿ç”¨æ•°æ®åº“çš„è¯ï¼Œå½“å¤§é‡è¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“å¯èƒ½æ•°æ®åº“å°±ä¼šç›´æ¥æŒ‚æ‰ã€‚ä½¿ç”¨ç¼“å­˜ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå› ä¸ºç¼“å­˜å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“åœ°å¿«ï¼</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul>
<li><strong>æ ¸å¿ƒåº”ç”¨å’ŒæœåŠ¡ä¼˜å…ˆä½¿ç”¨æ›´å¥½çš„ç¡¬ä»¶</strong></li>
<li><strong>ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µå¢åŠ æŠ¥è­¦è®¾ç½®ã€‚</strong></li>
<li><strong>æ³¨æ„å¤‡ä»½ï¼Œå¿…è¦æ—¶å€™å›æ»šã€‚</strong></li>
<li><strong>ç°åº¦å‘å¸ƒï¼š</strong> å°†æœåŠ¡å™¨é›†ç¾¤åˆ†æˆè‹¥å¹²éƒ¨åˆ†ï¼Œæ¯å¤©åªå‘å¸ƒä¸€éƒ¨åˆ†æœºå™¨ï¼Œè§‚å¯Ÿè¿è¡Œç¨³å®šæ²¡æœ‰æ•…éšœï¼Œç¬¬äºŒå¤©ç»§ç»­å‘å¸ƒä¸€éƒ¨åˆ†æœºå™¨ï¼ŒæŒç»­å‡ å¤©æ‰æŠŠæ•´ä¸ªé›†ç¾¤å…¨éƒ¨å‘å¸ƒå®Œæ¯•ï¼ŒæœŸé—´å¦‚æœå‘ç°é—®é¢˜ï¼Œåªéœ€è¦å›æ»šå·²å‘å¸ƒçš„ä¸€éƒ¨åˆ†æœåŠ¡å™¨å³å¯</li>
<li><strong>å®šæœŸæ£€æŸ¥&#x2F;æ›´æ¢ç¡¬ä»¶ï¼š</strong> å¦‚æœä¸æ˜¯è´­ä¹°çš„äº‘æœåŠ¡çš„è¯ï¼Œå®šæœŸè¿˜æ˜¯éœ€è¦å¯¹ç¡¬ä»¶è¿›è¡Œä¸€æ³¢æ£€æŸ¥çš„ï¼Œå¯¹äºä¸€äº›éœ€è¦æ›´æ¢æˆ–è€…å‡çº§çš„ç¡¬ä»¶ï¼Œè¦åŠæ—¶æ›´æ¢æˆ–è€…å‡çº§ã€‚</li>
<li>â€¦â€¦</li>
</ul>
<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/16/arraylist-source-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/16/arraylist-source-code/" itemprop="url">ArrayList æºç åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-16T22:11:32+08:00">
                2021-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E9%9B%86%E5%90%88/" itemprop="url" rel="index">
                    <span itemprop="name">é›†åˆ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/03/16/arraylist-source-code/" class="leancloud_visitors" data-flag-title="ArrayList æºç åˆ†æ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  7.1k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  30 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <!-- @include: @small-advertisement.snippet.md -->

<h2 id="ArrayList-ç®€ä»‹"><a href="#ArrayList-ç®€ä»‹" class="headerlink" title="ArrayList ç®€ä»‹"></a>ArrayList ç®€ä»‹</h2><p><code>ArrayList</code> çš„åº•å±‚æ˜¯æ•°ç»„é˜Ÿåˆ—ï¼Œç›¸å½“äºåŠ¨æ€æ•°ç»„ã€‚ä¸ Java ä¸­çš„æ•°ç»„ç›¸æ¯”ï¼Œå®ƒçš„å®¹é‡èƒ½åŠ¨æ€å¢é•¿ã€‚åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨<code>ensureCapacity</code>æ“ä½œæ¥å¢åŠ  <code>ArrayList</code> å®ä¾‹çš„å®¹é‡ã€‚è¿™å¯ä»¥å‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ã€‚</p>
<p><code>ArrayList</code> ç»§æ‰¿äº <code>AbstractList</code> ï¼Œå®ç°äº† <code>List</code>, <code>RandomAccess</code>, <code>Cloneable</code>, <code>java.io.Serializable</code> è¿™äº›æ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>List</code> : è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¸‹æ ‡è¿›è¡Œè®¿é—®ã€‚</li>
<li><code>RandomAccess</code> ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å¿—æ¥å£ï¼Œè¡¨æ˜å®ç°è¿™ä¸ªæ¥å£çš„ <code>List</code> é›†åˆæ˜¯æ”¯æŒ <strong>å¿«é€Ÿéšæœºè®¿é—®</strong> çš„ã€‚åœ¨ <code>ArrayList</code> ä¸­ï¼Œæˆ‘ä»¬å³å¯ä»¥é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡ï¼Œè¿™å°±æ˜¯å¿«é€Ÿéšæœºè®¿é—®ã€‚</li>
<li><code>Cloneable</code> ï¼šè¡¨æ˜å®ƒå…·æœ‰æ‹·è´èƒ½åŠ›ï¼Œå¯ä»¥è¿›è¡Œæ·±æ‹·è´æˆ–æµ…æ‹·è´æ“ä½œã€‚</li>
<li><code>Serializable</code> : è¡¨æ˜å®ƒå¯ä»¥è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµè¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨æˆ–ç½‘ç»œä¼ è¾“ï¼Œéå¸¸æ–¹ä¾¿ã€‚</li>
</ul>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/arraylist-class-diagram.png" alt="ArrayList ç±»å›¾"></p>
<h3 id="ArrayList-å’Œ-Vector-çš„åŒºåˆ«-ï¼ˆäº†è§£å³å¯ï¼‰"><a href="#ArrayList-å’Œ-Vector-çš„åŒºåˆ«-ï¼ˆäº†è§£å³å¯ï¼‰" class="headerlink" title="ArrayList å’Œ Vector çš„åŒºåˆ«?ï¼ˆäº†è§£å³å¯ï¼‰"></a>ArrayList å’Œ Vector çš„åŒºåˆ«?ï¼ˆäº†è§£å³å¯ï¼‰</h3><ul>
<li><code>ArrayList</code> æ˜¯ <code>List</code> çš„ä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ <code>Object[]</code>å­˜å‚¨ï¼Œé€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ ã€‚</li>
<li><code>Vector</code> æ˜¯ <code>List</code> çš„å¤è€å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨<code>Object[]</code> å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨ã€‚</li>
</ul>
<h3 id="ArrayList-å¯ä»¥æ·»åŠ -null-å€¼å—ï¼Ÿ"><a href="#ArrayList-å¯ä»¥æ·»åŠ -null-å€¼å—ï¼Ÿ" class="headerlink" title="ArrayList å¯ä»¥æ·»åŠ  null å€¼å—ï¼Ÿ"></a>ArrayList å¯ä»¥æ·»åŠ  null å€¼å—ï¼Ÿ</h3><p><code>ArrayList</code> ä¸­å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ <code>null</code> å€¼ã€‚ä¸è¿‡ï¼Œä¸å»ºè®®å‘<code>ArrayList</code> ä¸­æ·»åŠ  <code>null</code> å€¼ï¼Œ <code>null</code> å€¼æ— æ„ä¹‰ï¼Œä¼šè®©ä»£ç éš¾ä»¥ç»´æŠ¤æ¯”å¦‚å¿˜è®°åšåˆ¤ç©ºå¤„ç†å°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; listOfStrings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">listOfStrings.add(<span class="literal">null</span>);</span><br><span class="line">listOfStrings.add(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">System.out.println(listOfStrings);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[null, java]</span><br></pre></td></tr></table></figure>

<h3 id="Arraylist-ä¸-LinkedList-åŒºåˆ«"><a href="#Arraylist-ä¸-LinkedList-åŒºåˆ«" class="headerlink" title="Arraylist ä¸ LinkedList åŒºåˆ«?"></a>Arraylist ä¸ LinkedList åŒºåˆ«?</h3><ul>
<li><strong>æ˜¯å¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š</strong> <code>ArrayList</code> å’Œ <code>LinkedList</code> éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</li>
<li><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong> <code>ArrayList</code> åº•å±‚ä½¿ç”¨çš„æ˜¯ <strong><code>Object</code> æ•°ç»„</strong>ï¼›<code>LinkedList</code> åº•å±‚ä½¿ç”¨çš„æ˜¯ <strong>åŒå‘é“¾è¡¨</strong> æ•°æ®ç»“æ„ï¼ˆJDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7 å–æ¶ˆäº†å¾ªç¯ã€‚æ³¨æ„åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨çš„åŒºåˆ«ï¼Œä¸‹é¢æœ‰ä»‹ç»åˆ°ï¼ï¼‰</li>
<li><strong>æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š</strong><ul>
<li><code>ArrayList</code> é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®çš„å½±å“ã€‚ æ¯”å¦‚ï¼šæ‰§è¡Œ<code>add(E e)</code>æ–¹æ³•çš„æ—¶å€™ï¼Œ <code>ArrayList</code> ä¼šé»˜è®¤åœ¨å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ï¼Œè¿™ç§æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æŒ‡å®šä½ç½® i æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦å°±ä¸º O(n)ã€‚å› ä¸ºåœ¨è¿›è¡Œä¸Šè¿°æ“ä½œçš„æ—¶å€™é›†åˆä¸­ç¬¬ i å’Œç¬¬ i ä¸ªå…ƒç´ ä¹‹åçš„(n-i)ä¸ªå…ƒç´ éƒ½è¦æ‰§è¡Œå‘åä½&#x2F;å‘å‰ç§»ä¸€ä½çš„æ“ä½œã€‚</li>
<li><code>LinkedList</code> é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥åœ¨å¤´å°¾æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼ˆ<code>add(E e)</code>ã€<code>addFirst(E e)</code>ã€<code>addLast(E e)</code>ã€<code>removeFirst()</code>ã€ <code>removeLast()</code>ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå¦‚æœæ˜¯è¦åœ¨æŒ‡å®šä½ç½® <code>i</code> æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼Œ<code>remove(Object o)</code>,<code>remove(int index)</code>ï¼‰ï¼Œ æ—¶é—´å¤æ‚åº¦ä¸º O(n) ï¼Œå› ä¸ºéœ€è¦å…ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®å†æ’å…¥å’Œåˆ é™¤ã€‚</li>
</ul>
</li>
<li><strong>æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š</strong> <code>LinkedList</code> ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€Œ <code>ArrayList</code>ï¼ˆå®ç°äº† <code>RandomAccess</code> æ¥å£ï¼‰ æ”¯æŒã€‚å¿«é€Ÿéšæœºè®¿é—®å°±æ˜¯é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡(å¯¹åº”äº<code>get(int index)</code>æ–¹æ³•)ã€‚</li>
<li><strong>å†…å­˜ç©ºé—´å ç”¨ï¼š</strong> <code>ArrayList</code> çš„ç©ºé—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ LinkedList çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯” ArrayList æ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚</li>
</ul>
<h2 id="ArrayList-æ ¸å¿ƒæºç è§£è¯»"><a href="#ArrayList-æ ¸å¿ƒæºç è§£è¯»" class="headerlink" title="ArrayList æ ¸å¿ƒæºç è§£è¯»"></a>ArrayList æ ¸å¿ƒæºç è§£è¯»</h2><p>è¿™é‡Œä»¥ JDK1.8 ä¸ºä¾‹ï¼Œåˆ†æä¸€ä¸‹ <code>ArrayList</code> çš„åº•å±‚æºç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">8683452581122892189L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤åˆå§‹å®¹é‡å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç©ºæ•°ç»„ï¼ˆç”¨äºç©ºå®ä¾‹ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”¨äºé»˜è®¤å¤§å°ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚</span></span><br><span class="line">    <span class="comment">//æˆ‘ä»¬æŠŠå®ƒä»EMPTY_ELEMENTDATAæ•°ç»„ä¸­åŒºåˆ†å‡ºæ¥ï¼Œä»¥çŸ¥é“åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å®¹é‡éœ€è¦å¢åŠ å¤šå°‘ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜ArrayListæ•°æ®çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> Object[] elementData; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ArrayList æ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ï¼ˆç”¨æˆ·å¯ä»¥åœ¨åˆ›å»ºArrayListå¯¹è±¡æ—¶è‡ªå·±æŒ‡å®šé›†åˆçš„åˆå§‹å¤§å°ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(<span class="type">int</span> initialCapacity)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¼ å…¥çš„å‚æ•°å¤§äº0ï¼Œåˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„</span></span><br><span class="line">            <span class="built_in">this</span>.elementData = <span class="keyword">new</span> <span class="title class_">Object</span>[initialCapacity];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¼ å…¥çš„å‚æ•°ç­‰äº0ï¼Œåˆ›å»ºç©ºæ•°ç»„</span></span><br><span class="line">            <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å…¶ä»–æƒ…å†µï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Illegal Capacity: &quot;</span> +</span><br><span class="line">                    initialCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤æ— å‚æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     * DEFAULTCAPACITY_EMPTY_ELEMENTDATA ä¸º0.åˆå§‹åŒ–ä¸º10ï¼Œä¹Ÿå°±æ˜¯è¯´åˆå§‹å…¶å®æ˜¯ç©ºæ•°ç»„ å½“æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™æ•°ç»„å®¹é‡æ‰å˜æˆ10</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆçš„å…ƒç´ çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§å®ƒä»¬ç”±é›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†æŒ‡å®šé›†åˆè½¬æ¢ä¸ºæ•°ç»„</span></span><br><span class="line">        elementData = c.toArray();</span><br><span class="line">        <span class="comment">//å¦‚æœelementDataæ•°ç»„çš„é•¿åº¦ä¸ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœelementDataä¸æ˜¯Objectç±»å‹æ•°æ®ï¼ˆc.toArrayå¯èƒ½è¿”å›çš„ä¸æ˜¯Objectç±»å‹çš„æ•°ç»„æ‰€ä»¥åŠ ä¸Šä¸‹é¢çš„è¯­å¥ç”¨äºåˆ¤æ–­ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">                <span class="comment">//å°†åŸæ¥ä¸æ˜¯Objectç±»å‹çš„elementDataæ•°ç»„çš„å†…å®¹ï¼Œèµ‹å€¼ç»™æ–°çš„Objectç±»å‹çš„elementDataæ•°ç»„</span></span><br><span class="line">                elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å…¶ä»–æƒ…å†µï¼Œç”¨ç©ºæ•°ç»„ä»£æ›¿</span></span><br><span class="line">            <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹è¿™ä¸ªArrayListå®ä¾‹çš„å®¹é‡æ˜¯åˆ—è¡¨çš„å½“å‰å¤§å°ã€‚ åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ­¤æ“ä½œæ¥æœ€å°åŒ–ArrayListå®ä¾‹çš„å­˜å‚¨ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">trimToSize</span><span class="params">()</span> &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">if</span> (size &lt; elementData.length) &#123;</span><br><span class="line">            elementData = (size == <span class="number">0</span>)</span><br><span class="line">                    ? EMPTY_ELEMENTDATA</span><br><span class="line">                    : Arrays.copyOf(elementData, size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//ä¸‹é¢æ˜¯ArrayListçš„æ‰©å®¹æœºåˆ¶</span></span><br><span class="line"><span class="comment">//ArrayListçš„æ‰©å®¹æœºåˆ¶æé«˜äº†æ€§èƒ½ï¼Œå¦‚æœæ¯æ¬¡åªæ‰©å……ä¸€ä¸ªï¼Œ</span></span><br><span class="line"><span class="comment">//é‚£ä¹ˆé¢‘ç¹çš„æ’å…¥ä¼šå¯¼è‡´é¢‘ç¹çš„æ‹·è´ï¼Œé™ä½æ€§èƒ½ï¼Œè€ŒArrayListçš„æ‰©å®¹æœºåˆ¶é¿å…äº†è¿™ç§æƒ…å†µã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ArrayListå®ä¾‹çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘èƒ½å®¹çº³å…ƒç´ çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> minCapacity æ‰€éœ€çš„æœ€å°å®¹é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸æ˜¯é»˜è®¤ç©ºæ•°ç»„ï¼Œåˆ™minExpandçš„å€¼ä¸º0ï¼›</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯é»˜è®¤ç©ºæ•°ç»„ï¼Œåˆ™minExpandçš„å€¼ä¸º10</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">minExpand</span> <span class="operator">=</span> (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)</span><br><span class="line">                <span class="comment">// å¦‚æœä¸æ˜¯é»˜è®¤å…ƒç´ è¡¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»»æ„å¤§å°</span></span><br><span class="line">                ? <span class="number">0</span></span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯é»˜è®¤ç©ºæ•°ç»„ï¼Œå®ƒåº”è¯¥å·²ç»æ˜¯é»˜è®¤å¤§å°</span></span><br><span class="line">                : DEFAULT_CAPACITY;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæœ€å°å®¹é‡å¤§äºå·²æœ‰çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">        <span class="keyword">if</span> (minCapacity &gt; minExpand) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®éœ€è¦çš„æœ€å°å®¹é‡ï¼Œç¡®ä¿å®¹é‡è¶³å¤Ÿ</span></span><br><span class="line">            ensureExplicitCapacity(minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®ç»™å®šçš„æœ€å°å®¹é‡å’Œå½“å‰æ•°ç»„å…ƒç´ æ¥è®¡ç®—æ‰€éœ€å®¹é‡ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculateCapacity</span><span class="params">(Object[] elementData, <span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰æ•°ç»„å…ƒç´ ä¸ºç©ºæ•°ç»„ï¼ˆåˆå§‹æƒ…å†µï¼‰ï¼Œè¿”å›é»˜è®¤å®¹é‡å’Œæœ€å°å®¹é‡ä¸­çš„è¾ƒå¤§å€¼ä½œä¸ºæ‰€éœ€å®¹é‡</span></span><br><span class="line">        <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦åˆ™ç›´æ¥è¿”å›æœ€å°å®¹é‡</span></span><br><span class="line">        <span class="keyword">return</span> minCapacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿å†…éƒ¨å®¹é‡è¾¾åˆ°æŒ‡å®šçš„æœ€å°å®¹é‡ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacityInternal</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">        ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureExplicitCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº†</span></span><br><span class="line">            grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_ARRAY_SIZE</span> <span class="operator">=</span> Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">        <span class="comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">        <span class="comment">//å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span></span><br><span class="line">        <span class="comment">//æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ</span></span><br><span class="line">        <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        <span class="comment">//å†æ£€æŸ¥æ–°å®¹é‡æ˜¯å¦è¶…å‡ºäº†ArrayListæ‰€å®šä¹‰çš„æœ€å¤§å®¹é‡ï¼Œ</span></span><br><span class="line">        <span class="comment">//è‹¥è¶…å‡ºäº†ï¼Œåˆ™è°ƒç”¨hugeCapacity()æ¥æ¯”è¾ƒminCapacityå’Œ MAX_ARRAY_SIZEï¼Œ</span></span><br><span class="line">        <span class="comment">//å¦‚æœminCapacityå¤§äºMAX_ARRAY_SIZEï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸ºInteger.MAX_VALUEï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZEã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¯”è¾ƒminCapacityå’Œ MAX_ARRAY_SIZE</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hugeCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OutOfMemoryError</span>();</span><br><span class="line">        <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">                Integer.MAX_VALUE :</span><br><span class="line">                MAX_ARRAY_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­çš„å…ƒç´ æ•°ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å› true ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//æ³¨æ„=å’Œ==çš„åŒºåˆ«</span></span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ­¤åˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å›true ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="comment">//indexOf()æ–¹æ³•ï¼šè¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™ä¸º-1</span></span><br><span class="line">        <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™ä¸º-1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">                <span class="keyword">if</span> (elementData[i] == <span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">                <span class="comment">//equals()æ–¹æ³•æ¯”è¾ƒ</span></span><br><span class="line">                <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lastIndexOf</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">                <span class="keyword">if</span> (elementData[i] == <span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">                <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ­¤ArrayListå®ä¾‹çš„æµ…æ‹·è´ã€‚ ï¼ˆå…ƒç´ æœ¬èº«ä¸è¢«å¤åˆ¶ã€‚ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ArrayList&lt;?&gt; v = (ArrayList&lt;?&gt;) <span class="built_in">super</span>.clone();</span><br><span class="line">            <span class="comment">//Arrays.copyOfåŠŸèƒ½æ˜¯å®ç°æ•°ç»„çš„å¤åˆ¶ï¼Œè¿”å›å¤åˆ¶åçš„æ•°ç»„ã€‚å‚æ•°æ˜¯è¢«å¤åˆ¶çš„æ•°ç»„å’Œå¤åˆ¶çš„é•¿åº¦</span></span><br><span class="line">            v.elementData = Arrays.copyOf(elementData, size);</span><br><span class="line">            v.modCount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="comment">// è¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å¯ä»¥å…‹éš†çš„</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InternalError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»¥æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰è¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">     * è¿”å›çš„æ•°ç»„å°†æ˜¯â€œå®‰å…¨çš„â€ï¼Œå› ä¸ºè¯¥åˆ—è¡¨ä¸ä¿ç•™å¯¹å®ƒçš„å¼•ç”¨ã€‚</span></span><br><span class="line"><span class="comment">     * ï¼ˆæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å¿…é¡»åˆ†é…ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">     * å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥è‡ªç”±åœ°ä¿®æ”¹è¿”å›çš„æ•°ç»„ç»“æ„ã€‚</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ï¼šå¦‚æœå…ƒç´ æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¿®æ”¹å…ƒç´ çš„å†…å®¹ä¼šå½±å“åˆ°åŸåˆ—è¡¨ä¸­çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">     * æ­¤æ–¹æ³•å……å½“åŸºäºæ•°ç»„å’ŒåŸºäºé›†åˆçš„APIä¹‹é—´çš„æ¡¥æ¢ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOf(elementData, size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰;</span></span><br><span class="line"><span class="comment">     * è¿”å›çš„æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚ å¦‚æœåˆ—è¡¨é€‚åˆæŒ‡å®šçš„æ•°ç»„ï¼Œåˆ™è¿”å›å…¶ä¸­ã€‚</span></span><br><span class="line"><span class="comment">     * å¦åˆ™ï¼Œå°†ä¸ºæŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹å’Œæ­¤åˆ—è¡¨çš„å¤§å°åˆ†é…ä¸€ä¸ªæ–°æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœåˆ—è¡¨é€‚ç”¨äºæŒ‡å®šçš„æ•°ç»„ï¼Œå…¶ä½™ç©ºé—´ï¼ˆå³æ•°ç»„çš„åˆ—è¡¨æ•°é‡å¤šäºæ­¤å…ƒç´ ï¼‰ï¼Œåˆ™ç´§è·Ÿåœ¨é›†åˆç»“æŸåçš„æ•°ç»„ä¸­çš„å…ƒç´ è®¾ç½®ä¸ºnull ã€‚</span></span><br><span class="line"><span class="comment">     * ï¼ˆè¿™ä»…åœ¨è°ƒç”¨è€…çŸ¥é“åˆ—è¡¨ä¸åŒ…å«ä»»ä½•ç©ºå…ƒç´ çš„æƒ…å†µä¸‹æ‰èƒ½ç¡®å®šåˆ—è¡¨çš„é•¿åº¦ã€‚ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.length &lt; size)</span><br><span class="line">            <span class="comment">// æ–°å»ºä¸€ä¸ªè¿è¡Œæ—¶ç±»å‹çš„æ•°ç»„ï¼Œä½†æ˜¯ArrayListæ•°ç»„çš„å†…å®¹</span></span><br><span class="line">            <span class="keyword">return</span> (T[]) Arrays.copyOf(elementData, size, a.getClass());</span><br><span class="line">        <span class="comment">//è°ƒç”¨Systemæä¾›çš„arraycopy()æ–¹æ³•å®ç°æ•°ç»„ä¹‹é—´çš„å¤åˆ¶</span></span><br><span class="line">        System.arraycopy(elementData, <span class="number">0</span>, a, <span class="number">0</span>, size);</span><br><span class="line">        <span class="keyword">if</span> (a.length &gt; size)</span><br><span class="line">            a[size] = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Positional Access Operations</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    E <span class="title function_">elementData</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (E) elementData[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        rangeCheck(index);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> elementData(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        <span class="comment">//å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥</span></span><br><span class="line">        rangeCheck(index);</span><br><span class="line"></span><br><span class="line">        <span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> elementData(index);</span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        <span class="comment">//è¿”å›åŸæ¥åœ¨è¿™ä¸ªä½ç½®çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">        <span class="comment">//è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼</span></span><br><span class="line">        elementData[size++] = e;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * å…ˆè°ƒç”¨ rangeCheckForAdd å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥ï¼›ç„¶åè°ƒç”¨ ensureCapacityInternal æ–¹æ³•ä¿è¯capacityè¶³å¤Ÿå¤§ï¼›</span></span><br><span class="line"><span class="comment">     * å†å°†ä»indexå¼€å§‹ä¹‹åçš„æ‰€æœ‰æˆå‘˜åç§»ä¸€ä¸ªä½ç½®ï¼›å°†elementæ’å…¥indexä½ç½®ï¼›æœ€åsizeåŠ 1ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">        ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">        <span class="comment">//arraycopy()è¿™ä¸ªå®ç°æ•°ç»„ä¹‹é—´å¤åˆ¶çš„æ–¹æ³•ä¸€å®šè¦çœ‹ä¸€ä¸‹ï¼Œä¸‹é¢å°±ç”¨åˆ°äº†arraycopy()æ–¹æ³•å®ç°æ•°ç»„è‡ªå·±å¤åˆ¶è‡ªå·±</span></span><br><span class="line">        System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</span><br><span class="line">                size - index);</span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤è¯¥åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ å°†ä»»ä½•åç»­å…ƒç´ ç§»åŠ¨åˆ°å·¦ä¾§ï¼ˆä»å…¶ç´¢å¼•ä¸­å‡å»ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        rangeCheck(index);</span><br><span class="line"></span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> elementData(index);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">            System.arraycopy(elementData, index + <span class="number">1</span>, elementData, index,</span><br><span class="line">                    numMoved);</span><br><span class="line">        elementData[--size] = <span class="literal">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line">        <span class="comment">//ä»åˆ—è¡¨ä¸­åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªå‡ºç°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™å®ƒä¸ä¼šæ›´æ”¹ã€‚</span></span><br><span class="line"><span class="comment">     * è¿”å›trueï¼Œå¦‚æœæ­¤åˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">                <span class="keyword">if</span> (elementData[index] == <span class="literal">null</span>) &#123;</span><br><span class="line">                    fastRemove(index);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">                <span class="keyword">if</span> (o.equals(elementData[index])) &#123;</span><br><span class="line">                    fastRemove(index);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * è¯¥æ–¹æ³•ä¸ºç§æœ‰çš„ç§»é™¤æ–¹æ³•ï¼Œè·³è¿‡äº†è¾¹ç•Œæ£€æŸ¥ï¼Œå¹¶ä¸”ä¸è¿”å›è¢«ç§»é™¤çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fastRemove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">            System.arraycopy(elementData, index + <span class="number">1</span>, elementData, index,</span><br><span class="line">                    numMoved);</span><br><span class="line">        elementData[--size] = <span class="literal">null</span>; <span class="comment">// åœ¨ç§»é™¤å…ƒç´ åï¼Œå°†è¯¥ä½ç½®çš„å…ƒç´ è®¾ä¸º nullï¼Œä»¥ä¾¿åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰èƒ½å¤Ÿå›æ”¶è¯¥å…ƒç´ ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        modCount++;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŠŠæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ çš„å€¼è®¾ä¸ºnull</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            elementData[i] = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‰æŒ‡å®šé›†åˆçš„Iteratorè¿”å›çš„é¡ºåºå°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">numNew</span> <span class="operator">=</span> a.length;</span><br><span class="line">        ensureCapacityInternal(size + numNew);  <span class="comment">// Increments modCount</span></span><br><span class="line">        System.arraycopy(a, <span class="number">0</span>, elementData, size, numNew);</span><br><span class="line">        size += numNew;</span><br><span class="line">        <span class="keyword">return</span> numNew != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°æ­¤åˆ—è¡¨ä¸­ï¼Œä»æŒ‡å®šçš„ä½ç½®å¼€å§‹ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addAll</span><span class="params">(<span class="type">int</span> index, Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">numNew</span> <span class="operator">=</span> a.length;</span><br><span class="line">        ensureCapacityInternal(size + numNew);  <span class="comment">// Increments modCount</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index;</span><br><span class="line">        <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">            System.arraycopy(elementData, index, elementData, index + numNew,</span><br><span class="line">                    numMoved);</span><br><span class="line"></span><br><span class="line">        System.arraycopy(a, <span class="number">0</span>, elementData, index, numNew);</span><br><span class="line">        size += numNew;</span><br><span class="line">        <span class="keyword">return</span> numNew != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰ç´¢å¼•ä¸ºfromIndex ï¼ˆå«ï¼‰å’ŒtoIndexä¹‹é—´çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * å°†ä»»ä½•åç»­å…ƒç´ ç§»åŠ¨åˆ°å·¦ä¾§ï¼ˆå‡å°‘å…¶ç´¢å¼•ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">removeRange</span><span class="params">(<span class="type">int</span> fromIndex, <span class="type">int</span> toIndex)</span> &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - toIndex;</span><br><span class="line">        System.arraycopy(elementData, toIndex, elementData, fromIndex,</span><br><span class="line">                numMoved);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// clear to let GC do its work</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newSize</span> <span class="operator">=</span> size - (toIndex - fromIndex);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> newSize; i &lt; size; i++) &#123;</span><br><span class="line">            elementData[i] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size = newSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥ç»™å®šçš„ç´¢å¼•æ˜¯å¦åœ¨èŒƒå›´å†…ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rangeCheck</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * addå’ŒaddAllä½¿ç”¨çš„rangeCheckçš„ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rangeCheckForAdd</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt; size || index &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›IndexOutOfBoundsExceptionç»†èŠ‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">outOfBoundsMsg</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Index: &quot;</span> + index + <span class="string">&quot;, Size: &quot;</span> + size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šé›†åˆä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(c);</span><br><span class="line">        <span class="comment">//å¦‚æœæ­¤åˆ—è¡¨è¢«ä¿®æ”¹åˆ™è¿”å›true</span></span><br><span class="line">        <span class="keyword">return</span> batchRemove(c, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»…ä¿ç•™æ­¤åˆ—è¡¨ä¸­åŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * æ¢å¥è¯è¯´ï¼Œä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤å…¶ä¸­ä¸åŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(c);</span><br><span class="line">        <span class="keyword">return</span> batchRemove(c, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®å¼€å§‹ï¼Œè¿”å›åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼ˆæŒ‰æ­£ç¡®é¡ºåºï¼‰çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šçš„ç´¢å¼•è¡¨ç¤ºåˆå§‹è°ƒç”¨å°†è¿”å›çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºnext ã€‚ åˆå§‹è°ƒç”¨previouså°†è¿”å›æŒ‡å®šç´¢å¼•å‡1çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * è¿”å›çš„åˆ—è¡¨è¿­ä»£å™¨æ˜¯fail-fast ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title function_">listIterator</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;Index: &quot;</span> + index);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ListItr</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›åˆ—è¡¨ä¸­çš„åˆ—è¡¨è¿­ä»£å™¨ï¼ˆæŒ‰é€‚å½“çš„é¡ºåºï¼‰ã€‚</span></span><br><span class="line"><span class="comment">     * è¿”å›çš„åˆ—è¡¨è¿­ä»£å™¨æ˜¯fail-fast ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title function_">listIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ListItr</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›è¯¥åˆ—è¡¨ä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚</span></span><br><span class="line"><span class="comment">     * è¿”å›çš„è¿­ä»£å™¨æ˜¯fail-fast ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Itr</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="ArrayList-æ‰©å®¹æœºåˆ¶åˆ†æ"><a href="#ArrayList-æ‰©å®¹æœºåˆ¶åˆ†æ" class="headerlink" title="ArrayList æ‰©å®¹æœºåˆ¶åˆ†æ"></a>ArrayList æ‰©å®¹æœºåˆ¶åˆ†æ</h2><h3 id="å…ˆä»-ArrayList-çš„æ„é€ å‡½æ•°è¯´èµ·"><a href="#å…ˆä»-ArrayList-çš„æ„é€ å‡½æ•°è¯´èµ·" class="headerlink" title="å…ˆä» ArrayList çš„æ„é€ å‡½æ•°è¯´èµ·"></a>å…ˆä» ArrayList çš„æ„é€ å‡½æ•°è¯´èµ·</h3><p>ArrayList æœ‰ä¸‰ç§æ–¹å¼æ¥åˆå§‹åŒ–ï¼Œæ„é€ æ–¹æ³•æºç å¦‚ä¸‹ï¼ˆJDK8ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é»˜è®¤åˆå§‹å®¹é‡å¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½¿ç”¨åˆå§‹å®¹é‡10æ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨(æ— å‚æ•°æ„é€ )</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ï¼ˆç”¨æˆ·è‡ªå·±æŒ‡å®šå®¹é‡ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(<span class="type">int</span> initialCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;<span class="comment">//åˆå§‹å®¹é‡å¤§äº0</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = <span class="keyword">new</span> <span class="title class_">Object</span>[initialCapacity];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;<span class="comment">//åˆå§‹å®¹é‡ç­‰äº0</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºç©ºæ•°ç»„</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//åˆå§‹å®¹é‡å°äº0ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Illegal Capacity: &quot;</span> + initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ åˆ©ç”¨è¯¥é›†åˆçš„è¿­ä»£å™¨æŒ‰é¡ºåºè¿”å›</span></span><br><span class="line"><span class="comment"> *å¦‚æœæŒ‡å®šçš„é›†åˆä¸ºnullï¼Œthrows NullPointerExceptionã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">    elementData = c.toArray();</span><br><span class="line">    <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">        <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// replace with empty array.</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»†å¿ƒçš„åŒå­¦ä¸€å®šä¼šå‘ç°ï¼š<strong>ä»¥æ— å‚æ•°æ„é€ æ–¹æ³•åˆ›å»º <code>ArrayList</code> æ—¶ï¼Œå®é™…ä¸Šåˆå§‹åŒ–èµ‹å€¼çš„æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ã€‚å½“çœŸæ­£å¯¹æ•°ç»„è¿›è¡Œæ·»åŠ å…ƒç´ æ“ä½œæ—¶ï¼Œæ‰çœŸæ­£åˆ†é…å®¹é‡ã€‚å³å‘æ•°ç»„ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæ•°ç»„å®¹é‡æ‰©ä¸º 10ã€‚</strong> ä¸‹é¢åœ¨æˆ‘ä»¬åˆ†æ <code>ArrayList</code> æ‰©å®¹æ—¶ä¼šè®²åˆ°è¿™ä¸€ç‚¹å†…å®¹ï¼</p>
<blockquote>
<p>è¡¥å……ï¼šJDK6 new æ— å‚æ„é€ çš„ <code>ArrayList</code> å¯¹è±¡æ—¶ï¼Œç›´æ¥åˆ›å»ºäº†é•¿åº¦æ˜¯ 10 çš„ <code>Object[]</code> æ•°ç»„ <code>elementData</code> ã€‚</p>
</blockquote>
<h3 id="ä¸€æ­¥ä¸€æ­¥åˆ†æ-ArrayList-æ‰©å®¹æœºåˆ¶"><a href="#ä¸€æ­¥ä¸€æ­¥åˆ†æ-ArrayList-æ‰©å®¹æœºåˆ¶" class="headerlink" title="ä¸€æ­¥ä¸€æ­¥åˆ†æ ArrayList æ‰©å®¹æœºåˆ¶"></a>ä¸€æ­¥ä¸€æ­¥åˆ†æ ArrayList æ‰©å®¹æœºåˆ¶</h3><p>è¿™é‡Œä»¥æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„ <code>ArrayList</code> ä¸ºä¾‹åˆ†æã€‚</p>
<h4 id="add-æ–¹æ³•"><a href="#add-æ–¹æ³•" class="headerlink" title="add æ–¹æ³•"></a>add æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="comment">// åŠ å…ƒç´ ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ensureCapacityInternalæ–¹æ³•</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šJDK11 ç§»é™¤äº† <code>ensureCapacityInternal()</code> å’Œ <code>ensureExplicitCapacity()</code> æ–¹æ³•</p>
<p><code>ensureCapacityInternal</code> æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®ç»™å®šçš„æœ€å°å®¹é‡å’Œå½“å‰æ•°ç»„å…ƒç´ æ¥è®¡ç®—æ‰€éœ€å®¹é‡ã€‚</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculateCapacity</span><span class="params">(Object[] elementData, <span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æ•°ç»„å…ƒç´ ä¸ºç©ºæ•°ç»„ï¼ˆåˆå§‹æƒ…å†µï¼‰ï¼Œè¿”å›é»˜è®¤å®¹é‡å’Œæœ€å°å®¹é‡ä¸­çš„è¾ƒå¤§å€¼ä½œä¸ºæ‰€éœ€å®¹é‡</span></span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦åˆ™ç›´æ¥è¿”å›æœ€å°å®¹é‡</span></span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿å†…éƒ¨å®¹é‡è¾¾åˆ°æŒ‡å®šçš„æœ€å°å®¹é‡ã€‚</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacityInternal</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ensureCapacityInternal</code> æ–¹æ³•éå¸¸ç®€å•ï¼Œå†…éƒ¨ç›´æ¥è°ƒç”¨äº† <code>ensureExplicitCapacity</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureExplicitCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­å½“å‰æ•°ç»„å®¹é‡æ˜¯å¦è¶³ä»¥å­˜å‚¨minCapacityä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">//è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹</span></span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸€ä¸‹ï¼š</p>
<ul>
<li>å½“æˆ‘ä»¬è¦ <code>add</code> è¿›ç¬¬ 1 ä¸ªå…ƒç´ åˆ° <code>ArrayList</code> æ—¶ï¼Œ<code>elementData.length</code> ä¸º 0 ï¼ˆå› ä¸ºè¿˜æ˜¯ä¸€ä¸ªç©ºçš„ listï¼‰ï¼Œå› ä¸ºæ‰§è¡Œäº† <code>ensureCapacityInternal()</code> æ–¹æ³• ï¼Œæ‰€ä»¥ <code>minCapacity</code> æ­¤æ—¶ä¸º 10ã€‚æ­¤æ—¶ï¼Œ<code>minCapacity - elementData.length &gt; 0</code>æˆç«‹ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ <code>grow(minCapacity)</code> æ–¹æ³•ã€‚</li>
<li>å½“ <code>add</code> ç¬¬ 2 ä¸ªå…ƒç´ æ—¶ï¼Œ<code>minCapacity</code> ä¸º 2ï¼Œæ­¤æ—¶ <code>elementData.length</code>(å®¹é‡)åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ åæ‰©å®¹æˆ <code>10</code> äº†ã€‚æ­¤æ—¶ï¼Œ<code>minCapacity - elementData.length &gt; 0</code> ä¸æˆç«‹ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ ï¼ˆæ‰§è¡Œï¼‰<code>grow(minCapacity)</code> æ–¹æ³•ã€‚</li>
<li>æ·»åŠ ç¬¬ 3ã€4Â·Â·Â·åˆ°ç¬¬ 10 ä¸ªå…ƒç´ æ—¶ï¼Œä¾ç„¶ä¸ä¼šæ‰§è¡Œ grow æ–¹æ³•ï¼Œæ•°ç»„å®¹é‡éƒ½ä¸º 10ã€‚</li>
</ul>
<p>ç›´åˆ°æ·»åŠ ç¬¬ 11 ä¸ªå…ƒç´ ï¼Œ<code>minCapacity</code>(ä¸º 11)æ¯” <code>elementData.length</code>ï¼ˆä¸º 10ï¼‰è¦å¤§ã€‚è¿›å…¥ <code>grow</code> æ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚</p>
<h4 id="grow-æ–¹æ³•"><a href="#grow-æ–¹æ³•" class="headerlink" title="grow æ–¹æ³•"></a>grow æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_ARRAY_SIZE</span> <span class="operator">=</span> Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">    <span class="comment">// å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) `hugeCapacity()` æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œ</span></span><br><span class="line">    <span class="comment">// å¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º`Integer.MAX_VALUE`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º `Integer.MAX_VALUE - 8`ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1)</code>,æ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œå¦åˆ™æ˜¯ 1.5 å€å·¦å³ï¼‰ï¼</strong> å¥‡å¶ä¸åŒï¼Œæ¯”å¦‚ï¼š10+10&#x2F;2 &#x3D; 15, 33+33&#x2F;2&#x3D;49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°.</p>
<blockquote>
<p>â€œ&gt;&gt;â€ï¼ˆç§»ä½è¿ç®—ç¬¦ï¼‰ï¼š&gt;&gt;1 å³ç§»ä¸€ä½ç›¸å½“äºé™¤ 2ï¼Œå³ç§» n ä½ç›¸å½“äºé™¤ä»¥ 2 çš„ n æ¬¡æ–¹ã€‚è¿™é‡Œ oldCapacity æ˜æ˜¾å³ç§»äº† 1 ä½æ‰€ä»¥ç›¸å½“äº oldCapacity &#x2F;2ã€‚å¯¹äºå¤§æ•°æ®çš„ 2 è¿›åˆ¶è¿ç®—,ä½ç§»è¿ç®—ç¬¦æ¯”é‚£äº›æ™®é€šè¿ç®—ç¬¦çš„è¿ç®—è¦å¿«å¾ˆå¤š,å› ä¸ºç¨‹åºä»…ä»…ç§»åŠ¨ä¸€ä¸‹è€Œå·²,ä¸å»è®¡ç®—,è¿™æ ·æé«˜äº†æ•ˆç‡,èŠ‚çœäº†èµ„æº</p>
</blockquote>
<p><strong>æˆ‘ä»¬å†æ¥é€šè¿‡ä¾‹å­æ¢ç©¶ä¸€ä¸‹<code>grow()</code> æ–¹æ³•ï¼š</strong></p>
<ul>
<li>å½“ <code>add</code> ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼Œ<code>oldCapacity</code> ä¸º 0ï¼Œç»æ¯”è¾ƒåç¬¬ä¸€ä¸ª if åˆ¤æ–­æˆç«‹ï¼Œ<code>newCapacity = minCapacity</code>(ä¸º 10)ã€‚ä½†æ˜¯ç¬¬äºŒä¸ª if åˆ¤æ–­ä¸ä¼šæˆç«‹ï¼Œå³ <code>newCapacity</code> ä¸æ¯” <code>MAX_ARRAY_SIZE</code> å¤§ï¼Œåˆ™ä¸ä¼šè¿›å…¥ <code>hugeCapacity</code> æ–¹æ³•ã€‚æ•°ç»„å®¹é‡ä¸º 10ï¼Œ<code>add</code> æ–¹æ³•ä¸­ return true,size å¢ä¸º 1ã€‚</li>
<li>å½“ <code>add</code> ç¬¬ 11 ä¸ªå…ƒç´ è¿›å…¥ <code>grow</code> æ–¹æ³•æ—¶ï¼Œ<code>newCapacity</code> ä¸º 15ï¼Œæ¯” <code>minCapacity</code>ï¼ˆä¸º 11ï¼‰å¤§ï¼Œç¬¬ä¸€ä¸ª if åˆ¤æ–­ä¸æˆç«‹ã€‚æ–°å®¹é‡æ²¡æœ‰å¤§äºæ•°ç»„æœ€å¤§ sizeï¼Œä¸ä¼šè¿›å…¥ <code>hugeCapacity</code> æ–¹æ³•ã€‚æ•°ç»„å®¹é‡æ‰©ä¸º 15ï¼Œadd æ–¹æ³•ä¸­ return true,size å¢ä¸º 11ã€‚</li>
<li>ä»¥æ­¤ç±»æ¨Â·Â·Â·Â·Â·Â·</li>
</ul>
<p><strong>è¿™é‡Œè¡¥å……ä¸€ç‚¹æ¯”è¾ƒé‡è¦ï¼Œä½†æ˜¯å®¹æ˜“è¢«å¿½è§†æ‰çš„çŸ¥è¯†ç‚¹ï¼š</strong></p>
<ul>
<li>Java ä¸­çš„ <code>length</code>å±æ€§æ˜¯é’ˆå¯¹æ•°ç»„è¯´çš„,æ¯”å¦‚è¯´ä½ å£°æ˜äº†ä¸€ä¸ªæ•°ç»„,æƒ³çŸ¥é“è¿™ä¸ªæ•°ç»„çš„é•¿åº¦åˆ™ç”¨åˆ°äº† length è¿™ä¸ªå±æ€§.</li>
<li>Java ä¸­çš„ <code>length()</code> æ–¹æ³•æ˜¯é’ˆå¯¹å­—ç¬¦ä¸²è¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦åˆ™ç”¨åˆ° <code>length()</code> è¿™ä¸ªæ–¹æ³•.</li>
<li>Java ä¸­çš„ <code>size()</code> æ–¹æ³•æ˜¯é’ˆå¯¹æ³›å‹é›†åˆè¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªæ³›å‹æœ‰å¤šå°‘ä¸ªå…ƒç´ ,å°±è°ƒç”¨æ­¤æ–¹æ³•æ¥æŸ¥çœ‹!</li>
</ul>
<h4 id="hugeCapacity-æ–¹æ³•"><a href="#hugeCapacity-æ–¹æ³•" class="headerlink" title="hugeCapacity() æ–¹æ³•"></a>hugeCapacity() æ–¹æ³•</h4><p>ä»ä¸Šé¢ <code>grow()</code> æ–¹æ³•æºç æˆ‘ä»¬çŸ¥é“ï¼šå¦‚æœæ–°å®¹é‡å¤§äº <code>MAX_ARRAY_SIZE</code>,è¿›å…¥(æ‰§è¡Œ) <code>hugeCapacity()</code> æ–¹æ³•æ¥æ¯”è¾ƒ <code>minCapacity</code> å’Œ <code>MAX_ARRAY_SIZE</code>ï¼Œå¦‚æœ <code>minCapacity</code> å¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º <code>MAX_ARRAY_SIZE</code> å³ä¸º <code>Integer.MAX_VALUE - 8</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hugeCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OutOfMemoryError</span>();</span><br><span class="line">    <span class="comment">// å¯¹minCapacityå’ŒMAX_ARRAY_SIZEè¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">    <span class="comment">// è‹¥minCapacityå¤§ï¼Œå°†Integer.MAX_VALUEä½œä¸ºæ–°æ•°ç»„çš„å¤§å°</span></span><br><span class="line">    <span class="comment">// è‹¥MAX_ARRAY_SIZEå¤§ï¼Œå°†MAX_ARRAY_SIZEä½œä¸ºæ–°æ•°ç»„çš„å¤§å°</span></span><br><span class="line">    <span class="comment">// MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;</span></span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">        MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="System-arraycopy-å’Œ-Arrays-copyOf-æ–¹æ³•"><a href="#System-arraycopy-å’Œ-Arrays-copyOf-æ–¹æ³•" class="headerlink" title="System.arraycopy() å’Œ Arrays.copyOf()æ–¹æ³•"></a><code>System.arraycopy()</code> å’Œ <code>Arrays.copyOf()</code>æ–¹æ³•</h3><p>é˜…è¯»æºç çš„è¯ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç° <code>ArrayList</code> ä¸­å¤§é‡è°ƒç”¨äº†è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬ä¸Šé¢è®²çš„æ‰©å®¹æ“ä½œä»¥åŠ<code>add(int index, E element)</code>ã€<code>toArray()</code> ç­‰æ–¹æ³•ä¸­éƒ½ç”¨åˆ°äº†è¯¥æ–¹æ³•ï¼</p>
<h4 id="System-arraycopy-æ–¹æ³•"><a href="#System-arraycopy-æ–¹æ³•" class="headerlink" title="System.arraycopy() æ–¹æ³•"></a><code>System.arraycopy()</code> æ–¹æ³•</h4><p>æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬å‘ç° arraycopy æ˜¯ä¸€ä¸ª native æ–¹æ³•,æ¥ä¸‹æ¥æˆ‘ä»¬è§£é‡Šä¸€ä¸‹å„ä¸ªå‚æ•°çš„å…·ä½“æ„ä¹‰</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*   å¤åˆ¶æ•°ç»„</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> src æºæ•°ç»„</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> srcPos æºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> dest ç›®æ ‡æ•°ç»„</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> destPos ç›®æ ‡æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> length è¦å¤åˆ¶çš„æ•°ç»„å…ƒç´ çš„æ•°é‡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">arraycopy</span><span class="params">(Object src,  <span class="type">int</span>  srcPos,</span></span><br><span class="line"><span class="params">                                    Object dest, <span class="type">int</span> destPos,</span></span><br><span class="line"><span class="params">                                    <span class="type">int</span> length)</span>;</span><br></pre></td></tr></table></figure>

<p>åœºæ™¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment"> *å…ˆè°ƒç”¨ rangeCheckForAdd å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥ï¼›ç„¶åè°ƒç”¨ ensureCapacityInternal æ–¹æ³•ä¿è¯capacityè¶³å¤Ÿå¤§ï¼›</span></span><br><span class="line"><span class="comment"> *å†å°†ä»indexå¼€å§‹ä¹‹åçš„æ‰€æœ‰æˆå‘˜åç§»ä¸€ä¸ªä½ç½®ï¼›å°†elementæ’å…¥indexä½ç½®ï¼›æœ€åsizeåŠ 1ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    <span class="comment">//arraycopy()æ–¹æ³•å®ç°æ•°ç»„è‡ªå·±å¤åˆ¶è‡ªå·±</span></span><br><span class="line">    <span class="comment">//elementData:æºæ•°ç»„;index:æºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®;elementDataï¼šç›®æ ‡æ•°ç»„ï¼›index + 1ï¼šç›®æ ‡æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®ï¼› size - indexï¼šè¦å¤åˆ¶çš„æ•°ç»„å…ƒç´ çš„æ•°é‡ï¼›</span></span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>, size - index);</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„æ–¹æ³•æµ‹è¯•ä»¥ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArraycopyTest</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">    a[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    a[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    a[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">    a[<span class="number">3</span>] = <span class="number">3</span>;</span><br><span class="line">    System.arraycopy(a, <span class="number">2</span>, a, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">    a[<span class="number">2</span>]=<span class="number">99</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">      System.out.print(a[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1 99 2 3 0 0 0 0 0</span><br></pre></td></tr></table></figure>

<h4 id="Arrays-copyOf-æ–¹æ³•"><a href="#Arrays-copyOf-æ–¹æ³•" class="headerlink" title="Arrays.copyOf()æ–¹æ³•"></a><code>Arrays.copyOf()</code>æ–¹æ³•</h4><p>æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] copyOf(<span class="type">int</span>[] original, <span class="type">int</span> newLength) &#123;</span><br><span class="line">    <span class="comment">// ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°ç»„</span></span><br><span class="line">      <span class="type">int</span>[] copy = <span class="keyword">new</span> <span class="title class_">int</span>[newLength];</span><br><span class="line"><span class="comment">// è°ƒç”¨System.arraycopy,å°†æºæ•°ç»„ä¸­çš„æ•°æ®è¿›è¡Œæ‹·è´,å¹¶è¿”å›æ–°çš„æ•°ç»„</span></span><br><span class="line">      System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</span><br><span class="line">                       Math.min(original.length, newLength));</span><br><span class="line">      <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>åœºæ™¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰; è¿”å›çš„æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line"> <span class="comment">//elementDataï¼šè¦å¤åˆ¶çš„æ•°ç»„ï¼›sizeï¼šè¦å¤åˆ¶çš„é•¿åº¦</span></span><br><span class="line">     <span class="keyword">return</span> Arrays.copyOf(elementData, size);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ªäººè§‰å¾—ä½¿ç”¨ <code>Arrays.copyOf()</code>æ–¹æ³•ä¸»è¦æ˜¯ä¸ºäº†ç»™åŸæœ‰æ•°ç»„æ‰©å®¹ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayscopyOfTest</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">    a[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    a[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    a[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span>[] b = Arrays.copyOf(a, <span class="number">10</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;b.length&quot;</span>+b.length);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure>

<h4 id="ä¸¤è€…è”ç³»å’ŒåŒºåˆ«"><a href="#ä¸¤è€…è”ç³»å’ŒåŒºåˆ«" class="headerlink" title="ä¸¤è€…è”ç³»å’ŒåŒºåˆ«"></a>ä¸¤è€…è”ç³»å’ŒåŒºåˆ«</h4><p><strong>è”ç³»ï¼š</strong></p>
<p>çœ‹ä¸¤è€…æºä»£ç å¯ä»¥å‘ç° <code>copyOf()</code>å†…éƒ¨å®é™…è°ƒç”¨äº† <code>System.arraycopy()</code> æ–¹æ³•</p>
<p><strong>åŒºåˆ«ï¼š</strong></p>
<p><code>arraycopy()</code> éœ€è¦ç›®æ ‡æ•°ç»„ï¼Œå°†åŸæ•°ç»„æ‹·è´åˆ°ä½ è‡ªå·±å®šä¹‰çš„æ•°ç»„é‡Œæˆ–è€…åŸæ•°ç»„ï¼Œè€Œä¸”å¯ä»¥é€‰æ‹©æ‹·è´çš„èµ·ç‚¹å’Œé•¿åº¦ä»¥åŠæ”¾å…¥æ–°æ•°ç»„ä¸­çš„ä½ç½® <code>copyOf()</code> æ˜¯ç³»ç»Ÿè‡ªåŠ¨åœ¨å†…éƒ¨æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶è¿”å›è¯¥æ•°ç»„ã€‚</p>
<h3 id="ensureCapacityæ–¹æ³•"><a href="#ensureCapacityæ–¹æ³•" class="headerlink" title="ensureCapacityæ–¹æ³•"></a><code>ensureCapacity</code>æ–¹æ³•</h3><p><code>ArrayList</code> æºç ä¸­æœ‰ä¸€ä¸ª <code>ensureCapacity</code> æ–¹æ³•ä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°æ²¡æœ‰ï¼Œè¿™ä¸ªæ–¹æ³• <code>ArrayList</code> å†…éƒ¨æ²¡æœ‰è¢«è°ƒç”¨è¿‡ï¼Œæ‰€ä»¥å¾ˆæ˜¾ç„¶æ˜¯æä¾›ç»™ç”¨æˆ·è°ƒç”¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ ArrayList å®ä¾‹çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘å¯ä»¥å®¹çº³ç”±minimum capacityå‚æ•°æŒ‡å®šçš„å…ƒç´ æ•°ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   minCapacity   æ‰€éœ€çš„æœ€å°å®¹é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">minExpand</span> <span class="operator">=</span> (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)</span><br><span class="line">        <span class="comment">// any size if not default element table</span></span><br><span class="line">        ? <span class="number">0</span></span><br><span class="line">        <span class="comment">// larger than default for default empty table. It&#x27;s already</span></span><br><span class="line">        <span class="comment">// supposed to be at default size.</span></span><br><span class="line">        : DEFAULT_CAPACITY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; minExpand) &#123;</span><br><span class="line">        ensureExplicitCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç†è®ºä¸Šæ¥è¯´ï¼Œæœ€å¥½åœ¨å‘ <code>ArrayList</code> æ·»åŠ å¤§é‡å…ƒç´ ä¹‹å‰ç”¨ <code>ensureCapacity</code> æ–¹æ³•ï¼Œä»¥å‡å°‘å¢é‡é‡æ–°åˆ†é…çš„æ¬¡æ•°</p>
<p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç å®é™…æµ‹è¯•ä»¥ä¸‹è¿™ä¸ªæ–¹æ³•çš„æ•ˆæœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnsureCapacityTest</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> <span class="number">10000000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">      list.add(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;ä½¿ç”¨ensureCapacityæ–¹æ³•å‰ï¼š&quot;</span>+(endTime - startTime));</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ensureCapacityæ–¹æ³•å‰ï¼š2158</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnsureCapacityTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> <span class="number">10000000</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        list.ensureCapacity(N);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨ensureCapacityæ–¹æ³•åï¼š&quot;</span>+(endTime1 - startTime1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ensureCapacityæ–¹æ³•åï¼š1773</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿è¡Œç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå‘ <code>ArrayList</code> æ·»åŠ å¤§é‡å…ƒç´ ä¹‹å‰ä½¿ç”¨<code>ensureCapacity</code> æ–¹æ³•å¯ä»¥æå‡æ€§èƒ½ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ€§èƒ½å·®è·å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è€Œä¸”ï¼Œå®é™…é¡¹ç›®æ ¹æœ¬ä¹Ÿä¸å¯èƒ½å¾€ <code>ArrayList</code> é‡Œé¢æ·»åŠ è¿™ä¹ˆå¤šå…ƒç´ ã€‚</p>
<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/10/java-collection-questions-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/10/java-collection-questions-01/" itemprop="url">Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-10T21:58:37+08:00">
                2021-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E9%9B%86%E5%90%88/" itemprop="url" rel="index">
                    <span itemprop="name">é›†åˆ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/03/10/java-collection-questions-01/" class="leancloud_visitors" data-flag-title="Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  7.4k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  28 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <!-- @include: @small-advertisement.snippet.md -->

<!-- markdownlint-disable MD024 -->

<h2 id="é›†åˆæ¦‚è¿°"><a href="#é›†åˆæ¦‚è¿°" class="headerlink" title="é›†åˆæ¦‚è¿°"></a>é›†åˆæ¦‚è¿°</h2><h3 id="Java-é›†åˆæ¦‚è§ˆ"><a href="#Java-é›†åˆæ¦‚è§ˆ" class="headerlink" title="Java é›†åˆæ¦‚è§ˆ"></a>Java é›†åˆæ¦‚è§ˆ</h3><p>Java é›†åˆï¼Œä¹Ÿå«ä½œå®¹å™¨ï¼Œä¸»è¦æ˜¯ç”±ä¸¤å¤§æ¥å£æ´¾ç”Ÿè€Œæ¥ï¼šä¸€ä¸ªæ˜¯ <code>Collection</code>æ¥å£ï¼Œä¸»è¦ç”¨äºå­˜æ”¾å•ä¸€å…ƒç´ ï¼›å¦ä¸€ä¸ªæ˜¯ <code>Map</code> æ¥å£ï¼Œä¸»è¦ç”¨äºå­˜æ”¾é”®å€¼å¯¹ã€‚å¯¹äº<code>Collection</code> æ¥å£ï¼Œä¸‹é¢åˆæœ‰ä¸‰ä¸ªä¸»è¦çš„å­æ¥å£ï¼š<code>List</code>ã€<code>Set</code> ã€ <code>Queue</code>ã€‚</p>
<p>Java é›†åˆæ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/java-collection-hierarchy.png" alt="Java é›†åˆæ¡†æ¶æ¦‚è§ˆ"></p>
<p>æ³¨ï¼šå›¾ä¸­åªåˆ—ä¸¾äº†ä¸»è¦çš„ç»§æ‰¿æ´¾ç”Ÿå…³ç³»ï¼Œå¹¶æ²¡æœ‰åˆ—ä¸¾æ‰€æœ‰å…³ç³»ã€‚æ¯”æ–¹çœç•¥äº†<code>AbstractList</code>, <code>NavigableSet</code>ç­‰æŠ½è±¡ç±»ä»¥åŠå…¶ä»–çš„ä¸€äº›è¾…åŠ©ç±»ï¼Œå¦‚æƒ³æ·±å…¥äº†è§£ï¼Œå¯è‡ªè¡ŒæŸ¥çœ‹æºç ã€‚</p>
<h3 id="è¯´è¯´-List-Set-Queue-Map-å››è€…çš„åŒºåˆ«ï¼Ÿ"><a href="#è¯´è¯´-List-Set-Queue-Map-å››è€…çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="è¯´è¯´ List, Set, Queue, Map å››è€…çš„åŒºåˆ«ï¼Ÿ"></a>è¯´è¯´ List, Set, Queue, Map å››è€…çš„åŒºåˆ«ï¼Ÿ</h3><ul>
<li><code>List</code>(å¯¹ä»˜é¡ºåºçš„å¥½å¸®æ‰‹): å­˜å‚¨çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€å¯é‡å¤çš„ã€‚</li>
<li><code>Set</code>(æ³¨é‡ç‹¬ä¸€æ— äºŒçš„æ€§è´¨): å­˜å‚¨çš„å…ƒç´ ä¸å¯é‡å¤çš„ã€‚</li>
<li><code>Queue</code>(å®ç°æ’é˜ŸåŠŸèƒ½çš„å«å·æœº): æŒ‰ç‰¹å®šçš„æ’é˜Ÿè§„åˆ™æ¥ç¡®å®šå…ˆåé¡ºåºï¼Œå­˜å‚¨çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€å¯é‡å¤çš„ã€‚</li>
<li><code>Map</code>(ç”¨ key æ¥æœç´¢çš„ä¸“å®¶): ä½¿ç”¨é”®å€¼å¯¹ï¼ˆkey-valueï¼‰å­˜å‚¨ï¼Œç±»ä¼¼äºæ•°å­¦ä¸Šçš„å‡½æ•° y&#x3D;f(x)ï¼Œâ€xâ€ ä»£è¡¨ keyï¼Œâ€yâ€ ä»£è¡¨ valueï¼Œkey æ˜¯æ— åºçš„ã€ä¸å¯é‡å¤çš„ï¼Œvalue æ˜¯æ— åºçš„ã€å¯é‡å¤çš„ï¼Œæ¯ä¸ªé”®æœ€å¤šæ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚</li>
</ul>
<h3 id="é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“"><a href="#é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“" class="headerlink" title="é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“"></a>é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“</h3><p>å…ˆæ¥çœ‹ä¸€ä¸‹ <code>Collection</code> æ¥å£ä¸‹é¢çš„é›†åˆã€‚</p>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><ul>
<li><code>ArrayList</code>ï¼š<code>Object[]</code> æ•°ç»„ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹ï¼š<a href="./arraylist-source-code.md">ArrayList æºç åˆ†æ</a>ã€‚</li>
<li><code>Vector</code>ï¼š<code>Object[]</code> æ•°ç»„ã€‚</li>
<li><code>LinkedList</code>ï¼šåŒå‘é“¾è¡¨(JDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7 å–æ¶ˆäº†å¾ªç¯)ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹ï¼š<a href="./linkedlist-source-code.md">LinkedList æºç åˆ†æ</a>ã€‚</li>
</ul>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><ul>
<li><code>HashSet</code>(æ— åºï¼Œå”¯ä¸€): åŸºäº <code>HashMap</code> å®ç°çš„ï¼Œåº•å±‚é‡‡ç”¨ <code>HashMap</code> æ¥ä¿å­˜å…ƒç´ ã€‚</li>
<li><code>LinkedHashSet</code>: <code>LinkedHashSet</code> æ˜¯ <code>HashSet</code> çš„å­ç±»ï¼Œå¹¶ä¸”å…¶å†…éƒ¨æ˜¯é€šè¿‡ <code>LinkedHashMap</code> æ¥å®ç°çš„ã€‚</li>
<li><code>TreeSet</code>(æœ‰åºï¼Œå”¯ä¸€): çº¢é»‘æ ‘(è‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘)ã€‚</li>
</ul>
<h4 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h4><ul>
<li><code>PriorityQueue</code>: <code>Object[]</code> æ•°ç»„æ¥å®ç°å°é¡¶å †ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹ï¼š<a href="./priorityqueue-source-code.md">PriorityQueue æºç åˆ†æ</a>ã€‚</li>
<li><code>DelayQueue</code>:<code>PriorityQueue</code>ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹ï¼š<a href="./delayqueue-source-code.md">DelayQueue æºç åˆ†æ</a>ã€‚</li>
<li><code>ArrayDeque</code>: å¯æ‰©å®¹åŠ¨æ€åŒå‘æ•°ç»„ã€‚</li>
</ul>
<p>å†æ¥çœ‹çœ‹ <code>Map</code> æ¥å£ä¸‹é¢çš„é›†åˆã€‚</p>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><ul>
<li><code>HashMap</code>ï¼šJDK1.8 ä¹‹å‰ <code>HashMap</code> ç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ <code>HashMap</code> çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰ã€‚JDK1.8 ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹ï¼š<a href="./hashmap-source-code.md">HashMap æºç åˆ†æ</a>ã€‚</li>
<li><code>LinkedHashMap</code>ï¼š<code>LinkedHashMap</code> ç»§æ‰¿è‡ª <code>HashMap</code>ï¼Œæ‰€ä»¥å®ƒçš„åº•å±‚ä»ç„¶æ˜¯åŸºäºæ‹‰é“¾å¼æ•£åˆ—ç»“æ„å³ç”±æ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘ç»„æˆã€‚å¦å¤–ï¼Œ<code>LinkedHashMap</code> åœ¨ä¸Šé¢ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—ä¸Šé¢çš„ç»“æ„å¯ä»¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚åŒæ—¶é€šè¿‡å¯¹é“¾è¡¨è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå®ç°äº†è®¿é—®é¡ºåºç›¸å…³é€»è¾‘ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹ï¼š<a href="./linkedhashmap-source-code.md">LinkedHashMap æºç åˆ†æ</a></li>
<li><code>Hashtable</code>ï¼šæ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ <code>Hashtable</code> çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ã€‚</li>
<li><code>TreeMap</code>ï¼šçº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰ã€‚</li>
</ul>
<h3 id="å¦‚ä½•é€‰ç”¨é›†åˆ"><a href="#å¦‚ä½•é€‰ç”¨é›†åˆ" class="headerlink" title="å¦‚ä½•é€‰ç”¨é›†åˆ?"></a>å¦‚ä½•é€‰ç”¨é›†åˆ?</h3><p>æˆ‘ä»¬ä¸»è¦æ ¹æ®é›†åˆçš„ç‰¹ç‚¹æ¥é€‰æ‹©åˆé€‚çš„é›†åˆã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>æˆ‘ä»¬éœ€è¦æ ¹æ®é”®å€¼è·å–åˆ°å…ƒç´ å€¼æ—¶å°±é€‰ç”¨ <code>Map</code> æ¥å£ä¸‹çš„é›†åˆï¼Œéœ€è¦æ’åºæ—¶é€‰æ‹© <code>TreeMap</code>,ä¸éœ€è¦æ’åºæ—¶å°±é€‰æ‹© <code>HashMap</code>,éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨å°±é€‰ç”¨ <code>ConcurrentHashMap</code>ã€‚</li>
<li>æˆ‘ä»¬åªéœ€è¦å­˜æ”¾å…ƒç´ å€¼æ—¶ï¼Œå°±é€‰æ‹©å®ç°<code>Collection</code> æ¥å£çš„é›†åˆï¼Œéœ€è¦ä¿è¯å…ƒç´ å”¯ä¸€æ—¶é€‰æ‹©å®ç° <code>Set</code> æ¥å£çš„é›†åˆæ¯”å¦‚ <code>TreeSet</code> æˆ– <code>HashSet</code>ï¼Œä¸éœ€è¦å°±é€‰æ‹©å®ç° <code>List</code> æ¥å£çš„æ¯”å¦‚ <code>ArrayList</code> æˆ– <code>LinkedList</code>ï¼Œç„¶åå†æ ¹æ®å®ç°è¿™äº›æ¥å£çš„é›†åˆçš„ç‰¹ç‚¹æ¥é€‰ç”¨ã€‚</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆï¼Ÿ</h3><p>å½“æˆ‘ä»¬éœ€è¦å­˜å‚¨ä¸€ç»„ç±»å‹ç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ•°ç»„æ˜¯æœ€å¸¸ç”¨ä¸”æœ€åŸºæœ¬çš„å®¹å™¨ä¹‹ä¸€ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨æ•°ç»„å­˜å‚¨å¯¹è±¡å­˜åœ¨ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œå› ä¸ºåœ¨å®é™…å¼€å‘ä¸­ï¼Œå­˜å‚¨çš„æ•°æ®ç±»å‹å¤šç§å¤šæ ·ä¸”æ•°é‡ä¸ç¡®å®šã€‚è¿™æ—¶ï¼ŒJava é›†åˆå°±æ´¾ä¸Šç”¨åœºäº†ã€‚ä¸æ•°ç»„ç›¸æ¯”ï¼ŒJava é›†åˆæä¾›äº†æ›´çµæ´»ã€æ›´æœ‰æ•ˆçš„æ–¹æ³•æ¥å­˜å‚¨å¤šä¸ªæ•°æ®å¯¹è±¡ã€‚Java é›†åˆæ¡†æ¶ä¸­çš„å„ç§é›†åˆç±»å’Œæ¥å£å¯ä»¥å­˜å‚¨ä¸åŒç±»å‹å’Œæ•°é‡çš„å¯¹è±¡ï¼ŒåŒæ—¶è¿˜å…·æœ‰å¤šæ ·åŒ–çš„æ“ä½œæ–¹å¼ã€‚ç›¸è¾ƒäºæ•°ç»„ï¼ŒJava é›†åˆçš„ä¼˜åŠ¿åœ¨äºå®ƒä»¬çš„å¤§å°å¯å˜ã€æ”¯æŒæ³›å‹ã€å…·æœ‰å†…å»ºç®—æ³•ç­‰ã€‚æ€»çš„æ¥è¯´ï¼ŒJava é›†åˆæé«˜äº†æ•°æ®çš„å­˜å‚¨å’Œå¤„ç†çµæ´»æ€§ï¼Œå¯ä»¥æ›´å¥½åœ°é€‚åº”ç°ä»£è½¯ä»¶å¼€å‘ä¸­å¤šæ ·åŒ–çš„æ•°æ®éœ€æ±‚ï¼Œå¹¶æ”¯æŒé«˜è´¨é‡çš„ä»£ç ç¼–å†™ã€‚</p>
<h2 id="List-1"><a href="#List-1" class="headerlink" title="List"></a>List</h2><h3 id="ArrayList-å’Œ-Arrayï¼ˆæ•°ç»„ï¼‰çš„åŒºåˆ«ï¼Ÿ"><a href="#ArrayList-å’Œ-Arrayï¼ˆæ•°ç»„ï¼‰çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="ArrayList å’Œ Arrayï¼ˆæ•°ç»„ï¼‰çš„åŒºåˆ«ï¼Ÿ"></a>ArrayList å’Œ Arrayï¼ˆæ•°ç»„ï¼‰çš„åŒºåˆ«ï¼Ÿ</h3><p><code>ArrayList</code> å†…éƒ¨åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œæ¯” <code>Array</code>ï¼ˆé™æ€æ•°ç»„ï¼‰ ä½¿ç”¨èµ·æ¥æ›´åŠ çµæ´»ï¼š</p>
<ul>
<li><code>ArrayList</code>ä¼šæ ¹æ®å®é™…å­˜å‚¨çš„å…ƒç´ åŠ¨æ€åœ°æ‰©å®¹æˆ–ç¼©å®¹ï¼Œè€Œ <code>Array</code> è¢«åˆ›å»ºä¹‹åå°±ä¸èƒ½æ”¹å˜å®ƒçš„é•¿åº¦äº†ã€‚</li>
<li><code>ArrayList</code> å…è®¸ä½ ä½¿ç”¨æ³›å‹æ¥ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œ<code>Array</code> åˆ™ä¸å¯ä»¥ã€‚</li>
<li><code>ArrayList</code> ä¸­åªèƒ½å­˜å‚¨å¯¹è±¡ã€‚å¯¹äºåŸºæœ¬ç±»å‹æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨å…¶å¯¹åº”çš„åŒ…è£…ç±»ï¼ˆå¦‚ Integerã€Double ç­‰ï¼‰ã€‚<code>Array</code> å¯ä»¥ç›´æ¥å­˜å‚¨åŸºæœ¬ç±»å‹æ•°æ®ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨å¯¹è±¡ã€‚</li>
<li><code>ArrayList</code> æ”¯æŒæ’å…¥ã€åˆ é™¤ã€éå†ç­‰å¸¸è§æ“ä½œï¼Œå¹¶ä¸”æä¾›äº†ä¸°å¯Œçš„ API æ“ä½œæ–¹æ³•ï¼Œæ¯”å¦‚ <code>add()</code>ã€<code>remove()</code>ç­‰ã€‚<code>Array</code> åªæ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œåªèƒ½æŒ‰ç…§ä¸‹æ ‡è®¿é—®å…¶ä¸­çš„å…ƒç´ ï¼Œä¸å…·å¤‡åŠ¨æ€æ·»åŠ ã€åˆ é™¤å…ƒç´ çš„èƒ½åŠ›ã€‚</li>
<li><code>ArrayList</code>åˆ›å»ºæ—¶ä¸éœ€è¦æŒ‡å®šå¤§å°ï¼Œè€Œ<code>Array</code>åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯äºŒè€…ä½¿ç”¨çš„ç®€å•å¯¹æ¯”ï¼š</p>
<p><code>Array</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸€ä¸ª String ç±»å‹çš„æ•°ç»„</span></span><br><span class="line">String[] stringArr = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;!&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// ä¿®æ”¹æ•°ç»„å…ƒç´ çš„å€¼</span></span><br><span class="line">stringArr[<span class="number">0</span>] = <span class="string">&quot;goodbye&quot;</span>;</span><br><span class="line">System.out.println(Arrays.toString(stringArr));<span class="comment">// [goodbye, world, !]</span></span><br><span class="line"><span class="comment">// åˆ é™¤æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œéœ€è¦æ‰‹åŠ¨ç§»åŠ¨åé¢çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; stringArr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    stringArr[i] = stringArr[i + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">stringArr[stringArr.length - <span class="number">1</span>] = <span class="literal">null</span>;</span><br><span class="line">System.out.println(Arrays.toString(stringArr));<span class="comment">// [world, !, null]</span></span><br></pre></td></tr></table></figure>

<p><code>ArrayList</code> ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸€ä¸ª String ç±»å‹çš„ ArrayList</span></span><br><span class="line"> ArrayList&lt;String&gt; stringList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;!&quot;</span>));</span><br><span class="line"><span class="comment">// æ·»åŠ å…ƒç´ åˆ° ArrayList ä¸­</span></span><br><span class="line"> stringList.add(<span class="string">&quot;goodbye&quot;</span>);</span><br><span class="line"> System.out.println(stringList);<span class="comment">// [hello, world, !, goodbye]</span></span><br><span class="line"> <span class="comment">// ä¿®æ”¹ ArrayList ä¸­çš„å…ƒç´ </span></span><br><span class="line"> stringList.set(<span class="number">0</span>, <span class="string">&quot;hi&quot;</span>);</span><br><span class="line"> System.out.println(stringList);<span class="comment">// [hi, world, !, goodbye]</span></span><br><span class="line"> <span class="comment">// åˆ é™¤ ArrayList ä¸­çš„å…ƒç´ </span></span><br><span class="line"> stringList.remove(<span class="number">0</span>);</span><br><span class="line"> System.out.println(stringList); <span class="comment">// [world, !, goodbye]</span></span><br></pre></td></tr></table></figure>

<h3 id="ArrayList-å’Œ-Vector-çš„åŒºåˆ«-ï¼ˆäº†è§£å³å¯ï¼‰"><a href="#ArrayList-å’Œ-Vector-çš„åŒºåˆ«-ï¼ˆäº†è§£å³å¯ï¼‰" class="headerlink" title="ArrayList å’Œ Vector çš„åŒºåˆ«?ï¼ˆäº†è§£å³å¯ï¼‰"></a>ArrayList å’Œ Vector çš„åŒºåˆ«?ï¼ˆäº†è§£å³å¯ï¼‰</h3><ul>
<li><code>ArrayList</code> æ˜¯ <code>List</code> çš„ä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ <code>Object[]</code>å­˜å‚¨ï¼Œé€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ ã€‚</li>
<li><code>Vector</code> æ˜¯ <code>List</code> çš„å¤è€å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨<code>Object[]</code> å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨ã€‚</li>
</ul>
<h3 id="Vector-å’Œ-Stack-çš„åŒºåˆ«-ï¼ˆäº†è§£å³å¯ï¼‰"><a href="#Vector-å’Œ-Stack-çš„åŒºåˆ«-ï¼ˆäº†è§£å³å¯ï¼‰" class="headerlink" title="Vector å’Œ Stack çš„åŒºåˆ«?ï¼ˆäº†è§£å³å¯ï¼‰"></a>Vector å’Œ Stack çš„åŒºåˆ«?ï¼ˆäº†è§£å³å¯ï¼‰</h3><ul>
<li><code>Vector</code> å’Œ <code>Stack</code> ä¸¤è€…éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéƒ½æ˜¯ä½¿ç”¨ <code>synchronized</code> å…³é”®å­—è¿›è¡ŒåŒæ­¥å¤„ç†ã€‚</li>
<li><code>Stack</code> ç»§æ‰¿è‡ª <code>Vector</code>ï¼Œæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºçš„æ ˆï¼Œè€Œ <code>Vector</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</li>
</ul>
<p>éšç€ Java å¹¶å‘ç¼–ç¨‹çš„å‘å±•ï¼Œ<code>Vector</code> å’Œ <code>Stack</code> å·²ç»è¢«æ·˜æ±°ï¼Œæ¨èä½¿ç”¨å¹¶å‘é›†åˆç±»ï¼ˆä¾‹å¦‚ <code>ConcurrentHashMap</code>ã€<code>CopyOnWriteArrayList</code> ç­‰ï¼‰æˆ–è€…æ‰‹åŠ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•æ¥æä¾›å®‰å…¨çš„å¤šçº¿ç¨‹æ“ä½œæ”¯æŒã€‚</p>
<h3 id="ArrayList-å¯ä»¥æ·»åŠ -null-å€¼å—ï¼Ÿ"><a href="#ArrayList-å¯ä»¥æ·»åŠ -null-å€¼å—ï¼Ÿ" class="headerlink" title="ArrayList å¯ä»¥æ·»åŠ  null å€¼å—ï¼Ÿ"></a>ArrayList å¯ä»¥æ·»åŠ  null å€¼å—ï¼Ÿ</h3><p><code>ArrayList</code> ä¸­å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ <code>null</code> å€¼ã€‚ä¸è¿‡ï¼Œä¸å»ºè®®å‘<code>ArrayList</code> ä¸­æ·»åŠ  <code>null</code> å€¼ï¼Œ <code>null</code> å€¼æ— æ„ä¹‰ï¼Œä¼šè®©ä»£ç éš¾ä»¥ç»´æŠ¤æ¯”å¦‚å¿˜è®°åšåˆ¤ç©ºå¤„ç†å°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; listOfStrings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">listOfStrings.add(<span class="literal">null</span>);</span><br><span class="line">listOfStrings.add(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">System.out.println(listOfStrings);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[null, java]</span><br></pre></td></tr></table></figure>

<h3 id="ArrayList-æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ"><a href="#ArrayList-æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ" class="headerlink" title="ArrayList æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ"></a>ArrayList æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ</h3><p>å¯¹äºæ’å…¥ï¼š</p>
<ul>
<li>å¤´éƒ¨æ’å…¥ï¼šç”±äºéœ€è¦å°†æ‰€æœ‰å…ƒç´ éƒ½ä¾æ¬¡å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚</li>
<li>å°¾éƒ¨æ’å…¥ï¼šå½“ <code>ArrayList</code> çš„å®¹é‡æœªè¾¾åˆ°æé™æ—¶ï¼Œå¾€åˆ—è¡¨æœ«å°¾æ’å…¥å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œå› ä¸ºå®ƒåªéœ€è¦åœ¨æ•°ç»„æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ å³å¯ï¼›å½“å®¹é‡å·²è¾¾åˆ°æé™å¹¶ä¸”éœ€è¦æ‰©å®¹æ—¶ï¼Œåˆ™éœ€è¦æ‰§è¡Œä¸€æ¬¡ O(n) çš„æ“ä½œå°†åŸæ•°ç»„å¤åˆ¶åˆ°æ–°çš„æ›´å¤§çš„æ•°ç»„ä¸­ï¼Œç„¶åå†æ‰§è¡Œ O(1) çš„æ“ä½œæ·»åŠ å…ƒç´ ã€‚</li>
<li>æŒ‡å®šä½ç½®æ’å…¥ï¼šéœ€è¦å°†ç›®æ ‡ä½ç½®ä¹‹åçš„æ‰€æœ‰å…ƒç´ éƒ½å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œç„¶åå†æŠŠæ–°å…ƒç´ æ”¾å…¥æŒ‡å®šä½ç½®ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç§»åŠ¨å¹³å‡ n&#x2F;2 ä¸ªå…ƒç´ ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</li>
</ul>
<p>å¯¹äºåˆ é™¤ï¼š</p>
<ul>
<li>å¤´éƒ¨åˆ é™¤ï¼šç”±äºéœ€è¦å°†æ‰€æœ‰å…ƒç´ ä¾æ¬¡å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚</li>
<li>å°¾éƒ¨åˆ é™¤ï¼šå½“åˆ é™¤çš„å…ƒç´ ä½äºåˆ—è¡¨æœ«å°¾æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</li>
<li>æŒ‡å®šä½ç½®åˆ é™¤ï¼šéœ€è¦å°†ç›®æ ‡å…ƒç´ ä¹‹åçš„æ‰€æœ‰å…ƒç´ å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ä»¥å¡«è¡¥è¢«åˆ é™¤çš„ç©ºç™½ä½ç½®ï¼Œå› æ­¤éœ€è¦ç§»åŠ¨å¹³å‡ n&#x2F;2 ä¸ªå…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</li>
</ul>
<p>è¿™é‡Œç®€å•åˆ—ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ArrayListçš„åº•å±‚æ•°ç»„å¤§å°ä¸º10ï¼Œæ­¤æ—¶å­˜å‚¨äº†7ä¸ªå…ƒç´ </span></span><br><span class="line">+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">| <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> | <span class="number">4</span> | <span class="number">5</span> | <span class="number">6</span> | <span class="number">7</span> |   |   |   |</span><br><span class="line">+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">  <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span></span><br><span class="line"><span class="comment">// åœ¨ç´¢å¼•ä¸º1çš„ä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ 8ï¼Œè¯¥å…ƒç´ åé¢çš„æ‰€æœ‰å…ƒç´ éƒ½è¦å‘å³ç§»åŠ¨ä¸€ä½</span></span><br><span class="line">+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">| <span class="number">1</span> | <span class="number">8</span> | <span class="number">2</span> | <span class="number">3</span> | <span class="number">4</span> | <span class="number">5</span> | <span class="number">6</span> | <span class="number">7</span> |   |   |</span><br><span class="line">+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">  <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span></span><br><span class="line"><span class="comment">// åˆ é™¤ç´¢å¼•ä¸º1çš„ä½ç½®çš„å…ƒç´ ï¼Œè¯¥å…ƒç´ åé¢çš„æ‰€æœ‰å…ƒç´ éƒ½è¦å‘å·¦ç§»åŠ¨ä¸€ä½</span></span><br><span class="line">+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">| <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> | <span class="number">4</span> | <span class="number">5</span> | <span class="number">6</span> | <span class="number">7</span> |   |   |   |</span><br><span class="line">+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">  <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="LinkedList-æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ"><a href="#LinkedList-æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ" class="headerlink" title="LinkedList æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ"></a>LinkedList æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ</h3><ul>
<li>å¤´éƒ¨æ’å…¥&#x2F;åˆ é™¤ï¼šåªéœ€è¦ä¿®æ”¹å¤´ç»“ç‚¹çš„æŒ‡é’ˆå³å¯å®Œæˆæ’å…¥&#x2F;åˆ é™¤æ“ä½œï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</li>
<li>å°¾éƒ¨æ’å…¥&#x2F;åˆ é™¤ï¼šåªéœ€è¦ä¿®æ”¹å°¾ç»“ç‚¹çš„æŒ‡é’ˆå³å¯å®Œæˆæ’å…¥&#x2F;åˆ é™¤æ“ä½œï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</li>
<li>æŒ‡å®šä½ç½®æ’å…¥&#x2F;åˆ é™¤ï¼šéœ€è¦å…ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ï¼Œå†ä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡é’ˆå®Œæˆæ’å…¥&#x2F;åˆ é™¤ï¼Œä¸è¿‡ç”±äºæœ‰å¤´å°¾æŒ‡é’ˆï¼Œå¯ä»¥ä»è¾ƒè¿‘çš„æŒ‡é’ˆå‡ºå‘ï¼Œå› æ­¤éœ€è¦éå†å¹³å‡ n&#x2F;4 ä¸ªå…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</li>
</ul>
<p>è¿™é‡Œç®€å•åˆ—ä¸¾ä¸€ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘ä»¬è¦åˆ é™¤èŠ‚ç‚¹ 9 çš„è¯ï¼Œéœ€è¦å…ˆéå†é“¾è¡¨æ‰¾åˆ°è¯¥èŠ‚ç‚¹ã€‚ç„¶åï¼Œå†æ‰§è¡Œç›¸åº”èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘çš„æ›´æ”¹ï¼Œå…·ä½“çš„æºç å¯ä»¥å‚è€ƒï¼š<a href="./linkedlist-source-code.md">LinkedList æºç åˆ†æ</a> ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/linkedlist-unlink.jpg" alt="unlink æ–¹æ³•é€»è¾‘"></p>
<h3 id="LinkedList-ä¸ºä»€ä¹ˆä¸èƒ½å®ç°-RandomAccess-æ¥å£ï¼Ÿ"><a href="#LinkedList-ä¸ºä»€ä¹ˆä¸èƒ½å®ç°-RandomAccess-æ¥å£ï¼Ÿ" class="headerlink" title="LinkedList ä¸ºä»€ä¹ˆä¸èƒ½å®ç° RandomAccess æ¥å£ï¼Ÿ"></a>LinkedList ä¸ºä»€ä¹ˆä¸èƒ½å®ç° RandomAccess æ¥å£ï¼Ÿ</h3><p><code>RandomAccess</code> æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œç”¨æ¥è¡¨æ˜å®ç°è¯¥æ¥å£çš„ç±»æ”¯æŒéšæœºè®¿é—®ï¼ˆå³å¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿè®¿é—®å…ƒç´ ï¼‰ã€‚ç”±äº <code>LinkedList</code> åº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œå†…å­˜åœ°å€ä¸è¿ç»­ï¼Œåªèƒ½é€šè¿‡æŒ‡é’ˆæ¥å®šä½ï¼Œä¸æ”¯æŒéšæœºå¿«é€Ÿè®¿é—®ï¼Œæ‰€ä»¥ä¸èƒ½å®ç° <code>RandomAccess</code> æ¥å£ã€‚</p>
<h3 id="ArrayList-ä¸-LinkedList-åŒºåˆ«"><a href="#ArrayList-ä¸-LinkedList-åŒºåˆ«" class="headerlink" title="ArrayList ä¸ LinkedList åŒºåˆ«?"></a>ArrayList ä¸ LinkedList åŒºåˆ«?</h3><ul>
<li><strong>æ˜¯å¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š</strong> <code>ArrayList</code> å’Œ <code>LinkedList</code> éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</li>
<li><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong> <code>ArrayList</code> åº•å±‚ä½¿ç”¨çš„æ˜¯ <strong><code>Object</code> æ•°ç»„</strong>ï¼›<code>LinkedList</code> åº•å±‚ä½¿ç”¨çš„æ˜¯ <strong>åŒå‘é“¾è¡¨</strong> æ•°æ®ç»“æ„ï¼ˆJDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7 å–æ¶ˆäº†å¾ªç¯ã€‚æ³¨æ„åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨çš„åŒºåˆ«ï¼Œä¸‹é¢æœ‰ä»‹ç»åˆ°ï¼ï¼‰</li>
<li><strong>æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š</strong><ul>
<li><code>ArrayList</code> é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®çš„å½±å“ã€‚ æ¯”å¦‚ï¼šæ‰§è¡Œ<code>add(E e)</code>æ–¹æ³•çš„æ—¶å€™ï¼Œ <code>ArrayList</code> ä¼šé»˜è®¤åœ¨å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ï¼Œè¿™ç§æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æŒ‡å®šä½ç½® i æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦å°±ä¸º O(n)ã€‚å› ä¸ºåœ¨è¿›è¡Œä¸Šè¿°æ“ä½œçš„æ—¶å€™é›†åˆä¸­ç¬¬ i å’Œç¬¬ i ä¸ªå…ƒç´ ä¹‹åçš„(n-i)ä¸ªå…ƒç´ éƒ½è¦æ‰§è¡Œå‘åä½&#x2F;å‘å‰ç§»ä¸€ä½çš„æ“ä½œã€‚</li>
<li><code>LinkedList</code> é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥åœ¨å¤´å°¾æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼ˆ<code>add(E e)</code>ã€<code>addFirst(E e)</code>ã€<code>addLast(E e)</code>ã€<code>removeFirst()</code>ã€ <code>removeLast()</code>ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå¦‚æœæ˜¯è¦åœ¨æŒ‡å®šä½ç½® <code>i</code> æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼Œ<code>remove(Object o)</code>,<code>remove(int index)</code>ï¼‰ï¼Œ æ—¶é—´å¤æ‚åº¦ä¸º O(n) ï¼Œå› ä¸ºéœ€è¦å…ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®å†æ’å…¥å’Œåˆ é™¤ã€‚</li>
</ul>
</li>
<li><strong>æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š</strong> <code>LinkedList</code> ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€Œ <code>ArrayList</code>ï¼ˆå®ç°äº† <code>RandomAccess</code> æ¥å£ï¼‰ æ”¯æŒã€‚å¿«é€Ÿéšæœºè®¿é—®å°±æ˜¯é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡(å¯¹åº”äº<code>get(int index)</code>æ–¹æ³•)ã€‚</li>
<li><strong>å†…å­˜ç©ºé—´å ç”¨ï¼š</strong> <code>ArrayList</code> çš„ç©ºé—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ LinkedList çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯” ArrayList æ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚</li>
</ul>
<p>æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä¸€èˆ¬æ˜¯ä¸ä¼šä½¿ç”¨åˆ° <code>LinkedList</code> çš„ï¼Œéœ€è¦ç”¨åˆ° <code>LinkedList</code> çš„åœºæ™¯å‡ ä¹éƒ½å¯ä»¥ä½¿ç”¨ <code>ArrayList</code> æ¥ä»£æ›¿ï¼Œå¹¶ä¸”ï¼Œæ€§èƒ½é€šå¸¸ä¼šæ›´å¥½ï¼å°±è¿ <code>LinkedList</code> çš„ä½œè€…çº¦ä¹¦äºš Â· å¸ƒæ´›å…‹ï¼ˆJosh Blochï¼‰è‡ªå·±éƒ½è¯´ä»æ¥ä¸ä¼šä½¿ç”¨ <code>LinkedList</code> ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/redisimage-20220412110853807.png"></p>
<p>å¦å¤–ï¼Œä¸è¦ä¸‹æ„è¯†åœ°è®¤ä¸º <code>LinkedList</code> ä½œä¸ºé“¾è¡¨å°±æœ€é€‚åˆå…ƒç´ å¢åˆ çš„åœºæ™¯ã€‚æˆ‘åœ¨ä¸Šé¢ä¹Ÿè¯´äº†ï¼Œ<code>LinkedList</code> ä»…ä»…åœ¨å¤´å°¾æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ çš„æ—¶å€™æ—¶é—´å¤æ‚åº¦è¿‘ä¼¼ O(1)ï¼Œå…¶ä»–æƒ…å†µå¢åˆ å…ƒç´ çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n) ã€‚</p>
<h4 id="è¡¥å……å†…å®¹-åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨"><a href="#è¡¥å……å†…å®¹-åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="è¡¥å……å†…å®¹: åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨"></a>è¡¥å……å†…å®¹: åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨</h4><p><strong>åŒå‘é“¾è¡¨ï¼š</strong> åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ª prev æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ª next æŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/cs-basics/data-structure/bidirectional-linkedlist.png" alt="åŒå‘é“¾è¡¨"></p>
<p><strong>åŒå‘å¾ªç¯é“¾è¡¨ï¼š</strong> æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘ headï¼Œè€Œ head çš„ prev æŒ‡å‘æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ„æˆä¸€ä¸ªç¯ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/cs-basics/data-structure/bidirectional-circular-linkedlist.png" alt="åŒå‘å¾ªç¯é“¾è¡¨"></p>
<h4 id="è¡¥å……å†…å®¹-RandomAccess-æ¥å£"><a href="#è¡¥å……å†…å®¹-RandomAccess-æ¥å£" class="headerlink" title="è¡¥å……å†…å®¹:RandomAccess æ¥å£"></a>è¡¥å……å†…å®¹:RandomAccess æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RandomAccess</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æºç æˆ‘ä»¬å‘ç°å®é™…ä¸Š <code>RandomAccess</code> æ¥å£ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰å®šä¹‰ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘çœ‹æ¥ <code>RandomAccess</code> æ¥å£ä¸è¿‡æ˜¯ä¸€ä¸ªæ ‡è¯†ç½¢äº†ã€‚æ ‡è¯†ä»€ä¹ˆï¼Ÿ æ ‡è¯†å®ç°è¿™ä¸ªæ¥å£çš„ç±»å…·æœ‰éšæœºè®¿é—®åŠŸèƒ½ã€‚</p>
<p>åœ¨ <code>binarySearch()</code> æ–¹æ³•ä¸­ï¼Œå®ƒè¦åˆ¤æ–­ä¼ å…¥çš„ list æ˜¯å¦ <code>RandomAccess</code> çš„å®ä¾‹ï¼Œå¦‚æœæ˜¯ï¼Œè°ƒç”¨<code>indexedBinarySearch()</code>æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆè°ƒç”¨<code>iteratorBinarySearch()</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;</span><br><span class="line"><span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(List&lt;? extends Comparable&lt;? <span class="built_in">super</span> T&gt;&gt; list, T key)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (list <span class="keyword">instanceof</span> RandomAccess || list.size()&lt;BINARYSEARCH_THRESHOLD)</span><br><span class="line">        <span class="keyword">return</span> Collections.indexedBinarySearch(list, key);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> Collections.iteratorBinarySearch(list, key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ArrayList</code> å®ç°äº† <code>RandomAccess</code> æ¥å£ï¼Œ è€Œ <code>LinkedList</code> æ²¡æœ‰å®ç°ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘è§‰å¾—è¿˜æ˜¯å’Œåº•å±‚æ•°æ®ç»“æ„æœ‰å…³ï¼<code>ArrayList</code> åº•å±‚æ˜¯æ•°ç»„ï¼Œè€Œ <code>LinkedList</code> åº•å±‚æ˜¯é“¾è¡¨ã€‚æ•°ç»„å¤©ç„¶æ”¯æŒéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ‰€ä»¥ç§°ä¸ºå¿«é€Ÿéšæœºè®¿é—®ã€‚é“¾è¡¨éœ€è¦éå†åˆ°ç‰¹å®šä½ç½®æ‰èƒ½è®¿é—®ç‰¹å®šä½ç½®çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œæ‰€ä»¥ä¸æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚<code>ArrayList</code> å®ç°äº† <code>RandomAccess</code> æ¥å£ï¼Œå°±è¡¨æ˜äº†ä»–å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½ã€‚ <code>RandomAccess</code> æ¥å£åªæ˜¯æ ‡è¯†ï¼Œå¹¶ä¸æ˜¯è¯´ <code>ArrayList</code> å®ç° <code>RandomAccess</code> æ¥å£æ‰å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½çš„ï¼</p>
<h3 id="è¯´ä¸€è¯´-ArrayList-çš„æ‰©å®¹æœºåˆ¶å§"><a href="#è¯´ä¸€è¯´-ArrayList-çš„æ‰©å®¹æœºåˆ¶å§" class="headerlink" title="è¯´ä¸€è¯´ ArrayList çš„æ‰©å®¹æœºåˆ¶å§"></a>è¯´ä¸€è¯´ ArrayList çš„æ‰©å®¹æœºåˆ¶å§</h3><p>è¯¦è§ç¬”ä¸»çš„è¿™ç¯‡æ–‡ç« : <a href="https://javaguide.cn/java/collection/arraylist-source-code.html#_3-1-%E5%85%88%E4%BB%8E-arraylist-%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E8%AF%B4%E8%B5%B7">ArrayList æ‰©å®¹æœºåˆ¶åˆ†æ</a>ã€‚</p>
<h3 id="è¯´è¯´é›†åˆä¸­çš„-fail-fast-å’Œ-fail-safe-æ˜¯ä»€ä¹ˆ"><a href="#è¯´è¯´é›†åˆä¸­çš„-fail-fast-å’Œ-fail-safe-æ˜¯ä»€ä¹ˆ" class="headerlink" title="è¯´è¯´é›†åˆä¸­çš„ fail-fast å’Œ fail-safe æ˜¯ä»€ä¹ˆ"></a>è¯´è¯´é›†åˆä¸­çš„ fail-fast å’Œ fail-safe æ˜¯ä»€ä¹ˆ</h3><p>å…³äº<code>fail-fast</code>å¼•ç”¨<code>medium</code>ä¸­ä¸€ç¯‡æ–‡ç« å…³äº<code>fail-fast</code>å’Œ<code>fail-safe</code>çš„è¯´æ³•ï¼š</p>
<blockquote>
<p>Fail-fast systems are designed to immediately stop functioning upon encountering an unexpected condition. This immediate failure helps to catch errors early, making debugging more straightforward.</p>
</blockquote>
<p>å¿«é€Ÿå¤±è´¥çš„æ€æƒ³å³é’ˆå¯¹å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸è¿›è¡Œæå‰è¡¨æ˜æ•…éšœå¹¶åœæ­¢è¿è¡Œï¼Œé€šè¿‡å°½æ—©çš„å‘ç°å’Œåœæ­¢é”™è¯¯ï¼Œé™ä½æ•…éšœç³»ç»Ÿçº§è”çš„é£é™©ã€‚</p>
<p>åœ¨<code>java.util</code>åŒ…ä¸‹çš„å¤§éƒ¨åˆ†é›†åˆæ˜¯ä¸æ”¯æŒçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸ºäº†èƒ½å¤Ÿæå‰å‘ç°å¹¶å‘æ“ä½œå¯¼è‡´çº¿ç¨‹å®‰å…¨é£é™©ï¼Œæå‡ºé€šè¿‡ç»´æŠ¤ä¸€ä¸ª<code>modCount</code>è®°å½•ä¿®æ”¹çš„æ¬¡æ•°ï¼Œè¿­ä»£æœŸé—´é€šè¿‡æ¯”å¯¹é¢„æœŸä¿®æ”¹æ¬¡æ•°<code>expectedModCount</code>å’Œ<code>modCount</code>æ˜¯å¦ä¸€è‡´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¹¶å‘æ“ä½œï¼Œä»è€Œå®ç°å¿«é€Ÿå¤±è´¥ï¼Œç”±æ­¤ä¿è¯åœ¨é¿å…åœ¨å¼‚å¸¸æ—¶æ‰§è¡Œéå¿…è¦çš„å¤æ‚ä»£ç ã€‚</p>
<p>å¯¹åº”çš„æˆ‘ä»¬ç»™å‡ºä¸‹é¢è¿™æ ·ä¸€æ®µåœ¨ç¤ºä¾‹ï¼Œæˆ‘ä»¬é¦–å…ˆæ’å…¥<code>100</code>ä¸ªæ“ä½œå…ƒç´ ï¼Œä¸€ä¸ªçº¿ç¨‹è¿­ä»£å…ƒç´ ï¼Œä¸€ä¸ªçº¿ç¨‹åˆ é™¤å…ƒç´ ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœå¦‚æ„¿æŠ›å‡º<code>ConcurrentModificationException</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ CopyOnWriteArrayList é¿å… ConcurrentModificationException</span></span><br><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    list.add(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// è¿­ä»£å…ƒç´  (æ³¨æ„ï¼šInteger æ˜¯ä¸å¯å˜çš„ï¼Œè¿™é‡Œçš„ i++ ä¸ä¼šä¿®æ”¹ list ä¸­çš„å€¼)</span></span><br><span class="line">    <span class="keyword">for</span> (Integer i : list) &#123;</span><br><span class="line">        i++; <span class="comment">// è¿™è¡Œä»£ç å®é™…ä¸Šæ²¡æœ‰ä¿®æ”¹listä¸­çš„å…ƒç´ </span></span><br><span class="line">    &#125;</span><br><span class="line">    countDownLatch.countDown();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ é™¤å…ƒç´ 1&quot;</span>);</span><br><span class="line">    list.remove(Integer.valueOf(<span class="number">1</span>)); <span class="comment">// ä½¿ç”¨ Integer.valueOf(1) åˆ é™¤æŒ‡å®šå€¼çš„å¯¹è±¡</span></span><br><span class="line">    countDownLatch.countDown();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line">countDownLatch.await();</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨åˆå§‹åŒ–æ—¶æ’å…¥äº†<code>100</code>ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶å¯¹åº”çš„ä¿®æ”¹<code>modCount</code>æ¬¡æ•°ä¸º<code>100</code>ï¼Œéšåçº¿ç¨‹ 2 åœ¨çº¿ç¨‹ 1 è¿­ä»£æœŸé—´è¿›è¡Œå…ƒç´ åˆ é™¤æ“ä½œï¼Œæ­¤æ—¶å¯¹åº”çš„<code>modCount</code>å°±å˜ä¸º<code>101</code>ã€‚<br>çº¿ç¨‹ 1 åœ¨éšå<code>foreach</code>ç¬¬ 2 è½®å¾ªç¯å‘ç°<code>modCount</code> ä¸º<code>101</code>ï¼Œä¸é¢„æœŸçš„<code>expectedModCount(å€¼ä¸º100å› ä¸ºåˆå§‹åŒ–æ’å…¥äº†å…ƒç´ 100ä¸ª)</code>ä¸ç­‰ï¼Œåˆ¤å®šä¸ºå¹¶å‘æ“ä½œå¼‚å¸¸ï¼Œäºæ˜¯ä¾¿å¿«é€Ÿå¤±è´¥ï¼ŒæŠ›å‡º<code>ConcurrentModificationException</code>ï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/fail-fast-and-fail-safe-insert-100-values.png"></p>
<p>å¯¹æ­¤æˆ‘ä»¬ä¹Ÿç»™å‡º<code>for</code>å¾ªç¯åº•å±‚è¿­ä»£å™¨è·å–ä¸‹ä¸€ä¸ªå…ƒç´ æ—¶çš„<code>next</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å…¶å†…éƒ¨çš„<code>checkForComodification</code>å…·æœ‰é’ˆå¯¹ä¿®æ”¹æ¬¡æ•°æ¯”å¯¹çš„é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line"> 			<span class="comment">//æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¹¶å‘ä¿®æ”¹</span></span><br><span class="line">            checkForComodification();</span><br><span class="line">            <span class="comment">//......</span></span><br><span class="line">            <span class="comment">//è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">            <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">checkForComodification</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//å½“å‰å¾ªç¯éå†æ¬¡æ•°å’Œé¢„æœŸä¿®æ”¹æ¬¡æ•°ä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationException</span></span><br><span class="line">            <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è€Œ<code>fail-safe</code>ä¹Ÿå°±æ˜¯å®‰å…¨å¤±è´¥çš„å«ä¹‰ï¼Œå®ƒæ—¨åœ¨å³ä½¿é¢å¯¹æ„å¤–æƒ…å†µä¹Ÿèƒ½æ¢å¤å¹¶ç»§ç»­è¿è¡Œï¼Œè¿™ä½¿å¾—å®ƒç‰¹åˆ«é€‚ç”¨äºä¸ç¡®å®šæˆ–è€…ä¸ç¨³å®šçš„ç¯å¢ƒï¼š</p>
<blockquote>
<p>Fail-safe systems take a different approach, aiming to recover and continue even in the face of unexpected conditions. This makes them particularly suited for uncertain or volatile environments.</p>
</blockquote>
<p>è¯¥æ€æƒ³å¸¸è¿ç”¨äºå¹¶å‘å®¹å™¨ï¼Œæœ€ç»å…¸çš„å®ç°å°±æ˜¯<code>CopyOnWriteArrayList</code>çš„å®ç°ï¼Œé€šè¿‡å†™æ—¶å¤åˆ¶çš„æ€æƒ³ä¿è¯åœ¨è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶å¤åˆ¶å‡ºä¸€ä»½å¿«ç…§ï¼ŒåŸºäºè¿™ä»½å¿«ç…§å®Œæˆæ·»åŠ æˆ–è€…åˆ é™¤æ“ä½œåï¼Œå°†<code>CopyOnWriteArrayList</code>åº•å±‚çš„æ•°ç»„å¼•ç”¨æŒ‡å‘è¿™ä¸ªæ–°çš„æ•°ç»„ç©ºé—´ï¼Œç”±æ­¤é¿å…è¿­ä»£æ—¶è¢«å¹¶å‘ä¿®æ”¹æ‰€å¹²æ‰°æ‰€å¯¼è‡´å¹¶å‘æ“ä½œå®‰å…¨é—®é¢˜ï¼Œå½“ç„¶è¿™ç§åšæ³•ä¹Ÿå­˜ç¼ºç‚¹å³è¿›è¡Œéå†æ“ä½œæ—¶æ— æ³•è·å¾—å®æ—¶ç»“æœï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/fail-fast-and-fail-safe-copyonwritearraylist.png"></p>
<p>å¯¹åº”æˆ‘ä»¬ä¹Ÿç»™å‡º<code>CopyOnWriteArrayList</code>å®ç°<code>fail-safe</code>çš„æ ¸å¿ƒä»£ç ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„å®ç°å°±æ˜¯é€šè¿‡<code>getArray</code>è·å–æ•°ç»„å¼•ç”¨ç„¶åé€šè¿‡<code>Arrays.copyOf</code>å¾—åˆ°ä¸€ä¸ªæ•°ç»„çš„å¿«ç…§ï¼ŒåŸºäºè¿™ä¸ªå¿«ç…§å®Œæˆæ·»åŠ æ“ä½œåï¼Œä¿®æ”¹åº•å±‚<code>array</code>å˜é‡æŒ‡å‘çš„å¼•ç”¨åœ°å€ç”±æ­¤å®Œæˆå†™æ—¶å¤åˆ¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	<span class="comment">//è·å–åŸæœ‰æ•°ç»„</span></span><br><span class="line">            Object[] elements = getArray();</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">            <span class="comment">//åŸºäºåŸæœ‰æ•°ç»„å¤åˆ¶å‡ºä¸€ä»½å†…å­˜å¿«ç…§</span></span><br><span class="line">            Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">//è¿›è¡Œæ·»åŠ æ“ä½œ</span></span><br><span class="line">            newElements[len] = e;</span><br><span class="line">            <span class="comment">//arrayæŒ‡å‘æ–°çš„æ•°ç»„</span></span><br><span class="line">            setArray(newElements);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Set-1"><a href="#Set-1" class="headerlink" title="Set"></a>Set</h2><h3 id="Comparable-å’Œ-Comparator-çš„åŒºåˆ«"><a href="#Comparable-å’Œ-Comparator-çš„åŒºåˆ«" class="headerlink" title="Comparable å’Œ Comparator çš„åŒºåˆ«"></a>Comparable å’Œ Comparator çš„åŒºåˆ«</h3><p><code>Comparable</code> æ¥å£å’Œ <code>Comparator</code> æ¥å£éƒ½æ˜¯ Java ä¸­ç”¨äºæ’åºçš„æ¥å£ï¼Œå®ƒä»¬åœ¨å®ç°ç±»å¯¹è±¡ä¹‹é—´æ¯”è¾ƒå¤§å°ã€æ’åºç­‰æ–¹é¢å‘æŒ¥äº†é‡è¦ä½œç”¨ï¼š</p>
<ul>
<li><code>Comparable</code> æ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ª<code>java.lang</code>åŒ… å®ƒæœ‰ä¸€ä¸ª <code>compareTo(Object obj)</code>æ–¹æ³•ç”¨æ¥æ’åº</li>
<li><code>Comparator</code>æ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ª <code>java.util</code> åŒ…å®ƒæœ‰ä¸€ä¸ª<code>compare(Object obj1, Object obj2)</code>æ–¹æ³•ç”¨æ¥æ’åº</li>
</ul>
<p>ä¸€èˆ¬æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªé›†åˆä½¿ç”¨è‡ªå®šä¹‰æ’åºæ—¶ï¼Œæˆ‘ä»¬å°±è¦é‡å†™<code>compareTo()</code>æ–¹æ³•æˆ–<code>compare()</code>æ–¹æ³•ï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹æŸä¸€ä¸ªé›†åˆå®ç°ä¸¤ç§æ’åºæ–¹å¼ï¼Œæ¯”å¦‚ä¸€ä¸ª <code>song</code> å¯¹è±¡ä¸­çš„æ­Œåå’Œæ­Œæ‰‹ååˆ†åˆ«é‡‡ç”¨ä¸€ç§æ’åºæ–¹æ³•çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™<code>compareTo()</code>æ–¹æ³•å’Œä½¿ç”¨è‡ªåˆ¶çš„<code>Comparator</code>æ–¹æ³•æˆ–è€…ä»¥ä¸¤ä¸ª <code>Comparator</code> æ¥å®ç°æ­Œåæ’åºå’Œæ­Œæ˜Ÿåæ’åºï¼Œç¬¬äºŒç§ä»£è¡¨æˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸¤ä¸ªå‚æ•°ç‰ˆçš„ <code>Collections.sort()</code>.</p>
<h4 id="Comparator-å®šåˆ¶æ’åº"><a href="#Comparator-å®šåˆ¶æ’åº" class="headerlink" title="Comparator å®šåˆ¶æ’åº"></a>Comparator å®šåˆ¶æ’åº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">arrayList.add(-<span class="number">1</span>);</span><br><span class="line">arrayList.add(<span class="number">3</span>);</span><br><span class="line">arrayList.add(<span class="number">3</span>);</span><br><span class="line">arrayList.add(-<span class="number">5</span>);</span><br><span class="line">arrayList.add(<span class="number">7</span>);</span><br><span class="line">arrayList.add(<span class="number">4</span>);</span><br><span class="line">arrayList.add(-<span class="number">9</span>);</span><br><span class="line">arrayList.add(-<span class="number">7</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åŸå§‹æ•°ç»„:&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"><span class="comment">// void reverse(List list)ï¼šåè½¬</span></span><br><span class="line">Collections.reverse(arrayList);</span><br><span class="line">System.out.println(<span class="string">&quot;Collections.reverse(arrayList):&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"></span><br><span class="line"><span class="comment">// void sort(List list),æŒ‰è‡ªç„¶æ’åºçš„å‡åºæ’åº</span></span><br><span class="line">Collections.sort(arrayList);</span><br><span class="line">System.out.println(<span class="string">&quot;Collections.sort(arrayList):&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"><span class="comment">// å®šåˆ¶æ’åºçš„ç”¨æ³•</span></span><br><span class="line">Collections.sort(arrayList, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> o2.compareTo(o1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;å®šåˆ¶æ’åºåï¼š&quot;</span>);</span><br><span class="line">System.out.println(arrayList);</span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹æ•°ç»„:</span><br><span class="line">[-1, 3, 3, -5, 7, 4, -9, -7]</span><br><span class="line">Collections.reverse(arrayList):</span><br><span class="line">[-7, -9, 4, 7, -5, 3, 3, -1]</span><br><span class="line">Collections.sort(arrayList):</span><br><span class="line">[-9, -7, -5, -1, 3, 3, 4, 7]</span><br><span class="line">å®šåˆ¶æ’åºåï¼š</span><br><span class="line">[7, 4, 3, 3, -1, -5, -7, -9]</span><br></pre></td></tr></table></figure>

<h4 id="é‡å†™-compareTo-æ–¹æ³•å®ç°æŒ‰å¹´é¾„æ¥æ’åº"><a href="#é‡å†™-compareTo-æ–¹æ³•å®ç°æŒ‰å¹´é¾„æ¥æ’åº" class="headerlink" title="é‡å†™ compareTo æ–¹æ³•å®ç°æŒ‰å¹´é¾„æ¥æ’åº"></a>é‡å†™ compareTo æ–¹æ³•å®ç°æŒ‰å¹´é¾„æ¥æ’åº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// personå¯¹è±¡æ²¡æœ‰å®ç°Comparableæ¥å£ï¼Œæ‰€ä»¥å¿…é¡»å®ç°ï¼Œè¿™æ ·æ‰ä¸ä¼šå‡ºé”™ï¼Œæ‰å¯ä»¥ä½¿treemapä¸­çš„æ•°æ®æŒ‰é¡ºåºæ’åˆ—</span></span><br><span class="line"><span class="comment">// å‰é¢ä¸€ä¸ªä¾‹å­çš„Stringç±»å·²ç»é»˜è®¤å®ç°äº†Comparableæ¥å£ï¼Œè¯¦ç»†å¯ä»¥æŸ¥çœ‹Stringç±»çš„APIæ–‡æ¡£ï¼Œå¦å¤–å…¶ä»–</span></span><br><span class="line"><span class="comment">// åƒIntegerç±»ç­‰éƒ½å·²ç»å®ç°äº†Comparableæ¥å£ï¼Œæ‰€ä»¥ä¸éœ€è¦å¦å¤–å®ç°äº†</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Person&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Té‡å†™compareToæ–¹æ³•å®ç°æŒ‰å¹´é¾„æ¥æ’åº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Person o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.age &gt; o.getAge()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.age &lt; o.getAge()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    TreeMap&lt;Person, String&gt; pdata = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;Person, String&gt;();</span><br><span class="line">    pdata.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">30</span>), <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    pdata.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;æå››&quot;</span>, <span class="number">20</span>), <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">    pdata.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;ç‹äº”&quot;</span>, <span class="number">10</span>), <span class="string">&quot;wangwu&quot;</span>);</span><br><span class="line">    pdata.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;å°çº¢&quot;</span>, <span class="number">5</span>), <span class="string">&quot;xiaohong&quot;</span>);</span><br><span class="line">    <span class="comment">// å¾—åˆ°keyçš„å€¼çš„åŒæ—¶å¾—åˆ°keyæ‰€å¯¹åº”çš„å€¼</span></span><br><span class="line">    Set&lt;Person&gt; keys = pdata.keySet();</span><br><span class="line">    <span class="keyword">for</span> (Person key : keys) &#123;</span><br><span class="line">        System.out.println(key.getAge() + <span class="string">&quot;-&quot;</span> + key.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Outputï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5-å°çº¢</span><br><span class="line">10-ç‹äº”</span><br><span class="line">20-æå››</span><br><span class="line">30-å¼ ä¸‰</span><br></pre></td></tr></table></figure>

<h3 id="æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ"><a href="#æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ"></a>æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ</h3><ul>
<li>æ— åºæ€§ä¸ç­‰äºéšæœºæ€§ ï¼Œæ— åºæ€§æ˜¯æŒ‡å­˜å‚¨çš„æ•°æ®åœ¨åº•å±‚æ•°ç»„ä¸­å¹¶éæŒ‰ç…§æ•°ç»„ç´¢å¼•çš„é¡ºåºæ·»åŠ  ï¼Œè€Œæ˜¯æ ¹æ®æ•°æ®çš„å“ˆå¸Œå€¼å†³å®šçš„ã€‚</li>
<li>ä¸å¯é‡å¤æ€§æ˜¯æŒ‡æ·»åŠ çš„å…ƒç´ æŒ‰ç…§ <code>equals()</code> åˆ¤æ–­æ—¶ ï¼Œè¿”å› falseï¼Œéœ€è¦åŒæ—¶é‡å†™ <code>equals()</code> æ–¹æ³•å’Œ <code>hashCode()</code> æ–¹æ³•ã€‚</li>
</ul>
<h3 id="æ¯”è¾ƒ-HashSetã€LinkedHashSet-å’Œ-TreeSet-ä¸‰è€…çš„å¼‚åŒ"><a href="#æ¯”è¾ƒ-HashSetã€LinkedHashSet-å’Œ-TreeSet-ä¸‰è€…çš„å¼‚åŒ" class="headerlink" title="æ¯”è¾ƒ HashSetã€LinkedHashSet å’Œ TreeSet ä¸‰è€…çš„å¼‚åŒ"></a>æ¯”è¾ƒ HashSetã€LinkedHashSet å’Œ TreeSet ä¸‰è€…çš„å¼‚åŒ</h3><ul>
<li><code>HashSet</code>ã€<code>LinkedHashSet</code> å’Œ <code>TreeSet</code> éƒ½æ˜¯ <code>Set</code> æ¥å£çš„å®ç°ç±»ï¼Œéƒ½èƒ½ä¿è¯å…ƒç´ å”¯ä¸€ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
<li><code>HashSet</code>ã€<code>LinkedHashSet</code> å’Œ <code>TreeSet</code> çš„ä¸»è¦åŒºåˆ«åœ¨äºåº•å±‚æ•°æ®ç»“æ„ä¸åŒã€‚<code>HashSet</code> çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ï¼ˆåŸºäº <code>HashMap</code> å®ç°ï¼‰ã€‚<code>LinkedHashSet</code> çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨å’Œå“ˆå¸Œè¡¨ï¼Œå…ƒç´ çš„æ’å…¥å’Œå–å‡ºé¡ºåºæ»¡è¶³ FIFOã€‚<code>TreeSet</code> åº•å±‚æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ï¼Œå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œæ’åºçš„æ–¹å¼æœ‰è‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åºã€‚</li>
<li>åº•å±‚æ•°æ®ç»“æ„ä¸åŒåˆå¯¼è‡´è¿™ä¸‰è€…çš„åº”ç”¨åœºæ™¯ä¸åŒã€‚<code>HashSet</code> ç”¨äºä¸éœ€è¦ä¿è¯å…ƒç´ æ’å…¥å’Œå–å‡ºé¡ºåºçš„åœºæ™¯ï¼Œ<code>LinkedHashSet</code> ç”¨äºä¿è¯å…ƒç´ çš„æ’å…¥å’Œå–å‡ºé¡ºåºæ»¡è¶³ FIFO çš„åœºæ™¯ï¼Œ<code>TreeSet</code> ç”¨äºæ”¯æŒå¯¹å…ƒç´ è‡ªå®šä¹‰æ’åºè§„åˆ™çš„åœºæ™¯ã€‚</li>
</ul>
<h2 id="Queue-1"><a href="#Queue-1" class="headerlink" title="Queue"></a>Queue</h2><h3 id="Queue-ä¸-Deque-çš„åŒºåˆ«"><a href="#Queue-ä¸-Deque-çš„åŒºåˆ«" class="headerlink" title="Queue ä¸ Deque çš„åŒºåˆ«"></a>Queue ä¸ Deque çš„åŒºåˆ«</h3><p><code>Queue</code> æ˜¯å•ç«¯é˜Ÿåˆ—ï¼Œåªèƒ½ä»ä¸€ç«¯æ’å…¥å…ƒç´ ï¼Œå¦ä¸€ç«¯åˆ é™¤å…ƒç´ ï¼Œå®ç°ä¸Šä¸€èˆ¬éµå¾ª <strong>å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰</strong> è§„åˆ™ã€‚</p>
<p><code>Queue</code> æ‰©å±•äº† <code>Collection</code> çš„æ¥å£ï¼Œæ ¹æ® <strong>å› ä¸ºå®¹é‡é—®é¢˜è€Œå¯¼è‡´æ“ä½œå¤±è´¥åå¤„ç†æ–¹å¼çš„ä¸åŒ</strong> å¯ä»¥åˆ†ä¸ºä¸¤ç±»æ–¹æ³•: ä¸€ç§åœ¨æ“ä½œå¤±è´¥åä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦ä¸€ç§åˆ™ä¼šè¿”å›ç‰¹æ®Šå€¼ã€‚</p>
<table>
<thead>
<tr>
<th><code>Queue</code> æ¥å£</th>
<th>æŠ›å‡ºå¼‚å¸¸</th>
<th>è¿”å›ç‰¹æ®Šå€¼</th>
</tr>
</thead>
<tbody><tr>
<td>æ’å…¥é˜Ÿå°¾</td>
<td>add(E e)</td>
<td>offer(E e)</td>
</tr>
<tr>
<td>åˆ é™¤é˜Ÿé¦–</td>
<td>remove()</td>
<td>poll()</td>
</tr>
<tr>
<td>æŸ¥è¯¢é˜Ÿé¦–å…ƒç´ </td>
<td>element()</td>
<td>peek()</td>
</tr>
</tbody></table>
<p><code>Deque</code> æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—çš„ä¸¤ç«¯å‡å¯ä»¥æ’å…¥æˆ–åˆ é™¤å…ƒç´ ã€‚</p>
<p><code>Deque</code> æ‰©å±•äº† <code>Queue</code> çš„æ¥å£, å¢åŠ äº†åœ¨é˜Ÿé¦–å’Œé˜Ÿå°¾è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„æ–¹æ³•ï¼ŒåŒæ ·æ ¹æ®å¤±è´¥åå¤„ç†æ–¹å¼çš„ä¸åŒåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<table>
<thead>
<tr>
<th><code>Deque</code> æ¥å£</th>
<th>æŠ›å‡ºå¼‚å¸¸</th>
<th>è¿”å›ç‰¹æ®Šå€¼</th>
</tr>
</thead>
<tbody><tr>
<td>æ’å…¥é˜Ÿé¦–</td>
<td>addFirst(E e)</td>
<td>offerFirst(E e)</td>
</tr>
<tr>
<td>æ’å…¥é˜Ÿå°¾</td>
<td>addLast(E e)</td>
<td>offerLast(E e)</td>
</tr>
<tr>
<td>åˆ é™¤é˜Ÿé¦–</td>
<td>removeFirst()</td>
<td>pollFirst()</td>
</tr>
<tr>
<td>åˆ é™¤é˜Ÿå°¾</td>
<td>removeLast()</td>
<td>pollLast()</td>
</tr>
<tr>
<td>æŸ¥è¯¢é˜Ÿé¦–å…ƒç´ </td>
<td>getFirst()</td>
<td>peekFirst()</td>
</tr>
<tr>
<td>æŸ¥è¯¢é˜Ÿå°¾å…ƒç´ </td>
<td>getLast()</td>
<td>peekLast()</td>
</tr>
</tbody></table>
<p>äº‹å®ä¸Šï¼Œ<code>Deque</code> è¿˜æä¾›æœ‰ <code>push()</code> å’Œ <code>pop()</code> ç­‰å…¶ä»–æ–¹æ³•ï¼Œå¯ç”¨äºæ¨¡æ‹Ÿæ ˆã€‚</p>
<h3 id="ArrayDeque-ä¸-LinkedList-çš„åŒºåˆ«"><a href="#ArrayDeque-ä¸-LinkedList-çš„åŒºåˆ«" class="headerlink" title="ArrayDeque ä¸ LinkedList çš„åŒºåˆ«"></a>ArrayDeque ä¸ LinkedList çš„åŒºåˆ«</h3><p><code>ArrayDeque</code> å’Œ <code>LinkedList</code> éƒ½å®ç°äº† <code>Deque</code> æ¥å£ï¼Œä¸¤è€…éƒ½å…·æœ‰é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œä½†ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<ul>
<li><p><code>ArrayDeque</code> æ˜¯åŸºäºå¯å˜é•¿çš„æ•°ç»„å’ŒåŒæŒ‡é’ˆæ¥å®ç°ï¼Œè€Œ <code>LinkedList</code> åˆ™é€šè¿‡é“¾è¡¨æ¥å®ç°ã€‚</p>
</li>
<li><p><code>ArrayDeque</code> ä¸æ”¯æŒå­˜å‚¨ <code>NULL</code> æ•°æ®ï¼Œä½† <code>LinkedList</code> æ”¯æŒã€‚</p>
</li>
<li><p><code>ArrayDeque</code> æ˜¯åœ¨ JDK1.6 æ‰è¢«å¼•å…¥çš„ï¼Œè€Œ<code>LinkedList</code> æ—©åœ¨ JDK1.2 æ—¶å°±å·²ç»å­˜åœ¨ã€‚</p>
</li>
<li><p><code>ArrayDeque</code> æ’å…¥æ—¶å¯èƒ½å­˜åœ¨æ‰©å®¹è¿‡ç¨‹, ä¸è¿‡å‡æ‘Šåçš„æ’å…¥æ“ä½œä¾ç„¶ä¸º O(1)ã€‚è™½ç„¶ <code>LinkedList</code> ä¸éœ€è¦æ‰©å®¹ï¼Œä½†æ˜¯æ¯æ¬¡æ’å…¥æ•°æ®æ—¶å‡éœ€è¦ç”³è¯·æ–°çš„å †ç©ºé—´ï¼Œå‡æ‘Šæ€§èƒ½ç›¸æ¯”æ›´æ…¢ã€‚</p>
</li>
</ul>
<p>ä»æ€§èƒ½çš„è§’åº¦ä¸Šï¼Œé€‰ç”¨ <code>ArrayDeque</code> æ¥å®ç°é˜Ÿåˆ—è¦æ¯” <code>LinkedList</code> æ›´å¥½ã€‚æ­¤å¤–ï¼Œ<code>ArrayDeque</code> ä¹Ÿå¯ä»¥ç”¨äºå®ç°æ ˆã€‚</p>
<h3 id="è¯´ä¸€è¯´-PriorityQueue"><a href="#è¯´ä¸€è¯´-PriorityQueue" class="headerlink" title="è¯´ä¸€è¯´ PriorityQueue"></a>è¯´ä¸€è¯´ PriorityQueue</h3><p><code>PriorityQueue</code> æ˜¯åœ¨ JDK1.5 ä¸­è¢«å¼•å…¥çš„, å…¶ä¸ <code>Queue</code> çš„åŒºåˆ«åœ¨äºå…ƒç´ å‡ºé˜Ÿé¡ºåºæ˜¯ä¸ä¼˜å…ˆçº§ç›¸å…³çš„ï¼Œå³æ€»æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ å…ˆå‡ºé˜Ÿã€‚</p>
<p>è¿™é‡Œåˆ—ä¸¾å…¶ç›¸å…³çš„ä¸€äº›è¦ç‚¹ï¼š</p>
<ul>
<li><code>PriorityQueue</code> åˆ©ç”¨äº†äºŒå‰å †çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ï¼Œåº•å±‚ä½¿ç”¨å¯å˜é•¿çš„æ•°ç»„æ¥å­˜å‚¨æ•°æ®</li>
<li><code>PriorityQueue</code> é€šè¿‡å †å…ƒç´ çš„ä¸Šæµ®å’Œä¸‹æ²‰ï¼Œå®ç°äº†åœ¨ O(logn) çš„æ—¶é—´å¤æ‚åº¦å†…æ’å…¥å…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚</li>
<li><code>PriorityQueue</code> æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸”ä¸æ”¯æŒå­˜å‚¨ <code>NULL</code> å’Œ <code>non-comparable</code> çš„å¯¹è±¡ã€‚</li>
<li><code>PriorityQueue</code> é»˜è®¤æ˜¯å°é¡¶å †ï¼Œä½†å¯ä»¥æ¥æ”¶ä¸€ä¸ª <code>Comparator</code> ä½œä¸ºæ„é€ å‚æ•°ï¼Œä»è€Œæ¥è‡ªå®šä¹‰å…ƒç´ ä¼˜å…ˆçº§çš„å…ˆåã€‚</li>
</ul>
<p><code>PriorityQueue</code> åœ¨é¢è¯•ä¸­å¯èƒ½æ›´å¤šçš„ä¼šå‡ºç°åœ¨æ‰‹æ’•ç®—æ³•çš„æ—¶å€™ï¼Œå…¸å‹ä¾‹é¢˜åŒ…æ‹¬å †æ’åºã€æ±‚ç¬¬ K å¤§çš„æ•°ã€å¸¦æƒå›¾çš„éå†ç­‰ï¼Œæ‰€ä»¥éœ€è¦ä¼šç†Ÿç»ƒä½¿ç”¨æ‰è¡Œã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯-BlockingQueueï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-BlockingQueueï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ BlockingQueueï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ BlockingQueueï¼Ÿ</h3><p><code>BlockingQueue</code> ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿è‡ª <code>Queue</code>ã€‚<code>BlockingQueue</code>é˜»å¡çš„åŸå› æ˜¯å…¶æ”¯æŒå½“é˜Ÿåˆ—æ²¡æœ‰å…ƒç´ æ—¶ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æœ‰å…ƒç´ ï¼›è¿˜æ”¯æŒå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œä¸€ç›´ç­‰åˆ°é˜Ÿåˆ—å¯ä»¥æ”¾å…¥æ–°å…ƒç´ æ—¶å†æ”¾å…¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlockingQueue</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">Queue</span>&lt;E&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>BlockingQueue</code> å¸¸ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šå‘é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šä»é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®è¿›è¡Œå¤„ç†ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/blocking-queue.png" alt="BlockingQueue"></p>
<h3 id="BlockingQueue-çš„å®ç°ç±»æœ‰å“ªäº›ï¼Ÿ"><a href="#BlockingQueue-çš„å®ç°ç±»æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="BlockingQueue çš„å®ç°ç±»æœ‰å“ªäº›ï¼Ÿ"></a>BlockingQueue çš„å®ç°ç±»æœ‰å“ªäº›ï¼Ÿ</h3><p><img src="https://oss.javaguide.cn/github/javaguide/java/collection/blocking-queue-hierarchy.png" alt="BlockingQueue çš„å®ç°ç±»"></p>
<p>Java ä¸­å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—å®ç°ç±»æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li><code>ArrayBlockingQueue</code>ï¼šä½¿ç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚åœ¨åˆ›å»ºæ—¶éœ€è¦æŒ‡å®šå®¹é‡å¤§å°ï¼Œå¹¶æ”¯æŒå…¬å¹³å’Œéå…¬å¹³ä¸¤ç§æ–¹å¼çš„é”è®¿é—®æœºåˆ¶ã€‚</li>
<li><code>LinkedBlockingQueue</code>ï¼šä½¿ç”¨å•å‘é“¾è¡¨å®ç°çš„å¯é€‰æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚åœ¨åˆ›å»ºæ—¶å¯ä»¥æŒ‡å®šå®¹é‡å¤§å°ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™é»˜è®¤ä¸º<code>Integer.MAX_VALUE</code>ã€‚å’Œ<code>ArrayBlockingQueue</code>ä¸åŒçš„æ˜¯ï¼Œ å®ƒä»…æ”¯æŒéå…¬å¹³çš„é”è®¿é—®æœºåˆ¶ã€‚</li>
<li><code>PriorityBlockingQueue</code>ï¼šæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚å…ƒç´ å¿…é¡»å®ç°<code>Comparable</code>æ¥å£æˆ–è€…åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥<code>Comparator</code>å¯¹è±¡ï¼Œå¹¶ä¸”ä¸èƒ½æ’å…¥ null å…ƒç´ ã€‚</li>
<li><code>SynchronousQueue</code>ï¼šåŒæ­¥é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ç§ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œéƒ½å¿…é¡»ç­‰å¾…å¯¹åº”çš„åˆ é™¤æ“ä½œï¼Œåä¹‹åˆ é™¤æ“ä½œä¹Ÿå¿…é¡»ç­‰å¾…æ’å…¥æ“ä½œã€‚å› æ­¤ï¼Œ<code>SynchronousQueue</code>é€šå¸¸ç”¨äºçº¿ç¨‹ä¹‹é—´çš„ç›´æ¥ä¼ é€’æ•°æ®ã€‚</li>
<li><code>DelayQueue</code>ï¼šå»¶è¿Ÿé˜Ÿåˆ—ï¼Œå…¶ä¸­çš„å…ƒç´ åªæœ‰åˆ°äº†å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­å‡ºé˜Ÿã€‚</li>
<li>â€¦â€¦</li>
</ol>
<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œè¿™äº›é˜Ÿåˆ—ä½¿ç”¨çš„å…¶å®éƒ½ä¸å¤šï¼Œäº†è§£å³å¯ã€‚</p>
<h3 id="ArrayBlockingQueue-å’Œ-LinkedBlockingQueue-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#ArrayBlockingQueue-å’Œ-LinkedBlockingQueue-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="ArrayBlockingQueue å’Œ LinkedBlockingQueue æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>ArrayBlockingQueue å’Œ LinkedBlockingQueue æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><code>ArrayBlockingQueue</code> å’Œ <code>LinkedBlockingQueue</code> æ˜¯ Java å¹¶å‘åŒ…ä¸­å¸¸ç”¨çš„ä¸¤ç§é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œå®ƒä»¬éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸è¿‡ï¼Œä¸è¿‡å®ƒä»¬ä¹‹é—´ä¹Ÿå­˜åœ¨ä¸‹é¢è¿™äº›åŒºåˆ«ï¼š</p>
<ul>
<li>åº•å±‚å®ç°ï¼š<code>ArrayBlockingQueue</code> åŸºäºæ•°ç»„å®ç°ï¼Œè€Œ <code>LinkedBlockingQueue</code> åŸºäºé“¾è¡¨å®ç°ã€‚</li>
<li>æ˜¯å¦æœ‰ç•Œï¼š<code>ArrayBlockingQueue</code> æ˜¯æœ‰ç•Œé˜Ÿåˆ—ï¼Œå¿…é¡»åœ¨åˆ›å»ºæ—¶æŒ‡å®šå®¹é‡å¤§å°ã€‚<code>LinkedBlockingQueue</code> åˆ›å»ºæ—¶å¯ä»¥ä¸æŒ‡å®šå®¹é‡å¤§å°ï¼Œé»˜è®¤æ˜¯<code>Integer.MAX_VALUE</code>ï¼Œä¹Ÿå°±æ˜¯æ— ç•Œçš„ã€‚ä½†ä¹Ÿå¯ä»¥æŒ‡å®šé˜Ÿåˆ—å¤§å°ï¼Œä»è€Œæˆä¸ºæœ‰ç•Œçš„ã€‚</li>
<li>é”æ˜¯å¦åˆ†ç¦»ï¼š <code>ArrayBlockingQueue</code>ä¸­çš„é”æ˜¯æ²¡æœ‰åˆ†ç¦»çš„ï¼Œå³ç”Ÿäº§å’Œæ¶ˆè´¹ç”¨çš„æ˜¯åŒä¸€ä¸ªé”ï¼›<code>LinkedBlockingQueue</code>ä¸­çš„é”æ˜¯åˆ†ç¦»çš„ï¼Œå³ç”Ÿäº§ç”¨çš„æ˜¯<code>putLock</code>ï¼Œæ¶ˆè´¹æ˜¯<code>takeLock</code>ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹ä¹‹é—´çš„é”äº‰å¤ºã€‚</li>
<li>å†…å­˜å ç”¨ï¼š<code>ArrayBlockingQueue</code> éœ€è¦æå‰åˆ†é…æ•°ç»„å†…å­˜ï¼Œè€Œ <code>LinkedBlockingQueue</code> åˆ™æ˜¯åŠ¨æ€åˆ†é…é“¾è¡¨èŠ‚ç‚¹å†…å­˜ã€‚è¿™æ„å‘³ç€ï¼Œ<code>ArrayBlockingQueue</code> åœ¨åˆ›å»ºæ—¶å°±ä¼šå ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œä¸”å¾€å¾€ç”³è¯·çš„å†…å­˜æ¯”å®é™…æ‰€ç”¨çš„å†…å­˜æ›´å¤§ï¼Œè€Œ<code>LinkedBlockingQueue</code> åˆ™æ˜¯æ ¹æ®å…ƒç´ çš„å¢åŠ è€Œé€æ¸å ç”¨å†…å­˜ç©ºé—´ã€‚</li>
</ul>
<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/25/spring-cloud-gateway-questions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/25/spring-cloud-gateway-questions/" itemprop="url">Spring Cloud Gatewayå¸¸è§é—®é¢˜æ€»ç»“</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-02-25T23:01:41+08:00">
                2021-02-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">åˆ†å¸ƒå¼</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/02/25/spring-cloud-gateway-questions/" class="leancloud_visitors" data-flag-title="Spring Cloud Gatewayå¸¸è§é—®é¢˜æ€»ç»“">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  2.1k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  8 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>æœ¬æ–‡é‡æ„å®Œå–„è‡ª<a href="https://mp.weixin.qq.com/s/XjFYsP1IUqNzWqXZdJn-Aw">6000 å­— | 16 å›¾ | æ·±å…¥ç†è§£ Spring Cloud Gateway çš„åŸç† - æ‚Ÿç©ºèŠæ¶æ„</a>è¿™ç¯‡æ–‡ç« ã€‚</p>
</blockquote>
<h2 id="ä»€ä¹ˆæ˜¯-Spring-Cloud-Gatewayï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Spring-Cloud-Gatewayï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Spring Cloud Gatewayï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Spring Cloud Gatewayï¼Ÿ</h2><p>Spring Cloud Gateway å±äº Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œå…¶è¯ç”Ÿçš„ç›®æ ‡æ˜¯ä¸ºäº†æ›¿ä»£è€ç‰Œç½‘å…³ <strong>Zuul</strong>ã€‚å‡†ç¡®ç‚¹æ¥è¯´ï¼Œåº”è¯¥æ˜¯ Zuul 1.xã€‚Spring Cloud Gateway èµ·æ­¥è¦æ¯” Zuul 2.x æ›´æ—©ã€‚</p>
<p>ä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpring Cloud Gateway åŸºäº Spring WebFlux ã€‚Spring WebFlux ä½¿ç”¨ Reactor åº“æ¥å®ç°å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œåº•å±‚åŸºäº Netty å®ç°åŒæ­¥éé˜»å¡çš„ I&#x2F;Oã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/system-design/distributed-system/api-gateway/springcloud-gateway-%20demo.png"></p>
<p>Spring Cloud Gateway ä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§&#x2F;æŒ‡æ ‡ï¼Œé™æµã€‚</p>
<p>Spring Cloud Gateway å’Œ Zuul 2.x çš„å·®åˆ«ä¸å¤§ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿‡æ»¤å™¨æ¥å¤„ç†è¯·æ±‚ã€‚ä¸è¿‡ï¼Œç›®å‰æ›´åŠ æ¨èä½¿ç”¨ Spring Cloud Gateway è€Œé Zuulï¼ŒSpring Cloud ç”Ÿæ€å¯¹å…¶æ”¯æŒæ›´åŠ å‹å¥½ã€‚</p>
<ul>
<li>GitHub åœ°å€ï¼š <a href="https://github.com/spring-cloud/spring-cloud-gateway">https://github.com/spring-cloud/spring-cloud-gateway</a></li>
<li>å®˜ç½‘ï¼š <a href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a></li>
</ul>
<h2 id="Spring-Cloud-Gateway-çš„å·¥ä½œæµç¨‹ï¼Ÿ"><a href="#Spring-Cloud-Gateway-çš„å·¥ä½œæµç¨‹ï¼Ÿ" class="headerlink" title="Spring Cloud Gateway çš„å·¥ä½œæµç¨‹ï¼Ÿ"></a>Spring Cloud Gateway çš„å·¥ä½œæµç¨‹ï¼Ÿ</h2><p>Spring Cloud Gateway çš„å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/system-design/distributed-system/api-gateway/spring-cloud-gateway-workflow.png" alt="Spring Cloud Gateway çš„å·¥ä½œæµç¨‹"></p>
<p>è¿™æ˜¯ Spring å®˜æ–¹åšå®¢ä¸­çš„ä¸€å¼ å›¾ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="https://spring.io/blog/2022/08/26/creating-a-custom-spring-cloud-gateway-filter">https://spring.io/blog/2022/08/26/creating-a-custom-spring-cloud-gateway-filter</a>ã€‚</p>
<p>å…·ä½“çš„æµç¨‹åˆ†æï¼š</p>
<ol>
<li><strong>è·¯ç”±åˆ¤æ–­</strong>ï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾ç½‘å…³åï¼Œå…ˆç»è¿‡ Gateway Handler Mapping å¤„ç†ï¼Œè¿™é‡Œé¢ä¼šåšæ–­è¨€ï¼ˆPredicateï¼‰åˆ¤æ–­ï¼Œçœ‹ä¸‹ç¬¦åˆå“ªä¸ªè·¯ç”±è§„åˆ™ï¼Œè¿™ä¸ªè·¯ç”±æ˜ å°„åç«¯çš„æŸä¸ªæœåŠ¡ã€‚</li>
<li><strong>è¯·æ±‚è¿‡æ»¤</strong>ï¼šç„¶åè¯·æ±‚åˆ°è¾¾ Gateway Web Handlerï¼Œè¿™é‡Œé¢æœ‰å¾ˆå¤šè¿‡æ»¤å™¨ï¼Œç»„æˆè¿‡æ»¤å™¨é“¾ï¼ˆFilter Chainï¼‰ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå’Œä¿®æ”¹ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´ã€å‚æ•°æ ¡éªŒç­‰ç­‰ï¼Œæœ‰ç‚¹åƒå‡€åŒ–æ±¡æ°´ã€‚ç„¶åå°†è¯·æ±‚è½¬å‘åˆ°å®é™…çš„åç«¯æœåŠ¡ã€‚è¿™äº›è¿‡æ»¤å™¨é€»è¾‘ä¸Šå¯ä»¥ç§°ä½œ Pre-Filtersï¼ŒPre å¯ä»¥ç†è§£ä¸ºâ€œåœ¨â€¦ä¹‹å‰â€ã€‚</li>
<li><strong>æœåŠ¡å¤„ç†</strong>ï¼šåç«¯æœåŠ¡ä¼šå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</li>
<li><strong>å“åº”è¿‡æ»¤</strong>ï¼šåç«¯å¤„ç†å®Œç»“æœåï¼Œè¿”å›ç»™ Gateway çš„è¿‡æ»¤å™¨å†æ¬¡åšå¤„ç†ï¼Œé€»è¾‘ä¸Šå¯ä»¥ç§°ä½œ Post-Filtersï¼ŒPost å¯ä»¥ç†è§£ä¸ºâ€œåœ¨â€¦ä¹‹åâ€ã€‚</li>
<li><strong>å“åº”è¿”å›</strong>ï¼šå“åº”ç»è¿‡è¿‡æ»¤å¤„ç†åï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p>æ€»ç»“ï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚å…ˆé€šè¿‡åŒ¹é…è§„åˆ™æ‰¾åˆ°åˆé€‚çš„è·¯ç”±ï¼Œå°±èƒ½æ˜ å°„åˆ°å…·ä½“çš„æœåŠ¡ã€‚ç„¶åè¯·æ±‚ç»è¿‡è¿‡æ»¤å™¨å¤„ç†åè½¬å‘ç»™å…·ä½“çš„æœåŠ¡ï¼ŒæœåŠ¡å¤„ç†åï¼Œå†æ¬¡ç»è¿‡è¿‡æ»¤å™¨å¤„ç†ï¼Œæœ€åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<h2 id="Spring-Cloud-Gateway-çš„æ–­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Spring-Cloud-Gateway-çš„æ–­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Spring Cloud Gateway çš„æ–­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Spring Cloud Gateway çš„æ–­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>æ–­è¨€ï¼ˆPredicateï¼‰è¿™ä¸ªè¯å¬èµ·æ¥æå…¶æ·±å¥¥ï¼Œå®ƒæ˜¯ä¸€ç§ç¼–ç¨‹æœ¯è¯­ï¼Œæˆ‘ä»¬ç”Ÿæ´»ä¸­æ ¹æœ¬å°±ä¸ä¼šç”¨å®ƒã€‚è¯´ç™½äº†å®ƒå°±æ˜¯å¯¹ä¸€ä¸ªè¡¨è¾¾å¼è¿›è¡Œ if åˆ¤æ–­ï¼Œç»“æœä¸ºçœŸæˆ–å‡ï¼Œå¦‚æœä¸ºçœŸåˆ™åšè¿™ä»¶äº‹ï¼Œå¦åˆ™åšé‚£ä»¶äº‹ã€‚</p>
<p>åœ¨ Gateway ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ»¡è¶³äº†æ–­è¨€çš„æ¡ä»¶ï¼Œåˆ™æ˜ å°„åˆ°æŒ‡å®šçš„è·¯ç”±å™¨ï¼Œå°±èƒ½è½¬å‘åˆ°æŒ‡å®šçš„æœåŠ¡ä¸Šè¿›è¡Œå¤„ç†ã€‚</p>
<p>æ–­è¨€é…ç½®çš„ç¤ºä¾‹å¦‚ä¸‹ï¼Œé…ç½®äº†ä¸¤ä¸ªè·¯ç”±è§„åˆ™ï¼Œæœ‰ä¸€ä¸ª predicates æ–­è¨€é…ç½®ï¼Œå½“è¯·æ±‚ url ä¸­åŒ…å« <code>api/thirdparty</code>ï¼Œå°±åŒ¹é…åˆ°äº†ç¬¬ä¸€ä¸ªè·¯ç”± <code>route_thirdparty</code>ã€‚</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/system-design/distributed-system/api-gateway/spring-cloud-gateway-predicate-example.png" alt="æ–­è¨€é…ç½®ç¤ºä¾‹"></p>
<p>å¸¸è§çš„è·¯ç”±æ–­è¨€è§„åˆ™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/system-design/distributed-system/api-gateway/spring-cloud-gateway-predicate-rules.png" alt="Spring Cloud GateWay è·¯ç”±æ–­è¨€è§„åˆ™"></p>
<h2 id="Spring-Cloud-Gateway-çš„è·¯ç”±å’Œæ–­è¨€æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#Spring-Cloud-Gateway-çš„è·¯ç”±å’Œæ–­è¨€æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="Spring Cloud Gateway çš„è·¯ç”±å’Œæ–­è¨€æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>Spring Cloud Gateway çš„è·¯ç”±å’Œæ–­è¨€æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</h2><p>Route è·¯ç”±å’Œ Predicate æ–­è¨€çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼šï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/system-design/distributed-system/api-gateway/spring-cloud-gateway-predicate-route.png" alt="è·¯ç”±å’Œæ–­è¨€çš„å¯¹åº”å…³ç³»"></p>
<ul>
<li><strong>ä¸€å¯¹å¤š</strong>ï¼šä¸€ä¸ªè·¯ç”±è§„åˆ™å¯ä»¥åŒ…å«å¤šä¸ªæ–­è¨€ã€‚å¦‚ä¸Šå›¾ä¸­è·¯ç”± Route1 é…ç½®äº†ä¸‰ä¸ªæ–­è¨€ Predicateã€‚</li>
<li><strong>åŒæ—¶æ»¡è¶³</strong>ï¼šå¦‚æœä¸€ä¸ªè·¯ç”±è§„åˆ™ä¸­æœ‰å¤šä¸ªæ–­è¨€ï¼Œåˆ™éœ€è¦åŒæ—¶æ»¡è¶³æ‰èƒ½åŒ¹é…ã€‚å¦‚ä¸Šå›¾ä¸­è·¯ç”± Route2 é…ç½®äº†ä¸¤ä¸ªæ–­è¨€ï¼Œå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¿…é¡»åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ–­è¨€ï¼Œæ‰èƒ½åŒ¹é…è·¯ç”± Route2ã€‚</li>
<li><strong>ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸ</strong>ï¼šå¦‚æœä¸€ä¸ªè¯·æ±‚å¯ä»¥åŒ¹é…å¤šä¸ªè·¯ç”±ï¼Œåˆ™æ˜ å°„ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„è·¯ç”±ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ»¡è¶³ Route3 å’Œ Route4 çš„æ–­è¨€ï¼Œä½†æ˜¯ Route3 çš„é…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­é å‰ï¼Œæ‰€ä»¥åªä¼šåŒ¹é… Route3ã€‚</li>
</ul>
<h2 id="Spring-Cloud-Gateway-å¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±ï¼Ÿ"><a href="#Spring-Cloud-Gateway-å¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±ï¼Ÿ" class="headerlink" title="Spring Cloud Gateway å¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±ï¼Ÿ"></a>Spring Cloud Gateway å¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±ï¼Ÿ</h2><p>åœ¨ä½¿ç”¨ Spring Cloud Gateway çš„æ—¶å€™ï¼Œå®˜æ–¹æ–‡æ¡£æä¾›çš„æ–¹æ¡ˆæ€»æ˜¯åŸºäºé…ç½®æ–‡ä»¶æˆ–ä»£ç é…ç½®çš„æ–¹å¼ã€‚</p>
<p>Spring Cloud Gateway ä½œä¸ºå¾®æœåŠ¡çš„å…¥å£ï¼Œéœ€è¦å°½é‡é¿å…é‡å¯ï¼Œè€Œç°åœ¨é…ç½®æ›´æ”¹éœ€è¦é‡å¯æœåŠ¡ä¸èƒ½æ»¡è¶³å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­çš„åŠ¨æ€åˆ·æ–°ã€å®æ—¶å˜æ›´çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ Spring Cloud Gateway è¿è¡Œæ—¶åŠ¨æ€é…ç½®ç½‘å…³ã€‚</p>
<p>å®ç°åŠ¨æ€è·¯ç”±çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå…¶ä¸­ä¸€ç§æ¨èçš„æ–¹å¼æ˜¯åŸºäº Nacos æ³¨å†Œä¸­å¿ƒæ¥åšã€‚ Spring Cloud Gateway å¯ä»¥ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡çš„å…ƒæ•°æ®ï¼ˆä¾‹å¦‚æœåŠ¡åç§°ã€è·¯å¾„ç­‰ï¼‰ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆè·¯ç”±è§„åˆ™ã€‚è¿™æ ·ï¼Œå½“ä½ æ·»åŠ ã€ç§»é™¤æˆ–æ›´æ–°æœåŠ¡å®ä¾‹æ—¶ï¼Œç½‘å…³ä¼šè‡ªåŠ¨æ„ŸçŸ¥å¹¶ç›¸åº”åœ°è°ƒæ•´è·¯ç”±è§„åˆ™ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤è·¯ç”±é…ç½®ã€‚</p>
<p>å…¶å®è¿™äº›å¤æ‚çš„æ­¥éª¤å¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°ï¼Œé€šè¿‡ Nacos Server å’Œ Spring Cloud Alibaba Nacos Config å³å¯å®ç°é…ç½®çš„åŠ¨æ€å˜æ›´ï¼Œå®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config">https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config</a> ã€‚</p>
<h2 id="Spring-Cloud-Gateway-çš„è¿‡æ»¤å™¨æœ‰å“ªäº›ï¼Ÿ"><a href="#Spring-Cloud-Gateway-çš„è¿‡æ»¤å™¨æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Spring Cloud Gateway çš„è¿‡æ»¤å™¨æœ‰å“ªäº›ï¼Ÿ"></a>Spring Cloud Gateway çš„è¿‡æ»¤å™¨æœ‰å“ªäº›ï¼Ÿ</h2><p>è¿‡æ»¤å™¨ Filter æŒ‰ç…§è¯·æ±‚å’Œå“åº”å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><strong>Pre ç±»å‹</strong>ï¼šåœ¨è¯·æ±‚è¢«è½¬å‘åˆ°å¾®æœåŠ¡ä¹‹å‰ï¼Œå¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå’Œä¿®æ”¹ï¼Œä¾‹å¦‚å‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºä»¥åŠåè®®è½¬æ¢ç­‰æ“ä½œã€‚</li>
<li><strong>Post ç±»å‹</strong>ï¼šå¾®æœåŠ¡å¤„ç†å®Œè¯·æ±‚åï¼Œè¿”å›å“åº”ç»™ç½‘å…³ï¼Œç½‘å…³å¯ä»¥å†æ¬¡è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ä¿®æ”¹å“åº”å†…å®¹æˆ–å“åº”å¤´ã€æ—¥å¿—è¾“å‡ºã€æµé‡ç›‘æ§ç­‰ã€‚</li>
</ul>
<p>å¦å¤–ä¸€ç§åˆ†ç±»æ˜¯æŒ‰ç…§è¿‡æ»¤å™¨ Filter ä½œç”¨çš„èŒƒå›´è¿›è¡Œåˆ’åˆ†ï¼š</p>
<ul>
<li><strong>GatewayFilter</strong>ï¼šå±€éƒ¨è¿‡æ»¤å™¨ï¼Œåº”ç”¨åœ¨å•ä¸ªè·¯ç”±æˆ–ä¸€ç»„è·¯ç”±ä¸Šçš„è¿‡æ»¤å™¨ã€‚æ ‡çº¢è‰²è¡¨ç¤ºæ¯”è¾ƒå¸¸ç”¨çš„è¿‡æ»¤å™¨ã€‚</li>
<li><strong>GlobalFilter</strong>ï¼šå…¨å±€è¿‡æ»¤å™¨ï¼Œåº”ç”¨åœ¨æ‰€æœ‰è·¯ç”±ä¸Šçš„è¿‡æ»¤å™¨ã€‚</li>
</ul>
<h3 id="å±€éƒ¨è¿‡æ»¤å™¨"><a href="#å±€éƒ¨è¿‡æ»¤å™¨" class="headerlink" title="å±€éƒ¨è¿‡æ»¤å™¨"></a>å±€éƒ¨è¿‡æ»¤å™¨</h3><p>å¸¸è§çš„å±€éƒ¨è¿‡æ»¤å™¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/system-design/distributed-system/api-gateway/spring-cloud-gateway-gatewayfilters.png"></p>
<p>å…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸ªç¤ºä¾‹ï¼Œå¦‚æœ URL åŒ¹é…æˆåŠŸï¼Œåˆ™å»æ‰ URL ä¸­çš„ â€œapiâ€ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filters:</span> <span class="comment">#è¿‡æ»¤å™¨</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span> <span class="comment"># å°†è·³è½¬è·¯å¾„ä¸­åŒ…å«çš„ â€œapiâ€ æ›¿æ¢æˆç©º</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œæœ¬ç¯‡ä¸åšå±•å¼€ã€‚</p>
<h3 id="å…¨å±€è¿‡æ»¤å™¨"><a href="#å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨"></a>å…¨å±€è¿‡æ»¤å™¨</h3><p>å¸¸è§çš„å…¨å±€è¿‡æ»¤å™¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/system-design/distributed-system/api-gateway/spring-cloud-gateway-globalfilters.png"></p>
<p>å…¨å±€è¿‡æ»¤å™¨æœ€å¸¸è§çš„ç”¨æ³•æ˜¯è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">route_member</span> <span class="comment"># ç¬¬ä¸‰æ–¹å¾®æœåŠ¡è·¯ç”±è§„åˆ™</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://passjava-member</span> <span class="comment"># è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„ passjava-member æœåŠ¡</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># æ–­è¨€</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/member/**</span> <span class="comment"># å¦‚æœå‰ç«¯è¯·æ±‚è·¯å¾„åŒ…å« api/memberï¼Œåˆ™åº”ç”¨è¿™æ¡è·¯ç”±è§„åˆ™</span></span><br><span class="line">          <span class="attr">filters:</span> <span class="comment">#è¿‡æ»¤å™¨</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span> <span class="comment"># å°†è·³è½¬è·¯å¾„ä¸­åŒ…å«çš„apiæ›¿æ¢æˆç©º</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªå…³é”®å­— <code>lb</code>ï¼Œç”¨åˆ°äº†å…¨å±€è¿‡æ»¤å™¨ <code>LoadBalancerClientFilter</code>ï¼Œå½“åŒ¹é…åˆ°è¿™ä¸ªè·¯ç”±åï¼Œä¼šå°†è¯·æ±‚è½¬å‘åˆ° passjava-member æœåŠ¡ï¼Œä¸”æ”¯æŒè´Ÿè½½å‡è¡¡è½¬å‘ï¼Œä¹Ÿå°±æ˜¯å…ˆå°† passjava-member è§£ææˆå®é™…çš„å¾®æœåŠ¡çš„ host å’Œ portï¼Œç„¶åå†è½¬å‘ç»™å®é™…çš„å¾®æœåŠ¡ã€‚</p>
<h2 id="Spring-Cloud-Gateway-æ”¯æŒé™æµå—ï¼Ÿ"><a href="#Spring-Cloud-Gateway-æ”¯æŒé™æµå—ï¼Ÿ" class="headerlink" title="Spring Cloud Gateway æ”¯æŒé™æµå—ï¼Ÿ"></a>Spring Cloud Gateway æ”¯æŒé™æµå—ï¼Ÿ</h2><p>Spring Cloud Gateway è‡ªå¸¦äº†é™æµè¿‡æ»¤å™¨ï¼Œå¯¹åº”çš„æ¥å£æ˜¯ <code>RateLimiter</code>ï¼Œ<code>RateLimiter</code> æ¥å£åªæœ‰ä¸€ä¸ªå®ç°ç±» <code>RedisRateLimiter</code> ï¼ˆåŸºäº Redis + Lua å®ç°çš„é™æµï¼‰ï¼Œæä¾›çš„é™æµåŠŸèƒ½æ¯”è¾ƒç®€æ˜“ä¸”ä¸æ˜“ä½¿ç”¨ã€‚</p>
<p>ä» Sentinel 1.6.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒSentinel å¼•å…¥äº† Spring Cloud Gateway çš„é€‚é…æ¨¡å—ï¼Œå¯ä»¥æä¾›ä¸¤ç§èµ„æºç»´åº¦çš„é™æµï¼šroute ç»´åº¦å’Œè‡ªå®šä¹‰ API ç»´åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpring Cloud Gateway å¯ä»¥ç»“åˆ Sentinel å®ç°æ›´å¼ºå¤§çš„ç½‘å…³æµé‡æ§åˆ¶ã€‚</p>
<h2 id="Spring-Cloud-Gateway-å¦‚ä½•è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ï¼Ÿ"><a href="#Spring-Cloud-Gateway-å¦‚ä½•è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ï¼Ÿ" class="headerlink" title="Spring Cloud Gateway å¦‚ä½•è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ï¼Ÿ"></a>Spring Cloud Gateway å¦‚ä½•è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ï¼Ÿ</h2><p>åœ¨ SpringBoot é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ•è·å…¨å±€å¼‚å¸¸åªéœ€è¦åœ¨é¡¹ç›®ä¸­é…ç½® <code>@RestControllerAdvice</code>å’Œ <code>@ExceptionHandler</code>å°±å¯ä»¥äº†ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼åœ¨ Spring Cloud Gateway ä¸‹ä¸é€‚ç”¨ã€‚</p>
<p>Spring Cloud Gateway æä¾›äº†å¤šç§å…¨å±€å¤„ç†çš„æ–¹å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ˜¯å®ç°<code>ErrorWebExceptionHandler</code>å¹¶é‡å†™å…¶ä¸­çš„<code>handle</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalErrorWebExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">ErrorWebExceptionHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange, Throwable ex)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li>Spring Cloud Gateway å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/">https://cloud.spring.io/spring-cloud-gateway/reference/html/</a></li>
<li>Creating a custom Spring Cloud Gateway Filterï¼š<a href="https://spring.io/blog/2022/08/26/creating-a-custom-spring-cloud-gateway-filter">https://spring.io/blog/2022/08/26/creating-a-custom-spring-cloud-gateway-filter</a></li>
<li>å…¨å±€å¼‚å¸¸å¤„ç†: <a href="https://zhuanlan.zhihu.com/p/347028665">https://zhuanlan.zhihu.com/p/347028665</a></li>
</ul>
<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/22/computer-network-xiexiren-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/22/computer-network-xiexiren-summary/" itemprop="url">ã€Šè®¡ç®—æœºç½‘ç»œã€‹ï¼ˆè°¢å¸Œä»ï¼‰å†…å®¹æ€»ç»“</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-09-22T22:00:30+08:00">
                2020-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index">
                    <span itemprop="name">ç½‘ç»œ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/09/22/computer-network-xiexiren-summary/" class="leancloud_visitors" data-flag-title="ã€Šè®¡ç®—æœºç½‘ç»œã€‹ï¼ˆè°¢å¸Œä»ï¼‰å†…å®¹æ€»ç»“">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  11.2k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  39 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ¬æ–‡æ˜¯æˆ‘åœ¨å¤§äºŒå­¦ä¹ è®¡ç®—æœºç½‘ç»œæœŸé—´æ•´ç†ï¼Œ å¤§éƒ¨åˆ†å†…å®¹éƒ½æ¥è‡ªäºè°¢å¸Œä»è€å¸ˆçš„<a href="https://www.elias.ltd/usr/local/etc/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E7%AC%AC7%E7%89%88%EF%BC%89%E8%B0%A2%E5%B8%8C%E4%BB%81.pdf">ã€Šè®¡ç®—æœºç½‘ç»œã€‹ç¬¬ä¸ƒç‰ˆ</a>è¿™æœ¬ä¹¦ã€‚ä¸ºäº†å†…å®¹æ›´å®¹æ˜“ç†è§£ï¼Œæˆ‘å¯¹ä¹‹å‰çš„æ•´ç†è¿›è¡Œäº†ä¸€æ³¢é‡æ„ï¼Œå¹¶é…ä¸Šäº†ä¸€äº›ç›¸å…³çš„ç¤ºæ„å›¾ä¾¿äºç†è§£ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/fb5d8645cd55484ab0177f25a13e97db~tplv-k3u1fbpfcp-zoom-1.png"></p>
<p>ç›¸å…³é—®é¢˜ï¼š<a href="https://www.zhihu.com/question/327872966">å¦‚ä½•è¯„ä»·è°¢å¸Œä»çš„è®¡ç®—æœºç½‘ç»œï¼ˆç¬¬ä¸ƒç‰ˆï¼‰ï¼Ÿ - çŸ¥ä¹</a> ã€‚</p>
<h2 id="1-è®¡ç®—æœºç½‘ç»œæ¦‚è¿°"><a href="#1-è®¡ç®—æœºç½‘ç»œæ¦‚è¿°" class="headerlink" title="1. è®¡ç®—æœºç½‘ç»œæ¦‚è¿°"></a>1. è®¡ç®—æœºç½‘ç»œæ¦‚è¿°</h2><h3 id="1-1-åŸºæœ¬æœ¯è¯­"><a href="#1-1-åŸºæœ¬æœ¯è¯­" class="headerlink" title="1.1. åŸºæœ¬æœ¯è¯­"></a>1.1. åŸºæœ¬æœ¯è¯­</h3><ol>
<li><p><strong>ç»“ç‚¹ ï¼ˆnodeï¼‰</strong>ï¼šç½‘ç»œä¸­çš„ç»“ç‚¹å¯ä»¥æ˜¯è®¡ç®—æœºï¼Œé›†çº¿å™¨ï¼Œäº¤æ¢æœºæˆ–è·¯ç”±å™¨ç­‰ã€‚</p>
</li>
<li><p><strong>é“¾è·¯ï¼ˆlink ï¼‰</strong> : ä»ä¸€ä¸ªç»“ç‚¹åˆ°å¦ä¸€ä¸ªç»“ç‚¹çš„ä¸€æ®µç‰©ç†çº¿è·¯ã€‚ä¸­é—´æ²¡æœ‰ä»»ä½•å…¶ä»–äº¤ç‚¹ã€‚</p>
</li>
<li><p><strong>ä¸»æœºï¼ˆhostï¼‰</strong>ï¼šè¿æ¥åœ¨å› ç‰¹ç½‘ä¸Šçš„è®¡ç®—æœºã€‚</p>
</li>
<li><p><strong>ISPï¼ˆInternet Service Providerï¼‰</strong>ï¼šå› ç‰¹ç½‘æœåŠ¡æä¾›è€…ï¼ˆæä¾›å•†ï¼‰ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/e77e26123d404d438d0c5943e3c65893~tplv-k3u1fbpfcp-zoom-1.png" alt="ISP (Internet Service Provider) Definition"></p>
</li>
<li><p><strong>IXPï¼ˆInternet eXchange Pointï¼‰</strong>ï¼šäº’è”ç½‘äº¤æ¢ç‚¹ IXP çš„ä¸»è¦ä½œç”¨å°±æ˜¯å…è®¸ä¸¤ä¸ªç½‘ç»œç›´æ¥ç›¸è¿å¹¶äº¤æ¢åˆ†ç»„ï¼Œè€Œä¸éœ€è¦å†é€šè¿‡ç¬¬ä¸‰ä¸ªç½‘ç»œæ¥è½¬å‘åˆ†ç»„ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/7f9a6ddaa09441ceac11cb77f7a69d8f~tplv-k3u1fbpfcp-zoom-1.png" alt="IXP Traffic Levels During the Stratos Skydive â€” RIPE Labs"></p>
<p style="text-align:center;font-size:13px;color:gray">https://labs.ripe.net/Members/fergalc/ixp-traffic-during-stratos-skydive</p>
</li>
<li><p>**RFC(Request For Comments)**ï¼šæ„æ€æ˜¯â€œè¯·æ±‚è¯„è®®â€ï¼ŒåŒ…å«äº†å…³äº Internet å‡ ä¹æ‰€æœ‰çš„é‡è¦çš„æ–‡å­—èµ„æ–™ã€‚</p>
</li>
<li><p><strong>å¹¿åŸŸç½‘ WANï¼ˆWide Area Networkï¼‰</strong>ï¼šä»»åŠ¡æ˜¯é€šè¿‡é•¿è·ç¦»è¿é€ä¸»æœºå‘é€çš„æ•°æ®ã€‚</p>
</li>
<li><p><strong>åŸåŸŸç½‘ MANï¼ˆMetropolitan Area Networkï¼‰</strong>ï¼šç”¨æ¥å°†å¤šä¸ªå±€åŸŸç½‘è¿›è¡Œäº’è¿ã€‚</p>
</li>
<li><p><strong>å±€åŸŸç½‘ LANï¼ˆLocal Area Networkï¼‰</strong>ï¼šå­¦æ ¡æˆ–ä¼ä¸šå¤§å¤šæ‹¥æœ‰å¤šä¸ªäº’è¿çš„å±€åŸŸç½‘ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/eb48d21b2e984a63a26250010d7adac4~tplv-k3u1fbpfcp-zoom-1.png" alt="MAN &amp; WMAN | Red de Ã¡rea metropolitana, Redes informaticas, Par trenzado"></p>
<p style="text-align:center;font-size:13px;color:gray">http://conexionesmanwman.blogspot.com/</p>
</li>
<li><p><strong>ä¸ªäººåŒºåŸŸç½‘ PANï¼ˆPersonal Area Networkï¼‰</strong>ï¼šåœ¨ä¸ªäººå·¥ä½œçš„åœ°æ–¹æŠŠå±äºä¸ªäººä½¿ç”¨çš„ç”µå­è®¾å¤‡ç”¨æ— çº¿æŠ€æœ¯è¿æ¥èµ·æ¥çš„ç½‘ç»œ ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/54bd7b420388494fbe917e3c9c13f1a7~tplv-k3u1fbpfcp-zoom-1.png" alt="Advantages and disadvantages of personal area network (PAN) - IT Release"></p>
<p style="text-align:center;font-size:13px;color:gray">https://www.itrelease.com/2018/07/advantages-and-disadvantages-of-personal-area-network-pan/</p>
</li>
<li><p><strong>åˆ†ç»„ï¼ˆpacket ï¼‰</strong>ï¼šå› ç‰¹ç½‘ä¸­ä¼ é€çš„æ•°æ®å•å…ƒã€‚ç”±é¦–éƒ¨ header å’Œæ•°æ®æ®µç»„æˆã€‚åˆ†ç»„åˆç§°ä¸ºåŒ…ï¼Œé¦–éƒ¨å¯ç§°ä¸ºåŒ…å¤´ã€‚</p>
</li>
<li><p><strong>å­˜å‚¨è½¬å‘ï¼ˆstore and forward ï¼‰</strong>ï¼šè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªåˆ†ç»„ï¼Œå…ˆæ£€æŸ¥åˆ†ç»„æ˜¯å¦æ­£ç¡®ï¼Œå¹¶è¿‡æ»¤æ‰å†²çªåŒ…é”™è¯¯ã€‚ç¡®å®šåŒ…æ­£ç¡®åï¼Œå–å‡ºç›®çš„åœ°å€ï¼Œé€šè¿‡æŸ¥æ‰¾è¡¨æ‰¾åˆ°æƒ³è¦å‘é€çš„è¾“å‡ºç«¯å£åœ°å€ï¼Œç„¶åå°†è¯¥åŒ…å‘é€å‡ºå»ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/addb6b2211444a4da9e0ffc129dd444f~tplv-k3u1fbpfcp-zoom-1.gif"></p>
</li>
<li><p><strong>å¸¦å®½ï¼ˆbandwidthï¼‰</strong>ï¼šåœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œè¡¨ç¤ºåœ¨å•ä½æ—¶é—´å†…ä»ç½‘ç»œä¸­çš„æŸä¸€ç‚¹åˆ°å¦ä¸€ç‚¹æ‰€èƒ½é€šè¿‡çš„â€œæœ€é«˜æ•°æ®ç‡â€ã€‚å¸¸ç”¨æ¥è¡¨ç¤ºç½‘ç»œçš„é€šä¿¡çº¿è·¯æ‰€èƒ½ä¼ é€æ•°æ®çš„èƒ½åŠ›ã€‚å•ä½æ˜¯â€œæ¯”ç‰¹æ¯ç§’â€ï¼Œè®°ä¸º b&#x2F;sã€‚</p>
</li>
<li><p><strong>ååé‡ï¼ˆthroughput ï¼‰</strong>ï¼šè¡¨ç¤ºåœ¨å•ä½æ—¶é—´å†…é€šè¿‡æŸä¸ªç½‘ç»œï¼ˆæˆ–ä¿¡é“ã€æ¥å£ï¼‰çš„æ•°æ®é‡ã€‚ååé‡æ›´ç»å¸¸åœ°ç”¨äºå¯¹ç°å®ä¸–ç•Œä¸­çš„ç½‘ç»œçš„ä¸€ç§æµ‹é‡ï¼Œä»¥ä¾¿çŸ¥é“å®é™…ä¸Šåˆ°åº•æœ‰å¤šå°‘æ•°æ®é‡èƒ½å¤Ÿé€šè¿‡ç½‘ç»œã€‚ååé‡å—ç½‘ç»œçš„å¸¦å®½æˆ–ç½‘ç»œçš„é¢å®šé€Ÿç‡çš„é™åˆ¶ã€‚</p>
</li>
</ol>
<h3 id="1-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#1-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="1.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"></a>1.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“</h3><ol>
<li><strong>è®¡ç®—æœºç½‘ç»œï¼ˆç®€ç§°ç½‘ç»œï¼‰æŠŠè®¸å¤šè®¡ç®—æœºè¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œäº’è”ç½‘æŠŠè®¸å¤šç½‘ç»œè¿æ¥åœ¨ä¸€èµ·ï¼Œæ˜¯ç½‘ç»œçš„ç½‘ç»œã€‚</strong></li>
<li>å°å†™å­—æ¯ i å¼€å¤´çš„ internetï¼ˆäº’è”ç½‘ï¼‰æ˜¯é€šç”¨åè¯ï¼Œå®ƒæ³›æŒ‡ç”±å¤šä¸ªè®¡ç®—æœºç½‘ç»œç›¸äº’è¿æ¥è€Œæˆçš„ç½‘ç»œã€‚åœ¨è¿™äº›ç½‘ç»œä¹‹é—´çš„é€šä¿¡åè®®ï¼ˆå³é€šä¿¡è§„åˆ™ï¼‰å¯ä»¥æ˜¯ä»»æ„çš„ã€‚å¤§å†™å­—æ¯ I å¼€å¤´çš„ Internetï¼ˆäº’è”ç½‘ï¼‰æ˜¯ä¸“ç”¨åè¯ï¼Œå®ƒæŒ‡å…¨çƒæœ€å¤§çš„ï¼Œå¼€æ”¾çš„ï¼Œç”±ä¼—å¤šç½‘ç»œç›¸äº’è¿æ¥è€Œæˆçš„ç‰¹å®šçš„äº’è”ç½‘ï¼Œå¹¶é‡‡ç”¨ TCP&#x2F;IP åè®®ä½œä¸ºé€šä¿¡è§„åˆ™ï¼Œå…¶å‰èº«ä¸º ARPANETã€‚Internet çš„æ¨èè¯‘åä¸ºå› ç‰¹ç½‘ï¼Œç°åœ¨ä¸€èˆ¬æµè¡Œç§°ä¸ºäº’è”ç½‘ã€‚</li>
<li>è·¯ç”±å™¨æ˜¯å®ç°åˆ†ç»„äº¤æ¢çš„å…³é”®æ„ä»¶ï¼Œå…¶ä»»åŠ¡æ˜¯è½¬å‘æ”¶åˆ°çš„åˆ†ç»„ï¼Œè¿™æ˜¯ç½‘ç»œæ ¸å¿ƒéƒ¨åˆ†æœ€é‡è¦çš„åŠŸèƒ½ã€‚åˆ†ç»„äº¤æ¢é‡‡ç”¨å­˜å‚¨è½¬å‘æŠ€æœ¯ï¼Œè¡¨ç¤ºæŠŠä¸€ä¸ªæŠ¥æ–‡ï¼ˆè¦å‘é€çš„æ•´å—æ•°æ®ï¼‰åˆ†ä¸ºå‡ ä¸ªåˆ†ç»„åå†è¿›è¡Œä¼ é€ã€‚åœ¨å‘é€æŠ¥æ–‡ä¹‹å‰ï¼Œå…ˆæŠŠè¾ƒé•¿çš„æŠ¥æ–‡åˆ’åˆ†æˆä¸ºä¸€ä¸ªä¸ªæ›´å°çš„ç­‰é•¿æ•°æ®æ®µã€‚åœ¨æ¯ä¸ªæ•°æ®æ®µçš„å‰é¢åŠ ä¸Šä¸€äº›ç”±å¿…è¦çš„æ§åˆ¶ä¿¡æ¯ç»„æˆçš„é¦–éƒ¨åï¼Œå°±æ„æˆäº†ä¸€ä¸ªåˆ†ç»„ã€‚åˆ†ç»„åˆç§°ä¸ºåŒ…ã€‚åˆ†ç»„æ˜¯åœ¨äº’è”ç½‘ä¸­ä¼ é€çš„æ•°æ®å•å…ƒï¼Œæ­£æ˜¯ç”±äºåˆ†ç»„çš„å¤´éƒ¨åŒ…å«äº†è¯¸å¦‚ç›®çš„åœ°å€å’Œæºåœ°å€ç­‰é‡è¦æ§åˆ¶ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªåˆ†ç»„æ‰èƒ½åœ¨äº’è”ç½‘ä¸­ç‹¬ç«‹çš„é€‰æ‹©ä¼ è¾“è·¯å¾„ï¼Œå¹¶æ­£ç¡®åœ°äº¤ä»˜åˆ°åˆ†ç»„ä¼ è¾“çš„ç»ˆç‚¹ã€‚</li>
<li>äº’è”ç½‘æŒ‰å·¥ä½œæ–¹å¼å¯åˆ’åˆ†ä¸ºè¾¹ç¼˜éƒ¨åˆ†å’Œæ ¸å¿ƒéƒ¨åˆ†ã€‚ä¸»æœºåœ¨ç½‘ç»œçš„è¾¹ç¼˜éƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯è¿›è¡Œä¿¡æ¯å¤„ç†ã€‚ç”±å¤§é‡ç½‘ç»œå’Œè¿æ¥è¿™äº›ç½‘ç»œçš„è·¯ç”±å™¨ç»„æˆæ ¸å¿ƒéƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯æä¾›è¿é€šæ€§å’Œäº¤æ¢ã€‚</li>
<li>è®¡ç®—æœºé€šä¿¡æ˜¯è®¡ç®—æœºä¸­è¿›ç¨‹ï¼ˆå³è¿è¡Œç€çš„ç¨‹åºï¼‰ä¹‹é—´çš„é€šä¿¡ã€‚è®¡ç®—æœºç½‘ç»œé‡‡ç”¨çš„é€šä¿¡æ–¹å¼æ˜¯å®¢æˆ·-æœåŠ¡å™¨æ–¹å¼ï¼ˆC&#x2F;S æ–¹å¼ï¼‰å’Œå¯¹ç­‰è¿æ¥æ–¹å¼ï¼ˆP2P æ–¹å¼ï¼‰ã€‚</li>
<li>å®¢æˆ·å’ŒæœåŠ¡å™¨éƒ½æ˜¯æŒ‡é€šä¿¡ä¸­æ‰€æ¶‰åŠçš„åº”ç”¨è¿›ç¨‹ã€‚å®¢æˆ·æ˜¯æœåŠ¡è¯·æ±‚æ–¹ï¼ŒæœåŠ¡å™¨æ˜¯æœåŠ¡æä¾›æ–¹ã€‚</li>
<li>æŒ‰ç…§ä½œç”¨èŒƒå›´çš„ä¸åŒï¼Œè®¡ç®—æœºç½‘ç»œåˆ†ä¸ºå¹¿åŸŸç½‘ WANï¼ŒåŸåŸŸç½‘ MANï¼Œå±€åŸŸç½‘ LANï¼Œä¸ªäººåŒºåŸŸç½‘ PANã€‚</li>
<li><strong>è®¡ç®—æœºç½‘ç»œæœ€å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡æ˜¯ï¼šé€Ÿç‡ï¼Œå¸¦å®½ï¼Œååé‡ï¼Œæ—¶å»¶ï¼ˆå‘é€æ—¶å»¶ï¼Œå¤„ç†æ—¶å»¶ï¼Œæ’é˜Ÿæ—¶å»¶ï¼‰ï¼Œæ—¶å»¶å¸¦å®½ç§¯ï¼Œå¾€è¿”æ—¶é—´å’Œä¿¡é“åˆ©ç”¨ç‡ã€‚</strong></li>
<li>ç½‘ç»œåè®®å³åè®®ï¼Œæ˜¯ä¸ºè¿›è¡Œç½‘ç»œä¸­çš„æ•°æ®äº¤æ¢è€Œå»ºç«‹çš„è§„åˆ™ã€‚è®¡ç®—æœºç½‘ç»œçš„å„å±‚ä»¥åŠå…¶åè®®é›†åˆï¼Œç§°ä¸ºç½‘ç»œçš„ä½“ç³»ç»“æ„ã€‚</li>
<li><strong>äº”å±‚ä½“ç³»ç»“æ„ç”±åº”ç”¨å±‚ï¼Œè¿è¾“å±‚ï¼Œç½‘ç»œå±‚ï¼ˆç½‘é™…å±‚ï¼‰ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œç‰©ç†å±‚ç»„æˆã€‚è¿è¾“å±‚æœ€ä¸»è¦çš„åè®®æ˜¯ TCP å’Œ UDP åè®®ï¼Œç½‘ç»œå±‚æœ€é‡è¦çš„åè®®æ˜¯ IP åè®®ã€‚</strong></li>
</ol>
<p><img src="https://oss.javaguide.cn/p3-juejin/acec0fa44041449b8088872dcd7c0b3a~tplv-k3u1fbpfcp-zoom-1.gif"></p>
<p>ä¸‹é¢çš„å†…å®¹ä¼šä»‹ç»è®¡ç®—æœºç½‘ç»œçš„äº”å±‚ä½“ç³»ç»“æ„ï¼š<strong>ç‰©ç†å±‚+æ•°æ®é“¾è·¯å±‚+ç½‘ç»œå±‚ï¼ˆç½‘é™…å±‚ï¼‰+è¿è¾“å±‚+åº”ç”¨å±‚</strong>ã€‚</p>
<h2 id="2-ç‰©ç†å±‚ï¼ˆPhysical-Layerï¼‰"><a href="#2-ç‰©ç†å±‚ï¼ˆPhysical-Layerï¼‰" class="headerlink" title="2. ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰"></a>2. ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰</h2><p><img src="https://oss.javaguide.cn/p3-juejin/cf1bfdd36e5f4bde94aea44bbe7a6f8a~tplv-k3u1fbpfcp-zoom-1.png" alt="ç‰©ç†å±‚"></p>
<h3 id="2-1-åŸºæœ¬æœ¯è¯­"><a href="#2-1-åŸºæœ¬æœ¯è¯­" class="headerlink" title="2.1. åŸºæœ¬æœ¯è¯­"></a>2.1. åŸºæœ¬æœ¯è¯­</h3><ol>
<li><p><strong>æ•°æ®ï¼ˆdataï¼‰</strong>ï¼šè¿é€æ¶ˆæ¯çš„å®ä½“ã€‚</p>
</li>
<li><p><strong>ä¿¡å·ï¼ˆsignalï¼‰</strong>ï¼šæ•°æ®çš„ç”µæ°”çš„æˆ–ç”µç£çš„è¡¨ç°ã€‚æˆ–è€…è¯´ä¿¡å·æ˜¯é€‚åˆåœ¨ä¼ è¾“ä»‹è´¨ä¸Šä¼ è¾“çš„å¯¹è±¡ã€‚</p>
</li>
<li><p><strong>ç å…ƒï¼ˆ codeï¼‰</strong>ï¼šåœ¨ä½¿ç”¨æ—¶é—´åŸŸï¼ˆæˆ–ç®€ç§°ä¸ºæ—¶åŸŸï¼‰çš„æ³¢å½¢æ¥è¡¨ç¤ºæ•°å­—ä¿¡å·æ—¶ï¼Œä»£è¡¨ä¸åŒç¦»æ•£æ•°å€¼çš„åŸºæœ¬æ³¢å½¢ã€‚</p>
</li>
<li><p><strong>å•å·¥ï¼ˆsimplex ï¼‰</strong>ï¼šåªèƒ½æœ‰ä¸€ä¸ªæ–¹å‘çš„é€šä¿¡è€Œæ²¡æœ‰åæ–¹å‘çš„äº¤äº’ã€‚</p>
</li>
<li><p><strong>åŠåŒå·¥ï¼ˆhalf duplex ï¼‰</strong>ï¼šé€šä¿¡çš„åŒæ–¹éƒ½å¯ä»¥å‘é€ä¿¡æ¯ï¼Œä½†ä¸èƒ½åŒæ–¹åŒæ—¶å‘é€(å½“ç„¶ä¹Ÿå°±ä¸èƒ½åŒæ—¶æ¥æ”¶)ã€‚</p>
</li>
<li><p><strong>å…¨åŒå·¥ï¼ˆfull duplexï¼‰</strong>ï¼šé€šä¿¡çš„åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶ä¿¡æ¯ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/b1f02095b7c34eafb3c255ee81f58c2a~tplv-k3u1fbpfcp-zoom-1.png"></p>
</li>
<li><p><strong>å¤±çœŸ</strong>ï¼šå¤±å»çœŸå®æ€§ï¼Œä¸»è¦æ˜¯æŒ‡æ¥å—åˆ°çš„ä¿¡å·å’Œå‘é€çš„ä¿¡å·ä¸åŒï¼Œæœ‰ç£¨æŸå’Œè¡°å‡ã€‚å½±å“å¤±çœŸç¨‹åº¦çš„å› ç´ ï¼š1.ç å…ƒä¼ è¾“é€Ÿç‡ 2.ä¿¡å·ä¼ è¾“è·ç¦» 3.å™ªå£°å¹²æ‰° 4.ä¼ è¾“åª’ä½“è´¨é‡</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/f939342f543046459ffabdc476f7bca4~tplv-k3u1fbpfcp-zoom-1.png"></p>
</li>
<li><p><strong>å¥ˆæ°å‡†åˆ™</strong>ï¼šåœ¨ä»»ä½•ä¿¡é“ä¸­ï¼Œç å…ƒçš„ä¼ è¾“çš„æ•ˆç‡æ˜¯æœ‰ä¸Šé™çš„ï¼Œä¼ è¾“é€Ÿç‡è¶…è¿‡æ­¤ä¸Šé™ï¼Œå°±ä¼šå‡ºç°ä¸¥é‡çš„ç é—´ä¸²æ‰°é—®é¢˜ï¼Œä½¿æ¥æ”¶ç«¯å¯¹ç å…ƒçš„åˆ¤å†³ï¼ˆå³è¯†åˆ«ï¼‰æˆä¸ºä¸å¯èƒ½ã€‚</p>
</li>
<li><p><strong>é¦™å†œå®šç†</strong>ï¼šåœ¨å¸¦å®½å—é™ä¸”æœ‰å™ªå£°çš„ä¿¡é“ä¸­ï¼Œä¸ºäº†ä¸äº§ç”Ÿè¯¯å·®ï¼Œä¿¡æ¯çš„æ•°æ®ä¼ è¾“é€Ÿç‡æœ‰ä¸Šé™å€¼ã€‚</p>
</li>
<li><p><strong>åŸºå¸¦ä¿¡å·ï¼ˆbaseband signalï¼‰</strong>ï¼šæ¥è‡ªä¿¡æºçš„ä¿¡å·ã€‚æŒ‡æ²¡æœ‰ç»è¿‡è°ƒåˆ¶çš„æ•°å­—ä¿¡å·æˆ–æ¨¡æ‹Ÿä¿¡å·ã€‚</p>
</li>
<li><p><strong>å¸¦é€šï¼ˆé¢‘å¸¦ï¼‰ä¿¡å·ï¼ˆbandpass signalï¼‰</strong>ï¼šæŠŠåŸºå¸¦ä¿¡å·ç»è¿‡è½½æ³¢è°ƒåˆ¶åï¼ŒæŠŠä¿¡å·çš„é¢‘ç‡èŒƒå›´æ¬ç§»åˆ°è¾ƒé«˜çš„é¢‘æ®µä»¥ä¾¿åœ¨ä¿¡é“ä¸­ä¼ è¾“ï¼ˆå³ä»…åœ¨ä¸€æ®µé¢‘ç‡èŒƒå›´å†…èƒ½å¤Ÿé€šè¿‡ä¿¡é“ï¼‰ï¼Œè¿™é‡Œè°ƒåˆ¶è¿‡åçš„ä¿¡å·å°±æ˜¯å¸¦é€šä¿¡å·ã€‚</p>
</li>
<li><p><strong>è°ƒåˆ¶ï¼ˆmodulation ï¼‰</strong>ï¼šå¯¹ä¿¡å·æºçš„ä¿¡æ¯è¿›è¡Œå¤„ç†ååŠ åˆ°è½½æ³¢ä¿¡å·ä¸Šï¼Œä½¿å…¶å˜ä¸ºé€‚åˆåœ¨ä¿¡é“ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p><strong>ä¿¡å™ªæ¯”ï¼ˆsignal-to-noise ratio ï¼‰</strong>ï¼šæŒ‡ä¿¡å·çš„å¹³å‡åŠŸç‡å’Œå™ªå£°çš„å¹³å‡åŠŸç‡ä¹‹æ¯”ï¼Œè®°ä¸º S&#x2F;Nã€‚ä¿¡å™ªæ¯”ï¼ˆdBï¼‰&#x3D;10*log10ï¼ˆS&#x2F;Nï¼‰ã€‚</p>
</li>
<li><p><strong>ä¿¡é“å¤ç”¨ï¼ˆchannel multiplexing ï¼‰</strong>ï¼šæŒ‡å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªä¿¡é“ã€‚ï¼ˆå¹¶ä¸ä¸€å®šæ˜¯åŒæ—¶ï¼‰ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/5d9bf7b3db324ae7a88fcedcbace45d8~tplv-k3u1fbpfcp-zoom-1.png" alt="ä¿¡é“å¤ç”¨æŠ€æœ¯"></p>
</li>
<li><p><strong>æ¯”ç‰¹ç‡ï¼ˆbit rate ï¼‰</strong>ï¼šå•ä½æ—¶é—´ï¼ˆæ¯ç§’ï¼‰å†…ä¼ é€çš„æ¯”ç‰¹æ•°ã€‚</p>
</li>
<li><p><strong>æ³¢ç‰¹ç‡ï¼ˆbaud rateï¼‰</strong>ï¼šå•ä½æ—¶é—´è½½æ³¢è°ƒåˆ¶çŠ¶æ€æ”¹å˜çš„æ¬¡æ•°ã€‚é’ˆå¯¹æ•°æ®ä¿¡å·å¯¹è½½æ³¢çš„è°ƒåˆ¶é€Ÿç‡ã€‚</p>
</li>
<li><p><strong>å¤ç”¨ï¼ˆmultiplexingï¼‰</strong>ï¼šå…±äº«ä¿¡é“çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>ADSLï¼ˆAsymmetric Digital Subscriber Line ï¼‰</strong>ï¼šéå¯¹ç§°æ•°å­—ç”¨æˆ·çº¿ã€‚</p>
</li>
<li><p><strong>å…‰çº¤åŒè½´æ··åˆç½‘ï¼ˆHFC ç½‘ï¼‰</strong>ï¼šåœ¨ç›®å‰è¦†ç›–èŒƒå›´å¾ˆå¹¿çš„æœ‰çº¿ç”µè§†ç½‘çš„åŸºç¡€ä¸Šå¼€å‘çš„ä¸€ç§å±…æ°‘å®½å¸¦æ¥å…¥ç½‘</p>
</li>
</ol>
<h3 id="2-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#2-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="2.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"></a>2.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“</h3><ol>
<li><strong>ç‰©ç†å±‚çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯ç¡®å®šä¸ä¼ è¾“åª’ä½“æ¥å£æœ‰å…³çš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚æœºæ¢°ç‰¹æ€§ï¼Œç”µæ°”ç‰¹æ€§ï¼ŒåŠŸèƒ½ç‰¹æ€§ï¼Œè¿‡ç¨‹ç‰¹æ€§ã€‚</strong></li>
<li>ä¸€ä¸ªæ•°æ®é€šä¿¡ç³»ç»Ÿå¯åˆ’åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼Œå³æºç³»ç»Ÿï¼Œä¼ è¾“ç³»ç»Ÿï¼Œç›®çš„ç³»ç»Ÿã€‚æºç³»ç»ŸåŒ…æ‹¬æºç‚¹ï¼ˆæˆ–æºç«™ï¼Œä¿¡æºï¼‰å’Œå‘é€å™¨ï¼Œç›®çš„ç³»ç»ŸåŒ…æ‹¬æ¥æ”¶å™¨å’Œç»ˆç‚¹ã€‚</li>
<li><strong>é€šä¿¡çš„ç›®çš„æ˜¯ä¼ é€æ¶ˆæ¯ã€‚å¦‚è¯éŸ³ï¼Œæ–‡å­—ï¼Œå›¾åƒç­‰éƒ½æ˜¯æ¶ˆæ¯ï¼Œæ•°æ®æ˜¯è¿é€æ¶ˆæ¯çš„å®ä½“ã€‚ä¿¡å·åˆ™æ˜¯æ•°æ®çš„ç”µæ°”æˆ–ç”µç£çš„è¡¨ç°ã€‚</strong></li>
<li>æ ¹æ®ä¿¡å·ä¸­ä»£è¡¨æ¶ˆæ¯çš„å‚æ•°çš„å–å€¼æ–¹å¼ä¸åŒï¼Œä¿¡å·å¯åˆ†ä¸ºæ¨¡æ‹Ÿä¿¡å·ï¼ˆæˆ–è¿ç»­ä¿¡å·ï¼‰å’Œæ•°å­—ä¿¡å·ï¼ˆæˆ–ç¦»æ•£ä¿¡å·ï¼‰ã€‚åœ¨ä½¿ç”¨æ—¶é—´åŸŸï¼ˆç®€ç§°æ—¶åŸŸï¼‰çš„æ³¢å½¢è¡¨ç¤ºæ•°å­—ä¿¡å·æ—¶ï¼Œä»£è¡¨ä¸åŒç¦»æ•£æ•°å€¼çš„åŸºæœ¬æ³¢å½¢ç§°ä¸ºç å…ƒã€‚</li>
<li>æ ¹æ®åŒæ–¹ä¿¡æ¯äº¤äº’çš„æ–¹å¼ï¼Œé€šä¿¡å¯åˆ’åˆ†ä¸ºå•å‘é€šä¿¡ï¼ˆæˆ–å•å·¥é€šä¿¡ï¼‰ï¼ŒåŒå‘äº¤æ›¿é€šä¿¡ï¼ˆæˆ–åŠåŒå·¥é€šä¿¡ï¼‰ï¼ŒåŒå‘åŒæ—¶é€šä¿¡ï¼ˆå…¨åŒå·¥é€šä¿¡ï¼‰ã€‚</li>
<li>æ¥è‡ªä¿¡æºçš„ä¿¡å·ç§°ä¸ºåŸºå¸¦ä¿¡å·ã€‚ä¿¡å·è¦åœ¨ä¿¡é“ä¸Šä¼ è¾“å°±è¦ç»è¿‡è°ƒåˆ¶ã€‚è°ƒåˆ¶æœ‰åŸºå¸¦è°ƒåˆ¶å’Œå¸¦é€šè°ƒåˆ¶ä¹‹åˆ†ã€‚æœ€åŸºæœ¬çš„å¸¦é€šè°ƒåˆ¶æ–¹æ³•æœ‰è°ƒå¹…ï¼Œè°ƒé¢‘å’Œè°ƒç›¸ã€‚è¿˜æœ‰æ›´å¤æ‚çš„è°ƒåˆ¶æ–¹æ³•ï¼Œå¦‚æ­£äº¤æŒ¯å¹…è°ƒåˆ¶ã€‚</li>
<li>è¦æé«˜æ•°æ®åœ¨ä¿¡é“ä¸Šçš„ä¼ é€’é€Ÿç‡ï¼Œå¯ä»¥ä½¿ç”¨æ›´å¥½çš„ä¼ è¾“åª’ä½“ï¼Œæˆ–ä½¿ç”¨å…ˆè¿›çš„è°ƒåˆ¶æŠ€æœ¯ã€‚ä½†æ•°æ®ä¼ è¾“é€Ÿç‡ä¸å¯èƒ½ä»»æ„è¢«æé«˜ã€‚</li>
<li>ä¼ è¾“åª’ä½“å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œå³å¯¼å¼•å‹ä¼ è¾“åª’ä½“ï¼ˆåŒç»çº¿ï¼ŒåŒè½´ç”µç¼†ï¼Œå…‰çº¤ï¼‰å’Œéå¯¼å¼•å‹ä¼ è¾“åª’ä½“ï¼ˆæ— çº¿ï¼Œçº¢å¤–ï¼Œå¤§æ°”æ¿€å…‰ï¼‰ã€‚</li>
<li>ä¸ºäº†æœ‰æ•ˆåˆ©ç”¨å…‰çº¤èµ„æºï¼Œåœ¨å…‰çº¤å¹²çº¿å’Œç”¨æˆ·ä¹‹é—´å¹¿æ³›ä½¿ç”¨æ— æºå…‰ç½‘ç»œ PONã€‚æ— æºå…‰ç½‘ç»œæ— éœ€é…å¤‡ç”µæºï¼Œå…¶é•¿æœŸè¿è¥æˆæœ¬å’Œç®¡ç†æˆæœ¬éƒ½å¾ˆä½ã€‚æœ€æµè¡Œçš„æ— æºå…‰ç½‘ç»œæ˜¯ä»¥å¤ªç½‘æ— æºå…‰ç½‘ç»œ EPON å’Œå‰æ¯”ç‰¹æ— æºå…‰ç½‘ç»œ GPONã€‚</li>
</ol>
<h3 id="2-3-è¡¥å……"><a href="#2-3-è¡¥å……" class="headerlink" title="2.3. è¡¥å……"></a>2.3. è¡¥å……</h3><h4 id="2-3-1-ç‰©ç†å±‚ä¸»è¦åšå•¥ï¼Ÿ"><a href="#2-3-1-ç‰©ç†å±‚ä¸»è¦åšå•¥ï¼Ÿ" class="headerlink" title="2.3.1. ç‰©ç†å±‚ä¸»è¦åšå•¥ï¼Ÿ"></a>2.3.1. ç‰©ç†å±‚ä¸»è¦åšå•¥ï¼Ÿ</h4><p>ç‰©ç†å±‚ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯ <strong>é€æ˜åœ°ä¼ é€æ¯”ç‰¹æµ</strong>ã€‚ä¹Ÿå¯ä»¥å°†ç‰©ç†å±‚çš„ä¸»è¦ä»»åŠ¡æè¿°ä¸ºç¡®å®šä¸ä¼ è¾“åª’ä½“çš„æ¥å£çš„ä¸€äº›ç‰¹æ€§ï¼Œå³ï¼šæœºæ¢°ç‰¹æ€§ï¼ˆæ¥å£æ‰€ç”¨æ¥çº¿å™¨çš„ä¸€äº›ç‰©ç†å±æ€§å¦‚å½¢çŠ¶å’Œå°ºå¯¸ï¼‰ï¼Œç”µæ°”ç‰¹æ€§ï¼ˆæ¥å£ç”µç¼†çš„å„æ¡çº¿ä¸Šå‡ºç°çš„ç”µå‹çš„èŒƒå›´ï¼‰ï¼ŒåŠŸèƒ½ç‰¹æ€§ï¼ˆæŸæ¡çº¿ä¸Šå‡ºç°çš„æŸä¸€ç”µå¹³çš„ç”µå‹çš„æ„ä¹‰ï¼‰ï¼Œè¿‡ç¨‹ç‰¹æ€§ï¼ˆå¯¹äºä¸åŒåŠŸèƒ½çš„å„ç§å¯èƒ½äº‹ä»¶çš„å‡ºç°é¡ºåºï¼‰ã€‚</p>
<p><strong>ç‰©ç†å±‚è€ƒè™‘çš„æ˜¯æ€æ ·æ‰èƒ½åœ¨è¿æ¥å„ç§è®¡ç®—æœºçš„ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚</strong> ç°æœ‰çš„è®¡ç®—æœºç½‘ç»œä¸­çš„ç¡¬ä»¶è®¾å¤‡å’Œä¼ è¾“åª’ä½“çš„ç§ç±»éå¸¸ç¹å¤šï¼Œè€Œä¸”é€šä¿¡æ‰‹æ®µä¹Ÿæœ‰è®¸å¤šä¸åŒçš„æ–¹å¼ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ­£æ˜¯å°½å¯èƒ½åœ°å±è”½æ‰è¿™äº›ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µçš„å·®å¼‚ï¼Œä½¿ç‰©ç†å±‚ä¸Šé¢çš„æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿æ•°æ®é“¾è·¯å±‚åªè€ƒè™‘å®Œæˆæœ¬å±‚çš„åè®®å’ŒæœåŠ¡ï¼Œè€Œä¸å¿…è€ƒè™‘ç½‘ç»œçš„å…·ä½“ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µæ˜¯ä»€ä¹ˆã€‚</p>
<h4 id="2-3-2-å‡ ç§å¸¸ç”¨çš„ä¿¡é“å¤ç”¨æŠ€æœ¯"><a href="#2-3-2-å‡ ç§å¸¸ç”¨çš„ä¿¡é“å¤ç”¨æŠ€æœ¯" class="headerlink" title="2.3.2. å‡ ç§å¸¸ç”¨çš„ä¿¡é“å¤ç”¨æŠ€æœ¯"></a>2.3.2. å‡ ç§å¸¸ç”¨çš„ä¿¡é“å¤ç”¨æŠ€æœ¯</h4><ol>
<li>**é¢‘åˆ†å¤ç”¨(FDM)**ï¼šæ‰€æœ‰ç”¨æˆ·åœ¨åŒæ ·çš„æ—¶é—´å ç”¨ä¸åŒçš„å¸¦å®½èµ„æºã€‚</li>
<li><strong>æ—¶åˆ†å¤ç”¨ï¼ˆTDMï¼‰</strong>ï¼šæ‰€æœ‰ç”¨æˆ·åœ¨ä¸åŒçš„æ—¶é—´å ç”¨åŒæ ·çš„é¢‘å¸¦å®½åº¦ï¼ˆåˆ†æ—¶ä¸åˆ†é¢‘ï¼‰ã€‚</li>
<li>**ç»Ÿè®¡æ—¶åˆ†å¤ç”¨ (Statistic TDM)**ï¼šæ”¹è¿›çš„æ—¶åˆ†å¤ç”¨ï¼Œèƒ½å¤Ÿæ˜æ˜¾æé«˜ä¿¡é“çš„åˆ©ç”¨ç‡ã€‚</li>
<li>**ç åˆ†å¤ç”¨(CDM)**ï¼šç”¨æˆ·ä½¿ç”¨ç»è¿‡ç‰¹æ®ŠæŒ‘é€‰çš„ä¸åŒç å‹ï¼Œå› æ­¤å„ç”¨æˆ·ä¹‹é—´ä¸ä¼šé€ æˆå¹²æ‰°ã€‚è¿™ç§ç³»ç»Ÿå‘é€çš„ä¿¡å·æœ‰å¾ˆå¼ºçš„æŠ—å¹²æ‰°èƒ½åŠ›ï¼Œå…¶é¢‘è°±ç±»ä¼¼äºç™½å™ªå£°ï¼Œä¸æ˜“è¢«æ•Œäººå‘ç°ã€‚</li>
<li>**æ³¢åˆ†å¤ç”¨( WDM)**ï¼šæ³¢åˆ†å¤ç”¨å°±æ˜¯å…‰çš„é¢‘åˆ†å¤ç”¨ã€‚</li>
</ol>
<h4 id="2-3-3-å‡ ç§å¸¸ç”¨çš„å®½å¸¦æ¥å…¥æŠ€æœ¯ï¼Œä¸»è¦æ˜¯-ADSL-å’Œ-FTTx"><a href="#2-3-3-å‡ ç§å¸¸ç”¨çš„å®½å¸¦æ¥å…¥æŠ€æœ¯ï¼Œä¸»è¦æ˜¯-ADSL-å’Œ-FTTx" class="headerlink" title="2.3.3. å‡ ç§å¸¸ç”¨çš„å®½å¸¦æ¥å…¥æŠ€æœ¯ï¼Œä¸»è¦æ˜¯ ADSL å’Œ FTTx"></a>2.3.3. å‡ ç§å¸¸ç”¨çš„å®½å¸¦æ¥å…¥æŠ€æœ¯ï¼Œä¸»è¦æ˜¯ ADSL å’Œ FTTx</h4><p>ç”¨æˆ·åˆ°äº’è”ç½‘çš„å®½å¸¦æ¥å…¥æ–¹æ³•æœ‰éå¯¹ç§°æ•°å­—ç”¨æˆ·çº¿ ADSLï¼ˆç”¨æ•°å­—æŠ€æœ¯å¯¹ç°æœ‰çš„æ¨¡æ‹Ÿç”µè¯çº¿è¿›è¡Œæ”¹é€ ï¼Œè€Œä¸éœ€è¦é‡æ–°å¸ƒçº¿ã€‚ADSL çš„å¿«é€Ÿç‰ˆæœ¬æ˜¯ç”šé«˜é€Ÿæ•°å­—ç”¨æˆ·çº¿ VDSLã€‚ï¼‰ï¼Œå…‰çº¤åŒè½´æ··åˆç½‘ HFCï¼ˆæ˜¯åœ¨ç›®å‰è¦†ç›–èŒƒå›´å¾ˆå¹¿çš„æœ‰çº¿ç”µè§†ç½‘çš„åŸºç¡€ä¸Šå¼€å‘çš„ä¸€ç§å±…æ°‘å®½å¸¦æ¥å…¥ç½‘ï¼‰å’Œ FTTxï¼ˆå³å…‰çº¤åˆ°Â·Â·Â·Â·Â·Â·ï¼‰ã€‚</p>
<h2 id="3-æ•°æ®é“¾è·¯å±‚ï¼ˆData-Link-Layerï¼‰"><a href="#3-æ•°æ®é“¾è·¯å±‚ï¼ˆData-Link-Layerï¼‰" class="headerlink" title="3. æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰"></a>3. æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰</h2><p><img src="https://oss.javaguide.cn/p3-juejin/83ec6dafc8c14ca185bafb656d86f0b2~tplv-k3u1fbpfcp-zoom-1.png" alt="æ•°æ®é“¾è·¯å±‚"></p>
<h3 id="3-1-åŸºæœ¬æœ¯è¯­"><a href="#3-1-åŸºæœ¬æœ¯è¯­" class="headerlink" title="3.1. åŸºæœ¬æœ¯è¯­"></a>3.1. åŸºæœ¬æœ¯è¯­</h3><ol>
<li><p><strong>é“¾è·¯ï¼ˆlinkï¼‰</strong>ï¼šä¸€ä¸ªç»“ç‚¹åˆ°ç›¸é‚»ç»“ç‚¹çš„ä¸€æ®µç‰©ç†é“¾è·¯ã€‚</p>
</li>
<li><p><strong>æ•°æ®é“¾è·¯ï¼ˆdata linkï¼‰</strong>ï¼šæŠŠå®ç°æ§åˆ¶æ•°æ®è¿è¾“çš„åè®®çš„ç¡¬ä»¶å’Œè½¯ä»¶åŠ åˆ°é“¾è·¯ä¸Šå°±æ„æˆäº†æ•°æ®é“¾è·¯ã€‚</p>
</li>
<li><p><strong>å¾ªç¯å†—ä½™æ£€éªŒ CRCï¼ˆCyclic Redundancy Checkï¼‰</strong>ï¼šä¸ºäº†ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ï¼ŒCRC æ˜¯æ•°æ®é“¾è·¯å±‚å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æ£€é”™æŠ€æœ¯ã€‚</p>
</li>
<li><p><strong>å¸§ï¼ˆframeï¼‰</strong>ï¼šä¸€ä¸ªæ•°æ®é“¾è·¯å±‚çš„ä¼ è¾“å•å…ƒï¼Œç”±ä¸€ä¸ªæ•°æ®é“¾è·¯å±‚é¦–éƒ¨å’Œå…¶æºå¸¦çš„å°åŒ…æ‰€ç»„æˆåè®®æ•°æ®å•å…ƒã€‚</p>
</li>
<li><p><strong>MTUï¼ˆMaximum Transfer Uint ï¼‰</strong>ï¼šæœ€å¤§ä¼ é€å•å…ƒã€‚å¸§çš„æ•°æ®éƒ¨åˆ†çš„çš„é•¿åº¦ä¸Šé™ã€‚</p>
</li>
<li><p><strong>è¯¯ç ç‡ BERï¼ˆBit Error Rate ï¼‰</strong>ï¼šåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œä¼ è¾“é”™è¯¯çš„æ¯”ç‰¹å æ‰€ä¼ è¾“æ¯”ç‰¹æ€»æ•°çš„æ¯”ç‡ã€‚</p>
</li>
<li><p><strong>PPPï¼ˆPoint-to-Point Protocol ï¼‰</strong>ï¼šç‚¹å¯¹ç‚¹åè®®ã€‚å³ç”¨æˆ·è®¡ç®—æœºå’Œ ISP è¿›è¡Œé€šä¿¡æ—¶æ‰€ä½¿ç”¨çš„æ•°æ®é“¾è·¯å±‚åè®®ã€‚ä»¥ä¸‹æ˜¯ PPP å¸§çš„ç¤ºæ„å›¾ï¼š<br><img src="https://oss.javaguide.cn/p3-juejin/6b0310d3103c4149a725a28aaf001899~tplv-k3u1fbpfcp-zoom-1.jpeg" alt="PPP"></p>
</li>
<li><p><strong>MAC åœ°å€ï¼ˆMedia Access Control æˆ–è€… Medium Access Controlï¼‰</strong>ï¼šæ„è¯‘ä¸ºåª’ä½“è®¿é—®æ§åˆ¶ï¼Œæˆ–ç§°ä¸ºç‰©ç†åœ°å€ã€ç¡¬ä»¶åœ°å€ï¼Œç”¨æ¥å®šä¹‰ç½‘ç»œè®¾å¤‡çš„ä½ç½®ã€‚åœ¨ OSI æ¨¡å‹ä¸­ï¼Œç¬¬ä¸‰å±‚ç½‘ç»œå±‚è´Ÿè´£ IP åœ°å€ï¼Œç¬¬äºŒå±‚æ•°æ®é“¾è·¯å±‚åˆ™è´Ÿè´£ MAC åœ°å€ã€‚å› æ­¤ä¸€ä¸ªä¸»æœºä¼šæœ‰ä¸€ä¸ª MAC åœ°å€ï¼Œè€Œæ¯ä¸ªç½‘ç»œä½ç½®ä¼šæœ‰ä¸€ä¸ªä¸“å±äºå®ƒçš„ IP åœ°å€ ã€‚åœ°å€æ˜¯è¯†åˆ«æŸä¸ªç³»ç»Ÿçš„é‡è¦æ ‡è¯†ç¬¦ï¼Œâ€œåå­—æŒ‡å‡ºæˆ‘ä»¬æ‰€è¦å¯»æ‰¾çš„èµ„æºï¼Œåœ°å€æŒ‡å‡ºèµ„æºæ‰€åœ¨çš„åœ°æ–¹ï¼Œè·¯ç”±å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•åˆ°è¾¾è¯¥å¤„ã€‚â€</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/057b83e7ec5b4c149e56255a3be89141~tplv-k3u1fbpfcp-zoom-1.png" alt="ARP (Address Resolution Protocol) explained"></p>
</li>
<li><p><strong>ç½‘æ¡¥ï¼ˆbridgeï¼‰</strong>ï¼šä¸€ç§ç”¨äºæ•°æ®é“¾è·¯å±‚å®ç°ä¸­ç»§ï¼Œè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªå±€åŸŸç½‘çš„ç½‘ç»œäº’è¿è®¾å¤‡ã€‚</p>
</li>
<li><p><strong>äº¤æ¢æœºï¼ˆswitch ï¼‰</strong>ï¼šå¹¿ä¹‰çš„æ¥è¯´ï¼Œäº¤æ¢æœºæŒ‡çš„æ˜¯ä¸€ç§é€šä¿¡ç³»ç»Ÿä¸­å®Œæˆä¿¡æ¯äº¤æ¢çš„è®¾å¤‡ã€‚è¿™é‡Œå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚çš„äº¤æ¢æœºæŒ‡çš„æ˜¯äº¤æ¢å¼é›†çº¿å™¨ï¼Œå…¶å®è´¨æ˜¯ä¸€ä¸ªå¤šæ¥å£çš„ç½‘æ¡¥</p>
</li>
</ol>
<h3 id="3-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#3-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="3.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"></a>3.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“</h3><ol>
<li>é“¾è·¯æ˜¯ä»ä¸€ä¸ªç»“ç‚¹åˆ°ç›¸é‚»ç»“ç‚¹çš„ä¸€æ®µç‰©ç†é“¾è·¯ï¼Œæ•°æ®é“¾è·¯åˆ™åœ¨é“¾è·¯çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›å¿…è¦çš„ç¡¬ä»¶ï¼ˆå¦‚ç½‘ç»œé€‚é…å™¨ï¼‰å’Œè½¯ä»¶ï¼ˆå¦‚åè®®çš„å®ç°ï¼‰</li>
<li>æ•°æ®é“¾è·¯å±‚ä½¿ç”¨çš„ä¸»è¦æ˜¯<strong>ç‚¹å¯¹ç‚¹ä¿¡é“</strong>å’Œ<strong>å¹¿æ’­ä¿¡é“</strong>ä¸¤ç§ã€‚</li>
<li>æ•°æ®é“¾è·¯å±‚ä¼ è¾“çš„åè®®æ•°æ®å•å…ƒæ˜¯å¸§ã€‚æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜æ˜¯ï¼š<strong>å°è£…æˆå¸§</strong>ï¼Œ<strong>é€æ˜ä¼ è¾“</strong>å’Œ<strong>å·®é”™æ£€æµ‹</strong></li>
<li><strong>å¾ªç¯å†—ä½™æ£€éªŒ CRC</strong> æ˜¯ä¸€ç§æ£€é”™æ–¹æ³•ï¼Œè€Œå¸§æ£€éªŒåºåˆ— FCS æ˜¯æ·»åŠ åœ¨æ•°æ®åé¢çš„å†—ä½™ç </li>
<li><strong>ç‚¹å¯¹ç‚¹åè®® PPP</strong> æ˜¯æ•°æ®é“¾è·¯å±‚ä½¿ç”¨æœ€å¤šçš„ä¸€ç§åè®®ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šç®€å•ï¼Œåªæ£€æµ‹å·®é”™è€Œä¸å»çº æ­£å·®é”™ï¼Œä¸ä½¿ç”¨åºå·ï¼Œä¹Ÿä¸è¿›è¡Œæµé‡æ§åˆ¶ï¼Œå¯åŒæ—¶æ”¯æŒå¤šç§ç½‘ç»œå±‚åè®®</li>
<li>PPPoE æ˜¯ä¸ºå®½å¸¦ä¸Šç½‘çš„ä¸»æœºä½¿ç”¨çš„é“¾è·¯å±‚åè®®</li>
<li><strong>å±€åŸŸç½‘çš„ä¼˜ç‚¹æ˜¯ï¼šå…·æœ‰å¹¿æ’­åŠŸèƒ½ï¼Œä»ä¸€ä¸ªç«™ç‚¹å¯æ–¹ä¾¿åœ°è®¿é—®å…¨ç½‘ï¼›ä¾¿äºç³»ç»Ÿçš„æ‰©å±•å’Œé€æ¸æ¼”å˜ï¼›æé«˜äº†ç³»ç»Ÿçš„å¯é æ€§ï¼Œå¯ç”¨æ€§å’Œç”Ÿå­˜æ€§ã€‚</strong></li>
<li>è®¡ç®—æœºä¸å¤–æ¥å±€åŸŸç½‘é€šä¿¡éœ€è¦é€šè¿‡é€šä¿¡é€‚é…å™¨ï¼ˆæˆ–ç½‘ç»œé€‚é…å™¨ï¼‰ï¼Œå®ƒåˆç§°ä¸ºç½‘ç»œæ¥å£å¡æˆ–ç½‘å¡ã€‚<strong>è®¡ç®—å™¨çš„ç¡¬ä»¶åœ°å€å°±åœ¨é€‚é…å™¨çš„ ROM ä¸­</strong>ã€‚</li>
<li>ä»¥å¤ªç½‘é‡‡ç”¨çš„æ— è¿æ¥çš„å·¥ä½œæ–¹å¼ï¼Œå¯¹å‘é€çš„æ•°æ®å¸§ä¸è¿›è¡Œç¼–å·ï¼Œä¹Ÿä¸è¦æ±‚å¯¹æ–¹å‘å›ç¡®è®¤ã€‚ç›®çš„ç«™æ”¶åˆ°æœ‰å·®é”™å¸§å°±æŠŠå®ƒä¸¢æ‰ï¼Œå…¶ä»–ä»€ä¹ˆä¹Ÿä¸åš</li>
<li>ä»¥å¤ªç½‘é‡‡ç”¨çš„åè®®æ˜¯å…·æœ‰å†²çªæ£€æµ‹çš„<strong>è½½æ³¢ç›‘å¬å¤šç‚¹æ¥å…¥ CSMA&#x2F;CD</strong>ã€‚åè®®çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å‘é€å‰å…ˆç›‘å¬ï¼Œè¾¹å‘é€è¾¹ç›‘å¬ï¼Œä¸€æ—¦å‘ç°æ€»çº¿ä¸Šå‡ºç°äº†ç¢°æ’ï¼Œå°±ç«‹å³åœæ­¢å‘é€ã€‚ç„¶åæŒ‰ç…§é€€é¿ç®—æ³•ç­‰å¾…ä¸€æ®µéšæœºæ—¶é—´åå†æ¬¡å‘é€ã€‚</strong> å› æ­¤ï¼Œæ¯ä¸€ä¸ªç«™ç‚¹åœ¨è‡ªå·±å‘é€æ•°æ®ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…ï¼Œå­˜åœ¨ç€é­é‡ç¢°æ’çš„å¯èƒ½æ€§ã€‚ä»¥å¤ªç½‘ä¸Šçš„å„ç«™ç‚¹å¹³ç­‰åœ°äº‰ç”¨ä»¥å¤ªç½‘ä¿¡é“</li>
<li>ä»¥å¤ªç½‘çš„é€‚é…å™¨å…·æœ‰è¿‡æ»¤åŠŸèƒ½ï¼Œå®ƒåªæ¥æ”¶å•æ’­å¸§ï¼Œå¹¿æ’­å¸§å’Œå¤šæ’­å¸§ã€‚</li>
<li>ä½¿ç”¨é›†çº¿å™¨å¯ä»¥åœ¨ç‰©ç†å±‚æ‰©å±•ä»¥å¤ªç½‘ï¼ˆæ‰©å±•åçš„ä»¥å¤ªç½‘ä»ç„¶æ˜¯ä¸€ä¸ªç½‘ç»œï¼‰</li>
</ol>
<h3 id="3-3-è¡¥å……"><a href="#3-3-è¡¥å……" class="headerlink" title="3.3. è¡¥å……"></a>3.3. è¡¥å……</h3><ol>
<li>æ•°æ®é“¾è·¯å±‚çš„ç‚¹å¯¹ç‚¹ä¿¡é“å’Œå¹¿æ’­ä¿¡é“çš„ç‰¹ç‚¹ï¼Œä»¥åŠè¿™ä¸¤ç§ä¿¡é“æ‰€ä½¿ç”¨çš„åè®®ï¼ˆPPP åè®®ä»¥åŠ CSMA&#x2F;CD åè®®ï¼‰çš„ç‰¹ç‚¹</li>
<li>æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ï¼š<strong>å°è£…æˆå¸§</strong>ï¼Œ<strong>é€æ˜ä¼ è¾“</strong>ï¼Œ<strong>å·®é”™æ£€æµ‹</strong></li>
<li>ä»¥å¤ªç½‘çš„ MAC å±‚ç¡¬ä»¶åœ°å€</li>
<li>é€‚é…å™¨ï¼Œè½¬å‘å™¨ï¼Œé›†çº¿å™¨ï¼Œç½‘æ¡¥ï¼Œä»¥å¤ªç½‘äº¤æ¢æœºçš„ä½œç”¨ä»¥åŠé€‚ç”¨åœºåˆ</li>
</ol>
<h2 id="4-ç½‘ç»œå±‚ï¼ˆNetwork-Layerï¼‰"><a href="#4-ç½‘ç»œå±‚ï¼ˆNetwork-Layerï¼‰" class="headerlink" title="4. ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰"></a>4. ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰</h2><p><img src="https://oss.javaguide.cn/p3-juejin/775dc8136bec486aad4f1182c68f24cd~tplv-k3u1fbpfcp-zoom-1.png" alt="ç½‘ç»œå±‚"></p>
<h3 id="4-1-åŸºæœ¬æœ¯è¯­"><a href="#4-1-åŸºæœ¬æœ¯è¯­" class="headerlink" title="4.1. åŸºæœ¬æœ¯è¯­"></a>4.1. åŸºæœ¬æœ¯è¯­</h3><ol>
<li><strong>è™šç”µè·¯ï¼ˆVirtual Circuitï¼‰</strong> : åœ¨ä¸¤ä¸ªç»ˆç«¯è®¾å¤‡çš„é€»è¾‘æˆ–ç‰©ç†ç«¯å£ä¹‹é—´ï¼Œé€šè¿‡å»ºç«‹çš„åŒå‘çš„é€æ˜ä¼ è¾“é€šé“ã€‚è™šç”µè·¯è¡¨ç¤ºè¿™åªæ˜¯ä¸€æ¡é€»è¾‘ä¸Šçš„è¿æ¥ï¼Œåˆ†ç»„éƒ½æ²¿ç€è¿™æ¡é€»è¾‘è¿æ¥æŒ‰ç…§å­˜å‚¨è½¬å‘æ–¹å¼ä¼ é€ï¼Œè€Œå¹¶ä¸æ˜¯çœŸæ­£å»ºç«‹äº†ä¸€æ¡ç‰©ç†è¿æ¥ã€‚</li>
<li><strong>IPï¼ˆInternet Protocol ï¼‰</strong> : ç½‘é™…åè®® IP æ˜¯ TCP&#x2F;IP ä½“ç³»ä¸­ä¸¤ä¸ªæœ€ä¸»è¦çš„åè®®ä¹‹ä¸€ï¼Œæ˜¯ TCP&#x2F;IP ä½“ç³»ç»“æ„ç½‘é™…å±‚çš„æ ¸å¿ƒã€‚é…å¥—çš„æœ‰ ARPï¼ŒRARPï¼ŒICMPï¼ŒIGMPã€‚</li>
<li><strong>ARPï¼ˆAddress Resolution Protocolï¼‰</strong> : åœ°å€è§£æåè®®ã€‚åœ°å€è§£æåè®® ARP æŠŠ IP åœ°å€è§£æä¸ºç¡¬ä»¶åœ°å€ã€‚</li>
<li><strong>ICMPï¼ˆInternet Control Message Protocol ï¼‰</strong>ï¼šç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®® ï¼ˆICMP å…è®¸ä¸»æœºæˆ–è·¯ç”±å™¨æŠ¥å‘Šå·®é”™æƒ…å†µå’Œæä¾›æœ‰å…³å¼‚å¸¸æƒ…å†µçš„æŠ¥å‘Šï¼‰ã€‚</li>
<li><strong>å­ç½‘æ©ç ï¼ˆsubnet mask ï¼‰</strong>ï¼šå®ƒæ˜¯ä¸€ç§ç”¨æ¥æŒ‡æ˜ä¸€ä¸ª IP åœ°å€çš„å“ªäº›ä½æ ‡è¯†çš„æ˜¯ä¸»æœºæ‰€åœ¨çš„å­ç½‘ä»¥åŠå“ªäº›ä½æ ‡è¯†çš„æ˜¯ä¸»æœºçš„ä½æ©ç ã€‚å­ç½‘æ©ç ä¸èƒ½å•ç‹¬å­˜åœ¨ï¼Œå®ƒå¿…é¡»ç»“åˆ IP åœ°å€ä¸€èµ·ä½¿ç”¨ã€‚</li>
<li><strong>CIDRï¼ˆ Classless Inter-Domain Routing ï¼‰</strong>ï¼šæ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹© ï¼ˆç‰¹ç‚¹æ˜¯æ¶ˆé™¤äº†ä¼ ç»Ÿçš„ A ç±»ã€B ç±»å’Œ C ç±»åœ°å€ä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼Œå¹¶ä½¿ç”¨å„ç§é•¿åº¦çš„â€œç½‘ç»œå‰ç¼€â€(network-prefix)æ¥ä»£æ›¿åˆ†ç±»åœ°å€ä¸­çš„ç½‘ç»œå·å’Œå­ç½‘å·ï¼‰ã€‚</li>
<li><strong>é»˜è®¤è·¯ç”±ï¼ˆdefault routeï¼‰</strong>ï¼šå½“åœ¨è·¯ç”±è¡¨ä¸­æŸ¥ä¸åˆ°èƒ½åˆ°è¾¾ç›®çš„åœ°å€çš„è·¯ç”±æ—¶ï¼Œè·¯ç”±å™¨é€‰æ‹©çš„è·¯ç”±ã€‚é»˜è®¤è·¯ç”±è¿˜å¯ä»¥å‡å°è·¯ç”±è¡¨æ‰€å ç”¨çš„ç©ºé—´å’Œæœç´¢è·¯ç”±è¡¨æ‰€ç”¨çš„æ—¶é—´ã€‚</li>
<li><strong>è·¯ç”±é€‰æ‹©ç®—æ³•ï¼ˆVirtual Circuitï¼‰</strong>ï¼šè·¯ç”±é€‰æ‹©åè®®çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚å› ç‰¹ç½‘é‡‡ç”¨è‡ªé€‚åº”çš„ï¼Œåˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®®ã€‚</li>
</ol>
<h3 id="4-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#4-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="4.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"></a>4.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“</h3><ol>
<li><strong>TCP&#x2F;IP åè®®ä¸­çš„ç½‘ç»œå±‚å‘ä¸Šåªæä¾›ç®€å•çµæ´»çš„ï¼Œæ— è¿æ¥çš„ï¼Œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜çš„æ•°æ®æŠ¥æœåŠ¡ã€‚ç½‘ç»œå±‚ä¸æä¾›æœåŠ¡è´¨é‡çš„æ‰¿è¯ºï¼Œä¸ä¿è¯åˆ†ç»„äº¤ä»˜çš„æ—¶é™ï¼Œæ‰€ä¼ é€çš„åˆ†ç»„å¯èƒ½å‡ºé”™ã€ä¸¢å¤±ã€é‡å¤å’Œå¤±åºã€‚è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„å¯é æ€§ç”±è¿è¾“å±‚è´Ÿè´£</strong></li>
<li>åœ¨äº’è”ç½‘çš„äº¤ä»˜æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨æœ¬ç½‘ç»œç›´æ¥äº¤ä»˜ä¸ç”¨ç»è¿‡è·¯ç”±å™¨ï¼Œå¦ä¸€ç§æ˜¯å’Œå…¶ä»–ç½‘ç»œçš„é—´æ¥äº¤ä»˜ï¼Œè‡³å°‘ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œä½†æœ€åä¸€æ¬¡ä¸€å®šæ˜¯ç›´æ¥äº¤ä»˜</li>
<li>åˆ†ç±»çš„ IP åœ°å€ç”±ç½‘ç»œå·å­—æ®µï¼ˆæŒ‡æ˜ç½‘ç»œï¼‰å’Œä¸»æœºå·å­—æ®µï¼ˆæŒ‡æ˜ä¸»æœºï¼‰ç»„æˆã€‚ç½‘ç»œå·å­—æ®µæœ€å‰é¢çš„ç±»åˆ«æŒ‡æ˜ IP åœ°å€çš„ç±»åˆ«ã€‚IP åœ°å€æ˜¯ä¸€ç§åˆ†ç­‰çº§çš„åœ°å€ç»“æ„ã€‚IP åœ°å€ç®¡ç†æœºæ„åˆ†é… IP åœ°å€æ—¶åªåˆ†é…ç½‘ç»œå·ï¼Œä¸»æœºå·ç”±å¾—åˆ°è¯¥ç½‘ç»œå·çš„å•ä½è‡ªè¡Œåˆ†é…ã€‚è·¯ç”±å™¨æ ¹æ®ç›®çš„ä¸»æœºæ‰€è¿æ¥çš„ç½‘ç»œå·æ¥è½¬å‘åˆ†ç»„ã€‚ä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘è¿æ¥åˆ°ä¸¤ä¸ªç½‘ç»œï¼Œæ‰€ä»¥ä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘åº”å½“æœ‰ä¸¤ä¸ªä¸åŒçš„ IP åœ°å€</li>
<li>IP æ•°æ®æŠ¥åˆ†ä¸ºé¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ã€‚é¦–éƒ¨çš„å‰ä¸€éƒ¨åˆ†æ˜¯å›ºå®šé•¿åº¦ï¼Œå…± 20 å­—èŠ‚ï¼Œæ˜¯æ‰€æœ‰ IP æ•°æ®åŒ…å¿…é¡»å…·æœ‰çš„ï¼ˆæºåœ°å€ï¼Œç›®çš„åœ°å€ï¼Œæ€»é•¿åº¦ç­‰é‡è¦åœ°æ®µéƒ½å›ºå®šåœ¨é¦–éƒ¨ï¼‰ã€‚ä¸€äº›é•¿åº¦å¯å˜çš„å¯é€‰å­—æ®µå›ºå®šåœ¨é¦–éƒ¨çš„åé¢ã€‚IP é¦–éƒ¨ä¸­çš„ç”Ÿå­˜æ—¶é—´ç»™å‡ºäº† IP æ•°æ®æŠ¥åœ¨äº’è”ç½‘ä¸­æ‰€èƒ½ç»è¿‡çš„æœ€å¤§è·¯ç”±å™¨æ•°ã€‚å¯é˜²æ­¢ IP æ•°æ®æŠ¥åœ¨äº’è”ç½‘ä¸­æ— é™åˆ¶çš„å…œåœˆå­ã€‚</li>
<li><strong>åœ°å€è§£æåè®® ARP æŠŠ IP åœ°å€è§£æä¸ºç¡¬ä»¶åœ°å€ã€‚ARP çš„é«˜é€Ÿç¼“å­˜å¯ä»¥å¤§å¤§å‡å°‘ç½‘ç»œä¸Šçš„é€šä¿¡é‡ã€‚å› ä¸ºè¿™æ ·å¯ä»¥ä½¿ä¸»æœºä¸‹æ¬¡å†ä¸åŒæ ·åœ°å€çš„ä¸»æœºé€šä¿¡æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»é«˜é€Ÿç¼“å­˜ä¸­æ‰¾åˆ°æ‰€éœ€è¦çš„ç¡¬ä»¶åœ°å€è€Œä¸éœ€è¦å†å»ä»¥å¹¿æ’­æ–¹å¼å‘é€ ARP è¯·æ±‚åˆ†ç»„</strong></li>
<li>æ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹© CIDR æ˜¯è§£å†³ç›®å‰ IP åœ°å€ç´§ç¼ºçš„ä¸€ä¸ªå¥½åŠæ³•ã€‚CIDR è®°æ³•åœ¨ IP åœ°å€åé¢åŠ ä¸Šæ–œçº¿â€œ&#x2F;â€ï¼Œç„¶åå†™ä¸Šå‰ç¼€æ‰€å çš„ä½æ•°ã€‚å‰ç¼€ï¼ˆæˆ–ç½‘ç»œå‰ç¼€ï¼‰ç”¨æ¥æŒ‡æ˜ç½‘ç»œï¼Œå‰ç¼€åé¢çš„éƒ¨åˆ†æ˜¯åç¼€ï¼Œç”¨æ¥æŒ‡æ˜ä¸»æœºã€‚CIDR æŠŠå‰ç¼€éƒ½ç›¸åŒçš„è¿ç»­çš„ IP åœ°å€ç»„æˆä¸€ä¸ªâ€œCIDR åœ°å€å—â€ï¼ŒIP åœ°å€åˆ†é…éƒ½ä»¥ CIDR åœ°å€å—ä¸ºå•ä½ã€‚</li>
<li>ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®æ˜¯ IP å±‚çš„åè®®ã€‚ICMP æŠ¥æ–‡ä½œä¸º IP æ•°æ®æŠ¥çš„æ•°æ®ï¼ŒåŠ ä¸Šé¦–éƒ¨åç»„æˆ IP æ•°æ®æŠ¥å‘é€å‡ºå»ã€‚ä½¿ç”¨ ICMP æ•°æ®æŠ¥å¹¶ä¸æ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“ã€‚ICMP å…è®¸ä¸»æœºæˆ–è·¯ç”±å™¨æŠ¥å‘Šå·®é”™æƒ…å†µå’Œæä¾›æœ‰å…³å¼‚å¸¸æƒ…å†µçš„æŠ¥å‘Šã€‚ICMP æŠ¥æ–‡çš„ç§ç±»æœ‰ä¸¤ç§ï¼Œå³ ICMP å·®é”™æŠ¥å‘ŠæŠ¥æ–‡å’Œ ICMP è¯¢é—®æŠ¥æ–‡ã€‚</li>
<li><strong>è¦è§£å†³ IP åœ°å€è€—å°½çš„é—®é¢˜ï¼Œæœ€æ ¹æœ¬çš„åŠæ³•æ˜¯é‡‡ç”¨å…·æœ‰æ›´å¤§åœ°å€ç©ºé—´çš„æ–°ç‰ˆæœ¬ IP åè®®-IPv6ã€‚</strong> IPv6 æ‰€å¸¦æ¥çš„å˜åŒ–æœ‰ â‘  æ›´å¤§çš„åœ°å€ç©ºé—´ï¼ˆé‡‡ç”¨ 128 ä½åœ°å€ï¼‰â‘¡ çµæ´»çš„é¦–éƒ¨æ ¼å¼ â‘¢ æ”¹è¿›çš„é€‰é¡¹ â‘£ æ”¯æŒå³æ’å³ç”¨ â‘¤ æ”¯æŒèµ„æºçš„é¢„åˆ†é… â‘¥IPv6 çš„é¦–éƒ¨æ”¹ä¸º 8 å­—èŠ‚å¯¹é½ã€‚</li>
<li><strong>è™šæ‹Ÿä¸“ç”¨ç½‘ç»œ VPN åˆ©ç”¨å…¬ç”¨çš„äº’è”ç½‘ä½œä¸ºæœ¬æœºæ„ä¸“ç”¨ç½‘ä¹‹é—´çš„é€šä¿¡è½½ä½“ã€‚VPN å†…ä½¿ç”¨äº’è”ç½‘çš„ä¸“ç”¨åœ°å€ã€‚ä¸€ä¸ª VPN è‡³å°‘è¦æœ‰ä¸€ä¸ªè·¯ç”±å™¨å…·æœ‰åˆæ³•çš„å…¨çƒ IP åœ°å€ï¼Œè¿™æ ·æ‰èƒ½å’Œæœ¬ç³»ç»Ÿçš„å¦ä¸€ä¸ª VPN é€šè¿‡äº’è”ç½‘è¿›è¡Œé€šä¿¡ã€‚æ‰€æœ‰é€šè¿‡äº’è”ç½‘ä¼ é€çš„æ•°æ®éƒ½éœ€è¦åŠ å¯†ã€‚</strong></li>
<li>MPLS çš„ç‰¹ç‚¹æ˜¯ï¼šâ‘  æ”¯æŒé¢å‘è¿æ¥çš„æœåŠ¡è´¨é‡ â‘¡ æ”¯æŒæµé‡å·¥ç¨‹ï¼Œå¹³è¡¡ç½‘ç»œè´Ÿè½½ â‘¢ æœ‰æ•ˆçš„æ”¯æŒè™šæ‹Ÿä¸“ç”¨ç½‘ VPNã€‚MPLS åœ¨å…¥å£èŠ‚ç‚¹ç»™æ¯ä¸€ä¸ª IP æ•°æ®æŠ¥æ‰“ä¸Šå›ºå®šé•¿åº¦çš„â€œæ ‡è®°â€ï¼Œç„¶åæ ¹æ®æ ‡è®°åœ¨ç¬¬äºŒå±‚ï¼ˆé“¾è·¯å±‚ï¼‰ç”¨ç¡¬ä»¶è¿›è¡Œè½¬å‘ï¼ˆåœ¨æ ‡è®°äº¤æ¢è·¯ç”±å™¨ä¸­è¿›è¡Œæ ‡è®°äº¤æ¢ï¼‰ï¼Œå› è€Œè½¬å‘é€Ÿç‡å¤§å¤§åŠ å¿«ã€‚</li>
</ol>
<h2 id="5-ä¼ è¾“å±‚ï¼ˆTransport-Layerï¼‰"><a href="#5-ä¼ è¾“å±‚ï¼ˆTransport-Layerï¼‰" class="headerlink" title="5. ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰"></a>5. ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰</h2><p><img src="https://oss.javaguide.cn/p3-juejin/9fe85e137e7f4f03a580512200a59609~tplv-k3u1fbpfcp-zoom-1.png" alt="ä¼ è¾“å±‚"></p>
<h3 id="5-1-åŸºæœ¬æœ¯è¯­"><a href="#5-1-åŸºæœ¬æœ¯è¯­" class="headerlink" title="5.1. åŸºæœ¬æœ¯è¯­"></a>5.1. åŸºæœ¬æœ¯è¯­</h3><ol>
<li><p><strong>è¿›ç¨‹ï¼ˆprocessï¼‰</strong>ï¼šæŒ‡è®¡ç®—æœºä¸­æ­£åœ¨è¿è¡Œçš„ç¨‹åºå®ä½“ã€‚</p>
</li>
<li><p><strong>åº”ç”¨è¿›ç¨‹äº’ç›¸é€šä¿¡</strong>ï¼šä¸€å°ä¸»æœºçš„è¿›ç¨‹å’Œå¦ä¸€å°ä¸»æœºä¸­çš„ä¸€ä¸ªè¿›ç¨‹äº¤æ¢æ•°æ®çš„è¿‡ç¨‹ï¼ˆå¦å¤–æ³¨æ„é€šä¿¡çœŸæ­£çš„ç«¯ç‚¹ä¸æ˜¯ä¸»æœºè€Œæ˜¯ä¸»æœºä¸­çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ç«¯åˆ°ç«¯çš„é€šä¿¡æ˜¯åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼‰ã€‚</p>
</li>
<li><p><strong>ä¼ è¾“å±‚çš„å¤ç”¨ä¸åˆ†ç”¨</strong>ï¼šå¤ç”¨æŒ‡å‘é€æ–¹ä¸åŒçš„è¿›ç¨‹éƒ½å¯ä»¥é€šè¿‡åŒä¸€ä¸ªè¿è¾“å±‚åè®®ä¼ é€æ•°æ®ã€‚åˆ†ç”¨æŒ‡æ¥æ”¶æ–¹çš„è¿è¾“å±‚åœ¨å‰¥å»æŠ¥æ–‡çš„é¦–éƒ¨åèƒ½æŠŠè¿™äº›æ•°æ®æ­£ç¡®çš„äº¤ä»˜åˆ°ç›®çš„åº”ç”¨è¿›ç¨‹ã€‚</p>
</li>
<li><p><strong>TCPï¼ˆTransmission Control Protocolï¼‰</strong>ï¼šä¼ è¾“æ§åˆ¶åè®®ã€‚</p>
</li>
<li><p><strong>UDPï¼ˆUser Datagram Protocolï¼‰</strong>ï¼šç”¨æˆ·æ•°æ®æŠ¥åè®®ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/b136e69e0b9b426782f77623dcf098bd~tplv-k3u1fbpfcp-zoom-1.png" alt="TCP å’Œ UDP"></p>
</li>
<li><p><strong>ç«¯å£ï¼ˆportï¼‰</strong>ï¼šç«¯å£çš„ç›®çš„æ˜¯ä¸ºäº†ç¡®è®¤å¯¹æ–¹æœºå™¨çš„å“ªä¸ªè¿›ç¨‹åœ¨ä¸è‡ªå·±è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚ MSN å’Œ QQ çš„ç«¯å£ä¸åŒï¼Œå¦‚æœæ²¡æœ‰ç«¯å£å°±å¯èƒ½å‡ºç° QQ è¿›ç¨‹å’Œ MSN äº¤äº’é”™è¯¯ã€‚ç«¯å£åˆç§°åè®®ç«¯å£å·ã€‚</p>
</li>
<li><p><strong>åœæ­¢ç­‰å¾…åè®®ï¼ˆstop-and-waitï¼‰</strong>ï¼šæŒ‡å‘é€æ–¹æ¯å‘é€å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ï¼Œåœ¨æ”¶åˆ°ç¡®è®¤ä¹‹ååœ¨å‘é€ä¸‹ä¸€ä¸ªåˆ†ç»„ã€‚</p>
</li>
<li><p><strong>æµé‡æ§åˆ¶</strong> : å°±æ˜¯è®©å‘é€æ–¹çš„å‘é€é€Ÿç‡ä¸è¦å¤ªå¿«ï¼Œæ—¢è¦è®©æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ï¼Œä¹Ÿä¸è¦ä½¿ç½‘ç»œå‘ç”Ÿæ‹¥å¡ã€‚</p>
</li>
<li><p><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šé˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚æ‹¥å¡æ§åˆ¶æ‰€è¦åšçš„éƒ½æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿæ‰¿å—ç°æœ‰çš„ç½‘ç»œè´Ÿè·ã€‚</p>
</li>
</ol>
<h3 id="5-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#5-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="5.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"></a>5.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“</h3><ol>
<li><strong>è¿è¾“å±‚æä¾›åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é€»è¾‘é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿è¾“å±‚ä¹‹é—´çš„é€šä¿¡å¹¶ä¸æ˜¯çœŸæ­£åœ¨ä¸¤ä¸ªè¿è¾“å±‚ä¹‹é—´ç›´æ¥ä¼ è¾“æ•°æ®ã€‚è¿è¾“å±‚å‘åº”ç”¨å±‚å±è”½äº†ä¸‹é¢ç½‘ç»œçš„ç»†èŠ‚ï¼ˆå¦‚ç½‘ç»œæ‹“è¡¥ï¼Œæ‰€é‡‡ç”¨çš„è·¯ç”±é€‰æ‹©åè®®ç­‰ï¼‰ï¼Œå®ƒä½¿åº”ç”¨è¿›ç¨‹ä¹‹é—´çœ‹èµ·æ¥å¥½åƒä¸¤ä¸ªè¿è¾“å±‚å®ä½“ä¹‹é—´æœ‰ä¸€æ¡ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡ä¿¡é“ã€‚</strong></li>
<li><strong>ç½‘ç»œå±‚ä¸ºä¸»æœºæä¾›é€»è¾‘é€šä¿¡ï¼Œè€Œè¿è¾“å±‚ä¸ºåº”ç”¨è¿›ç¨‹ä¹‹é—´æä¾›ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡ã€‚</strong></li>
<li>è¿è¾“å±‚çš„ä¸¤ä¸ªé‡è¦åè®®æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®® UDP å’Œä¼ è¾“æ§åˆ¶åè®® TCPã€‚æŒ‰ç…§ OSI çš„æœ¯è¯­ï¼Œä¸¤ä¸ªå¯¹ç­‰è¿è¾“å®ä½“åœ¨é€šä¿¡æ—¶ä¼ é€çš„æ•°æ®å•ä½å«åšè¿è¾“åè®®æ•°æ®å•å…ƒ TPDUï¼ˆTransport Protocol Data Unitï¼‰ã€‚ä½†åœ¨ TCP&#x2F;IP ä½“ç³»ä¸­ï¼Œåˆ™æ ¹æ®æ‰€ä½¿ç”¨çš„åè®®æ˜¯ TCP æˆ– UDPï¼Œåˆ†åˆ«ç§°ä¹‹ä¸º TCP æŠ¥æ–‡æ®µæˆ– UDP ç”¨æˆ·æ•°æ®æŠ¥ã€‚</li>
<li><strong>UDP åœ¨ä¼ é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè¿œåœ°ä¸»æœºåœ¨æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ã€‚è™½ç„¶ UDP ä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ UDP ç¡®æ˜¯ä¸€ç§æœ€æœ‰æ•ˆçš„å·¥ä½œæ–¹å¼ã€‚ TCP æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ã€‚åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚TCP ä¸æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡ã€‚ç”±äº TCP è¦æä¾›å¯é çš„ï¼Œé¢å‘è¿æ¥çš„ä¼ è¾“æœåŠ¡ï¼Œéš¾ä»¥é¿å…åœ°å¢åŠ äº†è®¸å¤šå¼€é”€ï¼Œå¦‚ç¡®è®¤ï¼Œæµé‡æ§åˆ¶ï¼Œè®¡æ—¶å™¨ä»¥åŠè¿æ¥ç®¡ç†ç­‰ã€‚è¿™ä¸ä»…ä½¿åè®®æ•°æ®å•å…ƒçš„é¦–éƒ¨å¢å¤§å¾ˆå¤šï¼Œè¿˜è¦å ç”¨è®¸å¤šå¤„ç†æœºèµ„æºã€‚</strong></li>
<li>ç¡¬ä»¶ç«¯å£æ˜¯ä¸åŒç¡¬ä»¶è®¾å¤‡è¿›è¡Œäº¤äº’çš„æ¥å£ï¼Œè€Œè½¯ä»¶ç«¯å£æ˜¯åº”ç”¨å±‚å„ç§åè®®è¿›ç¨‹ä¸è¿è¾“å®ä½“è¿›è¡Œå±‚é—´äº¤äº’çš„ä¸€ç§åœ°å€ã€‚UDP å’Œ TCP çš„é¦–éƒ¨æ ¼å¼ä¸­éƒ½æœ‰æºç«¯å£å’Œç›®çš„ç«¯å£è¿™ä¸¤ä¸ªé‡è¦å­—æ®µã€‚å½“è¿è¾“å±‚æ”¶åˆ° IP å±‚äº¤ä¸Šæ¥çš„è¿è¾“å±‚æŠ¥æ–‡æ—¶ï¼Œå°±èƒ½å¤Ÿæ ¹æ®å…¶é¦–éƒ¨ä¸­çš„ç›®çš„ç«¯å£å·æŠŠæ•°æ®äº¤ä»˜åº”ç”¨å±‚çš„ç›®çš„åº”ç”¨å±‚ã€‚ï¼ˆä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ä¸å…‰è¦çŸ¥é“å¯¹æ–¹ IP åœ°å€è€Œä¸”è¦çŸ¥é“å¯¹æ–¹çš„ç«¯å£å·(ä¸ºäº†æ‰¾åˆ°å¯¹æ–¹è®¡ç®—æœºä¸­çš„åº”ç”¨è¿›ç¨‹)ï¼‰</li>
<li>è¿è¾“å±‚ç”¨ä¸€ä¸ª 16 ä½ç«¯å£å·æ ‡å¿—ä¸€ä¸ªç«¯å£ã€‚ç«¯å£å·åªæœ‰æœ¬åœ°æ„ä¹‰ï¼Œå®ƒåªæ˜¯ä¸ºäº†æ ‡å¿—è®¡ç®—æœºåº”ç”¨å±‚ä¸­çš„å„ä¸ªè¿›ç¨‹åœ¨å’Œè¿è¾“å±‚äº¤äº’æ—¶çš„å±‚é—´æ¥å£ã€‚åœ¨äº’è”ç½‘çš„ä¸åŒè®¡ç®—æœºä¸­ï¼Œç›¸åŒçš„ç«¯å£å·æ˜¯æ²¡æœ‰å…³è”çš„ã€‚åè®®ç«¯å£å·ç®€ç§°ç«¯å£ã€‚è™½ç„¶é€šä¿¡çš„ç»ˆç‚¹æ˜¯åº”ç”¨è¿›ç¨‹ï¼Œä½†åªè¦æŠŠæ‰€å‘é€çš„æŠ¥æ–‡äº¤åˆ°ç›®çš„ä¸»æœºçš„æŸä¸ªåˆé€‚ç«¯å£ï¼Œå‰©ä¸‹çš„å·¥ä½œï¼ˆæœ€åäº¤ä»˜ç›®çš„è¿›ç¨‹ï¼‰å°±ç”± TCP å’Œ UDP æ¥å®Œæˆã€‚</li>
<li>è¿è¾“å±‚çš„ç«¯å£å·åˆ†ä¸ºæœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ç«¯å£å·ï¼ˆ0&tilde;1023 æŒ‡æ´¾ç»™ç†ŸçŸ¥ç«¯å£ï¼Œ1024&tilde;49151 æ˜¯ç™»è®°ç«¯å£å·ï¼‰å’Œå®¢æˆ·ç«¯æš‚æ—¶ä½¿ç”¨çš„ç«¯å£å·ï¼ˆ49152&tilde;65535ï¼‰</li>
<li><strong>UDP çš„ä¸»è¦ç‰¹ç‚¹æ˜¯ â‘  æ— è¿æ¥ â‘¡ å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ â‘¢ é¢å‘æŠ¥æ–‡ â‘£ æ— æ‹¥å¡æ§åˆ¶ â‘¤ æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ â‘¥ é¦–éƒ¨å¼€é”€å°ï¼ˆåªæœ‰å››ä¸ªå­—æ®µï¼šæºç«¯å£ï¼Œç›®çš„ç«¯å£ï¼Œé•¿åº¦å’Œæ£€éªŒå’Œï¼‰</strong></li>
<li><strong>TCP çš„ä¸»è¦ç‰¹ç‚¹æ˜¯ â‘  é¢å‘è¿æ¥ â‘¡ æ¯ä¸€æ¡ TCP è¿æ¥åªèƒ½æ˜¯ä¸€å¯¹ä¸€çš„ â‘¢ æä¾›å¯é äº¤ä»˜ â‘£ æä¾›å…¨åŒå·¥é€šä¿¡ â‘¤ é¢å‘å­—èŠ‚æµ</strong></li>
<li><strong>TCP ç”¨ä¸»æœºçš„ IP åœ°å€åŠ ä¸Šä¸»æœºä¸Šçš„ç«¯å£å·ä½œä¸º TCP è¿æ¥çš„ç«¯ç‚¹ã€‚è¿™æ ·çš„ç«¯ç‚¹å°±å«åšå¥—æ¥å­—ï¼ˆsocketï¼‰æˆ–æ’å£ã€‚å¥—æ¥å­—ç”¨ï¼ˆIP åœ°å€ï¼šç«¯å£å·ï¼‰æ¥è¡¨ç¤ºã€‚æ¯ä¸€æ¡ TCP è¿æ¥å”¯ä¸€åœ°è¢«é€šä¿¡ä¸¤ç«¯çš„ä¸¤ä¸ªç«¯ç‚¹æ‰€ç¡®å®šã€‚</strong></li>
<li>åœæ­¢ç­‰å¾…åè®®æ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“çš„ï¼Œå®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯æ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚åœ¨æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹ä¸€ä¸ªåˆ†ç»„ã€‚</li>
<li>ä¸ºäº†æé«˜ä¼ è¾“æ•ˆç‡ï¼Œå‘é€æ–¹å¯ä»¥ä¸ä½¿ç”¨ä½æ•ˆç‡çš„åœæ­¢ç­‰å¾…åè®®ï¼Œè€Œæ˜¯é‡‡ç”¨æµæ°´çº¿ä¼ è¾“ã€‚æµæ°´çº¿ä¼ è¾“å°±æ˜¯å‘é€æ–¹å¯è¿ç»­å‘é€å¤šä¸ªåˆ†ç»„ï¼Œä¸å¿…æ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœä¸‹æ¥ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚è¿™æ ·å¯ä½¿ä¿¡é“ä¸Šä¸€ç›´æœ‰æ•°æ®ä¸é—´æ–­çš„åœ¨ä¼ é€ã€‚è¿™ç§ä¼ è¾“æ–¹å¼å¯ä»¥æ˜æ˜¾æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚</li>
<li>åœæ­¢ç­‰å¾…åè®®ä¸­è¶…æ—¶é‡ä¼ æ˜¯æŒ‡åªè¦è¶…è¿‡ä¸€æ®µæ—¶é—´ä»ç„¶æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡ä¼ å‰é¢å‘é€è¿‡çš„åˆ†ç»„ï¼ˆè®¤ä¸ºåˆšæ‰å‘é€è¿‡çš„åˆ†ç»„ä¸¢å¤±äº†ï¼‰ã€‚å› æ­¤æ¯å‘é€å®Œä¸€ä¸ªåˆ†ç»„éœ€è¦è®¾ç½®ä¸€ä¸ªè¶…æ—¶è®¡æ—¶å™¨ï¼Œå…¶é‡ä¼ æ—¶é—´åº”æ¯”æ•°æ®åœ¨åˆ†ç»„ä¼ è¾“çš„å¹³å‡å¾€è¿”æ—¶é—´æ›´é•¿ä¸€äº›ã€‚è¿™ç§è‡ªåŠ¨é‡ä¼ æ–¹å¼å¸¸ç§°ä¸ºè‡ªåŠ¨é‡ä¼ è¯·æ±‚ ARQã€‚å¦å¤–åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­è‹¥æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ã€‚è¿ç»­ ARQ åè®®å¯æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚å‘é€ç»´æŒä¸€ä¸ªå‘é€çª—å£ï¼Œå‡¡ä½äºå‘é€çª—å£å†…çš„åˆ†ç»„å¯è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚æ¥æ”¶æ–¹ä¸€èˆ¬é‡‡ç”¨ç´¯ç§¯ç¡®è®¤ï¼Œå¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼Œè¡¨æ˜åˆ°è¿™ä¸ªåˆ†ç»„ä½ç½®çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²ç»æ­£ç¡®æ”¶åˆ°äº†ã€‚</li>
<li>TCP æŠ¥æ–‡æ®µçš„å‰ 20 ä¸ªå­—èŠ‚æ˜¯å›ºå®šçš„ï¼Œå…¶åæœ‰ 40 å­—èŠ‚é•¿åº¦çš„å¯é€‰å­—æ®µã€‚å¦‚æœåŠ å…¥å¯é€‰å­—æ®µåé¦–éƒ¨é•¿åº¦ä¸æ˜¯ 4 çš„æ•´æ•°å€å­—èŠ‚ï¼Œéœ€è¦åœ¨å†åœ¨ä¹‹åç”¨ 0 å¡«å……ã€‚å› æ­¤ï¼ŒTCP é¦–éƒ¨çš„é•¿åº¦å–å€¼ä¸º 20+4n å­—èŠ‚,æœ€é•¿ä¸º 60 å­—èŠ‚ã€‚</li>
<li><strong>TCP ä½¿ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶ã€‚å‘é€çª—å£é‡Œé¢çš„åºå·è¡¨ç¤ºå…è®¸å‘é€çš„åºå·ã€‚å‘é€çª—å£åæ²¿çš„åé¢éƒ¨åˆ†è¡¨ç¤ºå·²å‘é€ä¸”å·²æ”¶åˆ°ç¡®è®¤ï¼Œè€Œå‘é€çª—å£å‰æ²¿çš„å‰é¢éƒ¨åˆ†è¡¨ç¤ºä¸å…è®¸å‘é€ã€‚å‘é€çª—å£åæ²¿çš„å˜åŒ–æƒ…å†µæœ‰ä¸¤ç§å¯èƒ½ï¼Œå³ä¸åŠ¨ï¼ˆæ²¡æœ‰æ”¶åˆ°æ–°çš„ç¡®è®¤ï¼‰å’Œå‰ç§»ï¼ˆæ”¶åˆ°äº†æ–°çš„ç¡®è®¤ï¼‰ã€‚å‘é€çª—å£çš„å‰æ²¿é€šå¸¸æ˜¯ä¸æ–­å‘å‰ç§»åŠ¨çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ€»æ˜¯å¸Œæœ›æ•°æ®ä¼ è¾“æ›´å¿«ä¸€äº›ã€‚ä½†å¦‚æœå‘é€æ–¹æŠŠæ•°æ®å‘é€çš„è¿‡å¿«ï¼Œæ¥æ”¶æ–¹å°±å¯èƒ½æ¥ä¸åŠæ¥æ”¶ï¼Œè¿™å°±ä¼šé€ æˆæ•°æ®çš„ä¸¢å¤±ã€‚æ‰€è°“æµé‡æ§åˆ¶å°±æ˜¯è®©å‘é€æ–¹çš„å‘é€é€Ÿç‡ä¸è¦å¤ªå¿«ï¼Œè¦è®©æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚</strong></li>
<li>åœ¨æŸæ®µæ—¶é—´ï¼Œè‹¥å¯¹ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ï¼Œç½‘ç»œçš„æ€§èƒ½å°±è¦å˜åã€‚è¿™ç§æƒ…å†µå°±å«æ‹¥å¡ã€‚æ‹¥å¡æ§åˆ¶å°±æ˜¯ä¸ºäº†é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚æ‹¥å¡æ§åˆ¶æ‰€è¦åšçš„éƒ½æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿæ‰¿å—ç°æœ‰çš„ç½‘ç»œè´Ÿè·ã€‚æ‹¥å¡æ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºï¼Œæ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸é™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚ç›¸åï¼Œæµé‡æ§åˆ¶å¾€å¾€æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ã€‚æµé‡æ§åˆ¶æ‰€è¦åšåˆ°çš„å°±æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥ä¾¿ä½¿æ¥æ”¶ç«¯æ¥å¾—åŠæ¥æ”¶ã€‚</li>
<li><strong>ä¸ºäº†è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼ŒTCP å‘é€æ–¹è¦ç»´æŒä¸€ä¸ªæ‹¥å¡çª—å£ cwnd çš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡æ§åˆ¶çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚å‘é€æ–¹è®©è‡ªå·±çš„å‘é€çª—å£å–ä¸ºæ‹¥å¡çª—å£å’Œæ¥æ”¶æ–¹çš„æ¥å—çª—å£ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚</strong></li>
<li><strong>TCP çš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼Œå³æ…¢å¼€å§‹ï¼Œæ‹¥å¡é¿å…ï¼Œå¿«é‡ä¼ å’Œå¿«æ¢å¤ã€‚åœ¨ç½‘ç»œå±‚ä¹Ÿå¯ä»¥ä½¿è·¯ç”±å™¨é‡‡ç”¨é€‚å½“çš„åˆ†ç»„ä¸¢å¼ƒç­–ç•¥ï¼ˆå¦‚ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç† AQMï¼‰ï¼Œä»¥å‡å°‘ç½‘ç»œæ‹¥å¡çš„å‘ç”Ÿã€‚</strong></li>
<li>è¿è¾“è¿æ¥çš„ä¸‰ä¸ªé˜¶æ®µï¼Œå³ï¼šè¿æ¥å»ºç«‹ï¼Œæ•°æ®ä¼ é€å’Œè¿æ¥é‡Šæ”¾ã€‚</li>
<li><strong>ä¸»åŠ¨å‘èµ· TCP è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åšå®¢æˆ·ï¼Œè€Œè¢«åŠ¨ç­‰å¾…è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åšæœåŠ¡å™¨ã€‚TCP è¿æ¥é‡‡ç”¨ä¸‰æŠ¥æ–‡æ¡æ‰‹æœºåˆ¶ã€‚æœåŠ¡å™¨è¦ç¡®è®¤ç”¨æˆ·çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå®¢æˆ·è¦å¯¹æœåŠ¡å™¨çš„ç¡®è®¤è¿›è¡Œç¡®è®¤ã€‚</strong></li>
<li>TCP çš„è¿æ¥é‡Šæ”¾é‡‡ç”¨å››æŠ¥æ–‡æ¡æ‰‹æœºåˆ¶ã€‚ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥åœ¨æ•°æ®ä¼ é€ç»“æŸåå‘å‡ºè¿æ¥é‡Šæ”¾çš„é€šçŸ¥ï¼Œå¾…å¯¹æ–¹ç¡®è®¤åè¿›å…¥åŠå…³é—­çŠ¶æ€ã€‚å½“å¦ä¸€æ–¹ä¹Ÿæ²¡æœ‰æ•°æ®å†å‘é€æ—¶ï¼Œåˆ™å‘é€è¿æ¥é‡Šæ”¾é€šçŸ¥ï¼Œå¯¹æ–¹ç¡®è®¤åå°±å®Œå…¨å…³é—­äº† TCP è¿æ¥</li>
</ol>
<h3 id="5-3-è¡¥å……ï¼ˆé‡è¦ï¼‰"><a href="#5-3-è¡¥å……ï¼ˆé‡è¦ï¼‰" class="headerlink" title="5.3. è¡¥å……ï¼ˆé‡è¦ï¼‰"></a>5.3. è¡¥å……ï¼ˆé‡è¦ï¼‰</h3><p>ä»¥ä¸‹çŸ¥è¯†ç‚¹éœ€è¦é‡ç‚¹å…³æ³¨ï¼š</p>
<ol>
<li>ç«¯å£å’Œå¥—æ¥å­—çš„æ„ä¹‰</li>
<li>UDP å’Œ TCP çš„åŒºåˆ«ä»¥åŠä¸¤è€…çš„åº”ç”¨åœºæ™¯</li>
<li>åœ¨ä¸å¯é çš„ç½‘ç»œä¸Šå®ç°å¯é ä¼ è¾“çš„å·¥ä½œåŸç†ï¼Œåœæ­¢ç­‰å¾…åè®®å’Œ ARQ åè®®</li>
<li>TCP çš„æ»‘åŠ¨çª—å£ï¼Œæµé‡æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶å’Œè¿æ¥ç®¡ç†</li>
<li>TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹æœºåˆ¶</li>
</ol>
<h2 id="6-åº”ç”¨å±‚ï¼ˆApplication-Layerï¼‰"><a href="#6-åº”ç”¨å±‚ï¼ˆApplication-Layerï¼‰" class="headerlink" title="6. åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰"></a>6. åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰</h2><p><img src="https://oss.javaguide.cn/p3-juejin/0f13f0ee13b24af7bdddf56162eb6602~tplv-k3u1fbpfcp-zoom-1.png" alt="åº”ç”¨å±‚"></p>
<h3 id="6-1-åŸºæœ¬æœ¯è¯­"><a href="#6-1-åŸºæœ¬æœ¯è¯­" class="headerlink" title="6.1. åŸºæœ¬æœ¯è¯­"></a>6.1. åŸºæœ¬æœ¯è¯­</h3><ol>
<li><p><strong>åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰</strong>ï¼šåŸŸåç³»ç»Ÿï¼ˆDNSï¼ŒDomain Name Systemï¼‰å°†äººç±»å¯è¯»çš„åŸŸå (ä¾‹å¦‚ï¼Œ<a href="http://www.baidu.com/">www.baidu.com</a>) è½¬æ¢ä¸ºæœºå™¨å¯è¯»çš„ IP åœ°å€ (ä¾‹å¦‚ï¼Œ220.181.38.148)ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸“ä¸ºäº’è”ç½‘è®¾è®¡çš„ç”µè¯è–„ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/e7da4b07947f4c0094d46dc96a067df0~tplv-k3u1fbpfcp-zoom-1.png"></p>
<p style="text-align:right;font-size:12px">https://www.seobility.net/en/wiki/HTTP_headers</p>
</li>
<li><p><strong>æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰</strong>ï¼šFTP æ˜¯ File Transfer Protocolï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰çš„è‹±æ–‡ç®€ç§°ï¼Œè€Œä¸­æ–‡ç®€ç§°ä¸ºâ€œæ–‡ä¼ åè®®â€ã€‚ç”¨äº Internet ä¸Šçš„æ§åˆ¶æ–‡ä»¶çš„åŒå‘ä¼ è¾“ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰ã€‚åŸºäºä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„ FTP åº”ç”¨ç¨‹åºï¼Œè€Œæ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºéƒ½éµå®ˆåŒä¸€ç§åè®®ä»¥ä¼ è¾“æ–‡ä»¶ã€‚åœ¨ FTP çš„ä½¿ç”¨å½“ä¸­ï¼Œç”¨æˆ·ç»å¸¸é‡åˆ°ä¸¤ä¸ªæ¦‚å¿µï¼šâ€ä¸‹è½½â€ï¼ˆDownloadï¼‰å’Œâ€ä¸Šä¼ â€ï¼ˆUploadï¼‰ã€‚ â€œä¸‹è½½â€æ–‡ä»¶å°±æ˜¯ä»è¿œç¨‹ä¸»æœºæ‹·è´æ–‡ä»¶è‡³è‡ªå·±çš„è®¡ç®—æœºä¸Šï¼›â€ä¸Šä¼ â€æ–‡ä»¶å°±æ˜¯å°†æ–‡ä»¶ä»è‡ªå·±çš„è®¡ç®—æœºä¸­æ‹·è´è‡³è¿œç¨‹ä¸»æœºä¸Šã€‚ç”¨ Internet è¯­è¨€æ¥è¯´ï¼Œç”¨æˆ·å¯é€šè¿‡å®¢æˆ·æœºç¨‹åºå‘ï¼ˆä»ï¼‰è¿œç¨‹ä¸»æœºä¸Šä¼ ï¼ˆä¸‹è½½ï¼‰æ–‡ä»¶ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/f3f2caaa361045a38fb89bb9fee15bd3~tplv-k3u1fbpfcp-zoom-1.png" alt="FTPå·¥ä½œè¿‡ç¨‹"></p>
</li>
<li><p><strong>ç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆTFTPï¼‰</strong>ï¼šTFTPï¼ˆTrivial File Transfer Protocol,ç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰æ˜¯ TCP&#x2F;IP åè®®æ—ä¸­çš„ä¸€ä¸ªç”¨æ¥åœ¨å®¢æˆ·æœºä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œç®€å•æ–‡ä»¶ä¼ è¾“çš„åè®®ï¼Œæä¾›ä¸å¤æ‚ã€å¼€é”€ä¸å¤§çš„æ–‡ä»¶ä¼ è¾“æœåŠ¡ã€‚ç«¯å£å·ä¸º 69ã€‚</p>
</li>
<li><p><strong>è¿œç¨‹ç»ˆç«¯åè®®ï¼ˆTELNETï¼‰</strong>ï¼šTelnet åè®®æ˜¯ TCP&#x2F;IP åè®®æ—ä¸­çš„ä¸€å‘˜ï¼Œæ˜¯ Internet è¿œç¨‹ç™»é™†æœåŠ¡çš„æ ‡å‡†åè®®å’Œä¸»è¦æ–¹å¼ã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå®Œæˆè¿œç¨‹ä¸»æœºå·¥ä½œçš„èƒ½åŠ›ã€‚åœ¨ç»ˆç«¯ä½¿ç”¨è€…çš„ç”µè„‘ä¸Šä½¿ç”¨ telnet ç¨‹åºï¼Œç”¨å®ƒè¿æ¥åˆ°æœåŠ¡å™¨ã€‚ç»ˆç«¯ä½¿ç”¨è€…å¯ä»¥åœ¨ telnet ç¨‹åºä¸­è¾“å…¥å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¼šåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå°±åƒç›´æ¥åœ¨æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸Šè¾“å…¥ä¸€æ ·ã€‚å¯ä»¥åœ¨æœ¬åœ°å°±èƒ½æ§åˆ¶æœåŠ¡å™¨ã€‚è¦å¼€å§‹ä¸€ä¸ª telnet ä¼šè¯ï¼Œå¿…é¡»è¾“å…¥ç”¨æˆ·åå’Œå¯†ç æ¥ç™»å½•æœåŠ¡å™¨ã€‚Telnet æ˜¯å¸¸ç”¨çš„è¿œç¨‹æ§åˆ¶ Web æœåŠ¡å™¨çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>ä¸‡ç»´ç½‘ï¼ˆWWWï¼‰</strong>ï¼šWWW æ˜¯ç¯çƒä¿¡æ¯ç½‘çš„ç¼©å†™ï¼Œï¼ˆäº¦ä½œâ€œWebâ€ã€â€œWWWâ€ã€â€œâ€™W3â€™â€ï¼Œè‹±æ–‡å…¨ç§°ä¸ºâ€œWorld Wide Webâ€ï¼‰ï¼Œä¸­æ–‡åå­—ä¸ºâ€œä¸‡ç»´ç½‘â€ï¼Œâ€ç¯çƒç½‘â€ç­‰ï¼Œå¸¸ç®€ç§°ä¸º Webã€‚åˆ†ä¸º Web å®¢æˆ·ç«¯å’Œ Web æœåŠ¡å™¨ç¨‹åºã€‚WWW å¯ä»¥è®© Web å®¢æˆ·ç«¯ï¼ˆå¸¸ç”¨æµè§ˆå™¨ï¼‰è®¿é—®æµè§ˆ Web æœåŠ¡å™¨ä¸Šçš„é¡µé¢ã€‚æ˜¯ä¸€ä¸ªç”±è®¸å¤šäº’ç›¸é“¾æ¥çš„è¶…æ–‡æœ¬ç»„æˆçš„ç³»ç»Ÿï¼Œé€šè¿‡äº’è”ç½‘è®¿é—®ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæœ‰ç”¨çš„äº‹ç‰©ï¼Œç§°ä¸ºä¸€æ ·â€œèµ„æºâ€ï¼›å¹¶ä¸”ç”±ä¸€ä¸ªå…¨å±€â€œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦â€ï¼ˆURIï¼‰æ ‡è¯†ï¼›è¿™äº›èµ„æºé€šè¿‡è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHypertext Transfer Protocolï¼‰ä¼ é€ç»™ç”¨æˆ·ï¼Œè€Œåè€…é€šè¿‡ç‚¹å‡»é“¾æ¥æ¥è·å¾—èµ„æºã€‚ä¸‡ç»´ç½‘è”ç›Ÿï¼ˆè‹±è¯­ï¼šWorld Wide Web Consortiumï¼Œç®€ç§° W3Cï¼‰ï¼Œåˆç§° W3C ç†äº‹ä¼šã€‚1994 å¹´ 10 æœˆåœ¨éº»çœç†å·¥å­¦é™¢ï¼ˆMITï¼‰è®¡ç®—æœºç§‘å­¦å®éªŒå®¤æˆç«‹ã€‚ä¸‡ç»´ç½‘è”ç›Ÿçš„åˆ›å»ºè€…æ˜¯ä¸‡ç»´ç½‘çš„å‘æ˜è€…è’‚å§†Â·ä¼¯çº³æ–¯-æã€‚ä¸‡ç»´ç½‘å¹¶ä¸ç­‰åŒäº’è”ç½‘ï¼Œä¸‡ç»´ç½‘åªæ˜¯äº’è”ç½‘æ‰€èƒ½æä¾›çš„æœåŠ¡å…¶ä¸­ä¹‹ä¸€ï¼Œæ˜¯é ç€äº’è”ç½‘è¿è¡Œçš„ä¸€é¡¹æœåŠ¡ã€‚</p>
</li>
<li><p><strong>ä¸‡ç»´ç½‘çš„å¤§è‡´å·¥ä½œå·¥ç¨‹ï¼š</strong></p>
<p><img src="https://oss.javaguide.cn/p3-juejin/ba628fd37fdc4ba59c1a74eae32e03b1~tplv-k3u1fbpfcp-zoom-1.jpeg" alt="ä¸‡ç»´ç½‘çš„å¤§è‡´å·¥ä½œå·¥ç¨‹"></p>
</li>
<li><p><strong>ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰</strong>ï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦æ˜¯å¯¹å¯ä»¥ä»äº’è”ç½‘ä¸Šå¾—åˆ°çš„èµ„æºçš„ä½ç½®å’Œè®¿é—®æ–¹æ³•çš„ä¸€ç§ç®€æ´çš„è¡¨ç¤ºï¼Œæ˜¯äº’è”ç½‘ä¸Šæ ‡å‡†èµ„æºçš„åœ°å€ã€‚äº’è”ç½‘ä¸Šçš„æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ URLï¼Œå®ƒåŒ…å«çš„ä¿¡æ¯æŒ‡å‡ºæ–‡ä»¶çš„ä½ç½®ä»¥åŠæµè§ˆå™¨åº”è¯¥æ€ä¹ˆå¤„ç†å®ƒã€‚</p>
</li>
<li><p><strong>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰</strong>ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚æ‰€æœ‰çš„ WWW æ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡ HTTP æœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶ HTML é¡µé¢çš„æ–¹æ³•ã€‚1960 å¹´ç¾å›½äºº Ted Nelson æ„æ€äº†ä¸€ç§é€šè¿‡è®¡ç®—æœºå¤„ç†æ–‡æœ¬ä¿¡æ¯çš„æ–¹æ³•ï¼Œå¹¶ç§°ä¹‹ä¸ºè¶…æ–‡æœ¬ï¼ˆhypertextï¼‰,è¿™æˆä¸ºäº† HTTP è¶…æ–‡æœ¬ä¼ è¾“åè®®æ ‡å‡†æ¶æ„çš„å‘å±•æ ¹åŸºã€‚</p>
<p>HTTP åè®®çš„æœ¬è´¨å°±æ˜¯ä¸€ç§æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çº¦å®šå¥½çš„é€šä¿¡æ ¼å¼ã€‚HTTP çš„åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/8e3efca026654874bde8be88c96e1783~tplv-k3u1fbpfcp-zoom-1.jpeg"></p>
</li>
<li><p><strong>ä»£ç†æœåŠ¡å™¨ï¼ˆProxy Serverï¼‰</strong>ï¼šä»£ç†æœåŠ¡å™¨ï¼ˆProxy Serverï¼‰æ˜¯ä¸€ç§ç½‘ç»œå®ä½“ï¼Œå®ƒåˆç§°ä¸ºä¸‡ç»´ç½‘é«˜é€Ÿç¼“å­˜ã€‚ ä»£ç†æœåŠ¡å™¨æŠŠæœ€è¿‘çš„ä¸€äº›è¯·æ±‚å’Œå“åº”æš‚å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸­ã€‚å½“æ–°è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œè‹¥ä»£ç†æœåŠ¡å™¨å‘ç°è¿™ä¸ªè¯·æ±‚ä¸æš‚æ—¶å­˜æ”¾çš„çš„è¯·æ±‚ç›¸åŒï¼Œå°±è¿”å›æš‚å­˜çš„å“åº”ï¼Œè€Œä¸éœ€è¦æŒ‰ URL çš„åœ°å€å†æ¬¡å»äº’è”ç½‘è®¿é—®è¯¥èµ„æºã€‚ä»£ç†æœåŠ¡å™¨å¯åœ¨å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å·¥ä½œï¼Œä¹Ÿå¯ä»¥åœ¨ä¸­é—´ç³»ç»Ÿå·¥ä½œã€‚</p>
</li>
<li><p><strong>ç®€å•é‚®ä»¶ä¼ è¾“åè®®(SMTP)</strong> : SMTPï¼ˆSimple Mail Transfer Protocolï¼‰å³ç®€å•é‚®ä»¶ä¼ è¾“åè®®,å®ƒæ˜¯ä¸€ç»„ç”¨äºç”±æºåœ°å€åˆ°ç›®çš„åœ°å€ä¼ é€é‚®ä»¶çš„è§„åˆ™ï¼Œç”±å®ƒæ¥æ§åˆ¶ä¿¡ä»¶çš„ä¸­è½¬æ–¹å¼ã€‚ SMTP åè®®å±äº TCP&#x2F;IP åè®®ç°‡ï¼Œå®ƒå¸®åŠ©æ¯å°è®¡ç®—æœºåœ¨å‘é€æˆ–ä¸­è½¬ä¿¡ä»¶æ—¶æ‰¾åˆ°ä¸‹ä¸€ä¸ªç›®çš„åœ°ã€‚ é€šè¿‡ SMTP åè®®æ‰€æŒ‡å®šçš„æœåŠ¡å™¨,å°±å¯ä»¥æŠŠ E-mail å¯„åˆ°æ”¶ä¿¡äººçš„æœåŠ¡å™¨ä¸Šäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹åªè¦å‡ åˆ†é’Ÿã€‚SMTP æœåŠ¡å™¨åˆ™æ˜¯éµå¾ª SMTP åè®®çš„å‘é€é‚®ä»¶æœåŠ¡å™¨ï¼Œç”¨æ¥å‘é€æˆ–ä¸­è½¬å‘å‡ºçš„ç”µå­é‚®ä»¶ã€‚</p>
<p><img src="https://oss.javaguide.cn/p3-juejin/2bdccb760474435aae52559f2ef9652f~tplv-k3u1fbpfcp-zoom-1.png" alt="ä¸€ä¸ªç”µå­é‚®ä»¶è¢«å‘é€çš„è¿‡ç¨‹"></p>
<p style="text-align:right;font-size:12px">https://www.campaignmonitor.com/resources/knowledge-base/what-is-the-code-that-makes-bcc-or-cc-operate-in-an-email/</p>
</li>
<li><p><strong>æœç´¢å¼•æ“</strong> :æœç´¢å¼•æ“ï¼ˆSearch Engineï¼‰æ˜¯æŒ‡æ ¹æ®ä¸€å®šçš„ç­–ç•¥ã€è¿ç”¨ç‰¹å®šçš„è®¡ç®—æœºç¨‹åºä»äº’è”ç½‘ä¸Šæœé›†ä¿¡æ¯ï¼Œåœ¨å¯¹ä¿¡æ¯è¿›è¡Œç»„ç»‡å’Œå¤„ç†åï¼Œä¸ºç”¨æˆ·æä¾›æ£€ç´¢æœåŠ¡ï¼Œå°†ç”¨æˆ·æ£€ç´¢ç›¸å…³çš„ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·çš„ç³»ç»Ÿã€‚æœç´¢å¼•æ“åŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€ç›®å½•ç´¢å¼•ã€å…ƒæœç´¢å¼•æ“ã€å‚ç›´æœç´¢å¼•æ“ã€é›†åˆå¼æœç´¢å¼•æ“ã€é—¨æˆ·æœç´¢å¼•æ“ä¸å…è´¹é“¾æ¥åˆ—è¡¨ç­‰ã€‚</p>
</li>
<li><p><strong>å‚ç›´æœç´¢å¼•æ“</strong>ï¼šå‚ç›´æœç´¢å¼•æ“æ˜¯é’ˆå¯¹æŸä¸€ä¸ªè¡Œä¸šçš„ä¸“ä¸šæœç´¢å¼•æ“ï¼Œæ˜¯æœç´¢å¼•æ“çš„ç»†åˆ†å’Œå»¶ä¼¸ï¼Œæ˜¯å¯¹ç½‘é¡µåº“ä¸­çš„æŸç±»ä¸“é—¨çš„ä¿¡æ¯è¿›è¡Œä¸€æ¬¡æ•´åˆï¼Œå®šå‘åˆ†å­—æ®µæŠ½å–å‡ºéœ€è¦çš„æ•°æ®è¿›è¡Œå¤„ç†åå†ä»¥æŸç§å½¢å¼è¿”å›ç»™ç”¨æˆ·ã€‚å‚ç›´æœç´¢æ˜¯ç›¸å¯¹é€šç”¨æœç´¢å¼•æ“çš„ä¿¡æ¯é‡å¤§ã€æŸ¥è¯¢ä¸å‡†ç¡®ã€æ·±åº¦ä¸å¤Ÿç­‰æå‡ºæ¥çš„æ–°çš„æœç´¢å¼•æ“æœåŠ¡æ¨¡å¼ï¼Œé€šè¿‡é’ˆå¯¹æŸä¸€ç‰¹å®šé¢†åŸŸã€æŸä¸€ç‰¹å®šäººç¾¤æˆ–æŸä¸€ç‰¹å®šéœ€æ±‚æä¾›çš„æœ‰ä¸€å®šä»·å€¼çš„ä¿¡æ¯å’Œç›¸å…³æœåŠ¡ã€‚å…¶ç‰¹ç‚¹å°±æ˜¯â€œä¸“ã€ç²¾ã€æ·±â€ï¼Œä¸”å…·æœ‰è¡Œä¸šè‰²å½©ï¼Œç›¸æ¯”è¾ƒé€šç”¨æœç´¢å¼•æ“çš„æµ·é‡ä¿¡æ¯æ— åºåŒ–ï¼Œå‚ç›´æœç´¢å¼•æ“åˆ™æ˜¾å¾—æ›´åŠ ä¸“æ³¨ã€å…·ä½“å’Œæ·±å…¥ã€‚</p>
</li>
<li><p><strong>å…¨æ–‡ç´¢å¼•</strong> :å…¨æ–‡ç´¢å¼•æŠ€æœ¯æ˜¯ç›®å‰æœç´¢å¼•æ“çš„å…³é”®æŠ€æœ¯ã€‚è¯•æƒ³åœ¨ 1M å¤§å°çš„æ–‡ä»¶ä¸­æœç´¢ä¸€ä¸ªè¯ï¼Œå¯èƒ½éœ€è¦å‡ ç§’ï¼Œåœ¨ 100M çš„æ–‡ä»¶ä¸­å¯èƒ½éœ€è¦å‡ åç§’ï¼Œå¦‚æœåœ¨æ›´å¤§çš„æ–‡ä»¶ä¸­æœç´¢é‚£ä¹ˆå°±éœ€è¦æ›´å¤§çš„ç³»ç»Ÿå¼€é”€ï¼Œè¿™æ ·çš„å¼€é”€æ˜¯ä¸ç°å®çš„ã€‚æ‰€ä»¥åœ¨è¿™æ ·çš„çŸ›ç›¾ä¸‹å‡ºç°äº†å…¨æ–‡ç´¢å¼•æŠ€æœ¯ï¼Œæœ‰æ—¶å€™æœ‰äººå«å€’æ’æ–‡æ¡£æŠ€æœ¯ã€‚</p>
</li>
<li><p><strong>ç›®å½•ç´¢å¼•</strong>ï¼šç›®å½•ç´¢å¼•ï¼ˆ search index&#x2F;directory)ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å°†ç½‘ç«™åˆ†é—¨åˆ«ç±»åœ°å­˜æ”¾åœ¨ç›¸åº”çš„ç›®å½•ä¸­ï¼Œå› æ­¤ç”¨æˆ·åœ¨æŸ¥è¯¢ä¿¡æ¯æ—¶ï¼Œå¯é€‰æ‹©å…³é”®è¯æœç´¢ï¼Œä¹Ÿå¯æŒ‰åˆ†ç±»ç›®å½•é€å±‚æŸ¥æ‰¾ã€‚</p>
</li>
</ol>
<h3 id="6-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#6-2-é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="6.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“"></a>6.2. é‡è¦çŸ¥è¯†ç‚¹æ€»ç»“</h3><ol>
<li>æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰ä½¿ç”¨ TCP å¯é çš„è¿è¾“æœåŠ¡ã€‚FTP ä½¿ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ã€‚ä¸€ä¸ª FTP æœåŠ¡å™¨è¿›ç¨‹å¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªç”¨æˆ·æä¾›æœåŠ¡ã€‚åœ¨è¿›è¡Œæ–‡ä»¶ä¼ è¾“æ—¶ï¼ŒFTP çš„å®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´è¦å…ˆå»ºç«‹ä¸¤ä¸ªå¹¶è¡Œçš„ TCP è¿æ¥:æ§åˆ¶è¿æ¥å’Œæ•°æ®è¿æ¥ã€‚å®é™…ç”¨äºä¼ è¾“æ–‡ä»¶çš„æ˜¯æ•°æ®è¿æ¥ã€‚</li>
<li>ä¸‡ç»´ç½‘å®¢æˆ·ç¨‹åºä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œäº¤äº’ä½¿ç”¨çš„åè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® HTTPã€‚HTTP ä½¿ç”¨ TCP è¿æ¥è¿›è¡Œå¯é ä¼ è¾“ã€‚ä½† HTTP æœ¬èº«æ˜¯æ— è¿æ¥ã€æ— çŠ¶æ€çš„ã€‚HTTP&#x2F;1.1 åè®®ä½¿ç”¨äº†æŒç»­è¿æ¥ï¼ˆåˆ†ä¸ºéæµæ°´çº¿æ–¹å¼å’Œæµæ°´çº¿æ–¹å¼ï¼‰</li>
<li>ç”µå­é‚®ä»¶æŠŠé‚®ä»¶å‘é€åˆ°æ”¶ä»¶äººä½¿ç”¨çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œå¹¶æ”¾åœ¨å…¶ä¸­çš„æ”¶ä»¶äººé‚®ç®±ä¸­ï¼Œæ”¶ä»¶äººå¯éšæ—¶ä¸Šç½‘åˆ°è‡ªå·±ä½¿ç”¨çš„é‚®ä»¶æœåŠ¡å™¨è¯»å–ï¼Œç›¸å½“äºç”µå­é‚®ç®±ã€‚</li>
<li>ä¸€ä¸ªç”µå­é‚®ä»¶ç³»ç»Ÿæœ‰ä¸‰ä¸ªé‡è¦ç»„æˆæ„ä»¶ï¼šç”¨æˆ·ä»£ç†ã€é‚®ä»¶æœåŠ¡å™¨ã€é‚®ä»¶åè®®ï¼ˆåŒ…æ‹¬é‚®ä»¶å‘é€åè®®ï¼Œå¦‚ SMTPï¼Œå’Œé‚®ä»¶è¯»å–åè®®ï¼Œå¦‚ POP3 å’Œ IMAPï¼‰ã€‚ç”¨æˆ·ä»£ç†å’Œé‚®ä»¶æœåŠ¡å™¨éƒ½è¦è¿è¡Œè¿™äº›åè®®ã€‚</li>
</ol>
<h3 id="6-3-è¡¥å……ï¼ˆé‡è¦ï¼‰"><a href="#6-3-è¡¥å……ï¼ˆé‡è¦ï¼‰" class="headerlink" title="6.3. è¡¥å……ï¼ˆé‡è¦ï¼‰"></a>6.3. è¡¥å……ï¼ˆé‡è¦ï¼‰</h3><p>ä»¥ä¸‹çŸ¥è¯†ç‚¹éœ€è¦é‡ç‚¹å…³æ³¨ï¼š</p>
<ol>
<li>åº”ç”¨å±‚çš„å¸¸è§åè®®ï¼ˆé‡ç‚¹å…³æ³¨ HTTP åè®®ï¼‰</li>
<li>åŸŸåç³»ç»Ÿ-ä»åŸŸåè§£æå‡º IP åœ°å€</li>
<li>è®¿é—®ä¸€ä¸ªç½‘ç«™å¤§è‡´çš„è¿‡ç¨‹</li>
<li>ç³»ç»Ÿè°ƒç”¨å’Œåº”ç”¨ç¼–ç¨‹æ¥å£æ¦‚å¿µ</li>
</ol>
<!-- @include: @article-footer.snippet.md -->

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/17/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">264</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/JayVae" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/shi-hai-jie-35" target="_blank" title="Zhihu">
                      
                        <i class="fa fa-fw fa-globe"></i>Zhihu</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="wechat" target="_blank" title="Wechat">
                      
                        <i class="fa fa-fw fa-globe"></i>Wechat</a>
                  </span>
                
            </div>
          

		  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=554191378&auto=1&height=66"></iframe>
		  
          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å²æµ·æ°</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">722k</span>
  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("SWULgkVHBjhFp99nBHCr8oHC-gzGzoHsz", "DQQN5XsGzlq3PIf1OSvGvoRR");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
